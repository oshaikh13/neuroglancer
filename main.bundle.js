/*

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 JS Signals <http://millermedeiros.github.com/js-signals/>
 Released under the MIT license
 Author: Miller Medeiros
 Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 MIT

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
var $jscomp={scope:{},getGlobal:function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global?global:g}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(g){return"jscomp_symbol_"+g+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
$jscomp.makeIterator=function(g){$jscomp.initSymbolIterator();if(g[$jscomp.global.Symbol.iterator])return g[$jscomp.global.Symbol.iterator]();if(!(g instanceof Array||"string"==typeof g||g instanceof String))throw new TypeError(g+" is not iterable");var d=0;return{next:function(){return d==g.length?{done:!0}:{done:!1,value:g[d++]}}}};$jscomp.arrayFromIterator=function(g){for(var d,e=[];!(d=g.next()).done;)e.push(d.value);return e};
$jscomp.arrayFromIterable=function(g){return g instanceof Array?g:$jscomp.arrayFromIterator($jscomp.makeIterator(g))};$jscomp.arrayFromArguments=function(g){for(var d=[],e=0;e<g.length;e++)d.push(g[e]);return d};$jscomp.inherits=function(g,d){function e(){}e.prototype=d.prototype;g.prototype=new e;g.prototype.constructor=g;for(var k in d)if($jscomp.global.Object.defineProperties){var b=$jscomp.global.Object.getOwnPropertyDescriptor(d,k);$jscomp.global.Object.defineProperty(g,k,b)}else g[k]=d[k]};
$jscomp.array=$jscomp.array||{};$jscomp.array.done_=function(){return{done:!0,value:void 0}};$jscomp.array.arrayIterator_=function(g,d){g instanceof String&&(g=String(g));var e=0;$jscomp.initSymbol();$jscomp.initSymbolIterator();var k={},b=(k.next=function(){if(e<g.length){var a=e++;return{value:d(a,g[a]),done:!1}}b.next=$jscomp.array.done_;return $jscomp.array.done_()},k[Symbol.iterator]=function(){return b},k);return b};
$jscomp.array.findInternal_=function(g,d,e){g instanceof String&&(g=String(g));for(var k=g.length,b=0;b<k;b++){var a=g[b];if(d.call(e,a,b,g))return{i:b,v:a}}return{i:-1,v:void 0}};
$jscomp.array.from=function(g,d,e){d=void 0===d?function(a){return a}:d;var k=[];$jscomp.initSymbol();$jscomp.initSymbolIterator();if(g[Symbol.iterator]){$jscomp.initSymbol();$jscomp.initSymbolIterator();g=g[Symbol.iterator]();for(var b;!(b=g.next()).done;)k.push(d.call(e,b.value))}else{b=g.length;for(var a=0;a<b;a++)k.push(d.call(e,g[a]))}return k};$jscomp.array.of=function(g){for(var d=[],e=0;e<arguments.length;++e)d[e-0]=arguments[e];return $jscomp.array.from(d)};
$jscomp.array.entries=function(){return $jscomp.array.arrayIterator_(this,function(g,d){return[g,d]})};$jscomp.array.entries$install=function(){Array.prototype.entries||(Array.prototype.entries=$jscomp.array.entries)};$jscomp.array.keys=function(){return $jscomp.array.arrayIterator_(this,function(g){return g})};$jscomp.array.keys$install=function(){Array.prototype.keys||(Array.prototype.keys=$jscomp.array.keys)};$jscomp.array.values=function(){return $jscomp.array.arrayIterator_(this,function(g,d){return d})};
$jscomp.array.values$install=function(){Array.prototype.values||(Array.prototype.values=$jscomp.array.values)};$jscomp.array.copyWithin=function(g,d,e){var k=this.length;g=Number(g);d=Number(d);e=Number(null!=e?e:k);if(g<d)for(e=Math.min(e,k);d<e;)d in this?this[g++]=this[d++]:(delete this[g++],d++);else for(e=Math.min(e,k+d-g),g+=e-d;e>d;)--e in this?this[--g]=this[e]:delete this[g];return this};$jscomp.array.copyWithin$install=function(){Array.prototype.copyWithin||(Array.prototype.copyWithin=$jscomp.array.copyWithin)};
$jscomp.array.fill=function(g,d,e){null!=e&&g.length||(e=this.length||0);e=Number(e);for(d=Number((void 0===d?0:d)||0);d<e;d++)this[d]=g;return this};$jscomp.array.fill$install=function(){Array.prototype.fill||(Array.prototype.fill=$jscomp.array.fill)};$jscomp.array.find=function(g,d){return $jscomp.array.findInternal_(this,g,d).v};$jscomp.array.find$install=function(){Array.prototype.find||(Array.prototype.find=$jscomp.array.find)};
$jscomp.array.findIndex=function(g,d){return $jscomp.array.findInternal_(this,g,d).i};$jscomp.array.findIndex$install=function(){Array.prototype.findIndex||(Array.prototype.findIndex=$jscomp.array.findIndex)};$jscomp.Map=function(g){g=void 0===g?[]:g;this.data_={};this.head_=$jscomp.Map.createHead_();this.size=0;if(g){g=$jscomp.makeIterator(g);for(var d=g.next();!d.done;d=g.next())d=d.value,this.set(d[0],d[1])}};
$jscomp.Map.checkBrowserConformance_=function(){var g=$jscomp.global.Map;if(!g||!g.prototype.entries||!Object.seal)return!1;try{var d=Object.seal({x:4}),e=new g($jscomp.makeIterator([[d,"s"]]));if("s"!=e.get(d)||1!=e.size||e.get({x:4})||e.set({x:4},"t")!=e||2!=e.size)return!1;var k=e.entries(),b=k.next();if(b.done||b.value[0]!=d||"s"!=b.value[1])return!1;b=k.next();return b.done||4!=b.value[0].x||"t"!=b.value[1]||!k.next().done?!1:!0}catch(a){return!1}};
$jscomp.Map.createHead_=function(){var g={};return g.previous=g.next=g.head=g};$jscomp.Map.getId_=function(g){if(!(g instanceof Object))return String(g);$jscomp.Map.key_ in g||g instanceof Object&&Object.isExtensible&&Object.isExtensible(g)&&$jscomp.Map.defineProperty_(g,$jscomp.Map.key_,++$jscomp.Map.index_);return $jscomp.Map.key_ in g?g[$jscomp.Map.key_]:" "+g};
$jscomp.Map.prototype.set=function(g,d){var e=this.maybeGetEntry_(g),k=e.id,b=e.list,e=e.entry;b||(b=this.data_[k]=[]);e?e.value=d:(e={next:this.head_,previous:this.head_.previous,head:this.head_,key:g,value:d},b.push(e),this.head_.previous.next=e,this.head_.previous=e,this.size++);return this};
$jscomp.Map.prototype["delete"]=function(g){var d=this.maybeGetEntry_(g);g=d.id;var e=d.list,k=d.index;return(d=d.entry)&&e?(e.splice(k,1),e.length||delete this.data_[g],d.previous.next=d.next,d.next.previous=d.previous,d.head=null,this.size--,!0):!1};$jscomp.Map.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=$jscomp.Map.createHead_();this.size=0};$jscomp.Map.prototype.has=function(g){return!!this.maybeGetEntry_(g).entry};
$jscomp.Map.prototype.get=function(g){return(g=this.maybeGetEntry_(g).entry)&&g.value};$jscomp.Map.prototype.maybeGetEntry_=function(g){var d=$jscomp.Map.getId_(g),e=this.data_[d];if(e)for(var k=0;k<e.length;k++){var b=e[k];if(g!==g&&b.key!==b.key||g===b.key)return{id:d,list:e,index:k,entry:b}}return{id:d,list:e,index:-1,entry:void 0}};$jscomp.Map.prototype.entries=function(){return this.iter_(function(g){return[g.key,g.value]})};$jscomp.Map.prototype.keys=function(){return this.iter_(function(g){return g.key})};
$jscomp.Map.prototype.values=function(){return this.iter_(function(g){return g.value})};$jscomp.Map.prototype.forEach=function(g,d){for(var e=$jscomp.makeIterator(this.entries()),k=e.next();!k.done;k=e.next())k=k.value,g.call(d,k[1],k[0],this)};
$jscomp.Map.prototype.iter_=function(g){var d=this,e=this.head_;$jscomp.initSymbol();$jscomp.initSymbolIterator();var k={};return k.next=function(){if(e){for(;e.head!=d.head_;)e=e.previous;for(;e.next!=e.head;)return e=e.next,{done:!1,value:g(e)};e=null}return{done:!0,value:void 0}},k[Symbol.iterator]=function(){return this},k};$jscomp.Map.index_=0;$jscomp.Map.defineProperty_=Object.defineProperty?function(g,d,e){Object.defineProperty(g,d,{value:String(e)})}:function(g,d,e){g[d]=String(e)};
$jscomp.Map.Entry_=function(){};$jscomp.Map.ASSUME_NO_NATIVE=!1;$jscomp.Map$install=function(){$jscomp.initSymbol();$jscomp.initSymbolIterator();!$jscomp.Map.ASSUME_NO_NATIVE&&$jscomp.Map.checkBrowserConformance_()?$jscomp.Map=$jscomp.global.Map:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Map.prototype[Symbol.iterator]=$jscomp.Map.prototype.entries,$jscomp.initSymbol(),$jscomp.Map.key_=Symbol("map-id-key"));$jscomp.Map$install=function(){}};$jscomp.math=$jscomp.math||{};
$jscomp.math.clz32=function(g){g=Number(g)>>>0;if(0===g)return 32;var d=0;0===(g&4294901760)&&(g<<=16,d+=16);0===(g&4278190080)&&(g<<=8,d+=8);0===(g&4026531840)&&(g<<=4,d+=4);0===(g&3221225472)&&(g<<=2,d+=2);0===(g&2147483648)&&d++;return d};$jscomp.math.imul=function(g,d){g=Number(g);d=Number(d);var e=g&65535,k=d&65535;return e*k+((g>>>16&65535)*k+e*(d>>>16&65535)<<16>>>0)|0};$jscomp.math.sign=function(g){g=Number(g);return 0===g||isNaN(g)?g:0<g?1:-1};
$jscomp.math.log10=function(g){return Math.log(g)/Math.LN10};$jscomp.math.log2=function(g){return Math.log(g)/Math.LN2};$jscomp.math.log1p=function(g){g=Number(g);if(.25>g&&-.25<g){for(var d=g,e=1,k=g,b=0,a=1;b!=k;)d*=g,a*=-1,k=(b=k)+a*d/++e;return k}return Math.log(1+g)};$jscomp.math.expm1=function(g){g=Number(g);if(.25>g&&-.25<g){for(var d=g,e=1,k=g,b=0;b!=k;)d*=g/++e,k=(b=k)+d;return k}return Math.exp(g)-1};$jscomp.math.cosh=function(g){g=Number(g);return(Math.exp(g)+Math.exp(-g))/2};
$jscomp.math.sinh=function(g){g=Number(g);return 0===g?g:(Math.exp(g)-Math.exp(-g))/2};$jscomp.math.tanh=function(g){g=Number(g);if(0===g)return g;var d=Math.exp(2*-Math.abs(g)),d=(1-d)/(1+d);return 0>g?-d:d};$jscomp.math.acosh=function(g){g=Number(g);return Math.log(g+Math.sqrt(g*g-1))};$jscomp.math.asinh=function(g){g=Number(g);if(0===g)return g;var d=Math.log(Math.abs(g)+Math.sqrt(g*g+1));return 0>g?-d:d};
$jscomp.math.atanh=function(g){g=Number(g);return($jscomp.math.log1p(g)-$jscomp.math.log1p(-g))/2};
$jscomp.math.hypot=function(g,d,e){for(var k=[],b=2;b<arguments.length;++b)k[b-2]=arguments[b];g=Number(g);d=Number(d);for(var a=Math.max(Math.abs(g),Math.abs(d)),c=$jscomp.makeIterator(k),b=c.next();!b.done;b=c.next())a=Math.max(a,Math.abs(b.value));if(1E100<a||1E-100>a){g/=a;d/=a;c=g*g+d*d;k=$jscomp.makeIterator(k);for(b=k.next();!b.done;b=k.next())b=b.value,b=Number(b)/a,c+=b*b;return Math.sqrt(c)*a}a=g*g+d*d;k=$jscomp.makeIterator(k);for(b=k.next();!b.done;b=k.next())b=b.value,a+=b*b;return Math.sqrt(a)};
$jscomp.math.trunc=function(g){g=Number(g);if(isNaN(g)||Infinity===g||-Infinity===g||0===g)return g;var d=Math.floor(Math.abs(g));return 0>g?-d:d};$jscomp.math.cbrt=function(g){if(0===g)return g;g=Number(g);var d=Math.pow(Math.abs(g),1/3);return 0>g?-d:d};$jscomp.number=$jscomp.number||{};$jscomp.number.isFinite=function(g){return"number"!==typeof g?!1:!isNaN(g)&&Infinity!==g&&-Infinity!==g};$jscomp.number.isInteger=function(g){return $jscomp.number.isFinite(g)?g===Math.floor(g):!1};
$jscomp.number.isNaN=function(g){return"number"===typeof g&&isNaN(g)};$jscomp.number.isSafeInteger=function(g){return $jscomp.number.isInteger(g)&&Math.abs(g)<=$jscomp.number.MAX_SAFE_INTEGER};$jscomp.number.EPSILON=Math.pow(2,-52);$jscomp.number.MAX_SAFE_INTEGER=9007199254740991;$jscomp.number.MIN_SAFE_INTEGER=-9007199254740991;$jscomp.object=$jscomp.object||{};
$jscomp.object.assign=function(g,d){for(var e=[],k=1;k<arguments.length;++k)e[k-1]=arguments[k];e=$jscomp.makeIterator(e);for(k=e.next();!k.done;k=e.next()){var k=k.value,b;for(b in k)Object.prototype.hasOwnProperty.call(k,b)&&(g[b]=k[b])}return g};$jscomp.object.is=function(g,d){return g===d?0!==g||1/g===1/d:g!==g&&d!==d};$jscomp.Set=function(g){g=void 0===g?[]:g;this.map_=new $jscomp.Map;if(g){g=$jscomp.makeIterator(g);for(var d=g.next();!d.done;d=g.next())this.add(d.value)}this.size=this.map_.size};
$jscomp.Set.checkBrowserConformance_=function(){var g=$jscomp.global.Set;if(!g||!g.prototype.entries||!Object.seal)return!1;var d=Object.seal({x:4}),g=new g($jscomp.makeIterator([d]));if(g.has(d)||1!=g.size||g.add(d)!=g||1!=g.size||g.add({x:4})!=g||2!=g.size)return!1;var g=g.entries(),e=g.next();if(e.done||e.value[0]!=d||e.value[1]!=d)return!1;e=g.next();return e.done||e.value[0]==d||4!=e.value[0].x||e.value[1]!=e.value[0]?!1:g.next().done};
$jscomp.Set.prototype.add=function(g){this.map_.set(g,g);this.size=this.map_.size;return this};$jscomp.Set.prototype["delete"]=function(g){g=this.map_["delete"](g);this.size=this.map_.size;return g};$jscomp.Set.prototype.clear=function(){this.map_.clear();this.size=0};$jscomp.Set.prototype.has=function(g){return this.map_.has(g)};$jscomp.Set.prototype.entries=function(){return this.map_.entries()};$jscomp.Set.prototype.values=function(){return this.map_.values()};
$jscomp.Set.prototype.forEach=function(g,d){var e=this;this.map_.forEach(function(k){return g.call(d,k,k,e)})};$jscomp.Set.ASSUME_NO_NATIVE=!1;$jscomp.Set$install=function(){!$jscomp.Set.ASSUME_NO_NATIVE&&$jscomp.Set.checkBrowserConformance_()?$jscomp.Set=$jscomp.global.Set:($jscomp.Map$install(),$jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Set.prototype[Symbol.iterator]=$jscomp.Set.prototype.values);$jscomp.Set$install=function(){}};$jscomp.string=$jscomp.string||{};
$jscomp.string.noRegExp_=function(g,d){if(g instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");};
$jscomp.string.fromCodePoint=function(g){for(var d=[],e=0;e<arguments.length;++e)d[e-0]=arguments[e];for(var e="",d=$jscomp.makeIterator(d),k=d.next();!k.done;k=d.next()){k=k.value;k=+k;if(0>k||1114111<k||k!==Math.floor(k))throw new RangeError("invalid_code_point "+k);65535>=k?e+=String.fromCharCode(k):(k-=65536,e+=String.fromCharCode(k>>>10&1023|55296),e+=String.fromCharCode(k&1023|56320))}return e};
$jscomp.string.repeat=function(g){var d=this.toString();if(0>g||1342177279<g)throw new RangeError("Invalid count value");g|=0;for(var e="";g;)if(g&1&&(e+=d),g>>>=1)d+=d;return e};$jscomp.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=$jscomp.string.repeat)};
$jscomp.string.codePointAt=function(g){var d=this.toString(),e=d.length;g=Number(g)||0;if(0<=g&&g<e){g|=0;var k=d.charCodeAt(g);if(55296>k||56319<k||g+1===e)return k;g=d.charCodeAt(g+1);return 56320>g||57343<g?k:1024*(k-55296)+g+9216}};$jscomp.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=$jscomp.string.codePointAt)};
$jscomp.string.includes=function(g,d){d=void 0===d?0:d;$jscomp.string.noRegExp_(g,"includes");return-1!==this.toString().indexOf(g,d)};$jscomp.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=$jscomp.string.includes)};
$jscomp.string.startsWith=function(g,d){d=void 0===d?0:d;$jscomp.string.noRegExp_(g,"startsWith");var e=this.toString();g+="";for(var k=e.length,b=g.length,a=Math.max(0,Math.min(d|0,e.length)),c=0;c<b&&a<k;)if(e[a++]!=g[c++])return!1;return c>=b};$jscomp.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=$jscomp.string.startsWith)};
$jscomp.string.endsWith=function(g,d){$jscomp.string.noRegExp_(g,"endsWith");var e=this.toString();g+="";void 0===d&&(d=e.length);for(var k=Math.max(0,Math.min(d|0,e.length)),b=g.length;0<b&&0<k;)if(e[--k]!=g[--b])return!1;return 0>=b};$jscomp.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=$jscomp.string.endsWith)};
(function(g){function d(k){if(e[k])return e[k].exports;var b=e[k]={exports:{},id:k,loaded:!1};g[k].call(b.exports,b,b.exports,d);b.loaded=!0;return b.exports}var e={};d.m=g;d.c=e;d.p="";return d(0)})([function(g,d,e){e(1);e(72);e(73);e(75);e(76);e(78);g.exports=e(79)},function(g,d,e){function k(a,c){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!c||"object"!==typeof c&&"function"!==typeof c?a:c}function b(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+
typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}function a(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function");}function c(a,c){return a.getChunkSource(F,t.stableStringify(c),function(){return new F(a,c)})}function f(a,c){var f=t.stableStringify({instance:a,key:c}),b=J.get(f);if(void 0!==b)return b;b=Promise.all([p.makeRequest(a,"GET",
"/v1beta2/volumes/"+c,"json"),p.makeRequest(a,"GET","/v1beta2/objects/"+c+"/meshes","json")]).then(function(f){f=h(f,2);return new G(a,c,f[0],f[1])});J.set(f,b);return b}function m(a){var c=P.get(a);if(void 0===c){var c=p.makeRequest(a,"GET","/v1beta2/volumes/","json").then(function(a){return new Q(a)}),f="Google "+p.INSTANCE_NAMES[a]+" volume list";v.StatusMessage.forPromise(c,{delay:!0,initialMessage:"Retrieving "+f+".",errorPrefix:"Error retrieving "+f+": "});P.set(a,c)}return c}function u(a,c){return m(a).then(function(a){var f=
c.lastIndexOf(":")+1,b=c.substring(0,f),f=c.substring(f);a=a.hierarchicalVolumeIds.get(b);return void 0===a?null:{offset:b.length,completions:y.getPrefixMatches(f,a)}})}function l(a){var c="brainmaps";a!==p.PRODUCTION_INSTANCE&&(c+="-"+p.INSTANCE_IDENTIFIERS[a].toLowerCase());q.registerDataSourceFactory(c,{description:"Google "+p.INSTANCE_NAMES[a]+" API",getVolume:f.bind(void 0,a),volumeCompleter:u.bind(void 0,a)})}var h=function(){return function(a,c){if(Array.isArray(a))return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var f=[],b=!0,m=!1,h=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var n=a[Symbol.iterator](),d;!(b=(d=n.next()).done)&&(f.push(d.value),!c||f.length!==c);b=!0);}catch(u){m=!0,h=u}finally{try{if(!b&&n["return"])n["return"]()}finally{if(m)throw h;}}return f}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),n=function(){function a(c,f){for(var b=0;b<f.length;b++){var m=f[b];m.enumerable=m.enumerable||
!1;m.configurable=!0;"value"in m&&(m.writable=!0);Object.defineProperty(c,m.key,m)}}return function(c,f,b){f&&a(c.prototype,f);b&&a(c,b);return c}}();e(2);var p=e(13),r=e(16),q=e(17);g=e(19);var w=e(59),x=e(56),v=e(4),y=e(18),A=e(22),t=e(11),B=new Map;B.set("UINT8",w.DataType.UINT8);B.set("FLOAT",w.DataType.FLOAT32);B.set("UINT64",w.DataType.UINT64);var D=function R(c){a(this,R);try{t.verifyObject(c),this.numChannels=t.verifyPositiveInt(c.channelCount),this.dataType=t.verifyMapKey(c.channelType,B),
this.voxelSize=t.parseXYZ(A.vec3.create(),c.pixelSize,t.verifyFinitePositiveFloat),this.upperVoxelBound=t.parseXYZ(A.vec3.create(),c.volumeSize,t.verifyPositiveInt)}catch(f){throw Error("Failed to parse BrainMaps volume geometry: "+f.message);}};d.VolumeInfo=D;var z=function(c){function f(c,b,m){a(this,f);b=k(this,Object.getPrototypeOf(f).call(this,c,b));b.parameters=m;b.initializeCounterpart(c.rpc,{type:"brainmaps/VolumeChunkSource",parameters:m});return b}b(f,c);n(f,[{key:"toString",value:function(){return r.volumeSourceToString(this.parameters)}}]);
return f}(x.VolumeChunkSource);d.VolumeChunkSource=z;var C=function S(c){a(this,S);t.verifyObject(c);this.name=t.verifyObjectProperty(c,"name",t.verifyString);this.type=t.verifyObjectProperty(c,"type",t.verifyString)};d.MeshInfo=C;var G=function(){function f(c,b,m,h){a(this,f);this.instance=c;this.volume_id=b;try{t.verifyObject(m);var n=this.scales=t.verifyObjectProperty(m,"geometry",function(a){return t.parseArray(a,function(a){return new D(a)})});if(0===n.length)throw Error("Expected at least one scale.");
var d=n[0],u=this.numChannels=d.numChannels,l=this.dataType=d.dataType;c=1;for(var p=n.length;c<p;++c){var B=n[c];if(B.dataType!==l)throw Error("Scale "+c+" has data type "+w.DataType[B.dataType]+" but scale 0 has data type "+w.DataType[l]+".");if(B.numChannels!==u)throw Error("Scale "+c+" has "+B.numChannels+" channel(s) but scale 0 has "+u+" channels.");}var q=w.VolumeType.IMAGE;if(1===u)switch(l){case w.DataType.UINT64:q=w.VolumeType.SEGMENTATION}this.volumeType=q}catch(e){throw Error("Failed to parse BrainMaps multiscale volume specification: "+
e.message);}try{t.verifyObject(h),this.meshes=t.verifyObjectProperty(h,"meshes",function(a){return void 0===a?[]:t.parseArray(a,function(a){return new C(a)})})}catch(e){throw Error("Failed to parse BrainMaps meshes specification: "+e.message);}}n(f,[{key:"getSources",value:function(a){var c=this,f=r.VolumeChunkEncoding.RAW;this.volumeType===w.VolumeType.SEGMENTATION?f=r.VolumeChunkEncoding.COMPRESSED_SEGMENTATION:this.volumeType===w.VolumeType.IMAGE&&this.dataType===w.DataType.UINT8&&1===this.numChannels&&
(f=r.VolumeChunkEncoding.JPEG);return this.scales.map(function(b,m){return Array.from(w.VolumeChunkSpecification.getDefaults({voxelSize:b.voxelSize,dataType:b.dataType,numChannels:b.numChannels,lowerVoxelBound:A.vec3.fromValues(0,0,0),upperVoxelBound:b.upperVoxelBound,volumeType:c.volumeType})).map(function(b){var h={instance:c.instance,volume_id:c.volume_id,scaleIndex:m,encoding:f};return a.getChunkSource(z,t.stableStringify(h),function(){return new z(a,b,h)})})})}},{key:"getMeshSource",value:function(a){var f=
this.meshes.find(function(a){return"TRIANGLES"===a.type});return void 0===f?null:c(a,{instance:this.instance,volume_id:this.volume_id,mesh_name:f.name})}}]);return f}();d.MultiscaleVolumeChunkSource=G;var F=function(c){function f(c,b){a(this,f);var m=k(this,Object.getPrototypeOf(f).call(this,c));m.parameters=b;m.initializeCounterpart(m.chunkManager.rpc,{type:"brainmaps/MeshSource",parameters:b});return m}b(f,c);n(f,[{key:"toString",value:function(){return r.meshSourceToString(this.parameters)}}]);
return f}(g.MeshSource);d.MeshSource=F;d.getMeshSource=c;var J=new Map;d.getVolume=f;var Q=function X(c){a(this,X);this.hierarchicalVolumeIds=new Map;try{t.verifyObject(c);var f=this.volumeIds=t.parseArray(c.volumeId,t.verifyString);f.sort();for(var b=new Map,m=$jscomp.makeIterator(f),n=m.next();!n.done;n=m.next()){var d=n.value;for(c=0;;){var u=d.indexOf(":",c);-1===u?u=void 0:++u;var l=d.substring(0,c),p=b.get(l);void 0===p&&(p=new Set,b.set(l,p));p.add(d.substring(c,u));if(void 0===u)break;c=u}}for(var B=
this.hierarchicalVolumeIds,q=$jscomp.makeIterator(b),e=q.next();!e.done;e=q.next()){var r=h(e.value,2);B.set(r[0],Array.from(r[1]))}}catch(w){throw Error("Failed to parse Brain Maps volume list reply: "+w.message);}};d.VolumeList=Q;var P=new Map;d.getVolumeList=m;d.volumeCompleter=u;d.registerBrainmapsDataSource=l;l(p.PRODUCTION_INSTANCE)},function(g,d,e){var k=e(3),b=e(4),a=e(6);g=e(7);var c=e(9),f=0;k.implementation.getNewTokenPromise=function(){var m=new b.StatusMessage(!0),d=void 0,l=new Promise(function(b){function n(){var a=
1>=arguments.length||void 0===arguments[1]?"Request authorization.":arguments[1];m.setText((0>=arguments.length||void 0===arguments[0]?"Brain Maps authorization required.":arguments[0])+"  ");var c=document.createElement("button");c.textContent=a;m.element.appendChild(c);c.addEventListener("click",function(){l(!1)});m.setVisible(!0)}function l(m){void 0!==d&&a.cancelPromise(d);n("Waiting for Brain Maps authorization...","Retry");d=c.authenticateGoogleOAuth2({clientId:"639403125587-4k5hgdfumtrvur8v48e3pr7oo91d765k.apps.googleusercontent.com",
scopes:["https://www.googleapis.com/auth/brainmaps"],immediate:m,authUser:0});d.then(function(a){a.generationId=f++;b(a)},function(a){m?n():n("Brain Maps authorization failed: "+a+".","Retry")});a.callFinally(d,function(){d=void 0})}l(!0)});a.callFinally(l,function(){m.dispose()});return l};g.registerRPC("brainmaps.requestToken",function(a){var c=this;k.getToken(a.invalidToken).then(function(a){c.invoke("brainmaps.receiveToken",{authResult:a})})})},function(g,d){var e=function c(){if(!(this instanceof
c))throw new TypeError("Cannot call a class as a function");};d.Implementation=e;d.implementation=new e;var k=null,b=null;d.getToken=function(c){if(null!==k&&(null===b||null==c||c.generationId!==b.generationId))return k;b=null;k=d.implementation.getNewTokenPromise(c);k.then(function(c){b=c});return k}},function(g,d,e){var k=function(){function a(a,f){for(var b=0;b<f.length;b++){var d=f[b];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}
return function(c,f,b){f&&a(c.prototype,f);b&&a(c,b);return c}}();e(5);var b=null;d.DEFAULT_STATUS_DELAY=200;g=function(){function a(){var c=0>=arguments.length||void 0===arguments[0]?!1:arguments[0];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");null===b&&(b=document.createElement("ul"),b.id="statusContainer",document.body.appendChild(b));var f=document.createElement("li");this.element=f;!0===c&&(c=d.DEFAULT_STATUS_DELAY);!1!==c?(this.setVisible(!1),this.timer=setTimeout(this.setVisible.bind(this,
!0),c)):this.timer=null;b.appendChild(f)}k(a,[{key:"dispose",value:function(){b.removeChild(this.element);this.element=null;null!==this.timer&&clearTimeout(this.timer)}},{key:"setText",value:function(a,f){this.element.textContent=a;f&&this.setVisible(!0)}},{key:"setHTML",value:function(a,f){this.element.innerHTML=a;f&&this.setVisible(!0)}},{key:"setVisible",value:function(a){this.timer=null;this.element.style.display=a?"block":"none"}}],[{key:"forPromise",value:function(c,f){var b=new a(f.delay);
b.setText(f.initialMessage);var d=b.dispose.bind(b);c.then(d,function(a){var c=void 0,c=a instanceof Error?a.message:""+a;a=f.errorPrefix;b.element.textContent=(void 0===a?"":a)+c+"  ";c=document.createElement("button");c.textContent="Dismiss";c.addEventListener("click",function(){b.dispose()});b.element.appendChild(c);b.setVisible(!0)});return c}}]);return a}();d.StatusMessage=g},function(g,d){},function(g,d){function e(a){var f=!1,b=void 0,u=void 0,l=new Promise(function(h,n){function l(a){f||(f=
!0,h(a))}function e(a){f||(f=!0,n(a))}function q(a){if(f)try{a()}catch(c){}}try{a(l,e,q)}catch(w){e(w)}u=function(){if(!f){f=!0;if(void 0!==b){try{b()}catch(a){}b=void 0}n(d.CANCELLED)}}});l.cancel=u;return l}function k(a){if(null!=a){var f=a.cancel;void 0!==f&&f.call(a)}}var b=function(){function a(c,b){for(var d=0;d<b.length;d++){var l=b[d];l.enumerable=l.enumerable||!1;l.configurable=!0;"value"in l&&(l.writable=!0);Object.defineProperty(c,l.key,l)}}return function(f,b,d){b&&a(f.prototype,b);d&&
a(f,d);return f}}(),a=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");}b(a,[{key:"toString",value:function(){return"CancellationError"}}]);return a}();d.CancellationError=a;d.CANCELLED=new a;d.makeCancellablePromise=e;d.cancelPromise=k;d.callFinally=function(a,f){return e(function(b,d,l){l(function(){k(a)});a.then(function(a){l(void 0);Promise.resolve(f(l)).then(function(){b(a)})},function(a){l(void 0);try{Promise.resolve(f(l)).then(function(){d(a)},
d)}catch(c){d(c)}})})};d.cancellableThen=function(a,f){return e(function(b,u,l){var h=!1;l(function(){h=!0;k(a)});a.then(function(a){h?u(d.CANCELLED):(l(void 0),b(f(a,l)))})})}},function(g,d,e){function k(a,c){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!c||"object"!==typeof c&&"function"!==typeof c?a:c}function b(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=
Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}function a(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function");}function c(a,c){u.set(a,c)}var f=function n(a,c,f){null===a&&(a=Function.prototype);var b=Object.getOwnPropertyDescriptor(a,c);if(void 0===b)return a=Object.getPrototypeOf(a),null===a?void 0:n(a,c,f);if("value"in b)return b.value;c=b.get;return void 0===
c?void 0:c.call(f)},m=function(){function a(c,f){for(var b=0;b<f.length;b++){var m=f[b];m.enumerable=m.enumerable||!1;m.configurable=!0;"value"in m&&(m.writable=!0);Object.defineProperty(c,m.key,m)}}return function(c,f,b){f&&a(c.prototype,f);b&&a(c,b);return c}}();g=e(8);var u=new Map;d.registerRPC=c;e=function(){function c(f){var b=this;a(this,c);this.target=f;this.objects=new Map;this.nextId=0;f.onmessage=function(a){a=a.data;u.get(a.functionName).call(b,a)}}m(c,[{key:"set",value:function(a,c){this.objects.set(a,
c)}},{key:"delete",value:function(a){this.objects.delete(a)}},{key:"get",value:function(a){return this.objects.get(a)}},{key:"getRef",value:function(a){var c=this.get(a.id);c.referencedGeneration=a.gen;c.addRef();return c}},{key:"invoke",value:function(a,c,f){c.functionName=a;this.target.postMessage(c,f)}},{key:"newId",value:function(){return this.nextId++}},{key:"numObjects",get:function(){return this.objects.size}}]);return c}();d.RPC=e;g=function(c){function d(){a(this,d);for(var c=arguments.length,
f=Array(c),b=0;b<c;b++)f[b]=arguments[b];var m,c=k(this,(m=Object.getPrototypeOf(d)).call.apply(m,[].concat([this],$jscomp.arrayFromIterable(f))));c.rpc=null;c.rpcId=null;return c}b(d,c);m(d,[{key:"initializeSharedObject",value:function(a){var c=1>=arguments.length||void 0===arguments[1]?a.newId():arguments[1];this.rpc=a;this.rpcId=c;this.isOwner=!1;a.set(c,this)}},{key:"initializeCounterpart",value:function(a){var c=1>=arguments.length||void 0===arguments[1]?{}:arguments[1];this.initializeSharedObject(a);
this.referencedGeneration=this.unreferencedGeneration=0;this.isOwner=!0;c.id=this.rpcId;a.invoke("SharedObject.new",c)}},{key:"dispose",value:function(){f(Object.getPrototypeOf(d.prototype),"dispose",this).call(this)}},{key:"addCounterpartRef",value:function(){return{id:this.rpcId,gen:++this.referencedGeneration}}},{key:"refCountReachedZero",value:function(){!0===this.isOwner?this.referencedGeneration===this.unreferencedGeneration&&this.ownerDispose():!1===this.isOwner?this.rpc.invoke("SharedObject.refCountReachedZero",
{id:this.rpcId,gen:this.referencedGeneration}):f(Object.getPrototypeOf(d.prototype),"refCountReachedZero",this).call(this)}},{key:"ownerDispose",value:function(){var a=this.rpc,c=this.rpcId;f(Object.getPrototypeOf(d.prototype),"refCountReachedZero",this).call(this);a.delete(c);a.invoke("SharedObject.dispose",{id:c})}},{key:"counterpartRefCountReachedZero",value:function(a){this.unreferencedGeneration=a;0===this.refCount&&a===this.referencedGeneration&&this.ownerDispose()}}]);return d}(g.RefCounted);
d.SharedObject=g;g=function(c){function f(c){var b=1>=arguments.length||void 0===arguments[1]?{}:arguments[1];a(this,f);var m=k(this,Object.getPrototypeOf(f).call(this));null!=c&&m.initializeSharedObject(c,b.id);return m}b(f,c);return f}(g);d.SharedObjectCounterpart=g;c("SharedObject.dispose",function(a){a=this.get(a.id);if(0!==a.refCount)throw Error("Attempted to dispose object with non-zero reference count.");a.disposed();this.delete(a.rpcId);a.rpcId=null;a.rpc=null});c("SharedObject.refCountReachedZero",
function(a){this.get(a.id).counterpartRefCountReachedZero(a.gen)});var l=new Map;d.registerSharedObject=function(a,c){l.set(a,c)};c("SharedObject.new",function(a){--(new (l.get(a.type))(this,a)).refCount})},function(g,d){var e=function(){function b(a,c){for(var f=0;f<c.length;f++){var b=c[f];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(a,b.key,b)}}return function(a,c,f){c&&b(a.prototype,c);f&&b(a,f);return a}}(),k=function(){function b(){if(!(this instanceof
b))throw new TypeError("Cannot call a class as a function");this.refCount=1}e(b,[{key:"addRef",value:function(){++this.refCount;return this}},{key:"dispose",value:function(){0===--this.refCount&&this.refCountReachedZero()}},{key:"refCountReachedZero",value:function(){this.disposed();var a=this.disposers;if(null!=a){for(var c=a.length;0<c;--c){var f=a[c-1];"object"===typeof f?f.dispose():f.call(this)}this.disposers=null}}},{key:"disposed",value:function(){}},{key:"registerDisposer",value:function(a){var c=
this.disposers;null==c?this.disposers=[a]:c.push(a);return a}},{key:"unregisterDisposer",value:function(a){var c=this.disposers;if(null!=c){var f=c.indexOf(a);-1!==f&&c.splice(f,1)}return a}},{key:"registerSignalBinding",value:function(a){this.registerDisposer(function(){return a.detach()})}},{key:"registerEventListener",value:function(a,c,f,b){a.addEventListener(c,f,b);this.registerDisposer(function(){return a.removeEventListener(c,f,b)})}}]);return b}();d.RefCounted=k},function(g,d,e){function k(a,
c){var f=document.createElement("iframe");f.style.display="none";f.id=a;f.name=a;f.src="https://accounts.google.com/o/oauth2/postmessageRelay?parent="+encodeURIComponent(location.origin)+"#rpctoken="+c;document.body.appendChild(f)}var b=function(){function a(c,f){for(var b=0;b<f.length;b++){var m=f[b];m.enumerable=m.enumerable||!1;m.configurable=!0;"value"in m&&(m.writable=!0);Object.defineProperty(c,m.key,m)}}return function(c,f,b){f&&a(c.prototype,f);b&&a(c,b);return c}}(),a=e(10),c=e(11),f=e(6),
m=e(12);d.AUTH_SERVER="https://accounts.google.com/o/oauth2/auth";d.embedRelayFrame=k;var u=function(){function a(){var f=this;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.proxyName="postmessageRelay"+m.getRandomHexString();this.rpcToken=""+m.getRandomHexString();this.relayReadyService="oauth2relayReady:"+this.rpcToken;this.oauth2CallbackService="oauth2callback:"+this.rpcToken;this.pendingRequests=new Map;k(this.proxyName,this.rpcToken);this.relayReadyPromise=
new Promise(function(a){addEventListener("message",function(b){if("https://accounts.google.com"===b.origin)try{var m=c.verifyObject(JSON.parse(b.data)),d=c.verifyString(m.s);d===f.relayReadyService&&a();if(d===f.oauth2CallbackService){var h=c.parseArray(m.a,function(a){return a}),l=c.verifyString(h[0]),u=location.origin;if(!l.startsWith(u+"#")&&!l.startsWith(u+"?"))throw Error("oauth2callback: URL "+JSON.stringify(l)+" does not match current origin "+u+".");for(var e=l.substring(u.length+1).split("&"),
t=new Map,B=$jscomp.makeIterator(e),D=B.next();!D.done;D=B.next()){var z=D.value.match("^([a-z_]+)=(.*)$");if(null===z)throw Error("oauth2callback: URL part "+JSON.stringify(z)+" does not match expected pattern.");t.set(z[1],z[2])}var C=t.get("state");if(void 0===C)throw Error("oauth2callback: State argument is missing.");var k=f.pendingRequests.get(C);if(void 0!==k){var g=t.get("error");if(void 0!==g){f.pendingRequests.delete(C);var J=t.get("error_subtype"),m=g;void 0!==J&&(m+=": "+J);k.reject(m)}else{var Q=
t.get("access_token"),P=t.get("token_type"),W=t.get("expires_in"),R=t.get("scope");if(void 0===Q||void 0===P||void 0===W||void 0===R)throw Error("oauth2callback: URL lacks expected parameters.");f.pendingRequests.delete(C);k.resolve({accessToken:Q,tokenType:P,expiresIn:W,scope:R})}}}}catch(S){throw Error("Invalid message received from https://accounts.google.com: "+JSON.stringify(b.data)+": "+S.message+".");}})})}b(a,[{key:"getAuthPromise",value:function(a){var c=this,b=f.makeCancellablePromise(function(f,
b){c.pendingRequests.set(a,{resolve:f,reject:b})});f.callFinally(b,function(){c.pendingRequests.delete(a)});return b}},{key:"makeAuthRequestUrl",value:function(a){var c=d.AUTH_SERVER+"?client_id="+encodeURIComponent(a.clientId),c=c+"&redirect_uri=postmessage&response_type=token",f=a.origin,c=c+("&origin="+encodeURIComponent(void 0===f?location.origin:f)),c=c+("&proxy="+this.proxyName),c=c+"&include_granted_scopes=true",c=c+("&scope="+encodeURIComponent(a.scopes.join(" ")));a.state&&(c+="&state="+
a.state);a.approvalPrompt&&(c+="&approval_prompt="+encodeURIComponent(a.approvalPrompt));a.loginHint&&(c+="&login_hint="+encodeURIComponent(a.loginHint));a.immediate&&(c+="&immediate=true");void 0!==a.authUser&&(c+="&authuser="+a.authUser);return c}}]);return a}(),l=void 0;d.authenticateGoogleOAuth2=function(c){var b=m.getRandomHexString(),d;void 0===l&&(l=new u);d=l;var e=d.makeAuthRequestUrl({state:b,clientId:c.clientId,scopes:c.scopes,approvalPrompt:c.approvalPrompt,loginHint:c.loginHint,immediate:c.immediate,
authUser:c.authUser}),q=d.getAuthPromise(b);c.immediate?d.relayReadyPromise.then(function(){var c=document.createElement("iframe");c.src=e;c.style.display="none";document.body.appendChild(c);f.callFinally(q,function(){a.removeFromParent(c)})}):function(){var a=open(e);f.callFinally(q,function(){a.close()})}();return q}},function(g,d){d.removeChildren=function(d){for(;;){var k=d.firstElementChild;if(!k)break;d.removeChild(k)}};d.removeFromParent=function(d){var k=d.parentElement;return k?(k.removeChild(d),
!0):!1}},function(g,d){function e(a){var c=typeof a;if("number"===c||"string"===c)if(c=parseFloat(""+a),!Number.isNaN(c))return c;throw Error("Expected floating-point number, but received: "+JSON.stringify(a)+".");}function k(a){if("object"===typeof a){if(null===a)return"null";if(Array.isArray(a)){var c="[",f=a.length,b=0;if(b<f)for(c+=k(a[b]);++b<f;)c+=",",c+=k(a[b]);return c+"]"}var c="{",f=Object.keys(a).sort(),b=0,m=f.length;if(b<m)for(var d=f[b],c=c+JSON.stringify(d),c=c+":"+k(a[d]);++b<m;)c+=
",",d=f[b],c+=JSON.stringify(d),c+=":",c+=k(a[d]);return c+="}"}return JSON.stringify(a)}function b(a){return a.replace(/['"]/g,function(a){return'"'===a?"'":'"'})}function a(a){return b(JSON.stringify(b(a)))}function c(f){if("object"===typeof f){if(null===f)return"null";var b=f.toJSON;if("function"===typeof b)return c(b.call(f));if(Array.isArray(f)){var b="[",m=f.length,d=0;if(d<m)for(b+=c(f[d]);++d<m;)b+="_",b+=c(f[d]);return b+"]"}for(var b="{",d=Object.keys(f),m=!0,d=$jscomp.makeIterator(d),h=
d.next();!h.done;h=d.next()){var h=h.value,l=f[h];void 0!==l&&(l=c(l))&&(m?m=!1:b+="_",b+=a(h),b+=":",b+=l)}return b+"}"}return"string"===typeof f?a(f):JSON.stringify(f)}function f(a,c,f,b){if(2<=a.length&&a.charAt(0)===c&&a.charAt(a.length-1)===c){a=a.substr(1,a.length-2);for(c=f;0<a.length;){var m=a.match(b);if(null===m){c+=a;break}c+=m[1];c+="\\";c+=f;a=a.substr(m.index+m[0].length)}return c+f}return a}function m(a){return f(a,"'",'"',A)}function u(a,c,b){var m=/[&_,]/g,d=void 0,h=void 0,l=void 0;
'"'===b?(d="'",h=A,l=v):(d='"',h=t,l=y);for(var u="";0<a.length;){var n=a.match(l),p=void 0,e=void 0;null===n?(p=a,e=a=""):(p=a.substr(0,n.index),a=a.substr(n.index+n[0].length),e=n[1],e=void 0!==e?f(e,d,b,h):n[2]);u+=p.replace(m,c);u+=e}return u}function l(a){return u(a,",",'"')}function h(a){return JSON.parse(l(a))}function n(a){for(var c="";0<a.length;){var f=a.match(v),b=void 0,d=void 0;null===f?(b=a,d=a=""):(b=a.substr(0,f.index),a=a.substr(f.index+f[0].length),d=f[1],d=void 0!==d?m(d):f[2]);
c+=b.replace(/\(/g,"[").replace(/\)/g,"]").replace("True","true").replace("False","false").replace(/,\s*([\}\]])/g,"$1");c+=d}return c}function p(a){if("object"!==typeof a||null==a||Array.isArray(a))throw Error("Expected JSON object, but received: "+JSON.stringify(a)+".");return a}function r(a){var c=parseInt(a,10);if(!Number.isInteger(c))throw Error("Expected integer, but received: "+JSON.stringify(a)+".");return c}function q(a){if("string"!==typeof a)throw Error("Expected string, but received: "+
JSON.stringify(a)+".");return a}d.verifyFloat=e;d.verifyFinitePositiveFloat=function(a){a=e(a);if(Number.isFinite(a)&&0<a)return a;throw Error("Expected positive finite floating-point number, but received: "+a+".");};d.parseXYZ=function(a,c){var f=2>=arguments.length||void 0===arguments[2]?e:arguments[2];p(c);var b=Object.keys(c);b.sort();if(3!==b.length||"x"!==b[0]||"y"!==b[1]||"z"!==b[2])throw Error("Expected object to have keys ['x', 'y', 'z'], but received: "+JSON.stringify(c)+".");a[0]=f(c.x);
a[1]=f(c.y);a[2]=f(c.z);return a};d.parseFiniteVec=function(a,c){var f=a.length;if(!Array.isArray(c)||c.length!==f)throw Error("Incompatible sizes");for(var b=0;b<f;++b)if(!Number.isFinite(parseFloat(c[b])))throw Error("Non-finite value.");for(b=0;b<f;++b)a[b]=parseFloat(c[b]);return a};d.parseIntVec=function(a,c){var f=a.length;if(!Array.isArray(c)||c.length!==f)throw Error("Incompatible sizes.");for(var b=0;b<f;++b){var m=parseInt(c[b],void 0);if(!Number.isInteger(m))throw Error("Non-integer value.");
}for(b=0;b<f;++b)a[b]=parseInt(c[b],void 0);return a};d.stableStringify=k;d.urlSafeStringifyString=a;d.urlSafeStringify=c;var w=/('(?:[^'\\]|(?:\\.))*')/,x=/("(?:[^'\\]|(?:\\.))*")/,v=new RegExp(w.source+"|"+x.source),y=new RegExp(x.source+"|"+w.source),A=/^((?:[^"'\\]|(?:\\.))*)"/,t=/^((?:[^"'\\]|(?:\\.))*)'/;d.normalizeStringLiteral=m;d.urlSafeToJSON=l;d.jsonToUrlSafe=function(a){return u(a,"_","'")};d.urlSafeParse=h;d.pythonLiteralToJSON=n;d.pythonLiteralParse=function(a){return JSON.parse(n(a))};
d.parseArray=function(a,c){if(!Array.isArray(a))throw Error("Expected array, but received: "+JSON.stringify(a)+".");return a.map(c)};d.parseFixedLengthArray=function(a,c,f){var b=a.length;if(!Array.isArray(c)||c.length!==b)throw Error("Expected length "+b+" array, but received: "+JSON.stringify(c)+".");for(var m=0;m<b;++m)a[m]=f(c[m],m);return a};d.verifyObject=p;d.verifyInt=r;d.verifyPositiveInt=function(a){a=r(a);if(0>=a)throw Error("Expected positive integer, but received: "+a+".");return a};d.verifyMapKey=
function(a,c){var f=c.get(a);if(void 0===f)throw Error("Expected one of "+JSON.stringify(Array.from(c.keys()))+", but received: "+JSON.stringify(a)+".");return f};d.verifyString=q;d.verifyOptionalString=function(a){return void 0===a?void 0:q(a)};d.verifyObjectProperty=function(a,c,f){a=a.hasOwnProperty(c)?a[c]:void 0;try{return f(a)}catch(b){throw Error("Error parsing "+JSON.stringify(c)+" property: "+b.message);}};d.verifyObjectAsMap=function(a,c){p(a);for(var f=new Map,b=$jscomp.makeIterator(Object.keys(a)),
m=b.next();!m.done;m=b.next()){m=m.value;try{f.set(m,c(a[m]))}catch(d){throw Error("Error parsing value associated with key "+JSON.stringify(m)+": "+d.message);}}return f};d.verifyFloat01=function(a){if("number"!==typeof a||!Number.isFinite(a)||0>a||1<a)throw Error("Expected floating point number in [0,1], but received: "+JSON.stringify(a)+".");return a};d.parseQueryStringParameters=function(a){if(""===a)return{};if(a.startsWith("{"))return h(a);var c={};a=a.split(/[&;]/);a=$jscomp.makeIterator(a);
for(var f=a.next();!f.done;f=a.next()){var f=f.value,b=f.match(/^([^=&;]+)=([^&;]*)$/);if(null===b)throw Error("Invalid query string part: "+JSON.stringify(f)+".");c[b[1]]=b[2]}return c}},function(g,d){d.getRandomHexString=function(){var d=Math.ceil((0>=arguments.length||void 0===arguments[0]?128:arguments[0])/32),k=new Uint32Array(d);crypto.getRandomValues(k);for(var b="",a=0;a<d;++a)b+=("00000000"+k[a].toString(16)).slice(-8);return b}},function(g,d,e){function k(a,c,b,l){d.INSTANCE_IDENTIFIERS[a]=
b;d.INSTANCE_NAMES[a]=l;b=["https://"+c];for(l=0;9>=l;++l)b.push("https://s"+l+"-"+c);d.INSTANCE_BASE_URLS[a]=b}var b=e(3),a=e(14),c=e(6);d.numPendingRequests=0;d.PRODUCTION_INSTANCE=0;d.INSTANCE_NAMES=[];d.INSTANCE_BASE_URLS=[];d.INSTANCE_IDENTIFIERS=[];d.brainmapsInstanceKey=function(a){return d.INSTANCE_IDENTIFIERS[a]};d.setupBrainmapsInstance=k;k(d.PRODUCTION_INSTANCE,"brainmaps.googleapis.com","prod","Brain Maps");d.makeRequest=function(f,m,u,l){var h=void 0;return c.makeCancellablePromise(function(c,
p,e){function q(e){null===h?--d.numPendingRequests:(h=a.openShardedHttpRequest(d.INSTANCE_BASE_URLS[f],u,m),h.responseType=l,h.setRequestHeader("Authorization",e.tokenType+" "+e.accessToken),h.onloadend=function(){if(null===h)--d.numPendingRequests;else{var f=this.status;200<=f&&300>f?(--d.numPendingRequests,c(this.response)):403===f||401===f?b.getToken(e).then(q):(--d.numPendingRequests,p(a.HttpError.fromXhr(this)))}},h.send())}e(function(){var a=h;h=null;null!=a&&a.abort()});b.getToken().then(q)})}},
function(g,d,e){function k(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}function b(a,f){if(Array.isArray(a)){var b=a.length,b=1===b?0:Math.abs(c.simpleStringHash(f))%b;return a[b]+f}return a+f}var a=function(){function a(c,f){for(var b=0;b<f.length;b++){var m=
f[b];m.enumerable=m.enumerable||!1;m.configurable=!0;"value"in m&&(m.writable=!0);Object.defineProperty(c,m.key,m)}}return function(c,f,b){f&&a(c.prototype,f);b&&a(c,b);return c}}(),c=e(15),f=e(6);$jscomp.initSymbol();d.URL_SYMBOL=Symbol("url");$jscomp.initSymbol();d.METHOD_SYMBOL=Symbol("method");var m=function(c){function f(a,c,b,m){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var d=a+" "+JSON.stringify(c)+" resulted in HTTP error "+b;m&&(d+=": "+m);var d=d+".",
u;u=Object.getPrototypeOf(f).call(this,d);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");u=!u||"object"!==typeof u&&"function"!==typeof u?this:u;u.name="HttpError";u.message=d;u.method=a;u.url=c;u.code=b;u.statusMessage=m;return u}k(f,c);a(f,null,[{key:"fromXhr",value:function(a){return new f(a[d.METHOD_SYMBOL],a[d.URL_SYMBOL],a.status,a.statusText)}}]);return f}(Error);d.HttpError=m;d.openHttpRequest=function(a){var c=1>=arguments.length||void 0===
arguments[1]?"GET":arguments[1],f=new XMLHttpRequest;f[d.METHOD_SYMBOL]=c;f[d.URL_SYMBOL]=a;f.open(c,a);return f};d.pickShard=b;d.openShardedHttpRequest=function(a,c){var f=2>=arguments.length||void 0===arguments[2]?"GET":arguments[2],m=new XMLHttpRequest,p=b(a,c);m[d.METHOD_SYMBOL]=f;m[d.URL_SYMBOL]=p;console.log("GET:");console.log(p);m.open(f,p);return m};d.sendHttpRequest=function(a,c){a.responseType=c;return f.makeCancellablePromise(function(c,f,b){a.onloadend=function(){var b=this.status;200<=
b&&300>b?c(this.response):f(m.fromXhr(a))};b(function(){a.abort()});a.send()})};d.parseSpecialUrl=function(a){var c=a.match(/^([^:\/]+):\/\/([^\/]+)(\/.*)?$/);if(null===c)throw Error("Invalid URL: "+JSON.stringify(a));return"gs"===c[1]?(a=c[2],[["https://"+a+".storage.googleapis.com","https://storage.googleapis.com/"+a],c[3]]):[[a],""]}},function(g,d){d.simpleStringHash=function(d){for(var k=0,b=d.length,a=0;a<b;++a)k=31*k+d.charCodeAt(a)|0;return k}},function(g,d,e){var k=e(13);(function(a){a[a.RAW=
0]="RAW";a[a.JPEG=1]="JPEG";a[a.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"})(d.VolumeChunkEncoding||(d.VolumeChunkEncoding={}));var b=d.VolumeChunkEncoding;d.volumeSourceToString=function(a){return"brainmaps-"+k.brainmapsInstanceKey(a.instance)+":volume/"+a.volume_id+"/"+a.scaleIndex+"/"+b[a.encoding]};d.meshSourceToString=function(a){return"brainmaps:"+k.brainmapsInstanceKey(a.instance)+":mesh/"+a.volume_id+"/"+a.mesh_name}},function(g,d,e){function k(a,c){void 0===c&&(c=-1===a.indexOf("/")?
":":"/");var f=a.lastIndexOf(c);return-1===f?0:f+1}function b(a,c){var f=k(a,c);return a.substring(f)}function a(a){a=a.match(l);if(null===a||void 0===a[1])throw Error('Data source URL must have the form "<protocol>://<path>".');var c=a[1],f=u.get(c);if(void 0===f)throw Error("Unsupported data source: "+JSON.stringify(c)+".");return[f,a[2],c]}var c=function(){return function(a,c){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var f=
[],b=!0,m=!1,d=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var u=a[Symbol.iterator](),l;!(b=(l=u.next()).done)&&(f.push(l.value),!c||f.length!==c);b=!0);}catch(e){m=!0,d=e}finally{try{if(!b&&u["return"])u["return"]()}finally{if(m)throw d;}}return f}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),f=e(6),m=e(18);d.findSourceGroupBasedOnSeparator=k;d.suggestLayerNameBasedOnSeparator=b;var u=new Map;d.registerDataSourceFactory=function(a,c){u.set(a,
c)};var l=/^(?:([a-zA-Z-+_]+):\/\/)?(.*)$/;d.getVolume=function(f){f=a(f);f=c(f,2);return f[0].getVolume(f[1])};d.getMeshSource=function(f,b){var m=2>=arguments.length||void 0===arguments[2]?0:arguments[2],d=a(b),d=c(d,2);return d[0].getMeshSource(f,d[1],m)};d.getSkeletonSource=function(f,b){var m=a(b),m=c(m,2);return m[0].getSkeletonSource(f,m[1])};d.volumeCompleter=function(a){var b=a.match(l),d=b[1];if(void 0===d){for(var b=[],e=$jscomp.makeIterator(u),q=e.next();!q.done;q=e.next()){var w=c(q.value,
2),q=w[0],w=w[1],q=q+"://";q.startsWith(a)&&b.push({value:q,description:w.description})}return Promise.resolve({offset:0,completions:b})}a=u.get(d);return void 0!==a&&(a=a.volumeCompleter,void 0!==a)?f.cancellableThen(a(b[2]),function(a){return m.applyCompletionOffset(d.length+3,a)}):Promise.reject(null)};d.suggestLayerName=function(f){f=a(f);var m=c(f,2);f=m[1];m=m[0].suggestLayerName;return void 0!==m?m(f):b(f)};d.findSourceGroup=function(f){f=a(f);f=c(f,3);var b=f[2];return(f[0].findSourceGroup||
k)(f[1])+b.length+3}},function(g,d){d.applyCompletionOffset=function(d,k){k.offset+=d;return k};d.getPrefixMatches=function(d,k){for(var b=[],a=$jscomp.makeIterator(k),c=a.next();!c.done;c=a.next())c=c.value,c.startsWith(d)&&b.push({value:c});return b};d.getPrefixMatchesWithDescriptions=function(d,k,b,a){var c=[];k=$jscomp.makeIterator(k);for(var f=k.next();!f.done;f=k.next()){var f=f.value,m=b(f);m.startsWith(d)&&c.push({value:m,description:a(f)})}return c}},function(g,d,e){function k(a,c){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!c||"object"!==typeof c&&"function"!==typeof c?a:c}function b(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}function a(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function");}var c=function y(a,c,f){null===a&&
(a=Function.prototype);var b=Object.getOwnPropertyDescriptor(a,c);if(void 0===b)return a=Object.getPrototypeOf(a),null===a?void 0:y(a,c,f);if("value"in b)return b.value;c=b.get;return void 0===c?void 0:c.call(f)},f=function(){function a(c,f){for(var b=0;b<f.length;b++){var m=f[b];m.enumerable=m.enumerable||!1;m.configurable=!0;"value"in m&&(m.writable=!0);Object.defineProperty(c,m.key,m)}}return function(c,f,b){f&&a(c.prototype,f);b&&a(c,b);return c}}(),m=e(20),u=e(22),l=e(33),h=e(69);g=e(58);var n=
e(57),p=e(35),r=e(7),q=function(){function c(){a(this,c);this.tempLightVec=u.vec4.create();this.tempPickID=new Float32Array(4)}f(c,[{key:"defineShader",value:function(a){a.addAttribute("highp vec3","aVertexPosition");a.addAttribute("highp vec3","aVertexNormal");a.addVarying("highp vec3","vColor");a.addUniform("highp vec4","uLightDirection");a.addUniform("highp vec3","uColor");a.addUniform("highp mat4","uModelMatrix");a.addUniform("highp mat4","uProjection");a.addUniform("highp vec4","uPickID");a.require(l.perspectivePanelEmit);
a.setVertexMain("\ngl_Position = uProjection * (uModelMatrix * vec4(aVertexPosition, 1.0));\nvec3 normal = (uModelMatrix * vec4(aVertexNormal, 0.0)).xyz;\nfloat lightingFactor = abs(dot(normal, uLightDirection.xyz)) + uLightDirection.w;\nvColor = lightingFactor * uColor;\n");a.setFragmentMain("emit(vec4(vColor, 1.0), uPickID);")}},{key:"beginLayer",value:function(a,c,f){var b=f.dataToDevice,m=f.lightDirection,d=f.ambientLighting;f=f.directionalLighting;a.uniformMatrix4fv(c.uniform("uProjection"),
!1,b);b=this.tempLightVec;u.vec3.scale(b,m,f);b[3]=d;a.uniform4fv(c.uniform("uLightDirection"),b)}},{key:"beginObject",value:function(a,c,f,b,m){a.uniformMatrix4fv(c.uniform("uModelMatrix"),!1,f);a.uniform4fv(c.uniform("uPickID"),h.setVec4FromUint32(this.tempPickID,m));a.uniform3fv(c.uniform("uColor"),b)}},{key:"getShader",value:function(a){var c=this;return a.memoize.get("mesh/MeshShaderManager",function(){var f=new m.ShaderBuilder(a);c.defineShader(f);return f.build()})}},{key:"drawFragment",value:function(a,
c,f){f.vertexBuffer.bindToVertexAttrib(c.attribute("aVertexPosition"),3);f.normalBuffer.bindToVertexAttrib(c.attribute("aVertexNormal"),3);f.indexBuffer.bind();a.drawElements(a.TRIANGLES,f.numIndices,a.UNSIGNED_INT,0)}},{key:"endLayer",value:function(a,c){a.disableVertexAttribArray(c.attribute("aVertexPosition"));a.disableVertexAttribArray(c.attribute("aVertexNormal"))}}]);return c}();d.MeshShaderManager=q;e=function(c){function m(c,f,b){a(this,m);var d=k(this,Object.getPrototypeOf(m).call(this));
d.chunkManager=c;d.source=f;d.displayState=b;d.meshShaderManager=new q;d.shader=d.registerDisposer(d.meshShaderManager.getShader(d.gl));var u=function(){d.redrawNeeded.dispatch()};d.registerSignalBinding(b.segmentColorHash.changed.add(u));d.registerSignalBinding(b.visibleSegments.changed.add(u));d.registerSignalBinding(b.segmentSelectionState.changed.add(u));d.registerDisposer(new r.SharedObject).initializeCounterpart(c.rpc,{type:"mesh/MeshLayer",chunkManager:c.rpcId,source:f.addCounterpartRef(),
visibleSegmentSet:b.visibleSegments.rpcId});d.setReady(!0);return d}b(m,c);f(m,[{key:"draw",value:function(a){var c=this.gl,f=this.shader;f.bind();var b=this.meshShaderManager;b.beginLayer(c,f,a);var m=this.source.fragmentSource.objectChunks;a=a.pickIDs;var d=u.mat4.create();u.mat4.identity(d);for(var l=u.vec3.create(),h=this.displayState,e=h.segmentColorHash,p=h.segmentSelectionState,h=$jscomp.makeIterator(h.visibleSegments),q=h.next();!q.done;q=h.next()){var q=q.value,w=m.get(q.low+":"+q.high);
if(void 0!==w){e.compute(l,q);if(p.isSelected(q))for(var r=0;3>r;++r)l[r]=.5*l[r]+.5;b.beginObject(c,f,d,l,a.register(this,q));q=$jscomp.makeIterator(w);for(w=q.next();!w.done;w=q.next())w=w.value,w.state===n.ChunkState.GPU_MEMORY&&b.drawFragment(c,f,w)}}b.endLayer(c,f)}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);return m}(l.PerspectiveViewRenderLayer);d.MeshLayer=e;var w=function(m){function d(c,f){a(this,d);var b=k(this,Object.getPrototypeOf(d).call(this,c));b.objectKey=
f.objectKey;b.vertexPositions=f.vertexPositions;var m=b.indices=f.indices;b.numIndices=m.length;b.vertexNormals=f.vertexNormals;return b}b(d,m);f(d,[{key:"copyToGPU",value:function(a){c(Object.getPrototypeOf(d.prototype),"copyToGPU",this).call(this,a);this.vertexBuffer=p.Buffer.fromData(a,this.vertexPositions,a.ARRAY_BUFFER,a.STATIC_DRAW);this.indexBuffer=p.Buffer.fromData(a,this.indices,a.ELEMENT_ARRAY_BUFFER,a.STATIC_DRAW);this.normalBuffer=p.Buffer.fromData(a,this.vertexNormals,a.ARRAY_BUFFER,
a.STATIC_DRAW)}},{key:"freeGPUMemory",value:function(a){c(Object.getPrototypeOf(d.prototype),"freeGPUMemory",this).call(this,a);this.vertexBuffer.dispose();this.indexBuffer.dispose();this.normalBuffer.dispose()}}]);return d}(g.Chunk);d.FragmentChunk=w;var x=function(m){function d(c,f){a(this,d);var b=k(this,Object.getPrototypeOf(d).call(this,c));b.meshSource=f;b.objectChunks=new Map;b.initializeCounterpart(c.rpc,{type:"mesh/FragmentSource"});return b}b(d,m);f(d,[{key:"addChunk",value:function(a,f){c(Object.getPrototypeOf(d.prototype),
"addChunk",this).call(this,a,f);var b=this.objectChunks,m=f.objectKey,u=b.get(m);void 0===u&&(u=new Set,b.set(m,u));u.add(f)}},{key:"deleteChunk",value:function(a){var f=this.chunks.get(a);c(Object.getPrototypeOf(d.prototype),"deleteChunk",this).call(this,a);a=this.objectChunks;var b=f.objectKey,m=a.get(b);m.delete(f);0===m.size&&a.delete(b)}},{key:"getChunk",value:function(a){return new w(this,a)}}]);return d}(g.ChunkSource);d.FragmentSource=x;e=function(m){function d(){a(this,d);for(var c=arguments.length,
f=Array(c),b=0;b<c;b++)f[b]=arguments[b];var m,c=k(this,(m=Object.getPrototypeOf(d)).call.apply(m,[].concat([this],$jscomp.arrayFromIterable(f))));c.fragmentSource=new x(c.chunkManager,c);return c}b(d,m);f(d,[{key:"initializeCounterpart",value:function(a,f){f.fragmentSource=this.fragmentSource.addCounterpartRef();c(Object.getPrototypeOf(d.prototype),"initializeCounterpart",this).call(this,a,f)}}]);return d}(g.ChunkSource);d.MeshSource=e},function(g,d,e){function k(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function");
}function b(a,c){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!c||"object"!==typeof c&&"function"!==typeof c?a:c}function a(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}function c(a){a=a.replace("\x00",
"");var c=[];a=$jscomp.makeIterator(a.split("\n"));for(var f=a.next();!f.done;f=a.next()){var f=f.value,b=f.match(/^ERROR:\s*(\d+):(\d+)\s*(.+)$/);null!==b?c.push({message:b[3].trim(),file:parseInt(b[1],10),line:parseInt(b[2],10)}):(b=f.match(/^ERROR:\s*(.+)$/),null!==b?c.push({message:b[1]}):(f=f.trim())&&c.push({message:f}))}return c}function f(a,f,b){var m=a.createShader(b);a.shaderSource(m,f);a.compileShader(m);if(!a.getShaderParameter(m,a.COMPILE_STATUS))throw a=a.getShaderInfoLog(m),new h(b,
f,a,c(a));return m}var m=function(){function a(c,f){for(var b=0;b<f.length;b++){var m=f[b];m.enumerable=m.enumerable||!1;m.configurable=!0;"value"in m&&(m.writable=!0);Object.defineProperty(c,m.key,m)}}return function(c,f,b){f&&a(c.prototype,f);b&&a(c,b);return c}}();g=e(8);var u=e(21);(function(a){a[a.VERTEX=u.GL_VERTEX_SHADER]="VERTEX";a[a.FRAGMENT=u.GL_FRAGMENT_SHADER]="FRAGMENT"})(d.ShaderType||(d.ShaderType={}));var l=d.ShaderType;d.parseShaderErrors=c;var h=function(c){function f(a,c,m,d){k(this,
f);var u="Error compiling "+l[a].toLowerCase()+" shader: "+m,h=b(this,Object.getPrototypeOf(f).call(this,u));h.name="ShaderCompilationError";h.log=m;h.message=u;h.shaderType=a;h.source=c;h.errorMessages=d;return h}a(f,c);return f}(Error);d.ShaderCompilationError=h;var n=function(c){function f(a,c,m){k(this,f);var d="Error linking shader: "+m,u=b(this,Object.getPrototypeOf(f).call(this,d));u.name="ShaderLinkError";u.log=m;u.message=d;u.vertexSource=a;u.fragmentSource=c;return u}a(f,c);return f}(Error);
d.ShaderLinkError=n;d.getShader=f;var p=function(c){function d(a,c,m,u,h){k(this,d);var l=b(this,Object.getPrototypeOf(d).call(this));l.gl=a;l.vertexSource=c;l.fragmentSource=m;l.attributes=new Map;l.uniforms=new Map;l.textureUnits=null;var e=l.vertexShader=f(a,c,a.VERTEX_SHADER),p=l.fragmentShader=f(a,m,a.FRAGMENT_SHADER),q=l.program=a.createProgram();a.attachShader(q,e);a.attachShader(q,p);a.linkProgram(q);if(!a.getProgramParameter(q,a.LINK_STATUS))throw a=a.getProgramInfoLog(q),new n(c,m,a);m=
l.uniforms;c=l.attributes;if(u)for(u=$jscomp.makeIterator(u),e=u.next();!e.done;e=u.next())e=e.value,m.set(e,a.getUniformLocation(q,e));if(h)for(h=$jscomp.makeIterator(h),u=h.next();!u.done;u=h.next())u=u.value,c.set(u,a.getAttribLocation(q,u));return l}a(d,c);m(d,[{key:"uniform",value:function(a){return this.uniforms.get(a)}},{key:"attribute",value:function(a){return this.attributes.get(a)}},{key:"textureUnit",value:function(a){return this.textureUnits.get(a)}},{key:"bind",value:function(){this.gl.useProgram(this.program)}},
{key:"disposed",value:function(){var a=this.gl;a.deleteShader(this.vertexShader);this.vertexShader=null;a.deleteShader(this.fragmentShader);this.fragmentShader=null;a.deleteProgram(this.program);this.uniforms=this.attributes=this.gl=this.program=null}}]);return d}(g.RefCounted);d.ShaderProgram=p;var r=function(){function a(){k(this,a);this.code="";this.parts=new Set}m(a,[{key:"add",value:function(a){if(!this.parts.has(a))switch(this.parts.add(a),typeof a){case "string":this.code+=a;break;case "function":this.add(a());
break;default:if(Array.isArray(a)){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next())this.add(c.value)}else throw Error("Invalid code type");}}},{key:"toString",value:function(){return this.code}}]);return a}();d.ShaderCode=r;e=function(){function a(c){k(this,a);this.gl=c;this.nextTextureUnit=this.nextSymbolID=0;this.varyingsCode=this.attributesCode=this.uniformsCode="";this.fragmentExtensionsSet=new Set;this.fragmentExtensions="";this.vertexCode=new r;this.vertexMain="";this.fragmentCode=
new r;this.fragmentMain="";this.required=new Set;this.uniforms=[];this.attributes=[];this.initializers=[];this.textureUnits=new Map}m(a,[{key:"allocateTextureUnit",value:function(a){var c=1>=arguments.length||void 0===arguments[1]?1:arguments[1];if(this.textureUnits.has(a))throw Error("Duplicate texture unit symbol: "+a);var f=this.nextTextureUnit;this.nextTextureUnit+=c;this.textureUnits.set(a,f);return f}},{key:"addTextureSampler2D",value:function(a,c,f){var b=this.allocateTextureUnit(c,f);this.addUniform("highp sampler2D",
a,f);this.addInitializer(function(c){if(f){for(var m=new Int32Array(f),d=0;d<f;++d)m[d]=d+b;c.gl.uniform1iv(c.uniform(a),m)}else c.gl.uniform1i(c.uniform(a),b)});return b}},{key:"symbol",value:function(a){return a+this.nextSymbolID++}},{key:"addAttribute",value:function(a,c){this.attributes.push(c);this.attributesCode+="attribute "+a+" "+c+";\n";return c}},{key:"addVarying",value:function(a,c){this.varyingsCode+="varying "+a+" "+c+";\n"}},{key:"addUniform",value:function(a,c,f){this.uniforms.push(c);
this.uniformsCode=null!=f?this.uniformsCode+("uniform "+a+" "+c+"["+f+"];\n"):this.uniformsCode+("uniform "+a+" "+c+";\n");return c}},{key:"addFragmentExtension",value:function(a){this.fragmentExtensionsSet.has(a)||(this.fragmentExtensionsSet.add(a),this.fragmentExtensions+="#extension "+a+" : require\n")}},{key:"addVertexCode",value:function(a){this.vertexCode.add(a)}},{key:"addFragmentCode",value:function(a){this.fragmentCode.add(a)}},{key:"setVertexMain",value:function(a){this.vertexMain=a}},{key:"setFragmentMain",
value:function(a){this.fragmentMain="void main() {\n"+a+"\n}\n"}},{key:"setFragmentMainFunction",value:function(a){this.fragmentMain=a}},{key:"addInitializer",value:function(a){this.initializers.push(a)}},{key:"require",value:function(a){this.required.has(a)||(this.required.add(a),a(this))}},{key:"build",value:function(){var a=new p(this.gl,"\nprecision highp float;\n"+this.uniformsCode+"\n"+this.attributesCode+"\n"+this.varyingsCode+"\n"+this.vertexCode+"\nvoid main() {\n"+this.vertexMain+"\n}\n",
"\n"+this.fragmentExtensions+"\nprecision highp float;\n"+this.uniformsCode+"\n"+this.varyingsCode+"\n"+this.fragmentCode+"\n"+this.fragmentMain+"\n",this.uniforms,this.attributes);a.textureUnits=this.textureUnits;var c=this.initializers;if(0<c.length){a.bind();for(var c=$jscomp.makeIterator(c),f=c.next();!f.done;f=c.next())f=f.value,f(a)}return a}}]);return a}();d.ShaderBuilder=e},function(g,d){d.GL_DEPTH_BUFFER_BIT=256;d.GL_STENCIL_BUFFER_BIT=1024;d.GL_COLOR_BUFFER_BIT=16384;d.GL_POINTS=0;d.GL_LINES=
1;d.GL_LINE_LOOP=2;d.GL_LINE_STRIP=3;d.GL_TRIANGLES=4;d.GL_TRIANGLE_STRIP=5;d.GL_TRIANGLE_FAN=6;d.GL_ZERO=0;d.GL_ONE=1;d.GL_SRC_COLOR=768;d.GL_ONE_MINUS_SRC_COLOR=769;d.GL_SRC_ALPHA=770;d.GL_ONE_MINUS_SRC_ALPHA=771;d.GL_DST_ALPHA=772;d.GL_ONE_MINUS_DST_ALPHA=773;d.GL_DST_COLOR=774;d.GL_ONE_MINUS_DST_COLOR=775;d.GL_SRC_ALPHA_SATURATE=776;d.GL_FUNC_ADD=32774;d.GL_BLEND_EQUATION=32777;d.GL_BLEND_EQUATION_RGB=32777;d.GL_BLEND_EQUATION_ALPHA=34877;d.GL_FUNC_SUBTRACT=32778;d.GL_FUNC_REVERSE_SUBTRACT=32779;
d.GL_BLEND_DST_RGB=32968;d.GL_BLEND_SRC_RGB=32969;d.GL_BLEND_DST_ALPHA=32970;d.GL_BLEND_SRC_ALPHA=32971;d.GL_CONSTANT_COLOR=32769;d.GL_ONE_MINUS_CONSTANT_COLOR=32770;d.GL_CONSTANT_ALPHA=32771;d.GL_ONE_MINUS_CONSTANT_ALPHA=32772;d.GL_BLEND_COLOR=32773;d.GL_ARRAY_BUFFER=34962;d.GL_ELEMENT_ARRAY_BUFFER=34963;d.GL_ARRAY_BUFFER_BINDING=34964;d.GL_ELEMENT_ARRAY_BUFFER_BINDING=34965;d.GL_STREAM_DRAW=35040;d.GL_STATIC_DRAW=35044;d.GL_DYNAMIC_DRAW=35048;d.GL_BUFFER_SIZE=34660;d.GL_BUFFER_USAGE=34661;d.GL_CURRENT_VERTEX_ATTRIB=
34342;d.GL_FRONT=1028;d.GL_BACK=1029;d.GL_FRONT_AND_BACK=1032;d.GL_CULL_FACE=2884;d.GL_BLEND=3042;d.GL_DITHER=3024;d.GL_STENCIL_TEST=2960;d.GL_DEPTH_TEST=2929;d.GL_SCISSOR_TEST=3089;d.GL_POLYGON_OFFSET_FILL=32823;d.GL_SAMPLE_ALPHA_TO_COVERAGE=32926;d.GL_SAMPLE_COVERAGE=32928;d.GL_NO_ERROR=0;d.GL_INVALID_ENUM=1280;d.GL_INVALID_VALUE=1281;d.GL_INVALID_OPERATION=1282;d.GL_OUT_OF_MEMORY=1285;d.GL_CW=2304;d.GL_CCW=2305;d.GL_LINE_WIDTH=2849;d.GL_ALIASED_POINT_SIZE_RANGE=33901;d.GL_ALIASED_LINE_WIDTH_RANGE=
33902;d.GL_CULL_FACE_MODE=2885;d.GL_FRONT_FACE=2886;d.GL_DEPTH_RANGE=2928;d.GL_DEPTH_WRITEMASK=2930;d.GL_DEPTH_CLEAR_VALUE=2931;d.GL_DEPTH_FUNC=2932;d.GL_STENCIL_CLEAR_VALUE=2961;d.GL_STENCIL_FUNC=2962;d.GL_STENCIL_FAIL=2964;d.GL_STENCIL_PASS_DEPTH_FAIL=2965;d.GL_STENCIL_PASS_DEPTH_PASS=2966;d.GL_STENCIL_REF=2967;d.GL_STENCIL_VALUE_MASK=2963;d.GL_STENCIL_WRITEMASK=2968;d.GL_STENCIL_BACK_FUNC=34816;d.GL_STENCIL_BACK_FAIL=34817;d.GL_STENCIL_BACK_PASS_DEPTH_FAIL=34818;d.GL_STENCIL_BACK_PASS_DEPTH_PASS=
34819;d.GL_STENCIL_BACK_REF=36003;d.GL_STENCIL_BACK_VALUE_MASK=36004;d.GL_STENCIL_BACK_WRITEMASK=36005;d.GL_VIEWPORT=2978;d.GL_SCISSOR_BOX=3088;d.GL_COLOR_CLEAR_VALUE=3106;d.GL_COLOR_WRITEMASK=3107;d.GL_UNPACK_ALIGNMENT=3317;d.GL_PACK_ALIGNMENT=3333;d.GL_MAX_TEXTURE_SIZE=3379;d.GL_MAX_VIEWPORT_DIMS=3386;d.GL_SUBPIXEL_BITS=3408;d.GL_RED_BITS=3410;d.GL_GREEN_BITS=3411;d.GL_BLUE_BITS=3412;d.GL_ALPHA_BITS=3413;d.GL_DEPTH_BITS=3414;d.GL_STENCIL_BITS=3415;d.GL_POLYGON_OFFSET_UNITS=10752;d.GL_POLYGON_OFFSET_FACTOR=
32824;d.GL_TEXTURE_BINDING_2D=32873;d.GL_SAMPLE_BUFFERS=32936;d.GL_SAMPLES=32937;d.GL_SAMPLE_COVERAGE_VALUE=32938;d.GL_SAMPLE_COVERAGE_INVERT=32939;d.GL_COMPRESSED_TEXTURE_FORMATS=34467;d.GL_DONT_CARE=4352;d.GL_FASTEST=4353;d.GL_NICEST=4354;d.GL_GENERATE_MIPMAP_HINT=33170;d.GL_BYTE=5120;d.GL_UNSIGNED_BYTE=5121;d.GL_SHORT=5122;d.GL_UNSIGNED_SHORT=5123;d.GL_INT=5124;d.GL_UNSIGNED_INT=5125;d.GL_FLOAT=5126;d.GL_DEPTH_COMPONENT=6402;d.GL_ALPHA=6406;d.GL_RGB=6407;d.GL_RGBA=6408;d.GL_LUMINANCE=6409;d.GL_LUMINANCE_ALPHA=
6410;d.GL_UNSIGNED_SHORT_4_4_4_4=32819;d.GL_UNSIGNED_SHORT_5_5_5_1=32820;d.GL_UNSIGNED_SHORT_5_6_5=33635;d.GL_FRAGMENT_SHADER=35632;d.GL_VERTEX_SHADER=35633;d.GL_MAX_VERTEX_ATTRIBS=34921;d.GL_MAX_VERTEX_UNIFORM_VECTORS=36347;d.GL_MAX_VARYING_VECTORS=36348;d.GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661;d.GL_MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660;d.GL_MAX_TEXTURE_IMAGE_UNITS=34930;d.GL_MAX_FRAGMENT_UNIFORM_VECTORS=36349;d.GL_SHADER_TYPE=35663;d.GL_DELETE_STATUS=35712;d.GL_LINK_STATUS=35714;d.GL_VALIDATE_STATUS=
35715;d.GL_ATTACHED_SHADERS=35717;d.GL_ACTIVE_UNIFORMS=35718;d.GL_ACTIVE_ATTRIBUTES=35721;d.GL_SHADING_LANGUAGE_VERSION=35724;d.GL_CURRENT_PROGRAM=35725;d.GL_NEVER=512;d.GL_LESS=513;d.GL_EQUAL=514;d.GL_LEQUAL=515;d.GL_GREATER=516;d.GL_NOTEQUAL=517;d.GL_GEQUAL=518;d.GL_ALWAYS=519;d.GL_KEEP=7680;d.GL_REPLACE=7681;d.GL_INCR=7682;d.GL_DECR=7683;d.GL_INVERT=5386;d.GL_INCR_WRAP=34055;d.GL_DECR_WRAP=34056;d.GL_VENDOR=7936;d.GL_RENDERER=7937;d.GL_VERSION=7938;d.GL_NEAREST=9728;d.GL_LINEAR=9729;d.GL_NEAREST_MIPMAP_NEAREST=
9984;d.GL_LINEAR_MIPMAP_NEAREST=9985;d.GL_NEAREST_MIPMAP_LINEAR=9986;d.GL_LINEAR_MIPMAP_LINEAR=9987;d.GL_TEXTURE_MAG_FILTER=10240;d.GL_TEXTURE_MIN_FILTER=10241;d.GL_TEXTURE_WRAP_S=10242;d.GL_TEXTURE_WRAP_T=10243;d.GL_TEXTURE_2D=3553;d.GL_TEXTURE=5890;d.GL_TEXTURE_CUBE_MAP=34067;d.GL_TEXTURE_BINDING_CUBE_MAP=34068;d.GL_TEXTURE_CUBE_MAP_POSITIVE_X=34069;d.GL_TEXTURE_CUBE_MAP_NEGATIVE_X=34070;d.GL_TEXTURE_CUBE_MAP_POSITIVE_Y=34071;d.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y=34072;d.GL_TEXTURE_CUBE_MAP_POSITIVE_Z=
34073;d.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z=34074;d.GL_MAX_CUBE_MAP_TEXTURE_SIZE=34076;d.GL_TEXTURE0=33984;d.GL_TEXTURE1=33985;d.GL_TEXTURE2=33986;d.GL_TEXTURE3=33987;d.GL_TEXTURE4=33988;d.GL_TEXTURE5=33989;d.GL_TEXTURE6=33990;d.GL_TEXTURE7=33991;d.GL_TEXTURE8=33992;d.GL_TEXTURE9=33993;d.GL_TEXTURE10=33994;d.GL_TEXTURE11=33995;d.GL_TEXTURE12=33996;d.GL_TEXTURE13=33997;d.GL_TEXTURE14=33998;d.GL_TEXTURE15=33999;d.GL_TEXTURE16=34E3;d.GL_TEXTURE17=34001;d.GL_TEXTURE18=34002;d.GL_TEXTURE19=34003;d.GL_TEXTURE20=
34004;d.GL_TEXTURE21=34005;d.GL_TEXTURE22=34006;d.GL_TEXTURE23=34007;d.GL_TEXTURE24=34008;d.GL_TEXTURE25=34009;d.GL_TEXTURE26=34010;d.GL_TEXTURE27=34011;d.GL_TEXTURE28=34012;d.GL_TEXTURE29=34013;d.GL_TEXTURE30=34014;d.GL_TEXTURE31=34015;d.GL_ACTIVE_TEXTURE=34016;d.GL_REPEAT=10497;d.GL_CLAMP_TO_EDGE=33071;d.GL_MIRRORED_REPEAT=33648;d.GL_FLOAT_VEC2=35664;d.GL_FLOAT_VEC3=35665;d.GL_FLOAT_VEC4=35666;d.GL_INT_VEC2=35667;d.GL_INT_VEC3=35668;d.GL_INT_VEC4=35669;d.GL_BOOL=35670;d.GL_BOOL_VEC2=35671;d.GL_BOOL_VEC3=
35672;d.GL_BOOL_VEC4=35673;d.GL_FLOAT_MAT2=35674;d.GL_FLOAT_MAT3=35675;d.GL_FLOAT_MAT4=35676;d.GL_SAMPLER_2D=35678;d.GL_SAMPLER_CUBE=35680;d.GL_VERTEX_ATTRIB_ARRAY_ENABLED=34338;d.GL_VERTEX_ATTRIB_ARRAY_SIZE=34339;d.GL_VERTEX_ATTRIB_ARRAY_STRIDE=34340;d.GL_VERTEX_ATTRIB_ARRAY_TYPE=34341;d.GL_VERTEX_ATTRIB_ARRAY_NORMALIZED=34922;d.GL_VERTEX_ATTRIB_ARRAY_POINTER=34373;d.GL_VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975;d.GL_IMPLEMENTATION_COLOR_READ_TYPE=35738;d.GL_IMPLEMENTATION_COLOR_READ_FORMAT=35739;
d.GL_COMPILE_STATUS=35713;d.GL_LOW_FLOAT=36336;d.GL_MEDIUM_FLOAT=36337;d.GL_HIGH_FLOAT=36338;d.GL_LOW_INT=36339;d.GL_MEDIUM_INT=36340;d.GL_HIGH_INT=36341;d.GL_FRAMEBUFFER=36160;d.GL_RENDERBUFFER=36161;d.GL_RGBA4=32854;d.GL_RGB5_A1=32855;d.GL_RGB565=36194;d.GL_DEPTH_COMPONENT16=33189;d.GL_STENCIL_INDEX=6401;d.GL_STENCIL_INDEX8=36168;d.GL_DEPTH_STENCIL=34041;d.GL_RENDERBUFFER_WIDTH=36162;d.GL_RENDERBUFFER_HEIGHT=36163;d.GL_RENDERBUFFER_INTERNAL_FORMAT=36164;d.GL_RENDERBUFFER_RED_SIZE=36176;d.GL_RENDERBUFFER_GREEN_SIZE=
36177;d.GL_RENDERBUFFER_BLUE_SIZE=36178;d.GL_RENDERBUFFER_ALPHA_SIZE=36179;d.GL_RENDERBUFFER_DEPTH_SIZE=36180;d.GL_RENDERBUFFER_STENCIL_SIZE=36181;d.GL_FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048;d.GL_FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049;d.GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050;d.GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051;d.GL_COLOR_ATTACHMENT0=36064;d.GL_DEPTH_ATTACHMENT=36096;d.GL_STENCIL_ATTACHMENT=36128;d.GL_DEPTH_STENCIL_ATTACHMENT=33306;d.GL_NONE=0;d.GL_FRAMEBUFFER_COMPLETE=
36053;d.GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054;d.GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055;d.GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057;d.GL_FRAMEBUFFER_UNSUPPORTED=36061;d.GL_FRAMEBUFFER_BINDING=36006;d.GL_RENDERBUFFER_BINDING=36007;d.GL_MAX_RENDERBUFFER_SIZE=34024;d.GL_INVALID_FRAMEBUFFER_OPERATION=1286;d.GL_UNPACK_FLIP_Y_WEBGL=37440;d.GL_UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441;d.GL_CONTEXT_LOST_WEBGL=37442;d.GL_UNPACK_COLORSPACE_CONVERSION_WEBGL=37443;d.GL_BROWSER_DEFAULT_WEBGL=37444},
function(g,d,e){g=e(23);d.vec2=g.vec2;d.vec3=g.vec3;d.vec4=g.vec4;d.mat2=g.mat2;d.mat3=g.mat3;d.mat4=g.mat4;d.quat=g.quat;e=e(23);d.identityMat4=e.mat4.create();d.AXES_NAMES=["x","y","z"];d.BoundingBox=function b(a,c){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.lower=a;this.upper=c};d.kAxes=[e.vec4.fromValues(1,0,0,0),e.vec4.fromValues(0,1,0,0),e.vec4.fromValues(0,0,1,0)];d.kZeroVec=e.vec3.fromValues(0,0,0);d.prod3=function(b){return b[0]*b[1]*b[2]};d.prod4=
function(b){return b[0]*b[1]*b[2]*b[3]};d.vec3Key=function(b){return b[0]+","+b[1]+","+b[2]}},function(g,d,e){d.glMatrix=e(24);d.mat2=e(25);d.mat2d=e(26);d.mat3=e(27);d.mat4=e(28);d.quat=e(29);d.vec2=e(32);d.vec3=e(30);d.vec4=e(31)},function(g,d){var e={EPSILON:1E-6};e.ARRAY_TYPE="undefined"!==typeof Float32Array?Float32Array:Array;e.RANDOM=Math.random;e.ENABLE_SIMD=!1;e.SIMD_AVAILABLE=e.ARRAY_TYPE===Float32Array&&"SIMD"in this;e.USE_SIMD=e.ENABLE_SIMD&&e.SIMD_AVAILABLE;e.setMatrixArrayType=function(b){e.ARRAY_TYPE=
b};var k=Math.PI/180;e.toRadian=function(b){return b*k};e.equals=function(b,a){return Math.abs(b-a)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(a))};g.exports=e},function(g,d,e){var k=e(24);d={create:function(){var b=new k.ARRAY_TYPE(4);b[0]=1;b[1]=0;b[2]=0;b[3]=1;return b},clone:function(b){var a=new k.ARRAY_TYPE(4);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=1;return b},fromValues:function(b,
a,c,f){var m=new k.ARRAY_TYPE(4);m[0]=b;m[1]=a;m[2]=c;m[3]=f;return m},set:function(b,a,c,f,m){b[0]=a;b[1]=c;b[2]=f;b[3]=m;return b},transpose:function(b,a){if(b===a){var c=a[1];b[1]=a[2];b[2]=c}else b[0]=a[0],b[1]=a[2],b[2]=a[1],b[3]=a[3];return b},invert:function(b,a){var c=a[0],f=a[1],m=a[2],d=a[3],l=c*d-m*f;if(!l)return null;l=1/l;b[0]=d*l;b[1]=-f*l;b[2]=-m*l;b[3]=c*l;return b},adjoint:function(b,a){var c=a[0];b[0]=a[3];b[1]=-a[1];b[2]=-a[2];b[3]=c;return b},determinant:function(b){return b[0]*
b[3]-b[2]*b[1]},multiply:function(b,a,c){var f=a[0],m=a[1],d=a[2];a=a[3];var l=c[0],h=c[1],n=c[2];c=c[3];b[0]=f*l+d*h;b[1]=m*l+a*h;b[2]=f*n+d*c;b[3]=m*n+a*c;return b}};d.mul=d.multiply;d.rotate=function(b,a,c){var f=a[0],m=a[1],d=a[2];a=a[3];var l=Math.sin(c);c=Math.cos(c);b[0]=f*c+d*l;b[1]=m*c+a*l;b[2]=f*-l+d*c;b[3]=m*-l+a*c;return b};d.scale=function(b,a,c){var f=a[1],m=a[2],d=a[3],l=c[0];c=c[1];b[0]=a[0]*l;b[1]=f*l;b[2]=m*c;b[3]=d*c;return b};d.fromRotation=function(b,a){var c=Math.sin(a),f=Math.cos(a);
b[0]=f;b[1]=c;b[2]=-c;b[3]=f;return b};d.fromScaling=function(b,a){b[0]=a[0];b[1]=0;b[2]=0;b[3]=a[1];return b};d.str=function(b){return"mat2("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")"};d.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2))};d.LDU=function(b,a,c,f){b[2]=f[2]/f[0];c[0]=f[0];c[1]=f[1];c[3]=f[3]-b[2]*c[1];return[b,a,c]};d.add=function(b,a,c){b[0]=a[0]+c[0];b[1]=a[1]+c[1];b[2]=a[2]+c[2];b[3]=a[3]+c[3];return b};d.subtract=function(b,a,c){b[0]=
a[0]-c[0];b[1]=a[1]-c[1];b[2]=a[2]-c[2];b[3]=a[3]-c[3];return b};d.sub=d.subtract;d.exactEquals=function(b,a){return b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]&&b[3]===a[3]};d.equals=function(b,a){var c=b[0],f=b[1],m=b[2],d=b[3],l=a[0],h=a[1],n=a[2],e=a[3];return Math.abs(c-l)<=k.EPSILON*Math.max(1,Math.abs(c),Math.abs(l))&&Math.abs(f-h)<=k.EPSILON*Math.max(1,Math.abs(f),Math.abs(h))&&Math.abs(m-n)<=k.EPSILON*Math.max(1,Math.abs(m),Math.abs(n))&&Math.abs(d-e)<=k.EPSILON*Math.max(1,Math.abs(d),Math.abs(e))};
d.multiplyScalar=function(b,a,c){b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c;b[3]=a[3]*c;return b};d.multiplyScalarAndAdd=function(b,a,c,f){b[0]=a[0]+c[0]*f;b[1]=a[1]+c[1]*f;b[2]=a[2]+c[2]*f;b[3]=a[3]+c[3]*f;return b};g.exports=d},function(g,d,e){var k=e(24);d={create:function(){var b=new k.ARRAY_TYPE(6);b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=0;b[5]=0;return b},clone:function(b){var a=new k.ARRAY_TYPE(6);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];
b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b},identity:function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=0;b[5]=0;return b},fromValues:function(b,a,c,f,m,d){var l=new k.ARRAY_TYPE(6);l[0]=b;l[1]=a;l[2]=c;l[3]=f;l[4]=m;l[5]=d;return l},set:function(b,a,c,f,m,d,l){b[0]=a;b[1]=c;b[2]=f;b[3]=m;b[4]=d;b[5]=l;return b},invert:function(b,a){var c=a[0],f=a[1],m=a[2],d=a[3],l=a[4],h=a[5],n=c*d-f*m;if(!n)return null;n=1/n;b[0]=d*n;b[1]=-f*n;b[2]=-m*n;b[3]=c*n;b[4]=(m*h-d*l)*n;b[5]=(f*l-c*h)*n;return b},determinant:function(b){return b[0]*
b[3]-b[1]*b[2]},multiply:function(b,a,c){var f=a[0],m=a[1],d=a[2],l=a[3],h=a[4];a=a[5];var n=c[0],e=c[1],r=c[2],q=c[3],k=c[4];c=c[5];b[0]=f*n+d*e;b[1]=m*n+l*e;b[2]=f*r+d*q;b[3]=m*r+l*q;b[4]=f*k+d*c+h;b[5]=m*k+l*c+a;return b}};d.mul=d.multiply;d.rotate=function(b,a,c){var f=a[0],m=a[1],d=a[2],l=a[3],h=a[4];a=a[5];var n=Math.sin(c);c=Math.cos(c);b[0]=f*c+d*n;b[1]=m*c+l*n;b[2]=f*-n+d*c;b[3]=m*-n+l*c;b[4]=h;b[5]=a;return b};d.scale=function(b,a,c){var f=a[1],m=a[2],d=a[3],l=a[4],h=a[5],n=c[0];c=c[1];
b[0]=a[0]*n;b[1]=f*n;b[2]=m*c;b[3]=d*c;b[4]=l;b[5]=h;return b};d.translate=function(b,a,c){var f=a[0],m=a[1],d=a[2],l=a[3],h=a[4];a=a[5];var n=c[0];c=c[1];b[0]=f;b[1]=m;b[2]=d;b[3]=l;b[4]=f*n+d*c+h;b[5]=m*n+l*c+a;return b};d.fromRotation=function(b,a){var c=Math.sin(a),f=Math.cos(a);b[0]=f;b[1]=c;b[2]=-c;b[3]=f;b[4]=0;b[5]=0;return b};d.fromScaling=function(b,a){b[0]=a[0];b[1]=0;b[2]=0;b[3]=a[1];b[4]=0;b[5]=0;return b};d.fromTranslation=function(b,a){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=a[0];b[5]=a[1];
return b};d.str=function(b){return"mat2d("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+")"};d.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+1)};d.add=function(b,a,c){b[0]=a[0]+c[0];b[1]=a[1]+c[1];b[2]=a[2]+c[2];b[3]=a[3]+c[3];b[4]=a[4]+c[4];b[5]=a[5]+c[5];return b};d.subtract=function(b,a,c){b[0]=a[0]-c[0];b[1]=a[1]-c[1];b[2]=a[2]-c[2];b[3]=a[3]-c[3];b[4]=a[4]-c[4];b[5]=a[5]-c[5];return b};d.sub=d.subtract;
d.multiplyScalar=function(b,a,c){b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c;b[3]=a[3]*c;b[4]=a[4]*c;b[5]=a[5]*c;return b};d.multiplyScalarAndAdd=function(b,a,c,f){b[0]=a[0]+c[0]*f;b[1]=a[1]+c[1]*f;b[2]=a[2]+c[2]*f;b[3]=a[3]+c[3]*f;b[4]=a[4]+c[4]*f;b[5]=a[5]+c[5]*f;return b};d.exactEquals=function(b,a){return b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]&&b[3]===a[3]&&b[4]===a[4]&&b[5]===a[5]};d.equals=function(b,a){var c=b[0],f=b[1],m=b[2],d=b[3],l=b[4],h=b[5],n=a[0],e=a[1],r=a[2],q=a[3],w=a[4],g=a[5];return Math.abs(c-
n)<=k.EPSILON*Math.max(1,Math.abs(c),Math.abs(n))&&Math.abs(f-e)<=k.EPSILON*Math.max(1,Math.abs(f),Math.abs(e))&&Math.abs(m-r)<=k.EPSILON*Math.max(1,Math.abs(m),Math.abs(r))&&Math.abs(d-q)<=k.EPSILON*Math.max(1,Math.abs(d),Math.abs(q))&&Math.abs(l-w)<=k.EPSILON*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(h-g)<=k.EPSILON*Math.max(1,Math.abs(h),Math.abs(g))};g.exports=d},function(g,d,e){var k=e(24);d={create:function(){var b=new k.ARRAY_TYPE(9);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=
0;b[8]=1;return b},fromMat4:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b},clone:function(b){var a=new k.ARRAY_TYPE(9);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},fromValues:function(b,a,c,f,m,d,l,h,n){var e=new k.ARRAY_TYPE(9);e[0]=b;e[1]=a;e[2]=c;e[3]=f;e[4]=
m;e[5]=d;e[6]=l;e[7]=h;e[8]=n;return e},set:function(b,a,c,f,m,d,l,h,n,e){b[0]=a;b[1]=c;b[2]=f;b[3]=m;b[4]=d;b[5]=l;b[6]=h;b[7]=n;b[8]=e;return b},identity:function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b},transpose:function(b,a){if(b===a){var c=a[1],f=a[2],m=a[5];b[1]=a[3];b[2]=a[6];b[3]=c;b[5]=a[7];b[6]=f;b[7]=m}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b},invert:function(b,a){var c=a[0],f=a[1],m=a[2],
d=a[3],l=a[4],h=a[5],n=a[6],e=a[7],r=a[8],q=r*l-h*e,k=-r*d+h*n,g=e*d-l*n,v=c*q+f*k+m*g;if(!v)return null;v=1/v;b[0]=q*v;b[1]=(-r*f+m*e)*v;b[2]=(h*f-m*l)*v;b[3]=k*v;b[4]=(r*c-m*n)*v;b[5]=(-h*c+m*d)*v;b[6]=g*v;b[7]=(-e*c+f*n)*v;b[8]=(l*c-f*d)*v;return b},adjoint:function(b,a){var c=a[0],f=a[1],m=a[2],d=a[3],l=a[4],h=a[5],n=a[6],e=a[7],r=a[8];b[0]=l*r-h*e;b[1]=m*e-f*r;b[2]=f*h-m*l;b[3]=h*n-d*r;b[4]=c*r-m*n;b[5]=m*d-c*h;b[6]=d*e-l*n;b[7]=f*n-c*e;b[8]=c*l-f*d;return b},determinant:function(b){var a=b[3],
c=b[4],f=b[5],m=b[6],d=b[7],l=b[8];return b[0]*(l*c-f*d)+b[1]*(-l*a+f*m)+b[2]*(d*a-c*m)},multiply:function(b,a,c){var f=a[0],m=a[1],d=a[2],l=a[3],h=a[4],n=a[5],e=a[6],r=a[7];a=a[8];var q=c[0],k=c[1],g=c[2],v=c[3],y=c[4],A=c[5],t=c[6],B=c[7];c=c[8];b[0]=q*f+k*l+g*e;b[1]=q*m+k*h+g*r;b[2]=q*d+k*n+g*a;b[3]=v*f+y*l+A*e;b[4]=v*m+y*h+A*r;b[5]=v*d+y*n+A*a;b[6]=t*f+B*l+c*e;b[7]=t*m+B*h+c*r;b[8]=t*d+B*n+c*a;return b}};d.mul=d.multiply;d.translate=function(b,a,c){var f=a[0],m=a[1],d=a[2],l=a[3],h=a[4],n=a[5],
e=a[6],r=a[7];a=a[8];var q=c[0];c=c[1];b[0]=f;b[1]=m;b[2]=d;b[3]=l;b[4]=h;b[5]=n;b[6]=q*f+c*l+e;b[7]=q*m+c*h+r;b[8]=q*d+c*n+a;return b};d.rotate=function(b,a,c){var f=a[0],m=a[1],d=a[2],l=a[3],h=a[4],n=a[5],e=a[6],r=a[7];a=a[8];var q=Math.sin(c);c=Math.cos(c);b[0]=c*f+q*l;b[1]=c*m+q*h;b[2]=c*d+q*n;b[3]=c*l-q*f;b[4]=c*h-q*m;b[5]=c*n-q*d;b[6]=e;b[7]=r;b[8]=a;return b};d.scale=function(b,a,c){var f=c[0];c=c[1];b[0]=f*a[0];b[1]=f*a[1];b[2]=f*a[2];b[3]=c*a[3];b[4]=c*a[4];b[5]=c*a[5];b[6]=a[6];b[7]=a[7];
b[8]=a[8];return b};d.fromTranslation=function(b,a){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};d.fromRotation=function(b,a){var c=Math.sin(a),f=Math.cos(a);b[0]=f;b[1]=c;b[2]=0;b[3]=-c;b[4]=f;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};d.fromScaling=function(b,a){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};d.fromMat2d=function(b,a){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};d.fromQuat=
function(b,a){var c=a[0],f=a[1],m=a[2],d=a[3],l=c+c,h=f+f,n=m+m,c=c*l,e=f*l,f=f*h,r=m*l,q=m*h,m=m*n,l=d*l,h=d*h,d=d*n;b[0]=1-f-m;b[3]=e-d;b[6]=r+h;b[1]=e+d;b[4]=1-c-m;b[7]=q-l;b[2]=r-h;b[5]=q+l;b[8]=1-c-f;return b};d.normalFromMat4=function(b,a){var c=a[0],f=a[1],m=a[2],d=a[3],l=a[4],h=a[5],n=a[6],e=a[7],r=a[8],q=a[9],k=a[10],g=a[11],v=a[12],y=a[13],A=a[14],t=a[15],B=c*h-f*l,D=c*n-m*l,z=c*e-d*l,C=f*n-m*h,G=f*e-d*h,F=m*e-d*n,J=r*y-q*v,Q=r*A-k*v,r=r*t-g*v,P=q*A-k*y,q=q*t-g*y,k=k*t-g*A,g=B*k-D*q+z*P+
C*r-G*Q+F*J;if(!g)return null;g=1/g;b[0]=(h*k-n*q+e*P)*g;b[1]=(n*r-l*k-e*Q)*g;b[2]=(l*q-h*r+e*J)*g;b[3]=(m*q-f*k-d*P)*g;b[4]=(c*k-m*r+d*Q)*g;b[5]=(f*r-c*q-d*J)*g;b[6]=(y*F-A*G+t*C)*g;b[7]=(A*z-v*F-t*D)*g;b[8]=(v*G-y*z+t*B)*g;return b};d.str=function(b){return"mat3("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+")"};d.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+Math.pow(b[6],
2)+Math.pow(b[7],2)+Math.pow(b[8],2))};d.add=function(b,a,c){b[0]=a[0]+c[0];b[1]=a[1]+c[1];b[2]=a[2]+c[2];b[3]=a[3]+c[3];b[4]=a[4]+c[4];b[5]=a[5]+c[5];b[6]=a[6]+c[6];b[7]=a[7]+c[7];b[8]=a[8]+c[8];return b};d.subtract=function(b,a,c){b[0]=a[0]-c[0];b[1]=a[1]-c[1];b[2]=a[2]-c[2];b[3]=a[3]-c[3];b[4]=a[4]-c[4];b[5]=a[5]-c[5];b[6]=a[6]-c[6];b[7]=a[7]-c[7];b[8]=a[8]-c[8];return b};d.sub=d.subtract;d.multiplyScalar=function(b,a,c){b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c;b[3]=a[3]*c;b[4]=a[4]*c;b[5]=a[5]*c;b[6]=
a[6]*c;b[7]=a[7]*c;b[8]=a[8]*c;return b};d.multiplyScalarAndAdd=function(b,a,c,f){b[0]=a[0]+c[0]*f;b[1]=a[1]+c[1]*f;b[2]=a[2]+c[2]*f;b[3]=a[3]+c[3]*f;b[4]=a[4]+c[4]*f;b[5]=a[5]+c[5]*f;b[6]=a[6]+c[6]*f;b[7]=a[7]+c[7]*f;b[8]=a[8]+c[8]*f;return b};d.exactEquals=function(b,a){return b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]&&b[3]===a[3]&&b[4]===a[4]&&b[5]===a[5]&&b[6]===a[6]&&b[7]===a[7]&&b[8]===a[8]};d.equals=function(b,a){var c=b[0],f=b[1],m=b[2],d=b[3],l=b[4],h=b[5],n=b[6],e=b[7],r=b[8],q=a[0],g=a[1],
x=a[2],v=a[3],y=a[4],A=a[5],t=b[6],B=a[7],D=a[8];return Math.abs(c-q)<=k.EPSILON*Math.max(1,Math.abs(c),Math.abs(q))&&Math.abs(f-g)<=k.EPSILON*Math.max(1,Math.abs(f),Math.abs(g))&&Math.abs(m-x)<=k.EPSILON*Math.max(1,Math.abs(m),Math.abs(x))&&Math.abs(d-v)<=k.EPSILON*Math.max(1,Math.abs(d),Math.abs(v))&&Math.abs(l-y)<=k.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(h-A)<=k.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(n-t)<=k.EPSILON*Math.max(1,Math.abs(n),Math.abs(t))&&Math.abs(e-
B)<=k.EPSILON*Math.max(1,Math.abs(e),Math.abs(B))&&Math.abs(r-D)<=k.EPSILON*Math.max(1,Math.abs(r),Math.abs(D))};g.exports=d},function(g,d,e){var k=e(24),b={scalar:{},SIMD:{},create:function(){var a=new k.ARRAY_TYPE(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){var c=new k.ARRAY_TYPE(16);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];
c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},copy:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];a[9]=c[9];a[10]=c[10];a[11]=c[11];a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a},fromValues:function(a,c,f,b,d,l,h,n,e,r,q,g,x,v,y,A){var t=new k.ARRAY_TYPE(16);t[0]=a;t[1]=c;t[2]=f;t[3]=b;t[4]=d;t[5]=l;t[6]=h;t[7]=n;t[8]=e;t[9]=r;t[10]=q;t[11]=g;t[12]=x;t[13]=v;t[14]=y;t[15]=A;return t},set:function(a,c,f,b,d,
l,h,n,e,r,q,k,g,v,y,A,t){a[0]=c;a[1]=f;a[2]=b;a[3]=d;a[4]=l;a[5]=h;a[6]=n;a[7]=e;a[8]=r;a[9]=q;a[10]=k;a[11]=g;a[12]=v;a[13]=y;a[14]=A;a[15]=t;return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}};b.scalar.transpose=function(a,c){if(a===c){var f=c[1],b=c[2],d=c[3],l=c[6],h=c[7],n=c[11];a[1]=c[4];a[2]=c[8];a[3]=c[12];a[4]=f;a[6]=c[9];a[7]=c[13];a[8]=b;a[9]=l;a[11]=c[14];a[12]=d;a[13]=h;a[14]=n}else a[0]=
c[0],a[1]=c[4],a[2]=c[8],a[3]=c[12],a[4]=c[1],a[5]=c[5],a[6]=c[9],a[7]=c[13],a[8]=c[2],a[9]=c[6],a[10]=c[10],a[11]=c[14],a[12]=c[3],a[13]=c[7],a[14]=c[11],a[15]=c[15];return a};b.SIMD.transpose=function(a,c){var f,b,d,l,h,n,e;f=SIMD.Float32x4.load(c,0);b=SIMD.Float32x4.load(c,4);d=SIMD.Float32x4.load(c,8);l=SIMD.Float32x4.load(c,12);h=SIMD.Float32x4.shuffle(f,b,0,1,4,5);n=SIMD.Float32x4.shuffle(d,l,0,1,4,5);e=SIMD.Float32x4.shuffle(h,n,0,2,4,6);h=SIMD.Float32x4.shuffle(h,n,1,3,5,7);SIMD.Float32x4.store(a,
0,e);SIMD.Float32x4.store(a,4,h);h=SIMD.Float32x4.shuffle(f,b,2,3,6,7);n=SIMD.Float32x4.shuffle(d,l,2,3,6,7);f=SIMD.Float32x4.shuffle(h,n,0,2,4,6);b=SIMD.Float32x4.shuffle(h,n,1,3,5,7);SIMD.Float32x4.store(a,8,f);SIMD.Float32x4.store(a,12,b);return a};b.transpose=k.USE_SIMD?b.SIMD.transpose:b.scalar.transpose;b.scalar.invert=function(a,c){var f=c[0],b=c[1],d=c[2],l=c[3],h=c[4],n=c[5],e=c[6],r=c[7],q=c[8],k=c[9],g=c[10],v=c[11],y=c[12],A=c[13],t=c[14],B=c[15],D=f*n-b*h,z=f*e-d*h,C=f*r-l*h,G=b*e-d*
n,F=b*r-l*n,J=d*r-l*e,Q=q*A-k*y,P=q*t-g*y,W=q*B-v*y,R=k*t-g*A,S=k*B-v*A,X=g*B-v*t,N=D*X-z*S+C*R+G*W-F*P+J*Q;if(!N)return null;N=1/N;a[0]=(n*X-e*S+r*R)*N;a[1]=(d*S-b*X-l*R)*N;a[2]=(A*J-t*F+B*G)*N;a[3]=(g*F-k*J-v*G)*N;a[4]=(e*W-h*X-r*P)*N;a[5]=(f*X-d*W+l*P)*N;a[6]=(t*C-y*J-B*z)*N;a[7]=(q*J-g*C+v*z)*N;a[8]=(h*S-n*W+r*Q)*N;a[9]=(b*W-f*S-l*Q)*N;a[10]=(y*F-A*C+B*D)*N;a[11]=(k*C-q*F-v*D)*N;a[12]=(n*P-h*R-e*Q)*N;a[13]=(f*R-b*P+d*Q)*N;a[14]=(A*z-y*G-t*D)*N;a[15]=(q*G-k*z+g*D)*N;return a};b.SIMD.invert=function(a,
c){var f,b,d,l,h,n,e,r,q;n=SIMD.Float32x4.load(c,0);e=SIMD.Float32x4.load(c,4);r=SIMD.Float32x4.load(c,8);q=SIMD.Float32x4.load(c,12);h=SIMD.Float32x4.shuffle(n,e,0,1,4,5);b=SIMD.Float32x4.shuffle(r,q,0,1,4,5);f=SIMD.Float32x4.shuffle(h,b,0,2,4,6);b=SIMD.Float32x4.shuffle(b,h,1,3,5,7);h=SIMD.Float32x4.shuffle(n,e,2,3,6,7);l=SIMD.Float32x4.shuffle(r,q,2,3,6,7);d=SIMD.Float32x4.shuffle(h,l,0,2,4,6);l=SIMD.Float32x4.shuffle(l,h,1,3,5,7);h=SIMD.Float32x4.mul(d,l);h=SIMD.Float32x4.swizzle(h,1,0,3,2);n=
SIMD.Float32x4.mul(b,h);e=SIMD.Float32x4.mul(f,h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,h),n);e=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,h),e);e=SIMD.Float32x4.swizzle(e,2,3,0,1);h=SIMD.Float32x4.mul(b,d);h=SIMD.Float32x4.swizzle(h,1,0,3,2);n=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,h),n);q=SIMD.Float32x4.mul(f,h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);n=SIMD.Float32x4.sub(n,SIMD.Float32x4.mul(l,h));q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,h),q);q=SIMD.Float32x4.swizzle(q,
2,3,0,1);h=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,3,0,1),l);h=SIMD.Float32x4.swizzle(h,1,0,3,2);d=SIMD.Float32x4.swizzle(d,2,3,0,1);n=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,h),n);r=SIMD.Float32x4.mul(f,h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);n=SIMD.Float32x4.sub(n,SIMD.Float32x4.mul(d,h));r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,h),r);r=SIMD.Float32x4.swizzle(r,2,3,0,1);h=SIMD.Float32x4.mul(f,b);h=SIMD.Float32x4.swizzle(h,1,0,3,2);r=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,h),r);q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,
h),q);h=SIMD.Float32x4.swizzle(h,2,3,0,1);r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,h),r);q=SIMD.Float32x4.sub(q,SIMD.Float32x4.mul(d,h));h=SIMD.Float32x4.mul(f,l);h=SIMD.Float32x4.swizzle(h,1,0,3,2);e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(d,h));r=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,h),r);h=SIMD.Float32x4.swizzle(h,2,3,0,1);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,h),e);r=SIMD.Float32x4.sub(r,SIMD.Float32x4.mul(b,h));h=SIMD.Float32x4.mul(f,d);h=SIMD.Float32x4.swizzle(h,1,0,3,2);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,
h),e);q=SIMD.Float32x4.sub(q,SIMD.Float32x4.mul(b,h));h=SIMD.Float32x4.swizzle(h,2,3,0,1);e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(l,h));q=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,h),q);f=SIMD.Float32x4.mul(f,n);f=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(f,2,3,0,1),f);f=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(f,1,0,3,2),f);h=SIMD.Float32x4.reciprocalApproximation(f);f=SIMD.Float32x4.sub(SIMD.Float32x4.add(h,h),SIMD.Float32x4.mul(f,SIMD.Float32x4.mul(h,h)));f=SIMD.Float32x4.swizzle(f,0,0,0,0);if(!f)return null;
SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(f,n));SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(f,e));SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(f,r));SIMD.Float32x4.store(a,12,SIMD.Float32x4.mul(f,q));return a};b.invert=k.USE_SIMD?b.SIMD.invert:b.scalar.invert;b.scalar.adjoint=function(a,c){var f=c[0],b=c[1],d=c[2],l=c[3],h=c[4],e=c[5],p=c[6],r=c[7],q=c[8],k=c[9],g=c[10],v=c[11],y=c[12],A=c[13],t=c[14],B=c[15];a[0]=e*(g*B-v*t)-k*(p*B-r*t)+A*(p*v-r*g);a[1]=-(b*(g*B-v*t)-k*(d*B-l*t)+A*(d*v-l*g));a[2]=
b*(p*B-r*t)-e*(d*B-l*t)+A*(d*r-l*p);a[3]=-(b*(p*v-r*g)-e*(d*v-l*g)+k*(d*r-l*p));a[4]=-(h*(g*B-v*t)-q*(p*B-r*t)+y*(p*v-r*g));a[5]=f*(g*B-v*t)-q*(d*B-l*t)+y*(d*v-l*g);a[6]=-(f*(p*B-r*t)-h*(d*B-l*t)+y*(d*r-l*p));a[7]=f*(p*v-r*g)-h*(d*v-l*g)+q*(d*r-l*p);a[8]=h*(k*B-v*A)-q*(e*B-r*A)+y*(e*v-r*k);a[9]=-(f*(k*B-v*A)-q*(b*B-l*A)+y*(b*v-l*k));a[10]=f*(e*B-r*A)-h*(b*B-l*A)+y*(b*r-l*e);a[11]=-(f*(e*v-r*k)-h*(b*v-l*k)+q*(b*r-l*e));a[12]=-(h*(k*t-g*A)-q*(e*t-p*A)+y*(e*g-p*k));a[13]=f*(k*t-g*A)-q*(b*t-d*A)+y*(b*
g-d*k);a[14]=-(f*(e*t-p*A)-h*(b*t-d*A)+y*(b*p-d*e));a[15]=f*(e*g-p*k)-h*(b*g-d*k)+q*(b*p-d*e);return a};b.SIMD.adjoint=function(a,c){var f,b,d,l,h,e,p,r,q;f=SIMD.Float32x4.load(c,0);b=SIMD.Float32x4.load(c,4);d=SIMD.Float32x4.load(c,8);l=SIMD.Float32x4.load(c,12);p=SIMD.Float32x4.shuffle(f,b,0,1,4,5);e=SIMD.Float32x4.shuffle(d,l,0,1,4,5);h=SIMD.Float32x4.shuffle(p,e,0,2,4,6);e=SIMD.Float32x4.shuffle(e,p,1,3,5,7);p=SIMD.Float32x4.shuffle(f,b,2,3,6,7);b=SIMD.Float32x4.shuffle(d,l,2,3,6,7);f=SIMD.Float32x4.shuffle(p,
b,0,2,4,6);b=SIMD.Float32x4.shuffle(b,p,1,3,5,7);p=SIMD.Float32x4.mul(f,b);p=SIMD.Float32x4.swizzle(p,1,0,3,2);d=SIMD.Float32x4.mul(e,p);l=SIMD.Float32x4.mul(h,p);p=SIMD.Float32x4.swizzle(p,2,3,0,1);d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,p),d);l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,p),l);l=SIMD.Float32x4.swizzle(l,2,3,0,1);p=SIMD.Float32x4.mul(e,f);p=SIMD.Float32x4.swizzle(p,1,0,3,2);d=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,p),d);q=SIMD.Float32x4.mul(h,p);p=SIMD.Float32x4.swizzle(p,2,3,0,1);
d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(b,p));q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,p),q);q=SIMD.Float32x4.swizzle(q,2,3,0,1);p=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,2,3,0,1),b);p=SIMD.Float32x4.swizzle(p,1,0,3,2);f=SIMD.Float32x4.swizzle(f,2,3,0,1);d=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,p),d);r=SIMD.Float32x4.mul(h,p);p=SIMD.Float32x4.swizzle(p,2,3,0,1);d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(f,p));r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,p),r);r=SIMD.Float32x4.swizzle(r,2,3,0,
1);p=SIMD.Float32x4.mul(h,e);p=SIMD.Float32x4.swizzle(p,1,0,3,2);r=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,p),r);q=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,p),q);p=SIMD.Float32x4.swizzle(p,2,3,0,1);r=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,p),r);q=SIMD.Float32x4.sub(q,SIMD.Float32x4.mul(f,p));p=SIMD.Float32x4.mul(h,b);p=SIMD.Float32x4.swizzle(p,1,0,3,2);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(f,p));r=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,p),r);p=SIMD.Float32x4.swizzle(p,2,3,0,1);l=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,
p),l);r=SIMD.Float32x4.sub(r,SIMD.Float32x4.mul(e,p));p=SIMD.Float32x4.mul(h,f);p=SIMD.Float32x4.swizzle(p,1,0,3,2);l=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,p),l);q=SIMD.Float32x4.sub(q,SIMD.Float32x4.mul(e,p));p=SIMD.Float32x4.swizzle(p,2,3,0,1);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(b,p));q=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,p),q);SIMD.Float32x4.store(a,0,d);SIMD.Float32x4.store(a,4,l);SIMD.Float32x4.store(a,8,r);SIMD.Float32x4.store(a,12,q);return a};b.adjoint=k.USE_SIMD?b.SIMD.adjoint:
b.scalar.adjoint;b.determinant=function(a){var c=a[0],f=a[1],b=a[2],d=a[3],l=a[4],e=a[5],n=a[6],p=a[7],r=a[8],q=a[9],k=a[10],g=a[11],v=a[12],y=a[13],A=a[14];a=a[15];return(c*e-f*l)*(k*a-g*A)-(c*n-b*l)*(q*a-g*y)+(c*p-d*l)*(q*A-k*y)+(f*n-b*e)*(r*a-g*v)-(f*p-d*e)*(r*A-k*v)+(b*p-d*n)*(r*y-q*v)};b.SIMD.multiply=function(a,c,f){var b=SIMD.Float32x4.load(c,0),d=SIMD.Float32x4.load(c,4),e=SIMD.Float32x4.load(c,8);c=SIMD.Float32x4.load(c,12);var h=SIMD.Float32x4.load(f,0),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,
0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),e),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),c))));SIMD.Float32x4.store(a,0,h);h=SIMD.Float32x4.load(f,4);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),e),
SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),c))));SIMD.Float32x4.store(a,4,h);h=SIMD.Float32x4.load(f,8);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),e),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),c))));SIMD.Float32x4.store(a,8,h);f=SIMD.Float32x4.load(f,12);b=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,
0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,1,1,1,1),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,2,2,2),e),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,3,3,3,3),c))));SIMD.Float32x4.store(a,12,b);return a};b.scalar.multiply=function(a,c,f){var b=c[0],d=c[1],e=c[2],h=c[3],n=c[4],p=c[5],r=c[6],q=c[7],k=c[8],g=c[9],v=c[10],y=c[11],A=c[12],t=c[13],B=c[14];c=c[15];var D=f[0],z=f[1],C=f[2],G=f[3];a[0]=D*b+z*n+C*k+G*A;a[1]=D*d+z*p+C*g+G*t;a[2]=D*e+z*
r+C*v+G*B;a[3]=D*h+z*q+C*y+G*c;D=f[4];z=f[5];C=f[6];G=f[7];a[4]=D*b+z*n+C*k+G*A;a[5]=D*d+z*p+C*g+G*t;a[6]=D*e+z*r+C*v+G*B;a[7]=D*h+z*q+C*y+G*c;D=f[8];z=f[9];C=f[10];G=f[11];a[8]=D*b+z*n+C*k+G*A;a[9]=D*d+z*p+C*g+G*t;a[10]=D*e+z*r+C*v+G*B;a[11]=D*h+z*q+C*y+G*c;D=f[12];z=f[13];C=f[14];G=f[15];a[12]=D*b+z*n+C*k+G*A;a[13]=D*d+z*p+C*g+G*t;a[14]=D*e+z*r+C*v+G*B;a[15]=D*h+z*q+C*y+G*c;return a};b.multiply=k.USE_SIMD?b.SIMD.multiply:b.scalar.multiply;b.mul=b.multiply;b.scalar.translate=function(a,c,f){var b=
f[0],d=f[1];f=f[2];var e,h,n,p,r,q,k,g,v,y,A,t;c===a?(a[12]=c[0]*b+c[4]*d+c[8]*f+c[12],a[13]=c[1]*b+c[5]*d+c[9]*f+c[13],a[14]=c[2]*b+c[6]*d+c[10]*f+c[14],a[15]=c[3]*b+c[7]*d+c[11]*f+c[15]):(e=c[0],h=c[1],n=c[2],p=c[3],r=c[4],q=c[5],k=c[6],g=c[7],v=c[8],y=c[9],A=c[10],t=c[11],a[0]=e,a[1]=h,a[2]=n,a[3]=p,a[4]=r,a[5]=q,a[6]=k,a[7]=g,a[8]=v,a[9]=y,a[10]=A,a[11]=t,a[12]=e*b+r*d+v*f+c[12],a[13]=h*b+q*d+y*f+c[13],a[14]=n*b+k*d+A*f+c[14],a[15]=p*b+g*d+t*f+c[15]);return a};b.SIMD.translate=function(a,c,f){var b=
SIMD.Float32x4.load(c,0),d=SIMD.Float32x4.load(c,4),e=SIMD.Float32x4.load(c,8),h=SIMD.Float32x4.load(c,12);f=SIMD.Float32x4(f[0],f[1],f[2],0);c!==a&&(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11]);b=SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(f,0,0,0,0));d=SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(f,1,1,1,1));e=SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(f,2,2,2,2));c=SIMD.Float32x4.add(b,SIMD.Float32x4.add(d,SIMD.Float32x4.add(e,
h)));SIMD.Float32x4.store(a,12,c);return a};b.translate=k.USE_SIMD?b.SIMD.translate:b.scalar.translate;b.scalar.scale=function(a,c,f){var b=f[0],d=f[1];f=f[2];a[0]=c[0]*b;a[1]=c[1]*b;a[2]=c[2]*b;a[3]=c[3]*b;a[4]=c[4]*d;a[5]=c[5]*d;a[6]=c[6]*d;a[7]=c[7]*d;a[8]=c[8]*f;a[9]=c[9]*f;a[10]=c[10]*f;a[11]=c[11]*f;a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a};b.SIMD.scale=function(a,c,f){var b;f=SIMD.Float32x4(f[0],f[1],f[2],0);b=SIMD.Float32x4.load(c,0);SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(b,
SIMD.Float32x4.swizzle(f,0,0,0,0)));b=SIMD.Float32x4.load(c,4);SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(f,1,1,1,1)));b=SIMD.Float32x4.load(c,8);SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(f,2,2,2,2)));a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a};b.scale=k.USE_SIMD?b.SIMD.scale:b.scalar.scale;b.rotate=function(a,c,f,b){var d=b[0],e=b[1];b=b[2];var h=Math.sqrt(d*d+e*e+b*b),n,p,r,q,g,x,v,y,A,t,B,D,z,C,G,F,J,Q,P,W;if(Math.abs(h)<k.EPSILON)return null;
h=1/h;d*=h;e*=h;b*=h;n=Math.sin(f);p=Math.cos(f);r=1-p;f=c[0];h=c[1];q=c[2];g=c[3];x=c[4];v=c[5];y=c[6];A=c[7];t=c[8];B=c[9];D=c[10];z=c[11];C=d*d*r+p;G=e*d*r+b*n;F=b*d*r-e*n;J=d*e*r-b*n;Q=e*e*r+p;P=b*e*r+d*n;W=d*b*r+e*n;d=e*b*r-d*n;e=b*b*r+p;a[0]=f*C+x*G+t*F;a[1]=h*C+v*G+B*F;a[2]=q*C+y*G+D*F;a[3]=g*C+A*G+z*F;a[4]=f*J+x*Q+t*P;a[5]=h*J+v*Q+B*P;a[6]=q*J+y*Q+D*P;a[7]=g*J+A*Q+z*P;a[8]=f*W+x*d+t*e;a[9]=h*W+v*d+B*e;a[10]=q*W+y*d+D*e;a[11]=g*W+A*d+z*e;c!==a&&(a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);
return a};b.scalar.rotateX=function(a,c,f){var b=Math.sin(f);f=Math.cos(f);var d=c[4],e=c[5],h=c[6],n=c[7],p=c[8],r=c[9],q=c[10],k=c[11];c!==a&&(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[4]=d*f+p*b;a[5]=e*f+r*b;a[6]=h*f+q*b;a[7]=n*f+k*b;a[8]=p*f-d*b;a[9]=r*f-e*b;a[10]=q*f-h*b;a[11]=k*f-n*b;return a};b.SIMD.rotateX=function(a,c,f){var b=SIMD.Float32x4.splat(Math.sin(f));f=SIMD.Float32x4.splat(Math.cos(f));c!==a&&(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],
a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);var d=SIMD.Float32x4.load(c,4);c=SIMD.Float32x4.load(c,8);SIMD.Float32x4.store(a,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(d,f),SIMD.Float32x4.mul(c,b)));SIMD.Float32x4.store(a,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,f),SIMD.Float32x4.mul(d,b)));return a};b.rotateX=k.USE_SIMD?b.SIMD.rotateX:b.scalar.rotateX;b.scalar.rotateY=function(a,c,f){var b=Math.sin(f);f=Math.cos(f);var d=c[0],e=c[1],h=c[2],n=c[3],p=c[8],r=c[9],q=c[10],k=c[11];c!==a&&(a[4]=c[4],
a[5]=c[5],a[6]=c[6],a[7]=c[7],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[0]=d*f-p*b;a[1]=e*f-r*b;a[2]=h*f-q*b;a[3]=n*f-k*b;a[8]=d*b+p*f;a[9]=e*b+r*f;a[10]=h*b+q*f;a[11]=n*b+k*f;return a};b.SIMD.rotateY=function(a,c,f){var b=SIMD.Float32x4.splat(Math.sin(f));f=SIMD.Float32x4.splat(Math.cos(f));c!==a&&(a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);var d=SIMD.Float32x4.load(c,0);c=SIMD.Float32x4.load(c,8);SIMD.Float32x4.store(a,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,
f),SIMD.Float32x4.mul(c,b)));SIMD.Float32x4.store(a,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(d,b),SIMD.Float32x4.mul(c,f)));return a};b.rotateY=k.USE_SIMD?b.SIMD.rotateY:b.scalar.rotateY;b.scalar.rotateZ=function(a,c,f){var b=Math.sin(f);f=Math.cos(f);var d=c[0],e=c[1],h=c[2],n=c[3],p=c[4],r=c[5],q=c[6],k=c[7];c!==a&&(a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[0]=d*f+p*b;a[1]=e*f+r*b;a[2]=h*f+q*b;a[3]=n*f+k*b;a[4]=p*f-d*b;a[5]=r*f-e*b;a[6]=q*f-h*
b;a[7]=k*f-n*b;return a};b.SIMD.rotateZ=function(a,c,b){var d=SIMD.Float32x4.splat(Math.sin(b));b=SIMD.Float32x4.splat(Math.cos(b));c!==a&&(a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);var e=SIMD.Float32x4.load(c,0);c=SIMD.Float32x4.load(c,4);SIMD.Float32x4.store(a,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(e,b),SIMD.Float32x4.mul(c,d)));SIMD.Float32x4.store(a,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,b),SIMD.Float32x4.mul(e,d)));return a};b.rotateZ=k.USE_SIMD?
b.SIMD.rotateZ:b.scalar.rotateZ;b.fromTranslation=function(a,c){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};b.fromScaling=function(a,c){a[0]=c[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=c[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotation=function(a,c,b){var d=b[0],e=b[1];b=b[2];var l=Math.sqrt(d*d+e*e+b*b),h;if(Math.abs(l)<k.EPSILON)return null;l=1/l;d*=l;
e*=l;b*=l;l=Math.sin(c);c=Math.cos(c);h=1-c;a[0]=d*d*h+c;a[1]=e*d*h+b*l;a[2]=b*d*h-e*l;a[3]=0;a[4]=d*e*h-b*l;a[5]=e*e*h+c;a[6]=b*e*h+d*l;a[7]=0;a[8]=d*b*h+e*l;a[9]=e*b*h-d*l;a[10]=b*b*h+c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromXRotation=function(a,c){var b=Math.sin(c),d=Math.cos(c);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=d;a[6]=b;a[7]=0;a[8]=0;a[9]=-b;a[10]=d;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromYRotation=function(a,c){var b=Math.sin(c),d=Math.cos(c);a[0]=d;a[1]=
0;a[2]=-b;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=b;a[9]=0;a[10]=d;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromZRotation=function(a,c){var b=Math.sin(c),d=Math.cos(c);a[0]=d;a[1]=b;a[2]=0;a[3]=0;a[4]=-b;a[5]=d;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotationTranslation=function(a,c,b){var d=c[0],e=c[1],l=c[2],h=c[3],n=d+d,p=e+e,r=l+l;c=d*n;var q=d*p,d=d*r,k=e*p,e=e*r,l=l*r,n=h*n,p=h*p,h=h*r;a[0]=1-(k+l);a[1]=q+h;a[2]=d-p;a[3]=0;a[4]=
q-h;a[5]=1-(c+l);a[6]=e+n;a[7]=0;a[8]=d+p;a[9]=e-n;a[10]=1-(c+k);a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};b.getTranslation=function(a,c){a[0]=c[12];a[1]=c[13];a[2]=c[14];return a};b.getRotation=function(a,c){var b=c[0]+c[5]+c[10],d=0;0<b?(d=2*Math.sqrt(b+1),a[3]=.25*d,a[0]=(c[6]-c[9])/d,a[1]=(c[8]-c[2])/d,a[2]=(c[1]-c[4])/d):c[0]>c[5]&c[0]>c[10]?(d=2*Math.sqrt(1+c[0]-c[5]-c[10]),a[3]=(c[6]-c[9])/d,a[0]=.25*d,a[1]=(c[1]+c[4])/d,a[2]=(c[8]+c[2])/d):c[5]>c[10]?(d=2*Math.sqrt(1+c[5]-
c[0]-c[10]),a[3]=(c[8]-c[2])/d,a[0]=(c[1]+c[4])/d,a[1]=.25*d,a[2]=(c[6]+c[9])/d):(d=2*Math.sqrt(1+c[10]-c[0]-c[5]),a[3]=(c[1]-c[4])/d,a[0]=(c[8]+c[2])/d,a[1]=(c[6]+c[9])/d,a[2]=.25*d);return a};b.fromRotationTranslationScale=function(a,c,b,d){var e=c[0],l=c[1],h=c[2],n=c[3],p=e+e,k=l+l,q=h+h;c=e*p;var g=e*k,e=e*q,x=l*k,l=l*q,h=h*q,p=n*p,k=n*k,n=n*q,q=d[0],v=d[1];d=d[2];a[0]=(1-(x+h))*q;a[1]=(g+n)*q;a[2]=(e-k)*q;a[3]=0;a[4]=(g-n)*v;a[5]=(1-(c+h))*v;a[6]=(l+p)*v;a[7]=0;a[8]=(e+k)*d;a[9]=(l-p)*d;a[10]=
(1-(c+x))*d;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};b.fromRotationTranslationScaleOrigin=function(a,c,b,d,e){var l=c[0],h=c[1],n=c[2],p=c[3],k=l+l,q=h+h,g=n+n;c=l*k;var x=l*q,l=l*g,v=h*q,h=h*g,n=n*g,k=p*k,q=p*q,p=p*g,g=d[0],y=d[1];d=d[2];var A=e[0],t=e[1];e=e[2];a[0]=(1-(v+n))*g;a[1]=(x+p)*g;a[2]=(l-q)*g;a[3]=0;a[4]=(x-p)*y;a[5]=(1-(c+n))*y;a[6]=(h+k)*y;a[7]=0;a[8]=(l+q)*d;a[9]=(h-k)*d;a[10]=(1-(c+v))*d;a[11]=0;a[12]=b[0]+A-(a[0]*A+a[4]*t+a[8]*e);a[13]=b[1]+t-(a[1]*A+a[5]*t+a[9]*
e);a[14]=b[2]+e-(a[2]*A+a[6]*t+a[10]*e);a[15]=1;return a};b.fromQuat=function(a,c){var b=c[0],d=c[1],e=c[2],l=c[3],h=b+b,n=d+d,p=e+e,b=b*h,k=d*h,d=d*n,q=e*h,g=e*n,e=e*p,h=l*h,n=l*n,l=l*p;a[0]=1-d-e;a[1]=k+l;a[2]=q-n;a[3]=0;a[4]=k-l;a[5]=1-b-e;a[6]=g+h;a[7]=0;a[8]=q+n;a[9]=g-h;a[10]=1-b-d;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.frustum=function(a,c,b,d,e,l,h){var n=1/(b-c),p=1/(e-d),k=1/(l-h);a[0]=2*l*n;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*l*p;a[6]=0;a[7]=0;a[8]=(b+c)*n;a[9]=(e+d)*p;a[10]=
(h+l)*k;a[11]=-1;a[12]=0;a[13]=0;a[14]=h*l*2*k;a[15]=0;return a};b.perspective=function(a,c,b,d,e){c=1/Math.tan(c/2);var l=1/(d-e);a[0]=c/b;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(e+d)*l;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*e*d*l;a[15]=0;return a};b.perspectiveFromFieldOfView=function(a,c,b,d){var e=Math.tan(c.upDegrees*Math.PI/180),l=Math.tan(c.downDegrees*Math.PI/180),h=Math.tan(c.leftDegrees*Math.PI/180);c=Math.tan(c.rightDegrees*Math.PI/180);var n=2/(h+c),p=2/(e+l);a[0]=
n;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=p;a[6]=0;a[7]=0;a[8]=-((h-c)*n*.5);a[9]=(e-l)*p*.5;a[10]=d/(b-d);a[11]=-1;a[12]=0;a[13]=0;a[14]=d*b/(b-d);a[15]=0;return a};b.ortho=function(a,c,b,d,e,l,h){var n=1/(c-b),p=1/(d-e),k=1/(l-h);a[0]=-2*n;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*p;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*k;a[11]=0;a[12]=(c+b)*n;a[13]=(e+d)*p;a[14]=(h+l)*k;a[15]=1;return a};b.lookAt=function(a,c,f,d){var e,l,h,n,p,g,q,w,x=c[0],v=c[1];c=c[2];h=d[0];n=d[1];l=d[2];q=f[0];d=f[1];e=f[2];if(Math.abs(x-
q)<k.EPSILON&&Math.abs(v-d)<k.EPSILON&&Math.abs(c-e)<k.EPSILON)return b.identity(a);f=x-q;d=v-d;q=c-e;w=1/Math.sqrt(f*f+d*d+q*q);f*=w;d*=w;q*=w;e=n*q-l*d;l=l*f-h*q;h=h*d-n*f;(w=Math.sqrt(e*e+l*l+h*h))?(w=1/w,e*=w,l*=w,h*=w):h=l=e=0;n=d*h-q*l;p=q*e-f*h;g=f*l-d*e;(w=Math.sqrt(n*n+p*p+g*g))?(w=1/w,n*=w,p*=w,g*=w):g=p=n=0;a[0]=e;a[1]=n;a[2]=f;a[3]=0;a[4]=l;a[5]=p;a[6]=d;a[7]=0;a[8]=h;a[9]=g;a[10]=q;a[11]=0;a[12]=-(e*x+l*v+h*c);a[13]=-(n*x+p*v+g*c);a[14]=-(f*x+d*v+q*c);a[15]=1;return a};b.str=function(a){return"mat4("+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};b.add=function(a,c,
b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];a[2]=c[2]+b[2];a[3]=c[3]+b[3];a[4]=c[4]+b[4];a[5]=c[5]+b[5];a[6]=c[6]+b[6];a[7]=c[7]+b[7];a[8]=c[8]+b[8];a[9]=c[9]+b[9];a[10]=c[10]+b[10];a[11]=c[11]+b[11];a[12]=c[12]+b[12];a[13]=c[13]+b[13];a[14]=c[14]+b[14];a[15]=c[15]+b[15];return a};b.subtract=function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];a[2]=c[2]-b[2];a[3]=c[3]-b[3];a[4]=c[4]-b[4];a[5]=c[5]-b[5];a[6]=c[6]-b[6];a[7]=c[7]-b[7];a[8]=c[8]-b[8];a[9]=c[9]-b[9];a[10]=c[10]-b[10];a[11]=c[11]-b[11];a[12]=c[12]-b[12];
a[13]=c[13]-b[13];a[14]=c[14]-b[14];a[15]=c[15]-b[15];return a};b.sub=b.subtract;b.multiplyScalar=function(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;a[2]=c[2]*b;a[3]=c[3]*b;a[4]=c[4]*b;a[5]=c[5]*b;a[6]=c[6]*b;a[7]=c[7]*b;a[8]=c[8]*b;a[9]=c[9]*b;a[10]=c[10]*b;a[11]=c[11]*b;a[12]=c[12]*b;a[13]=c[13]*b;a[14]=c[14]*b;a[15]=c[15]*b;return a};b.multiplyScalarAndAdd=function(a,c,b,d){a[0]=c[0]+b[0]*d;a[1]=c[1]+b[1]*d;a[2]=c[2]+b[2]*d;a[3]=c[3]+b[3]*d;a[4]=c[4]+b[4]*d;a[5]=c[5]+b[5]*d;a[6]=c[6]+b[6]*d;a[7]=c[7]+b[7]*
d;a[8]=c[8]+b[8]*d;a[9]=c[9]+b[9]*d;a[10]=c[10]+b[10]*d;a[11]=c[11]+b[11]*d;a[12]=c[12]+b[12]*d;a[13]=c[13]+b[13]*d;a[14]=c[14]+b[14]*d;a[15]=c[15]+b[15]*d;return a};b.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&a[8]===c[8]&&a[9]===c[9]&&a[10]===c[10]&&a[11]===c[11]&&a[12]===c[12]&&a[13]===c[13]&&a[14]===c[14]&&a[15]===c[15]};b.equals=function(a,c){var b=a[0],d=a[1],e=a[2],l=a[3],h=a[4],n=a[5],p=a[6],g=a[7],
q=a[8],w=a[9],x=a[10],v=a[11],y=a[12],A=a[13],t=a[14],B=a[15],D=c[0],z=c[1],C=c[2],G=c[3],F=c[4],J=c[5],Q=c[6],P=c[7],W=c[8],R=c[9],S=c[10],X=c[11],N=c[12],Y=c[13],ba=c[14],ya=c[15];return Math.abs(b-D)<=k.EPSILON*Math.max(1,Math.abs(b),Math.abs(D))&&Math.abs(d-z)<=k.EPSILON*Math.max(1,Math.abs(d),Math.abs(z))&&Math.abs(e-C)<=k.EPSILON*Math.max(1,Math.abs(e),Math.abs(C))&&Math.abs(l-G)<=k.EPSILON*Math.max(1,Math.abs(l),Math.abs(G))&&Math.abs(h-F)<=k.EPSILON*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(n-
J)<=k.EPSILON*Math.max(1,Math.abs(n),Math.abs(J))&&Math.abs(p-Q)<=k.EPSILON*Math.max(1,Math.abs(p),Math.abs(Q))&&Math.abs(g-P)<=k.EPSILON*Math.max(1,Math.abs(g),Math.abs(P))&&Math.abs(q-W)<=k.EPSILON*Math.max(1,Math.abs(q),Math.abs(W))&&Math.abs(w-R)<=k.EPSILON*Math.max(1,Math.abs(w),Math.abs(R))&&Math.abs(x-S)<=k.EPSILON*Math.max(1,Math.abs(x),Math.abs(S))&&Math.abs(v-X)<=k.EPSILON*Math.max(1,Math.abs(v),Math.abs(X))&&Math.abs(y-N)<=k.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(A-Y)<=k.EPSILON*
Math.max(1,Math.abs(A),Math.abs(Y))&&Math.abs(t-ba)<=k.EPSILON*Math.max(1,Math.abs(t),Math.abs(ba))&&Math.abs(B-ya)<=k.EPSILON*Math.max(1,Math.abs(B),Math.abs(ya))};g.exports=b},function(g,d,e){var k=e(24),b=e(27),a=e(30);d=e(31);var c={create:function(){var a=new k.ARRAY_TYPE(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}};c.rotationTo=function(){var b=a.create(),d=a.fromValues(1,0,0),e=a.fromValues(0,1,0);return function(l,h,n){var p=a.dot(h,n);if(-.999999>p)return a.cross(b,d,h),1E-6>a.length(b)&&a.cross(b,
e,h),a.normalize(b,b),c.setAxisAngle(l,b,Math.PI),l;if(.999999<p)return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l;a.cross(b,h,n);l[0]=b[0];l[1]=b[1];l[2]=b[2];l[3]=1+p;return c.normalize(l,l)}}();c.setAxes=function(){var a=b.create();return function(b,d,e,h){a[0]=e[0];a[3]=e[1];a[6]=e[2];a[1]=h[0];a[4]=h[1];a[7]=h[2];a[2]=-d[0];a[5]=-d[1];a[8]=-d[2];return c.normalize(b,c.fromMat3(b,a))}}();c.clone=d.clone;c.fromValues=d.fromValues;c.copy=d.copy;c.set=d.set;c.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;
return a};c.setAxisAngle=function(a,c,b){b*=.5;var d=Math.sin(b);a[0]=d*c[0];a[1]=d*c[1];a[2]=d*c[2];a[3]=Math.cos(b);return a};c.getAxisAngle=function(a,c){var b=2*Math.acos(c[3]),d=Math.sin(b/2);0!=d?(a[0]=c[0]/d,a[1]=c[1]/d,a[2]=c[2]/d):(a[0]=1,a[1]=0,a[2]=0);return b};c.add=d.add;c.multiply=function(a,c,b){var d=c[0],e=c[1],n=c[2];c=c[3];var p=b[0],k=b[1],q=b[2];b=b[3];a[0]=d*b+c*p+e*q-n*k;a[1]=e*b+c*k+n*p-d*q;a[2]=n*b+c*q+d*k-e*p;a[3]=c*b-d*p-e*k-n*q;return a};c.mul=c.multiply;c.scale=d.scale;
c.rotateX=function(a,c,b){b*=.5;var d=c[0],e=c[1],n=c[2];c=c[3];var p=Math.sin(b);b=Math.cos(b);a[0]=d*b+c*p;a[1]=e*b+n*p;a[2]=n*b-e*p;a[3]=c*b-d*p;return a};c.rotateY=function(a,c,b){b*=.5;var d=c[0],e=c[1],n=c[2];c=c[3];var p=Math.sin(b);b=Math.cos(b);a[0]=d*b-n*p;a[1]=e*b+c*p;a[2]=n*b+d*p;a[3]=c*b-e*p;return a};c.rotateZ=function(a,c,b){b*=.5;var d=c[0],e=c[1],n=c[2];c=c[3];var p=Math.sin(b);b=Math.cos(b);a[0]=d*b+e*p;a[1]=e*b-d*p;a[2]=n*b+c*p;a[3]=c*b-n*p;return a};c.calculateW=function(a,c){var b=
c[0],d=c[1],e=c[2];a[0]=b;a[1]=d;a[2]=e;a[3]=Math.sqrt(Math.abs(1-b*b-d*d-e*e));return a};c.dot=d.dot;c.lerp=d.lerp;c.slerp=function(a,c,b,d){var e=c[0],n=c[1],p=c[2];c=c[3];var k=b[0],q=b[1],g=b[2];b=b[3];var x,v,y;v=e*k+n*q+p*g+c*b;0>v&&(v=-v,k=-k,q=-q,g=-g,b=-b);1E-6<1-v?(x=Math.acos(v),y=Math.sin(x),v=Math.sin((1-d)*x)/y,d=Math.sin(d*x)/y):v=1-d;a[0]=v*e+d*k;a[1]=v*n+d*q;a[2]=v*p+d*g;a[3]=v*c+d*b;return a};c.sqlerp=function(){var a=c.create(),b=c.create();return function(d,e,h,n,p,k){c.slerp(a,
e,p,k);c.slerp(b,h,n,k);c.slerp(d,a,b,2*k*(1-k));return d}}();c.invert=function(a,c){var b=c[0],d=c[1],e=c[2],n=c[3],p=b*b+d*d+e*e+n*n,p=p?1/p:0;a[0]=-b*p;a[1]=-d*p;a[2]=-e*p;a[3]=n*p;return a};c.conjugate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=c[3];return a};c.length=d.length;c.len=c.length;c.squaredLength=d.squaredLength;c.sqrLen=c.squaredLength;c.normalize=d.normalize;c.fromMat3=function(a,c){var b=c[0]+c[4]+c[8];if(0<b)b=Math.sqrt(b+1),a[3]=.5*b,b=.5/b,a[0]=(c[5]-c[7])*b,a[1]=(c[6]-
c[2])*b,a[2]=(c[1]-c[3])*b;else{var d=0;c[4]>c[0]&&(d=1);c[8]>c[3*d+d]&&(d=2);var e=(d+1)%3,n=(d+2)%3,b=Math.sqrt(c[3*d+d]-c[3*e+e]-c[3*n+n]+1);a[d]=.5*b;b=.5/b;a[3]=(c[3*e+n]-c[3*n+e])*b;a[e]=(c[3*e+d]+c[3*d+e])*b;a[n]=(c[3*n+d]+c[3*d+n])*b}return a};c.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};c.exactEquals=d.exactEquals;c.equals=d.equals;g.exports=c},function(g,d,e){var k=e(24),b={create:function(){var a=new k.ARRAY_TYPE(3);a[0]=0;a[1]=0;a[2]=0;return a},clone:function(a){var c=
new k.ARRAY_TYPE(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c},fromValues:function(a,c,b){var d=new k.ARRAY_TYPE(3);d[0]=a;d[1]=c;d[2]=b;return d},copy:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];return a},set:function(a,c,b,d){a[0]=c;a[1]=b;a[2]=d;return a},add:function(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];a[2]=c[2]+b[2];return a},subtract:function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];a[2]=c[2]-b[2];return a}};b.sub=b.subtract;b.multiply=function(a,c,b){a[0]=c[0]*b[0];a[1]=c[1]*b[1];a[2]=c[2]*b[2];
return a};b.mul=b.multiply;b.divide=function(a,c,b){a[0]=c[0]/b[0];a[1]=c[1]/b[1];a[2]=c[2]/b[2];return a};b.div=b.divide;b.ceil=function(a,c){a[0]=Math.ceil(c[0]);a[1]=Math.ceil(c[1]);a[2]=Math.ceil(c[2]);return a};b.floor=function(a,c){a[0]=Math.floor(c[0]);a[1]=Math.floor(c[1]);a[2]=Math.floor(c[2]);return a};b.min=function(a,c,b){a[0]=Math.min(c[0],b[0]);a[1]=Math.min(c[1],b[1]);a[2]=Math.min(c[2],b[2]);return a};b.max=function(a,c,b){a[0]=Math.max(c[0],b[0]);a[1]=Math.max(c[1],b[1]);a[2]=Math.max(c[2],
b[2]);return a};b.round=function(a,c){a[0]=Math.round(c[0]);a[1]=Math.round(c[1]);a[2]=Math.round(c[2]);return a};b.scale=function(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;a[2]=c[2]*b;return a};b.scaleAndAdd=function(a,c,b,d){a[0]=c[0]+b[0]*d;a[1]=c[1]+b[1]*d;a[2]=c[2]+b[2]*d;return a};b.distance=function(a,c){var b=c[0]-a[0],d=c[1]-a[1],e=c[2]-a[2];return Math.sqrt(b*b+d*d+e*e)};b.dist=b.distance;b.squaredDistance=function(a,c){var b=c[0]-a[0],d=c[1]-a[1],e=c[2]-a[2];return b*b+d*d+e*e};b.sqrDist=b.squaredDistance;
b.length=function(a){var c=a[0],b=a[1];a=a[2];return Math.sqrt(c*c+b*b+a*a)};b.len=b.length;b.squaredLength=function(a){var c=a[0],b=a[1];a=a[2];return c*c+b*b+a*a};b.sqrLen=b.squaredLength;b.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];return a};b.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];a[2]=1/c[2];return a};b.normalize=function(a,c){var b=c[0],d=c[1],e=c[2],b=b*b+d*d+e*e;0<b&&(b=1/Math.sqrt(b),a[0]=c[0]*b,a[1]=c[1]*b,a[2]=c[2]*b);return a};b.dot=function(a,c){return a[0]*c[0]+a[1]*
c[1]+a[2]*c[2]};b.cross=function(a,c,b){var d=c[0],e=c[1];c=c[2];var l=b[0],h=b[1];b=b[2];a[0]=e*b-c*h;a[1]=c*l-d*b;a[2]=d*h-e*l;return a};b.lerp=function(a,c,b,d){var e=c[0],l=c[1];c=c[2];a[0]=e+d*(b[0]-e);a[1]=l+d*(b[1]-l);a[2]=c+d*(b[2]-c);return a};b.hermite=function(a,c,b,d,e,l){var h=l*l,n=h*(2*l-3)+1,p=h*(l-2)+l,k=h*(l-1);l=h*(3-2*l);a[0]=c[0]*n+b[0]*p+d[0]*k+e[0]*l;a[1]=c[1]*n+b[1]*p+d[1]*k+e[1]*l;a[2]=c[2]*n+b[2]*p+d[2]*k+e[2]*l;return a};b.bezier=function(a,c,b,d,e,l){var h=1-l,n=h*h,p=
l*l,k=n*h,n=3*l*n,h=3*p*h;l*=p;a[0]=c[0]*k+b[0]*n+d[0]*h+e[0]*l;a[1]=c[1]*k+b[1]*n+d[1]*h+e[1]*l;a[2]=c[2]*k+b[2]*n+d[2]*h+e[2]*l;return a};b.random=function(a,c){c=c||1;var b=2*k.RANDOM()*Math.PI,d=2*k.RANDOM()-1,e=Math.sqrt(1-d*d)*c;a[0]=Math.cos(b)*e;a[1]=Math.sin(b)*e;a[2]=d*c;return a};b.transformMat4=function(a,c,b){var d=c[0],e=c[1];c=c[2];var l=b[3]*d+b[7]*e+b[11]*c+b[15],l=l||1;a[0]=(b[0]*d+b[4]*e+b[8]*c+b[12])/l;a[1]=(b[1]*d+b[5]*e+b[9]*c+b[13])/l;a[2]=(b[2]*d+b[6]*e+b[10]*c+b[14])/l;return a};
b.transformMat3=function(a,c,b){var d=c[0],e=c[1];c=c[2];a[0]=d*b[0]+e*b[3]+c*b[6];a[1]=d*b[1]+e*b[4]+c*b[7];a[2]=d*b[2]+e*b[5]+c*b[8];return a};b.transformQuat=function(a,c,b){var d=c[0],e=c[1],l=c[2];c=b[0];var h=b[1],n=b[2];b=b[3];var p=b*d+h*l-n*e,k=b*e+n*d-c*l,q=b*l+c*e-h*d,d=-c*d-h*e-n*l;a[0]=p*b+d*-c+k*-n-q*-h;a[1]=k*b+d*-h+q*-c-p*-n;a[2]=q*b+d*-n+p*-h-k*-c;return a};b.rotateX=function(a,c,b,d){var e=[],l=[];e[0]=c[0]-b[0];e[1]=c[1]-b[1];e[2]=c[2]-b[2];l[0]=e[0];l[1]=e[1]*Math.cos(d)-e[2]*
Math.sin(d);l[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d);a[0]=l[0]+b[0];a[1]=l[1]+b[1];a[2]=l[2]+b[2];return a};b.rotateY=function(a,c,b,d){var e=[],l=[];e[0]=c[0]-b[0];e[1]=c[1]-b[1];e[2]=c[2]-b[2];l[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d);l[1]=e[1];l[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d);a[0]=l[0]+b[0];a[1]=l[1]+b[1];a[2]=l[2]+b[2];return a};b.rotateZ=function(a,c,b,d){var e=[],l=[];e[0]=c[0]-b[0];e[1]=c[1]-b[1];e[2]=c[2]-b[2];l[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d);l[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d);
l[2]=e[2];a[0]=l[0]+b[0];a[1]=l[1]+b[1];a[2]=l[2]+b[2];return a};b.forEach=function(){var a=b.create();return function(c,b,d,e,l,h){b||(b=3);d||(d=0);for(e=e?Math.min(e*b+d,c.length):c.length;d<e;d+=b)a[0]=c[d],a[1]=c[d+1],a[2]=c[d+2],l(a,a,h),c[d]=a[0],c[d+1]=a[1],c[d+2]=a[2];return c}}();b.angle=function(a,c){var d=b.fromValues(a[0],a[1],a[2]),e=b.fromValues(c[0],c[1],c[2]);b.normalize(d,d);b.normalize(e,e);d=b.dot(d,e);return 1<d?0:Math.acos(d)};b.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+
a[2]+")"};b.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]};b.equals=function(a,c){var b=a[0],d=a[1],e=a[2],l=c[0],h=c[1],n=c[2];return Math.abs(b-l)<=k.EPSILON*Math.max(1,Math.abs(b),Math.abs(l))&&Math.abs(d-h)<=k.EPSILON*Math.max(1,Math.abs(d),Math.abs(h))&&Math.abs(e-n)<=k.EPSILON*Math.max(1,Math.abs(e),Math.abs(n))};g.exports=b},function(g,d,e){var k=e(24),b={create:function(){var a=new k.ARRAY_TYPE(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a},clone:function(a){var c=new k.ARRAY_TYPE(4);
c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c},fromValues:function(a,c,b,d){var e=new k.ARRAY_TYPE(4);e[0]=a;e[1]=c;e[2]=b;e[3]=d;return e},copy:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];return a},set:function(a,c,b,d,e){a[0]=c;a[1]=b;a[2]=d;a[3]=e;return a},add:function(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];a[2]=c[2]+b[2];a[3]=c[3]+b[3];return a},subtract:function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];a[2]=c[2]-b[2];a[3]=c[3]-b[3];return a}};b.sub=b.subtract;b.multiply=function(a,c,
b){a[0]=c[0]*b[0];a[1]=c[1]*b[1];a[2]=c[2]*b[2];a[3]=c[3]*b[3];return a};b.mul=b.multiply;b.divide=function(a,c,b){a[0]=c[0]/b[0];a[1]=c[1]/b[1];a[2]=c[2]/b[2];a[3]=c[3]/b[3];return a};b.div=b.divide;b.ceil=function(a,c){a[0]=Math.ceil(c[0]);a[1]=Math.ceil(c[1]);a[2]=Math.ceil(c[2]);a[3]=Math.ceil(c[3]);return a};b.floor=function(a,c){a[0]=Math.floor(c[0]);a[1]=Math.floor(c[1]);a[2]=Math.floor(c[2]);a[3]=Math.floor(c[3]);return a};b.min=function(a,c,b){a[0]=Math.min(c[0],b[0]);a[1]=Math.min(c[1],
b[1]);a[2]=Math.min(c[2],b[2]);a[3]=Math.min(c[3],b[3]);return a};b.max=function(a,c,b){a[0]=Math.max(c[0],b[0]);a[1]=Math.max(c[1],b[1]);a[2]=Math.max(c[2],b[2]);a[3]=Math.max(c[3],b[3]);return a};b.round=function(a,c){a[0]=Math.round(c[0]);a[1]=Math.round(c[1]);a[2]=Math.round(c[2]);a[3]=Math.round(c[3]);return a};b.scale=function(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;a[2]=c[2]*b;a[3]=c[3]*b;return a};b.scaleAndAdd=function(a,c,b,d){a[0]=c[0]+b[0]*d;a[1]=c[1]+b[1]*d;a[2]=c[2]+b[2]*d;a[3]=c[3]+b[3]*d;return a};
b.distance=function(a,c){var b=c[0]-a[0],d=c[1]-a[1],e=c[2]-a[2],l=c[3]-a[3];return Math.sqrt(b*b+d*d+e*e+l*l)};b.dist=b.distance;b.squaredDistance=function(a,c){var b=c[0]-a[0],d=c[1]-a[1],e=c[2]-a[2],l=c[3]-a[3];return b*b+d*d+e*e+l*l};b.sqrDist=b.squaredDistance;b.length=function(a){var c=a[0],b=a[1],d=a[2];a=a[3];return Math.sqrt(c*c+b*b+d*d+a*a)};b.len=b.length;b.squaredLength=function(a){var c=a[0],b=a[1],d=a[2];a=a[3];return c*c+b*b+d*d+a*a};b.sqrLen=b.squaredLength;b.negate=function(a,c){a[0]=
-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=-c[3];return a};b.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];a[2]=1/c[2];a[3]=1/c[3];return a};b.normalize=function(a,c){var b=c[0],d=c[1],e=c[2],l=c[3],h=b*b+d*d+e*e+l*l;0<h&&(h=1/Math.sqrt(h),a[0]=b*h,a[1]=d*h,a[2]=e*h,a[3]=l*h);return a};b.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};b.lerp=function(a,c,b,d){var e=c[0],l=c[1],h=c[2];c=c[3];a[0]=e+d*(b[0]-e);a[1]=l+d*(b[1]-l);a[2]=h+d*(b[2]-h);a[3]=c+d*(b[3]-c);return a};b.random=function(a,
c){c=c||1;a[0]=k.RANDOM();a[1]=k.RANDOM();a[2]=k.RANDOM();a[3]=k.RANDOM();b.normalize(a,a);b.scale(a,a,c);return a};b.transformMat4=function(a,c,b){var d=c[0],e=c[1],l=c[2];c=c[3];a[0]=b[0]*d+b[4]*e+b[8]*l+b[12]*c;a[1]=b[1]*d+b[5]*e+b[9]*l+b[13]*c;a[2]=b[2]*d+b[6]*e+b[10]*l+b[14]*c;a[3]=b[3]*d+b[7]*e+b[11]*l+b[15]*c;return a};b.transformQuat=function(a,c,b){var d=c[0],e=c[1],l=c[2],h=b[0],n=b[1],p=b[2];b=b[3];var k=b*d+n*l-p*e,q=b*e+p*d-h*l,g=b*l+h*e-n*d,d=-h*d-n*e-p*l;a[0]=k*b+d*-h+q*-p-g*-n;a[1]=
q*b+d*-n+g*-h-k*-p;a[2]=g*b+d*-p+k*-n-q*-h;a[3]=c[3];return a};b.forEach=function(){var a=b.create();return function(c,b,d,e,l,h){b||(b=4);d||(d=0);for(e=e?Math.min(e*b+d,c.length):c.length;d<e;d+=b)a[0]=c[d],a[1]=c[d+1],a[2]=c[d+2],a[3]=c[d+3],l(a,a,h),c[d]=a[0],c[d+1]=a[1],c[d+2]=a[2],c[d+3]=a[3];return c}}();b.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]};b.equals=function(a,c){var b=
a[0],d=a[1],e=a[2],l=a[3],h=c[0],n=c[1],p=c[2],g=c[3];return Math.abs(b-h)<=k.EPSILON*Math.max(1,Math.abs(b),Math.abs(h))&&Math.abs(d-n)<=k.EPSILON*Math.max(1,Math.abs(d),Math.abs(n))&&Math.abs(e-p)<=k.EPSILON*Math.max(1,Math.abs(e),Math.abs(p))&&Math.abs(l-g)<=k.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))};g.exports=b},function(g,d,e){var k=e(24),b={create:function(){var a=new k.ARRAY_TYPE(2);a[0]=0;a[1]=0;return a},clone:function(a){var c=new k.ARRAY_TYPE(2);c[0]=a[0];c[1]=a[1];return c},fromValues:function(a,
c){var b=new k.ARRAY_TYPE(2);b[0]=a;b[1]=c;return b},copy:function(a,c){a[0]=c[0];a[1]=c[1];return a},set:function(a,c,b){a[0]=c;a[1]=b;return a},add:function(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];return a},subtract:function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];return a}};b.sub=b.subtract;b.multiply=function(a,c,b){a[0]=c[0]*b[0];a[1]=c[1]*b[1];return a};b.mul=b.multiply;b.divide=function(a,c,b){a[0]=c[0]/b[0];a[1]=c[1]/b[1];return a};b.div=b.divide;b.ceil=function(a,c){a[0]=Math.ceil(c[0]);a[1]=Math.ceil(c[1]);
return a};b.floor=function(a,c){a[0]=Math.floor(c[0]);a[1]=Math.floor(c[1]);return a};b.min=function(a,c,b){a[0]=Math.min(c[0],b[0]);a[1]=Math.min(c[1],b[1]);return a};b.max=function(a,c,b){a[0]=Math.max(c[0],b[0]);a[1]=Math.max(c[1],b[1]);return a};b.round=function(a,c){a[0]=Math.round(c[0]);a[1]=Math.round(c[1]);return a};b.scale=function(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;return a};b.scaleAndAdd=function(a,c,b,d){a[0]=c[0]+b[0]*d;a[1]=c[1]+b[1]*d;return a};b.distance=function(a,c){var b=c[0]-a[0],
d=c[1]-a[1];return Math.sqrt(b*b+d*d)};b.dist=b.distance;b.squaredDistance=function(a,c){var b=c[0]-a[0],d=c[1]-a[1];return b*b+d*d};b.sqrDist=b.squaredDistance;b.length=function(a){var c=a[0];a=a[1];return Math.sqrt(c*c+a*a)};b.len=b.length;b.squaredLength=function(a){var c=a[0];a=a[1];return c*c+a*a};b.sqrLen=b.squaredLength;b.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];return a};b.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];return a};b.normalize=function(a,c){var b=c[0],d=c[1],b=b*b+d*d;0<b&&
(b=1/Math.sqrt(b),a[0]=c[0]*b,a[1]=c[1]*b);return a};b.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]};b.cross=function(a,c,b){c=c[0]*b[1]-c[1]*b[0];a[0]=a[1]=0;a[2]=c;return a};b.lerp=function(a,c,b,d){var e=c[0];c=c[1];a[0]=e+d*(b[0]-e);a[1]=c+d*(b[1]-c);return a};b.random=function(a,c){c=c||1;var b=2*k.RANDOM()*Math.PI;a[0]=Math.cos(b)*c;a[1]=Math.sin(b)*c;return a};b.transformMat2=function(a,c,b){var d=c[0];c=c[1];a[0]=b[0]*d+b[2]*c;a[1]=b[1]*d+b[3]*c;return a};b.transformMat2d=function(a,c,b){var d=
c[0];c=c[1];a[0]=b[0]*d+b[2]*c+b[4];a[1]=b[1]*d+b[3]*c+b[5];return a};b.transformMat3=function(a,c,b){var d=c[0];c=c[1];a[0]=b[0]*d+b[3]*c+b[6];a[1]=b[1]*d+b[4]*c+b[7];return a};b.transformMat4=function(a,c,b){var d=c[0];c=c[1];a[0]=b[0]*d+b[4]*c+b[12];a[1]=b[1]*d+b[5]*c+b[13];return a};b.forEach=function(){var a=b.create();return function(c,b,d,e,l,h){b||(b=2);d||(d=0);for(e=e?Math.min(e*b+d,c.length):c.length;d<e;d+=b)a[0]=c[d],a[1]=c[d+1],l(a,a,h),c[d]=a[0],c[d+1]=a[1];return c}}();b.str=function(a){return"vec2("+
a[0]+", "+a[1]+")"};b.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]};b.equals=function(a,c){var b=a[0],d=a[1],e=c[0],l=c[1];return Math.abs(b-e)<=k.EPSILON*Math.max(1,Math.abs(b),Math.abs(e))&&Math.abs(d-l)<=k.EPSILON*Math.max(1,Math.abs(d),Math.abs(l))};g.exports=b},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||
"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a){a.addFragmentExtension("GL_EXT_draw_buffers");a.addFragmentCode(d.glsl_perspectivePanelEmit)}var f=function C(a,b,c){null===
a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:C(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},m=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),u=e(34);g=e(37);var l=e(37),h=e(49),n=e(50),
p=e(56),r=e(67),q=e(22),w=e(68),x=e(65),v=e(69),y=e(48);e(70);e(71);var A=function(c){function d(){k(this,d);for(var a=arguments.length,c=Array(a),e=0;e<a;e++)c[e]=arguments[e];var f,a=b(this,(f=Object.getPrototypeOf(d)).call.apply(f,[].concat([this],$jscomp.arrayFromIterable(c))));a.redrawNeeded=new y.Signal;return a}a(d,c);m(d,[{key:"draw",value:function(a){}},{key:"drawPicking",value:function(a){}}]);return d}(g.RenderLayer);d.PerspectiveViewRenderLayer=A;(function(a){a[a.COLOR=0]="COLOR";a[a.Z=
1]="Z";a[a.PICK=2]="PICK";a[a.NUM_TEXTURES=3]="NUM_TEXTURES"})(d.OffscreenTextures||(d.OffscreenTextures={}));var t=d.OffscreenTextures;d.glsl_perspectivePanelEmit=[v.glsl_packFloat01ToFixedPoint,"\nvoid emit(vec4 color, vec4 pickId) {\n  gl_FragData["+t.COLOR+"] = color;\n  gl_FragData["+t.Z+"] = packFloat01ToFixedPoint(1.0 - gl_FragCoord.z);\n  gl_FragData["+t.PICK+"] = pickId;\n}\n"];d.perspectivePanelEmit=c;var B=q.vec3.create(),D=q.mat4.create();e=function(d){function e(a,d,f){k(this,e);var n=
b(this,Object.getPrototypeOf(e).call(this,a,d,f));n.visibleLayerTracker=n.registerDisposer(new l.VisibleRenderLayerTracker(n.viewer.layerManager,A,function(a){a.redrawNeeded.add(n.scheduleRedraw,n);n.scheduleRedraw()},function(a){a.redrawNeeded.remove(n.scheduleRedraw,n);n.scheduleRedraw()}));n.sliceViews=new Set;n.projectionMat=q.mat4.create();n.inverseProjectionMat=q.mat4.create();n.modelViewMat=q.mat4.create();n.width=null;n.height=null;n.pickIDs=new h.PickIDManager;n.axesLineHelper=n.registerDisposer(u.AxesLineHelper.get(n.gl));
n.sliceViewRenderHelper=n.registerDisposer(p.SliceViewRenderHelper.get(n.gl,"SliceViewRenderHelper:PerspectivePanel",c));n.offscreenFramebuffer=new x.OffscreenFramebuffer(n.gl,{numDataBuffers:t.NUM_TEXTURES,depthBuffer:!0,stencilBuffer:!0});n.offscreenCopyHelper=x.OffscreenCopyHelper.get(n.gl);n.registerSignalBinding(n.navigationState.changed.add(function(){n.viewportChanged()}));a=n.registerDisposer(new r.TrackableBooleanCheckbox(f.showSliceViews));a.element.className="perspective-panel-show-slice-views noselect";
d=document.createElement("label");d.className="perspective-panel-show-slice-views noselect";d.appendChild(document.createTextNode("Slices"));d.appendChild(a.element);n.element.appendChild(d);n.registerSignalBinding(f.showSliceViews.changed.add(function(){n.scheduleRedraw()}));n.registerSignalBinding(f.showAxisLines.changed.add(function(){n.scheduleRedraw()}));return n}a(e,d);m(e,[{key:"updateProjectionMatrix",value:function(){var a=this.projectionMat;q.mat4.perspective(a,Math.PI/4,this.width/this.height,
10,5E3);var b=this.modelViewMat;this.navigationState.toMat4(b);q.vec3.set(B,1,-1,-1);q.mat4.scale(b,b,B);var c=q.vec3.set(B,0,0,100);q.mat4.translate(b,b,c);q.mat4.invert(D,b);q.mat4.multiply(a,a,D);q.mat4.invert(this.inverseProjectionMat,a)}},{key:"viewportChanged",value:function(){this.context.scheduleRedraw()}},{key:"onResize",value:function(){this.width=this.element.clientWidth;this.height=this.element.clientHeight;this.viewportChanged()}},{key:"disposed",value:function(){for(var a=$jscomp.makeIterator(this.sliceViews),
b=a.next();!b.done;b=a.next())b.value.dispose();this.sliceViews.clear()}},{key:"updateMouseState",value:function(a){a.pickedRenderLayer=null;if(!this.navigationState.valid)return!1;var b=a.position,c=this.offscreenFramebuffer,d=this.width,e=this.height;if(!c.hasSize(d,e))return!1;var f=this.mouseX,n=e-this.mouseY,h=c.readPixel(t.Z,f,n),h=1-v.unpackFloat01FromFixedPoint(h);if(1===h)return!1;b[0]=2*f/d-1;b[1]=2*n/e-1;b[2]=2*h-1;q.vec3.transformMat4(b,b,this.inverseProjectionMat);this.pickIDs.setMouseState(a,
c.readPixelAsUint32(t.PICK,f,n));return!0}},{key:"onMousedown",value:function(a){if(event.target===this.element&&(f(Object.getPrototypeOf(e.prototype),"onMousedown",this).call(this,a),this.navigationState.valid&&0===a.button)){var b=this;w.startRelativeMouseDrag(a,function(a,c,d){b.navigationState.pose.rotateRelative(q.kAxes[1],-c/4*Math.PI/180);b.navigationState.pose.rotateRelative(q.kAxes[0],d/4*Math.PI/180);b.viewer.navigationState.changed.dispatch()})}}},{key:"draw",value:function(){if(this.navigationState.valid){for(var a=
$jscomp.makeIterator(this.sliceViews),b=a.next();!b.done;b=a.next())b.value.updateRendering();a=this.gl;this.offscreenFramebuffer.bind(this.width,this.height);a.disable(a.SCISSOR_TEST);this.gl.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.enable(a.DEPTH_TEST);var c=this.projectionMat;this.updateProjectionMatrix();var d=q.vec4.create();q.vec4.transformMat4(d,q.kAxes[2],this.modelViewMat);q.vec4.normalize(d,d);b=this.pickIDs;b.clear();for(var b={dataToDevice:c,lightDirection:d.subarray(0,
3),ambientLighting:.2,directionalLighting:.8,pickIDs:b},e=this.visibleLayerTracker.getVisibleLayers(),f=$jscomp.makeIterator(e),n=f.next();!n.done;n=f.next())n.value.draw(b);if(this.viewer.showSliceViews.value)for(var f=this.sliceViewRenderHelper,n=$jscomp.makeIterator(this.sliceViews),h=n.next();!h.done;h=n.next()){var h=h.value,l=.2+.8*Math.abs(q.vec3.dot(d,h.viewportAxes[2])),p=D;q.mat4.identity(p);p[0]=h.width/2;p[5]=-h.height/2;q.mat4.multiply(p,h.viewportToData,p);q.mat4.multiply(p,c,p);f.draw(h.offscreenFramebuffer.dataTextures[0],
p,q.vec4.fromValues(l,l,l,1),q.vec4.fromValues(.5,.5,.5,1),0,0,1,1)}this.viewer.showAxisLines.value&&(q.mat4.identity(D),D[0]=1600,D[5]=1600,D[10]=1600,d=this.navigationState.position.spatialCoordinates,D[12]=d[0],D[13]=d[1],D[14]=d[2],D[15]=1,q.mat4.multiply(D,c,D),a.WEBGL_draw_buffers.drawBuffersWEBGL([a.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL]),this.axesLineHelper.draw(D,!1));a.WEBGL_draw_buffers.drawBuffersWEBGL([a.NONE,a.WEBGL_draw_buffers.COLOR_ATTACHMENT1_WEBGL,a.WEBGL_draw_buffers.COLOR_ATTACHMENT2_WEBGL]);
c=$jscomp.makeIterator(e);for(d=c.next();!d.done;d=c.next())d.value.drawPicking(b);a.disable(a.DEPTH_TEST);this.offscreenFramebuffer.unbind();this.setGLViewport();this.offscreenCopyHelper.draw(this.offscreenFramebuffer.dataTextures[t.COLOR])}}},{key:"zoomByMouse",value:function(a){this.navigationState.zoomBy(a)}},{key:"navigationState",get:function(){return this.viewer.navigationState}}]);return e}(n.RenderedDataPanel);d.PerspectivePanel=e},function(g,d,e){function k(a,b){if("function"!==typeof b&&
null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var b=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&
a(b,d);return b}}();g=e(8);var a=e(35),c=e(36);e=function(d){function e(b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var d;d=Object.getPrototypeOf(e).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");d=!d||"object"!==typeof d&&"function"!==typeof d?this:d;d.gl=b;d.vertexBuffer=d.registerDisposer(a.Buffer.fromData(b,new Float32Array([0,0,0,1,1,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,1,1]),b.ARRAY_BUFFER,b.STATIC_DRAW));
d.colorBuffer=d.registerDisposer(a.Buffer.fromData(b,new Float32Array([1,0,0,.5,1,0,0,.5,0,1,0,.5,0,1,0,.5,0,0,1,.5,0,0,1,.5]),b.ARRAY_BUFFER,b.STATIC_DRAW));d.trivialColorShader=d.registerDisposer(c.trivialColorShader(b));return d}k(e,d);b(e,[{key:"draw",value:function(a){var b=1>=arguments.length||void 0===arguments[1]?!0:arguments[1],c=this.trivialColorShader,d=this.gl;c.bind();d.uniformMatrix4fv(c.uniform("uProjectionMatrix"),!1,a);var e=c.attribute("aVertexPosition");this.vertexBuffer.bindToVertexAttrib(e,
4);c=c.attribute("aColor");this.colorBuffer.bindToVertexAttrib(c,4);b&&(d.colorMask(!1,!1,!1,!0),d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),d.colorMask(!0,!0,!0,!0),d.enable(d.BLEND),d.blendFunc(d.ONE_MINUS_DST_ALPHA,d.DST_ALPHA));d.lineWidth(1);d.drawArrays(d.LINES,0,6);b&&d.disable(d.BLEND);d.disableVertexAttribArray(e);d.disableVertexAttribArray(c)}}],[{key:"get",value:function(a){return a.memoize.get("SliceViewPanel:AxesLineHelper",function(){return new e(a)})}}]);return e}(g.RefCounted);
d.AxesLineHelper=e},function(g,d){var e=function(){function b(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,d){c&&b(a.prototype,c);d&&b(a,d);return a}}(),k=function(){function b(a,c){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.gl=a;this.bufferType=c;this.gl=a;this.buffer=a.createBuffer();void 0===this.bufferType&&(this.bufferType=
a.ARRAY_BUFFER)}e(b,[{key:"bind",value:function(){this.gl.bindBuffer(this.bufferType,this.buffer)}},{key:"bindToVertexAttrib",value:function(a,b){var d=2>=arguments.length||void 0===arguments[2]?this.gl.FLOAT:arguments[2],e=3>=arguments.length||void 0===arguments[3]?!1:arguments[3],k=4>=arguments.length||void 0===arguments[4]?0:arguments[4],l=5>=arguments.length||void 0===arguments[5]?0:arguments[5];this.bind();this.gl.enableVertexAttribArray(a);this.gl.vertexAttribPointer(a,b,d,e,k,l)}},{key:"setData",
value:function(a,b){var d=this.gl;void 0===b&&(b=d.STATIC_DRAW);this.bind();d.bufferData(this.bufferType,a,b)}},{key:"dispose",value:function(){this.gl.deleteBuffer(this.buffer);this.gl=this.buffer=null}}],[{key:"fromData",value:function(a,c,d,e){a=new b(a,d);a.setData(c,e);return a}}]);return b}();d.Buffer=k},function(g,d,e){var k=e(20);d.trivialTextureShader=function(b){return b.memoize.get("trivialTextureShader",function(){var a=new k.ShaderBuilder(b);a.addVarying("vec2","vTexCoord");a.addUniform("sampler2D",
"uSampler");a.addUniform("mat4","uProjectionMatrix");a.setFragmentMain("gl_FragColor = texture2D(uSampler, vTexCoord);");a.addAttribute("vec4","aVertexPosition");a.addAttribute("vec2","aTexCoord");a.setVertexMain("vTexCoord = aTexCoord; gl_Position = uProjectionMatrix * aVertexPosition;");return a.build()})};d.trivialColorShader=function(b){return b.memoize.get("trivialColorShader",function(){var a=new k.ShaderBuilder(b);a.addVarying("vec4","vColor");a.setFragmentMain("gl_FragColor = vColor;");a.addAttribute("vec4",
"aVertexPosition");a.addAttribute("vec4","aColor");a.addUniform("mat4","uProjectionMatrix");a.setVertexMain("vColor = aColor; gl_Position = uProjectionMatrix * aVertexPosition;");return a.build()})};d.trivialUniformColorShader=function(b){return b.memoize.get("trivialUniformColorShader",function(){var a=new k.ShaderBuilder(b);a.addUniform("mat4","uProjectionMatrix");a.addAttribute("vec4","aVertexPosition");a.addUniform("vec4","uColor");a.setFragmentMain("gl_FragColor = uColor;");a.setVertexMain("gl_Position = uProjectionMatrix * aVertexPosition;");
return a.build()})}},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,
writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),n;!(d=(n=h.next()).done)&&(c.push(n.value),!b||c.length!==b);d=!0);}catch(l){e=!0,f=l}finally{try{if(!d&&h["return"])h["return"]()}finally{if(e)throw f;
}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=e(38);g=e(8);var u=e(22),l=e(46),h=e(47),n=e(48);e=function(c){function d(){k(this,d);for(var a=arguments.length,c=Array(a),e=0;e<a;e++)c[e]=arguments[e];var f,a=
b(this,(f=Object.getPrototypeOf(d)).call.apply(f,[].concat([this],$jscomp.arrayFromIterable(c))));a.ready=!1;a.layerChanged=new n.Signal;a.readyStateChanged=new n.Signal;a.voxelSize=null;a.boundingBox=null;return a}a(d,c);f(d,[{key:"setReady",value:function(a){this.ready=a;this.readyStateChanged.dispatch();this.layerChanged.dispatch()}},{key:"handleAction",value:function(a){}},{key:"getValueAt",value:function(a){}}]);return d}(g.RefCounted);d.RenderLayer=e;e=function(c){function d(){k(this,d);return b(this,
Object.getPrototypeOf(d).apply(this,arguments))}a(d,c);f(d,[{key:"onShow",value:function(){}},{key:"onHide",value:function(){}}]);return d}(g.RefCounted);d.UserLayerDropdown=e;e=function(c){function d(){var a=0>=arguments.length||void 0===arguments[0]?[]:arguments[0];k(this,d);var c=b(this,Object.getPrototypeOf(d).call(this));c.layersChanged=new n.Signal;c.readyStateChanged=new n.Signal;c.specificationChanged=new n.Signal;c.renderLayers=[];a.forEach(c.addRenderLayer.bind(c));return c}a(d,c);f(d,[{key:"addRenderLayer",
value:function(a){this.renderLayers.push(a);var b=this.layersChanged,c=this.readyStateChanged;this.registerDisposer(a);this.registerSignalBinding(a.layerChanged.add(b.dispatch,b));this.registerSignalBinding(a.readyStateChanged.add(c.dispatch,c));b.dispatch()}},{key:"getValueAt",value:function(a,b,c){var d=void 0,e=this.renderLayers;if(-1!==e.indexOf(b))return c;b=$jscomp.makeIterator(e);for(c=b.next();!c.done&&(c=c.value,!c.ready||(d=c.getValueAt(a),void 0===d));c=b.next());return d}},{key:"toJSON",
value:function(){return null}},{key:"makeDropdown",value:function(a){}},{key:"handleAction",value:function(a){}}]);return d}(g.RefCounted);d.UserLayer=e;var p=function(c){function d(a){var c=1>=arguments.length||void 0===arguments[1]?null:arguments[1],e=2>=arguments.length||void 0===arguments[2]?!0:arguments[2];k(this,d);var f=b(this,Object.getPrototypeOf(d).call(this));f.name=a;f.visible=e;f.readyStateChanged=new n.Signal;f.layerChanged=new n.Signal;f.specificationChanged=new n.Signal;f.wasDisposed=
!1;f.layer_=null;f.layer=c;return f}a(d,c);f(d,[{key:"updateSignalBindings",value:function(a,b){b(a.layersChanged,this.handleLayerChanged,this);b(a.readyStateChanged,this.readyStateChanged.dispatch,this.readyStateChanged);b(a.specificationChanged,this.specificationChanged.dispatch,this.specificationChanged)}},{key:"handleLayerChanged",value:function(){this.visible&&this.layerChanged.dispatch()}},{key:"setVisible",value:function(a){a!==this.visible&&(this.visible=a,this.layerChanged.dispatch())}},
{key:"disposed",value:function(){this.wasDisposed=!0}},{key:"layer",get:function(){return this.layer_},set:function(a){var b=this.layer_;null!=b&&this.updateSignalBindings(b,l.removeSignalBinding);this.layer_=a;null!=a&&(this.updateSignalBindings(a,l.addSignalBinding),this.readyStateChanged.dispatch(),this.handleLayerChanged())}}]);return d}(g.RefCounted);d.ManagedUserLayer=p;e=function(d){function e(){k(this,e);for(var a=arguments.length,c=Array(a),d=0;d<a;d++)c[d]=arguments[d];var f,a=b(this,(f=
Object.getPrototypeOf(e)).call.apply(f,[].concat([this],$jscomp.arrayFromIterable(c))));a.managedLayers=[];a.layersChanged=new n.Signal;a.readyStateChanged=new n.Signal;a.specificationChanged=new n.Signal;a.boundPositions=new WeakSet;return a}a(e,d);f(e,[{key:"updateSignalBindings",value:function(a,b){b(a.layerChanged,this.layersChanged.dispatch,this.layersChanged);b(a.readyStateChanged,this.readyStateChanged.dispatch,this.readyStateChanged);b(a.specificationChanged,this.specificationChanged.dispatch,
this.specificationChanged)}},{key:"addManagedLayer",value:function(a){this.updateSignalBindings(a,l.addSignalBinding);this.managedLayers.push(a);this.layersChanged.dispatch();return a}},{key:"addUserLayer",value:function(a,b,c){a=new p(a,b,c);return this.addManagedLayer(a)}},{key:"readyRenderLayers",value:function(){function a(p,k){for(;;)switch(b){case 0:n=$jscomp.makeIterator(l.managedLayers),h=n.next();case 1:if(h.done){b=3;break}f=h.value;if(f.visible&&f.layer){b=4;break}b=2;break;case 4:e=$jscomp.makeIterator(f.layer.renderLayers),
d=e.next();case 5:if(d.done){b=7;break}c=d.value;if(c.ready){b=8;break}b=6;break;case 8:return b=9,{value:c,done:!1};case 9:if(void 0===k){b=10;break}b=-1;throw k;case 10:case 6:d=e.next();b=5;break;case 7:case 2:h=n.next();b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,c,d,e,f,h,n,l=this,p={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();p[Symbol.iterator]=function(){return this};
return p}},{key:"unbindManagedLayer",value:function(a){this.updateSignalBindings(a,l.removeSignalBinding);a.dispose()}},{key:"clear",value:function(){for(var a=$jscomp.makeIterator(this.managedLayers),b=a.next();!b.done;b=a.next())this.unbindManagedLayer(b.value);this.managedLayers.length=0;this.layersChanged.dispatch()}},{key:"removeManagedLayer",value:function(a){var b=this.managedLayers.indexOf(a);if(-1===b)throw Error("Internal error: invalid managed layer.");this.unbindManagedLayer(a);this.managedLayers.splice(b,
1);this.layersChanged.dispatch()}},{key:"reorderManagedLayer",value:function(a,b){var d=this.managedLayers.length;a===b||0>a||a>=d||0>b||b>=d||(d=this.managedLayers.splice(a,1),d=c(d,1)[0],this.managedLayers.splice(b,0,d),this.layersChanged.dispatch())}},{key:"disposed",value:function(){this.clear()}},{key:"getLayerByName",value:function(a){return this.managedLayers.find(function(b){return b.name===a})}},{key:"initializePosition",value:function(a){var b=this;if(!a.valid&&!this.updatePositionFromLayers(a)){var c=
this.boundPositions;if(!c.has(a)){c.add(a);var d=function(){b.updatePositionFromLayers(a);a.valid&&(b.readyStateChanged.remove(d),b.boundPositions.delete(a))};this.readyStateChanged.add(d)}}}},{key:"updatePositionFromLayers",value:function(a){if(!a.valid)for(var b=$jscomp.makeIterator(this.managedLayers),c=b.next();!c.done;c=b.next())if(c=c.value.layer,null!=c)for(var c=$jscomp.makeIterator(c.renderLayers),d=c.next();!d.done;d=c.next())if(d=d.value,d.ready&&(a.voxelSize.valid||null==d.voxelSize||
(u.vec3.copy(a.voxelSize.size,d.voxelSize),a.voxelSize.setValid()),!a.spatialCoordinatesValid&&!a.voxelCoordinatesValid&&null!=d.boundingBox)){var d=d.boundingBox,e=u.vec3.create();u.vec3.add(e,d.lower,d.upper);u.vec3.scale(e,e,.5);a.setVoxelCoordinates(e)}}},{key:"invokeAction",value:function(a){for(var b=$jscomp.makeIterator(this.managedLayers),c=b.next();!c.done;c=b.next())if(c=c.value,c.visible){c=c.layer;c.handleAction(a);for(var c=$jscomp.makeIterator(c.renderLayers),d=c.next();!d.done;d=c.next())d=
d.value,d.ready&&d.handleAction(a)}}},{key:"renderLayers",get:function(){var a=this;$jscomp.initSymbol();$jscomp.initSymbolIterator();var b={};return b[Symbol.iterator]=function(){function b(p,k){for(;;)switch(c){case 0:l=$jscomp.makeIterator(a.managedLayers),n=l.next();case 1:if(n.done){c=3;break}h=n.value;f=$jscomp.makeIterator(h.layer.renderLayers);e=f.next();case 4:if(e.done){c=6;break}d=e.value;c=7;return{value:d,done:!1};case 7:if(void 0===k){c=8;break}c=-1;throw k;case 8:case 5:e=f.next();
c=4;break;case 6:case 2:n=l.next();c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,h,n,l,p={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();p[Symbol.iterator]=function(){return this};return p},b}},{key:"visibleRenderLayers",get:function(){var a=this;$jscomp.initSymbol();$jscomp.initSymbolIterator();var b={};return b[Symbol.iterator]=function(){function b(p,k){for(;;)switch(c){case 0:l=
$jscomp.makeIterator(a.managedLayers),n=l.next();case 1:if(n.done){c=3;break}h=n.value;if(h.visible){c=4;break}c=2;break;case 4:f=$jscomp.makeIterator(h.layer.renderLayers),e=f.next();case 5:if(e.done){c=7;break}d=e.value;c=8;return{value:d,done:!1};case 8:if(void 0===k){c=9;break}c=-1;throw k;case 9:case 6:e=f.next();c=5;break;case 7:case 2:n=l.next();c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,h,n,l,p={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,
a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();p[Symbol.iterator]=function(){return this};return p},b}}]);return e}(g.RefCounted);d.LayerManager=e;e=function(){function a(){var b=this;k(this,a);this.changed=new n.Signal;this.position=u.vec3.create();this.active=!1;this.pickedRenderLayer=null;this.pickedValue=new h.Uint64(0,0);this.stale=!1;this.triggerUpdate=m(function(){b.update()},50,{leading:!0,trailing:!0})}f(a,[{key:"updateUnconditionally",value:function(){this.triggerUpdate.cancel();
this.update();return this.active}},{key:"updateIfStale",value:function(){this.stale&&this.update()}},{key:"update",value:function(){var a=this.updater;this.stale=!1;a?this.setActive(a(this)):this.setActive(!1)}},{key:"setActive",value:function(a){this.stale=!1;if(this.active!==a||!0===a)this.active=a,this.changed.dispatch()}}]);return a}();d.MouseSelectionState=e;e=function(c){function d(a,c){k(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.layerManager=a;e.mouseState=c;e.values=new Map;
e.changed=new n.Signal;e.needsUpdate=!0;e.registerSignalBinding(c.changed.add(e.handleChange,e));e.registerSignalBinding(a.layersChanged.add(function(){e.handleLayerChange()}));return e}a(d,c);f(d,[{key:"handleLayerChange",value:function(){this.mouseState.active&&this.handleChange()}},{key:"handleChange",value:function(){this.needsUpdate=!0;this.changed.dispatch()}},{key:"update",value:function(){if(this.needsUpdate){this.needsUpdate=!1;var a=this.values,b=this.mouseState;a.clear();if(b.active)for(var c=
b.position,d=$jscomp.makeIterator(this.layerManager.managedLayers),e=d.next();!e.done;e=d.next()){var e=e.value,f=e.layer;e.visible&&f&&a.set(f,f.getValueAt(c,b.pickedRenderLayer,b.pickedValue))}}}},{key:"get",value:function(a){this.update();return this.values.get(a)}}]);return d}(g.RefCounted);d.LayerSelectedValues=e;g=function(c){function d(a,c,e,f){k(this,d);var h=b(this,Object.getPrototypeOf(d).call(this));h.layerManager=a;h.renderLayerType=c;h.layerAdded=e;h.layerRemoved=f;h.visibleLayers=new Set;
h.newVisibleLayers=new Set;h.updatePending=null;h.registerSignalBinding(a.layersChanged.add(h.handleLayersChanged,h));h.updateVisibleLayers();return h}a(d,c);f(d,[{key:"handleLayersChanged",value:function(){if(null===this.updatePending){var a=this;this.updatePending=setTimeout(function(){a.updatePending=null;a.updateVisibleLayers()},0)}}},{key:"disposed",value:function(){this.cancelUpdate();this.visibleLayers.forEach(this.layerRemoved);this.visibleLayers.clear()}},{key:"cancelUpdate",value:function(){var a=
this.updatePending;null!==a&&clearTimeout(a)}},{key:"updateVisibleLayers",value:function(){for(var a=this.visibleLayers,b=this.newVisibleLayers,c=this.renderLayerType,d=this.layerAdded,e=this.layerRemoved,f=$jscomp.makeIterator(this.layerManager.readyRenderLayers()),h=f.next();!h.done;h=f.next())h=h.value,h instanceof c&&(b.add(h),a.has(h)||(a.add(h),d(h)));c=$jscomp.makeIterator(a);for(d=c.next();!d.done;d=c.next())d=d.value,b.has(d)||(a.delete(d),e(d));b.clear()}},{key:"getVisibleLayers",value:function(){null!==
this.updatePending&&(this.cancelUpdate(),this.updateVisibleLayers());return this.visibleLayers}}]);return d}(g.RefCounted);d.VisibleRenderLayerTracker=g},function(g,d,e){var k=e(39),b=e(40);g.exports=function(a,c,d){var e=!0,g=!0;if("function"!=typeof a)throw new TypeError("Expected a function");b(d)&&(e="leading"in d?!!d.leading:e,g="trailing"in d?!!d.trailing:g);return k(a,c,{leading:e,maxWait:c,trailing:g})}},function(g,d,e){var k=e(40),b=e(41),a=e(42),c=Math.max,f=Math.min;g.exports=function(d,
e,l){function h(a){var b=w,c=x;w=x=void 0;B=a;return y=d.apply(c,b)}function n(a){var b=a-t;a-=B;return void 0===t||b>=e||0>b||z&&a>=v}function p(){var a=b();if(n(a))return g(a);var c=setTimeout,d;d=a-B;a=e-(a-t);d=z?f(a,v-d):a;A=c(p,d)}function g(a){A=void 0;if(C&&w)return h(a);w=x=void 0;return y}function q(){var a=b(),c=n(a);w=arguments;x=this;t=a;if(c){if(void 0===A)return B=a=t,A=setTimeout(p,e),D?h(a):y;if(z)return A=setTimeout(p,e),h(t)}void 0===A&&(A=setTimeout(p,e));return y}var w,x,v,y,
A,t,B=0,D=!1,z=!1,C=!0;if("function"!=typeof d)throw new TypeError("Expected a function");e=a(e)||0;k(l)&&(D=!!l.leading,v=(z="maxWait"in l)?c(a(l.maxWait)||0,e):v,C="trailing"in l?!!l.trailing:C);q.cancel=function(){B=0;w=t=x=A=void 0};q.flush=function(){return void 0===A?y:g(b())};return q}},function(g,d){g.exports=function(d){var k=typeof d;return!!d&&("object"==k||"function"==k)}},function(g,d){g.exports=function(){return Date.now()}},function(g,d,e){var k=e(43),b=e(40),a=e(44),c=0/0,f=/^\s+|\s+$/g,
m=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,l=/^0o[0-7]+$/i,h=parseInt;g.exports=function(d){if("number"==typeof d)return d;if(a(d))return c;b(d)&&(d=k(d.valueOf)?d.valueOf():d,d=b(d)?d+"":d);if("string"!=typeof d)return 0===d?d:+d;d=d.replace(f,"");var e=u.test(d);return e||l.test(d)?h(d.slice(2),e?2:8):m.test(d)?c:+d}},function(g,d,e){var k=e(40),b=Object.prototype.toString;g.exports=function(a){a=k(a)?b.call(a):"";return"[object Function]"==a||"[object GeneratorFunction]"==a}},function(g,d,e){var k=
e(45),b=Object.prototype.toString;g.exports=function(a){return"symbol"==typeof a||k(a)&&"[object Symbol]"==b.call(a)}},function(g,d){g.exports=function(d){return!!d&&"object"==typeof d}},function(g,d){d.removeSignalBinding=function(d,k,b){d.remove(k,b)};d.addSignalBinding=function(d,k,b){d.add(k,b)}},function(g,d){var e=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,
c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),k=new Uint32Array(2),b=[],a=2;for(;36>=a;++a){var c=Math.floor(32/Math.log2(a)),f=Math.pow(a,c),m=Math.floor(c/2),u=Math.pow(a,m),m=Math.pow(a,c-m),l="^[0-"+String.fromCharCode(48+Math.min(9,a-1));10<a&&(l+="a-"+String.fromCharCode(97+a-11),l+="A-"+String.fromCharCode(65+a-11));l+="]{1,"+Math.ceil(64/Math.log2(a))+"}$";b[a]={lowDigits:c,lowBase:f,lowBase1:u,lowBase2:m,pattern:new RegExp(l)}}a=function(){function a(){var b=0>=arguments.length||void 0===
arguments[0]?0:arguments[0],c=1>=arguments.length||void 0===arguments[1]?0:arguments[1];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.low=b;this.high=c}e(a,[{key:"clone",value:function(){return new a(this.low,this.high)}},{key:"assign",value:function(a){this.low=a.low;this.high=a.high}},{key:"toString",value:function(){var a=0>=arguments.length||void 0===arguments[0]?10:arguments[0],c=this.low,d=this.high;if(0===d)return c.toString(a);var d=4294967296*d,e=b[a],
f=e.lowBase,e=e.lowDigits,h=d%f,d=Math.floor(d/f),c=c+h,d=d+Math.floor(c/f),c=(c%f).toString(a);return d.toString(a)+"0".repeat(e-c.length)+c}},{key:"parseString",value:function(a){var c=1>=arguments.length||void 0===arguments[1]?10:arguments[1],d=b[c],e=d.lowDigits,f=d.lowBase,h=d.lowBase1,l=d.lowBase2;if(!d.pattern.test(a))return!1;if(a.length<=e)return this.low=parseInt(a,c),this.high=0,!0;e=a.length-e;d=parseInt(a.substr(e),c);c=parseInt(a.substr(0,e),c);f=Math.floor(c*f/4294967296);h=d+c%4294967296*
h%4294967296*l%4294967296;4294967296<h&&(++f,h-=4294967296);if(h>>>0!==h||f>>>0!==f)return!1;this.low=h;this.high=f;return!0}},{key:"valid",value:function(){var a=this.low,b=this.high;return a>>>0===a&&b>>>0===b}}],[{key:"less",value:function(a,b){return a.high<b.high||a.high===b.high&&a.low<b.low}},{key:"equal",value:function(a,b){return a.low===b.low&&a.high===b.high}},{key:"min",value:function(b,c){return a.less(b,c)?b:c}},{key:"random",value:function(){crypto.getRandomValues(k);return new a(k[0],
k[1])}},{key:"parseString",value:function(b){var c=1>=arguments.length||void 0===arguments[1]?10:arguments[1],d=new a;if(!d.parseString(b,c))throw Error("Failed to parse string as uint64 value: "+JSON.stringify(b)+".");return d}}]);return a}();a.ZERO=new a(0,0);d.Uint64=a},function(g,d,e){var k;(function(b){function a(a,b,c,d,e){this._listener=b;this._isOnce=c;this.context=d;this._signal=a;this._priority=e||0}function c(a,b){if("function"!==typeof a)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",
b));}function f(){this._bindings=[];this._prevParams=null;var a=this;this.dispatch=function(){f.prototype.dispatch.apply(a,arguments)}}a.prototype={active:!0,params:null,execute:function(a){var b;this.active&&this._listener&&(a=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,a),this._isOnce&&this.detach());return b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},
getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};f.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(b,c,d,e){var f=this._indexOfListener(b,d);if(-1!==f){if(b=this._bindings[f],b.isOnce()!==c)throw Error("You cannot add"+
(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.");}else b=new a(this,b,c,d,e),this._addBinding(b);this.memorize&&this._prevParams&&b.execute(this._prevParams);return b},_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c=this._bindings.length,d;c--;)if(d=this._bindings[c],d._listener===a&&d.context===
b)return c;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,d){c(a,"add");return this._registerListener(a,!1,b,d)},addOnce:function(a,b,d){c(a,"addOnce");return this._registerListener(a,!0,b,d)},remove:function(a,b){c(a,"remove");var d=this._indexOfListener(a,b);-1!==d&&(this._bindings[d]._destroy(),this._bindings.splice(d,1));return a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},
halt:function(){this._shouldPropagate=!1},dispatch:function(a){if(this.active){var b=Array.prototype.slice.call(arguments),c=this._bindings.length,d;this.memorize&&(this._prevParams=b);if(c){d=this._bindings.slice();this._shouldPropagate=!0;do c--;while(d[c]&&this._shouldPropagate&&!1!==d[c].execute(b))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+
this.getNumListeners()+"]"}};f.Signal=f;!(k=function(){return f}.call(d,e,d,g),void 0!==k&&(g.exports=k))})(this)},function(g,d){var e=function(){function b(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,d){c&&b(a.prototype,c);d&&b(a,d);return a}}(),k=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.renderLayers=
[null];this.lowValues=[0];this.highValues=[0]}e(b,[{key:"clear",value:function(){this.renderLayers.length=1;this.lowValues.length=1;this.highValues.length=1}},{key:"register",value:function(a,b){var d=this.renderLayers,e=this.lowValues,k=this.highValues,l=d.length;d[l]=a;e[l]=b.low;k[l]=b.high;return l}},{key:"setMouseState",value:function(a,b){a.pickedRenderLayer=this.renderLayers[b];var d=a.pickedValue;d.low=this.lowValues[b];d.high=this.highValues[b]}}]);return b}();d.PickIDManager=k},function(g,
d,e){function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,
c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(51);var c=e(22),f=e(54);e(55);d.KEY_COMMANDS=new Map;e=function(a){for(var b=c.AXES_NAMES[a],e=function(e){var f=0>e?"-":"+";d.KEY_COMMANDS.set("rotate-relative-"+b+f,function(){this.navigationState.pose.rotateRelative(c.kAxes[a],.1*e)});var n=c.vec3.create();d.KEY_COMMANDS.set(""+
b+f,function(){var b=this.navigationState;n[0]=0;n[1]=0;n[2]=0;n[a]=e;b.pose.translateVoxelsRelative(n)})},f=$jscomp.makeIterator([-1,1]),k=f.next();!k.done;k=f.next())e(k.value)};for(var m=0;3>m;++m)e(m);d.KEY_COMMANDS.set("snap",function(){this.navigationState.pose.snap()});d.KEY_COMMANDS.set("zoom-in",function(){this.navigationState.zoomBy(.5)});d.KEY_COMMANDS.set("zoom-out",function(){this.navigationState.zoomBy(2)});var u=c.vec3.create();g=function(e){function h(a,b,c){if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");
var d=k(this,Object.getPrototypeOf(h).call(this,a,b));d.viewer=c;d.mouseX=0;d.mouseY=0;d.mouseStateUpdater=d.updateMouseState.bind(d);b.classList.add("rendered-data-panel");d.registerEventListener(b,"mousemove",d.onMousemove.bind(d));d.registerEventListener(b,"mouseleave",d.onMouseout.bind(d));d.registerEventListener(b,"mousedown",d.onMousedown.bind(d),!1);d.registerEventListener(b,"wheel",d.onMousewheel.bind(d),!1);d.registerEventListener(b,"dblclick",function(){d.viewer.layerManager.invokeAction("select")});
return d}b(h,e);a(h,[{key:"onMouseout",value:function(a){a=this.viewer.mouseState;a.updater=void 0;a.setActive(!1)}},{key:"onKeyCommand",value:function(a){return(a=d.KEY_COMMANDS.get(a))?(a.call(this),!0):!1}},{key:"onMousemove",value:function(a){var b=this.element;a.target===b&&(this.mouseX=a.offsetX-b.clientLeft,this.mouseY=a.offsetY-b.clientTop,a=this.viewer.mouseState,a.updater=this.mouseStateUpdater,a.triggerUpdate())}},{key:"onMousewheel",value:function(a){if(a.ctrlKey)this.onMousemove(a),this.zoomByMouse(f.getWheelZoomAmount(a));
else{var b=this.navigationState;u[0]=0;u[1]=0;u[2]=(0<a.wheelDelta?1:-1)*(a.shiftKey?10:1);b.pose.translateVoxelsRelative(u)}a.preventDefault()}},{key:"onMousedown",value:function(a){if(event.target===this.element&&(this.onMousemove(a),2===a.button&&(a=this.viewer.mouseState,a.updateUnconditionally()))){var b=this.navigationState.pose.position;c.vec3.copy(b.spatialCoordinates,a.position);b.changed.dispatch()}}}]);return h}(g.RenderedPanel);d.RenderedDataPanel=g},function(g,d,e){function k(a,b){if(!(a instanceof
b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,
b):a.__proto__=b)}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=e(52),m=e(48);g=e(8);e=function(d){function e(a,c){k(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.context=a;d.element=c;d.gl=a.gl;d.registerEventListener(c,"mouseenter",function(a){d.context.setActivePanel(d)});a.addPanel(d);
return d}a(e,d);c(e,[{key:"scheduleRedraw",value:function(){this.context.scheduleRedraw()}},{key:"setGLViewport",value:function(){var a=this.element,b=a.offsetLeft+a.clientLeft,c=a.clientWidth,d=a.clientHeight,e=a.offsetTop+a.clientTop+d,a=this.gl;a.enable(a.SCISSOR_TEST);e=this.context.canvas.height-e;a.viewport(b,e,c,d);a.scissor(b,e,c,d)}},{key:"onKeyCommand",value:function(a){return!1}},{key:"disposed",value:function(){this.context.removePanel(this)}}]);return e}(g.RefCounted);d.RenderedPanel=
e;g=function(d){function e(a){k(this,e);var c=b(this,Object.getPrototypeOf(e).call(this));c.container=a;c.canvas=document.createElement("canvas");c.updateStarted=new m.Signal;c.updateFinished=new m.Signal;c.panels=new Set;c.activePanel=null;c.updatePending=null;c.needsRedraw=!1;var d=c.canvas;d.className="gl-canvas";a.appendChild(d);c.gl=f.initializeWebGL(d);c.registerEventListener(window,"resize",c.onResize.bind(c));return c}a(e,d);c(e,[{key:"disposed",value:function(){null!=this.updatePending&&
(cancelAnimationFrame(this.updatePending),this.updatePending=null)}},{key:"addPanel",value:function(a){this.panels.add(a);null==this.activePanel&&this.setActivePanel(a)}},{key:"setActivePanel",value:function(a){var b=this.activePanel;null!=b&&b.element.attributes.removeNamedItem("isActivePanel");null!=a&&a.element.setAttribute("isActivePanel","true");this.activePanel=a}},{key:"removePanel",value:function(a){this.panels.delete(a);a===this.activePanel&&this.setActivePanel(null);a.dispose()}},{key:"onResize",
value:function(){this.scheduleRedraw();for(var a=$jscomp.makeIterator(this.panels),b=a.next();!b.done;b=a.next())b.value.onResize()}},{key:"scheduleUpdate",value:function(){null===this.updatePending&&(this.updatePending=requestAnimationFrame(this.update.bind(this)))}},{key:"scheduleRedraw",value:function(){this.needsRedraw||(this.needsRedraw=!0,this.scheduleUpdate())}},{key:"update",value:function(){this.updatePending=null;this.updateStarted.dispatch();if(this.needsRedraw){this.needsRedraw=!1;var a=
this.gl,b=this.canvas;b.width=b.offsetWidth;b.height=b.offsetHeight;this.gl.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a=$jscomp.makeIterator(this.panels);for(b=a.next();!b.done;b=a.next()){var b=b.value,c=b.element;0!==c.clientWidth&&0!==c.clientHeight&&(b.setGLViewport(),b.draw())}}this.updateFinished.dispatch()}}]);return e}(g.RefCounted);d.DisplayContext=g},function(g,d,e){var k=e(53);d.DEBUG_SHADERS=!1;d.initializeWebGL=function(b){var a=null,a={antialias:!1,stencil:!0};
d.DEBUG_SHADERS&&(console.log("DEBUGGING via preserveDrawingBuffer"),a.preserveDrawingBuffer=!0);a=b.getContext("webgl",a)||b.getContext("experimental-webgl",a);a.memoize=new k.Memoize;a.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);a.maxTextureImageUnits=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);a.tempTextureUnit=a.maxTextureImageUnits-1;a.WEBGL_draw_buffers=a.getExtension("WEBGL_draw_buffers");if(!a.WEBGL_draw_buffers)throw Error("WEBGL_draw_buffers extension not available");b=$jscomp.makeIterator(["OES_texture_float",
"OES_element_index_uint"]);for(var c=b.next();!c.done;c=b.next())if(c=c.value,!a.getExtension(c))throw Error(c+" extension not available");return a}},function(g,d){var e=function(){function b(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,d){c&&b(a.prototype,c);d&&b(a,d);return a}}(),k=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");
this.map=new Map}e(b,[{key:"get",value:function(a,b){var d=this.map,e=d.get(a);void 0===e?(e=b(),e.registerDisposer(function(){d.delete(a)}),d.set(a,e)):e.addRef();return e}}]);return b}();d.Memoize=k},function(g,d){d.getWheelZoomAmount=function(d){var k=.005,b=d.deltaMode;1===b?k=.1:2===b&&(k=2);return Math.exp(d.deltaY*k)}},function(g,d){},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a,b){for(var c=$jscomp.makeIterator(y),d=c.next();!d.done;d=c.next())if(d=d.value,d=d(a,b),null!=d)return d;throw Error("No chunk format handler found.");
}var f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=function t(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:t(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},u=e(57),
l=e(58),h=e(59),n=e(63);g=e(8);var p=e(22),r=e(35),q=e(65),w=e(20),x=e(48),v=p.mat4.create();e=function(c){function d(a,c,e,f){k(this,d);var h=b(this,Object.getPrototypeOf(d).call(this));h.gl=a;h.chunkManager=c;h.layerManager=e;h.navigationState=f;h.dataToViewport=p.mat4.create();h.viewportToDevice=p.mat4.create();h.dataToDevice=p.mat4.create();h.visibleChunks=new Map;h.viewChanged=new x.Signal;h.renderingStale=!0;h.visibleChunksStale=!0;h.visibleLayersStale=!1;h.visibleLayerList=[];h.newVisibleLayers=
new Set;h.offscreenFramebuffer=new q.OffscreenFramebuffer(h.gl,{numDataBuffers:1,depthBuffer:!1,stencilBuffer:!0});p.mat4.identity(h.dataToViewport);h.initializeCounterpart(h.chunkManager.rpc,{type:"SliceView",chunkManager:c.rpcId});h.updateVisibleLayers();h.registerSignalBinding(f.changed.add(function(){h.updateViewportFromNavigationState()}));h.updateViewportFromNavigationState();h.registerSignalBinding(e.layersChanged.add(function(){!h.visibleLayersStale&&h.hasValidViewport&&(h.visibleLayersStale=
!0,setTimeout(h.updateVisibleLayers.bind(h),0))}));h.viewChanged.add(function(){h.renderingStale=!0});h.registerSignalBinding(c.chunkQueueManager.visibleChunksChanged.add(h.viewChanged.dispatch,h.viewChanged));return h}a(d,c);f(d,[{key:"updateViewportFromNavigationState",value:function(){var a=this.navigationState;a.valid&&(a.toMat4(v),this.setViewportToDataMatrix(v))}},{key:"updateVisibleLayers",value:function(){if(!this.hasValidViewport)return!1;this.visibleLayersStale=!1;var a=this.visibleLayers,
b=this.rpc,c={id:this.rpcId},d=this.newVisibleLayers,e=!1,f=this.visibleLayerList;f.length=0;for(var h=$jscomp.makeIterator(this.layerManager.readyRenderLayers()),l=h.next();!l.done;l=h.next())l=l.value,l instanceof n.RenderLayer&&(d.add(l),f.push(l),a.has(l)||(a.set(l,[]),l.redrawNeeded.add(this.viewChanged.dispatch,this.viewChanged),c.layerId=l.rpcId,b.invoke("SliceView.addVisibleLayer",c),e=!0));f=$jscomp.makeIterator(a.keys());for(h=f.next();!h.done;h=f.next())h=h.value,d.has(h)||(a.delete(h),
h.redrawNeeded.remove(this.viewChanged.dispatch,this.viewChanged),c.layerId=h.rpcId,b.invoke("SliceView.removeVisibleLayer",c),e=!0);d.clear();e&&(this.visibleSourcesStale=!0);this.viewChanged.dispatch();return e}},{key:"onViewportChanged",value:function(){var a=this.width,b=this.height,c=this.viewportToDevice,d=this.dataToViewport,e=this.dataToDevice;p.mat4.ortho(c,-a/2,a/2,b/2,-b/2,-1,1);p.mat4.multiply(e,c,d);this.visibleChunksStale=!0;this.viewChanged.dispatch()}},{key:"setViewportSize",value:function(a,
b){return m(Object.getPrototypeOf(d.prototype),"setViewportSize",this).call(this,a,b)?(this.rpc.invoke("SliceView.updateView",{id:this.rpcId,width:a,height:b}),!0):!1}},{key:"onViewportToDataMatrixChanged",value:function(){var a=this.viewportToData;p.mat4.invert(this.dataToViewport,a);this.rpc.invoke("SliceView.updateView",{id:this.rpcId,viewportToData:a})}},{key:"onHasValidViewport",value:function(){this.updateVisibleLayers()}},{key:"updateRendering",value:function(){if(this.renderingStale&&this.hasValidViewport&&
0!==this.width&&0!==this.height){this.renderingStale=!1;this.maybeUpdateVisibleChunks();var a=this.gl,b=this.offscreenFramebuffer;b.bind(this.width,this.height);a.disable(a.SCISSOR_TEST);a.clearStencil(0);a.clearColor(0,0,0,0);a.colorMask(!0,!0,!0,!0);a.clear(a.COLOR_BUFFER_BIT);a.enable(a.STENCIL_TEST);a.disable(a.DEPTH_TEST);a.stencilOpSeparate(a.FRONT_AND_BACK,a.KEEP,a.KEEP,a.REPLACE);for(var c=0,d=$jscomp.makeIterator(this.visibleLayerList),e=d.next();!e.done;e=d.next())e=e.value,a.clear(a.STENCIL_BUFFER_BIT),
a.stencilFuncSeparate(a.FRONT_AND_BACK,a.GREATER,1,1),1===c&&(a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA)),e.draw(this),++c;a.disable(a.BLEND);a.disable(a.STENCIL_TEST);b.unbind()}}},{key:"maybeUpdateVisibleChunks",value:function(){if(!this.visibleChunksStale&&!this.visibleSourcesStale)return!1;this.visibleChunksStale=!1;this.updateVisibleChunks();return!0}},{key:"updateVisibleChunks",value:function(){var a=this.visibleChunks;this.computeVisibleChunks(function(b){var c=a.get(b);
void 0===c?(c=[],a.set(b,c)):c.length=0;return c},function(a,b,c){a=p.vec3Key(c);b[b.length]=a})}}]);return d}(h.SliceViewBase);d.SliceView=e;var y=[];d.registerChunkFormatHandler=function(a){y.push(a)};e=function(d){function e(a,d){k(this,e);var f=b(this,Object.getPrototypeOf(e).call(this,a));f.spec=d;f.chunkFormatHandler=f.registerDisposer(c(a.chunkQueueManager.gl,d));return f}a(e,d);f(e,[{key:"initializeCounterpart",value:function(a,b){this.spec.toObject(b.spec={});m(Object.getPrototypeOf(e.prototype),
"initializeCounterpart",this).call(this,a,b)}},{key:"getValueAt",value:function(a){for(var b=p.vec3.create(),c=this.spec,d=c.chunkLayout,e=d.offset,f=d.size,d=0;3>d;++d)b[d]=Math.floor((a[d]-e[d])/f[d]);d=p.vec3Key(b);d=this.chunks.get(d);if(!d)return null;for(var h=c.voxelSize,l=0;3>l;++l)b[l]=Math.floor((a[l]-e[l]-b[l]*f[l])/h[l]);a=d.chunkDataSize;for(e=0;3>e;++e)if(b[e]>=a[e])return;c=c.numChannels;if(1===c)return d.getChannelValueAt(b,0);a=Array(c);for(e=0;e<c;++e)a[e]=d.getChannelValueAt(b,
e);return a}},{key:"getChunk",value:function(a){return this.chunkFormatHandler.getChunk(this,a)}},{key:"chunkFormat",get:function(){return this.chunkFormatHandler.chunkFormat}}]);return e}(l.ChunkSource);d.VolumeChunkSource=e;l=function(c){function d(a,c){k(this,d);var e=b(this,Object.getPrototypeOf(d).call(this,a));e.chunkGridPosition=c.chunkGridPosition;e.chunkDataSize=c.chunkDataSize||a.spec.chunkDataSize;e.state=u.ChunkState.SYSTEM_MEMORY;return e}a(d,c);f(d,[{key:"chunkFormat",get:function(){return this.source.chunkFormat}}]);
return d}(l.Chunk);d.VolumeChunk=l;g=function(c){function d(a,c){k(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.gl=a;e.copyVertexPositionsBuffer=e.registerDisposer(r.Buffer.fromData(e.gl,new Float32Array([-1,-1,0,1,-1,1,0,1,1,1,0,1,1,-1,0,1]),e.gl.ARRAY_BUFFER,e.gl.STATIC_DRAW));e.copyTexCoordsBuffer=e.registerDisposer(r.Buffer.fromData(e.gl,new Float32Array([0,0,0,1,1,1,1,0]),e.gl.ARRAY_BUFFER,e.gl.STATIC_DRAW));e.textureCoordinateAdjustment=new Float32Array(4);var f=new w.ShaderBuilder(a);
f.addVarying("vec2","vTexCoord");f.addUniform("sampler2D","uSampler");f.addInitializer(function(b){a.uniform1i(b.uniform("uSampler"),0)});f.addUniform("vec4","uColorFactor");f.addUniform("vec4","uBackgroundColor");f.addUniform("mat4","uProjectionMatrix");f.addUniform("vec4","uTextureCoordinateAdjustment");f.require(c);f.setFragmentMain("\nvec4 sampledColor = texture2D(uSampler, vTexCoord);\nif (sampledColor.a == 0.0) {\n  sampledColor = uBackgroundColor;\n}\nemit(sampledColor * uColorFactor, vec4(0,0,0,0));\n");
f.addAttribute("vec4","aVertexPosition");f.addAttribute("vec2","aTexCoord");f.setVertexMain("\nvTexCoord = uTextureCoordinateAdjustment.xy + aTexCoord * uTextureCoordinateAdjustment.zw;\ngl_Position = uProjectionMatrix * aVertexPosition;\n");e.shader=e.registerDisposer(f.build());return e}a(d,c);f(d,[{key:"draw",value:function(a,b,c,d,e,f,h,l){var n=this.gl,k=this.shader,g=this.textureCoordinateAdjustment;g[0]=e;g[1]=f;g[2]=h-e;g[3]=l-f;k.bind();n.activeTexture(n.TEXTURE0);n.bindTexture(n.TEXTURE_2D,
a);n.uniformMatrix4fv(k.uniform("uProjectionMatrix"),!1,b);n.uniform4fv(k.uniform("uColorFactor"),c);n.uniform4fv(k.uniform("uBackgroundColor"),d);n.uniform4fv(k.uniform("uTextureCoordinateAdjustment"),g);a=k.attribute("aVertexPosition");this.copyVertexPositionsBuffer.bindToVertexAttrib(a,4);k=k.attribute("aTexCoord");this.copyTexCoordsBuffer.bindToVertexAttrib(k,2);n.drawArrays(n.TRIANGLE_FAN,0,4);n.disableVertexAttribArray(a);n.disableVertexAttribArray(k);n.bindTexture(n.TEXTURE_2D,null)}}],[{key:"get",
value:function(a,b,c){return a.memoize.get(b,function(){return new d(a,c)})}}]);return d}(g.RefCounted);d.SliceViewRenderHelper=g},function(g,d){var e=function(){function b(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,d){c&&b(a.prototype,c);d&&b(a,d);return a}}();(function(b){b[b.GPU_MEMORY=0]="GPU_MEMORY";b[b.SYSTEM_MEMORY=1]="SYSTEM_MEMORY";b[b.SYSTEM_MEMORY_WORKER=2]=
"SYSTEM_MEMORY_WORKER";b[b.DOWNLOADING=3]="DOWNLOADING";b[b.QUEUED=4]="QUEUED";b[b.NEW=5]="NEW";b[b.FAILED=6]="FAILED";b[b.EXPIRED=7]="EXPIRED"})(d.ChunkState||(d.ChunkState={}));(function(b){b[b.FIRST_TIER=0]="FIRST_TIER";b[b.FIRST_ORDERED_TIER=0]="FIRST_ORDERED_TIER";b[b.VISIBLE=0]="VISIBLE";b[b.PREFETCH=1]="PREFETCH";b[b.LAST_ORDERED_TIER=1]="LAST_ORDERED_TIER";b[b.RECENT=2]="RECENT";b[b.LAST_TIER=2]="LAST_TIER"})(d.ChunkPriorityTier||(d.ChunkPriorityTier={}));var k=function(){function b(a,c){if(!(this instanceof
b))throw new TypeError("Cannot call a class as a function");this.itemCapacity=this.availableItems=a;this.sizeCapacity=this.availableSize=c}e(b,[{key:"adjust",value:function(a,b){this.availableItems+=a;this.availableSize+=b}},{key:"toString",value:function(){return this.availableItems+"/"+this.itemCapacity+" items, "+this.availableSize+"/"+this.sizeCapacity+" size"}},{key:"toObject",value:function(){return{itemCapacity:this.itemCapacity,sizeCapacity:this.sizeCapacity}}}],[{key:"fromObject",value:function(a){return new b(a.itemCapacity,
a.sizeCapacity)}}]);return b}();k.INFINITE=new k(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);d.AvailableCapacity=k},function(g,d,e){function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var c=function n(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:n(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=
c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=e(57);g=e(7);var u=e(48),l=e(53);e=function(){function b(c){a(this,b);this.source=c;this.state=m.ChunkState.SYSTEM_MEMORY}f(b,[{key:"copyToGPU",value:function(a){this.state=m.ChunkState.GPU_MEMORY}},{key:"freeGPUMemory",value:function(a){this.state=m.ChunkState.SYSTEM_MEMORY}},{key:"gl",get:function(){return this.source.gl}}]);
return b}();d.Chunk=e;e=function(c){function d(b,c,e){a(this,d);var f=k(this,Object.getPrototypeOf(d).call(this));f.gl=c;f.visibleChunksChanged=new u.Signal;f.pendingChunkUpdates=null;f.pendingChunkUpdatesTail=null;f.chunkUpdateDeadline=null;f.chunkUpdateDelay=30;f.initializeCounterpart(b,{type:"ChunkQueueManager",gpuMemoryCapacity:e.gpuMemory.toObject(),systemMemoryCapacity:e.systemMemory.toObject(),downloadCapacity:e.download.toObject()});return f}b(d,c);f(d,[{key:"scheduleChunkUpdate",value:function(){var a=
this.chunkUpdateDeadline,b=void 0,b=null===a||Date.now()<a?0:this.chunkUpdateDelay;setTimeout(this.processPendingChunkUpdates.bind(this),b)}},{key:"processPendingChunkUpdates",value:function(){var a=this.chunkUpdateDeadline;if(null!==a&&Date.now()>a)setTimeout(this.processPendingChunkUpdates.bind(this),this.chunkUpdateDelay);else{var a=this.pendingChunkUpdates,b=this.rpc.get(a.source),c=a.state;if(c===m.ChunkState.EXPIRED)b.deleteChunk(a.id);else{var d=void 0,e=a.id;a["new"]?(d=b.getChunk(a),b.addChunk(e,
d)):d=b.chunks.get(e);if(c!==d.state)switch(c){case m.ChunkState.GPU_MEMORY:d.copyToGPU(this.gl);this.visibleChunksChanged.dispatch();break;case m.ChunkState.SYSTEM_MEMORY:d.freeGPUMemory(this.gl);break;default:throw Error("INTERNAL ERROR: Invalid chunk state: "+m.ChunkState[c]);}}null!=(this.pendingChunkUpdates=a.nextUpdate)?this.scheduleChunkUpdate():this.pendingChunkUpdatesTail=null}}}]);return d}(g.SharedObject);d.ChunkQueueManager=e;g.registerRPC("Chunk.update",function(a){var b=this.get(a.source).chunkManager.chunkQueueManager,
c=b.pendingChunkUpdatesTail;null==c?(b.pendingChunkUpdates=a,b.pendingChunkUpdatesTail=a,b.scheduleChunkUpdate()):(c.nextUpdate=a,b.pendingChunkUpdatesTail=a)});e=function(c){function d(b){a(this,d);var c=k(this,Object.getPrototypeOf(d).call(this));c.chunkQueueManager=b;c.chunkSourceCache=new Map;c.registerDisposer(b.addRef());c.initializeCounterpart(b.rpc,{type:"ChunkManager",chunkQueueManager:b.rpcId});return c}b(d,c);f(d,[{key:"getChunkSource",value:function(a,b,c){var d=this.chunkSourceCache,
e=d.get(a);void 0===e&&(e=new l.Memoize,d.set(a,e));return e.get(b,c)}}]);return d}(g.SharedObject);d.ChunkManager=e;g=function(d){function e(b){a(this,e);var c=k(this,Object.getPrototypeOf(e).call(this));c.chunkManager=b;c.chunks=new Map;c.registerDisposer(b.addRef());return c}b(e,d);f(e,[{key:"initializeCounterpart",value:function(a,b){b.chunkManager=this.chunkManager.rpcId;c(Object.getPrototypeOf(e.prototype),"initializeCounterpart",this).call(this,a,b)}},{key:"deleteChunk",value:function(a){this.chunks.delete(a)}},
{key:"addChunk",value:function(a,b){this.chunks.set(a,b)}},{key:"getChunk",value:function(a){return null}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);return e}(g.SharedObject);d.ChunkSource=g},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&
b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b,c){for(var d=0;3>d;++d)a[d]=Number.POSITIVE_INFINITY,b[d]=Number.NEGATIVE_INFINITY;c=$jscomp.makeIterator(c);for(d=c.next();!d.done;d=c.next())for(var e=d.value.spec,d=e.lowerChunkBound,e=e.upperChunkBound,f=0;3>f;++f)a[f]=Math.min(a[f],d[f]),b[f]=Math.max(b[f],e[f])}function c(a,b,c,d){return a>=d||b<=c?w.FULLY_OUTSIDE:a>=c&&b<=d?w.FULLY_INSIDE:
w.PARTIALLY_INSIDE}function f(a,b,d,e){for(var f=w.FULLY_INSIDE,h=0;3>h;++h){var l=c(a[h],b[h],d[h],e[h]);switch(l){case w.FULLY_OUTSIDE:return l;case w.PARTIALLY_INSIDE:f=l}}return f}function m(a,b,c){var d=c.length,e=0;if(1<d)for(var f=0,h=0;h<d;++h){for(var l=c[h],n=0,k=n,g=0;3>g;++g)var m=l.spec.chunkLayout.size[g],n=Math.max(n,m*Math.abs(a[g])),k=Math.max(k,m*Math.abs(b[g]));l=n*k;l>f&&(f=l,e=h)}return c[e]}var u=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),l;!(d=(l=h.next()).done)&&(c.push(l.value),!b||c.length!==b);d=!0);}catch(n){e=!0,f=n}finally{try{if(!d&&h["return"])h["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),l=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||
!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),h=e(60),n=e(22),p=e(61),r=e(62);g=e(7);var q=e(22),w;(function(a){a[a.FULLY_OUTSIDE=0]="FULLY_OUTSIDE";a[a.FULLY_INSIDE=1]="FULLY_INSIDE";a[a.PARTIALLY_INSIDE=2]="PARTIALLY_INSIDE"})(w||(w={}));e=function(d){function e(){k(this,e);var a;a=Object.getPrototypeOf(e).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.width=null;a.height=null;a.hasViewportToData=!1;a.hasValidViewport=!1;a.viewportToData=n.mat4.create();a.viewportAxes=[n.vec4.create(),n.vec4.create(),n.vec4.create()];a.previousViewportAxes=[n.vec3.create(),n.vec3.create()];a.centerDataPosition=n.vec3.create();a.viewportPlaneDistanceToOrigin=null;a.visibleChunkLayouts=new Map;a.visibleLayers=new Map;a.visibleSourcesStale=!0;a.pixelSize=null;n.mat4.identity(a.viewportToData);return a}b(e,d);
l(e,[{key:"onViewportChanged",value:function(){}},{key:"maybeSetHasValidViewport",value:function(){!this.hasValidViewport&&null!==this.width&&null!==this.height&&this.hasViewportToData&&(this.hasValidViewport=!0,this.onHasValidViewport());if(this.hasValidViewport)this.onViewportChanged()}},{key:"onHasValidViewport",value:function(){}},{key:"setViewportSize",value:function(a,b){return a!==this.width||b!==this.height?(this.width=a,this.height=b,this.maybeSetHasValidViewport(),!0):!1}},{key:"setViewportToDataMatrix",
value:function(a){if(this.hasViewportToData&&n.mat4.equals(this.viewportToData,a))return!1;this.hasViewportToData=!0;n.mat4.copy(this.viewportToData,a);n.vec3.transformMat4(this.centerDataPosition,q.kZeroVec,a);for(var b=void 0,c=this.viewportAxes,d=this.previousViewportAxes,e=0;3>e;++e){var f=c[e];n.vec4.transformMat4(f,q.kAxes[e],a);0===e&&(b=n.vec3.length(f));n.vec4.normalize(f,f)}this.viewportAxes=c;this.previousViewportAxes=d;if(!p.approxEqual(b,this.pixelSize)||.95>n.vec3.dot(c[0],d[0])||.95>
n.vec3.dot(c[1],d[1]))n.vec3.copy(d[0],c[0]),n.vec3.copy(d[1],c[1]),this.visibleSourcesStale=!0,this.pixelSize=b;this.viewportPlaneDistanceToOrigin=n.vec3.dot(this.centerDataPosition,this.viewportAxes[2]);this.onViewportToDataMatrixChanged();this.maybeSetHasValidViewport();return!0}},{key:"onViewportToDataMatrixChanged",value:function(){}},{key:"updateVisibleSources",value:function(){if(this.visibleSourcesStale){this.visibleSourcesStale=!1;var a=1.1*this.pixelSize,b=this.visibleChunkLayouts,c=u(this.viewportAxes,
2),d=c[0],e=c[1],f=this.visibleLayers;b.clear();for(var c=function(c){l=u(c,2);c=l[0];var f=l[1];f.length=0;c=c.sources;for(var h=c.length,n=void 0,k=c[0][0].spec.voxelSize,g=function(b){for(var c=0;3>c;++c){var d=b[c];if(d>a&&d>k[c])return!0}return!1},p=function(a,c){f[f.length++]=a;var d=a.spec.chunkLayout,e=b.get(d);void 0===e&&(e=new Map,b.set(d,e));e.set(a,h-c-1)},n=h-1;;){var q=m(d,e,c[n]);p(q,n);if(0===n||!g(q.spec.voxelSize))break;--n}f.reverse()},f=$jscomp.makeIterator(f),h=f.next();!h.done;h=
f.next()){var l;c(h.value)}}}},{key:"computeVisibleChunks",value:function(b,d){var e=this;this.updateVisibleSources();for(var h=this.centerDataPosition,l=n.vec3.clone(h),k=n.vec3.clone(h),h=n.vec3.create(),g=$jscomp.makeIterator([-this.width/2,this.width/2]),m=g.next();!m.done;m=g.next())for(var m=m.value,p=$jscomp.makeIterator([-this.height/2,this.height/2]),u=p.next();!u.done;u=p.next())u=u.value,n.vec3.scale(h,q.kAxes[0],m),n.vec3.scaleAndAdd(h,h,q.kAxes[1],u),n.vec3.transformMat4(h,h,this.viewportToData),
n.vec3.min(l,l,h),n.vec3.max(k,k,h);for(var v=n.vec3.create(),A=n.vec3.create(),y=n.vec3.create(),x=this.viewportAxes[2],h=0;3>h;++h)0<x[h]&&(y[h]=1);var N=[],Y=[];this.visibleChunkLayouts.forEach(function(h,g){function m(){for(var a=0,b=0,c=0;3>c;++c)var d=z[c],e=x[c],f=v[c],h=A[c]-f,l=y[c]*h,a=a+e*d*(f+l),b=b+e*d*(f+h-l);return a<J?!1:b<=J}function p(a){function b(){P=r.partitionArray(N,0,k,function(b){var d=b.spec;switch(c(v[a],A[a],d.lowerChunkBound[a],d.upperChunkBound[a])){case w.PARTIALLY_INSIDE:return!0;
case w.FULLY_INSIDE:Y.push(b);default:return!1}})}if(0!==Y.length||0!==P){for(var e=1,f=0;3>f;++f)e*=Math.max(0,A[f]-v[f]);if(0!==e&&m())if(1===e)d(g,q,v,Y);else{for(var h;;)if(e=v[a],f=A[a],h=f-e,1===h)a=(a+1)%3;else break;h=e+Math.floor(.5*h);var l=(a+1)%3,n=Y.length;A[a]=h;var k=P;b();p(l);A[a]=f;v[a]=h;b();p(l);v[a]=e;Y.length=n;P=k}}}var q=b(g),z=g.size,u=g.offset,J=e.viewportPlaneDistanceToOrigin-n.vec3.dot(u,e.viewportAxes[2]);a(v,A,h.keys());for(var F=0;3>F;++F)v[F]=Math.max(v[F],Math.floor((l[F]-
u[F])/z[F])),A[F]=Math.min(A[F],Math.floor((k[F]-u[F])/z[F]+1));Y.length=0;N.length=0;u=$jscomp.makeIterator(h.keys());for(F=u.next();!F.done;F=u.next()){var F=F.value,Q=F.spec;switch(f(v,A,Q.lowerChunkBound,Q.upperChunkBound)){case w.FULLY_INSIDE:Y.push(F);break;case w.PARTIALLY_INSIDE:N.push(F)}}var P=N.length;p(0)})}}]);return e}(g.SharedObject);d.SliceViewBase=e;(function(a){a[a.UINT8=0]="UINT8";a[a.UINT16=1]="UINT16";a[a.UINT32=2]="UINT32";a[a.UINT64=3]="UINT64";a[a.FLOAT32=4]="FLOAT32"})(d.DataType||
(d.DataType={}));var x=d.DataType;d.DATA_TYPE_BYTES=[];d.DATA_TYPE_BYTES[x.UINT8]=1;d.DATA_TYPE_BYTES[x.UINT16]=2;d.DATA_TYPE_BYTES[x.UINT32]=4;d.DATA_TYPE_BYTES[x.UINT64]=8;d.DATA_TYPE_BYTES[x.FLOAT32]=4;(function(a){a[a.UNKNOWN=0]="UNKNOWN";a[a.IMAGE=1]="IMAGE";a[a.SEGMENTATION=2]="SEGMENTATION"})(d.VolumeType||(d.VolumeType={}));var v=d.VolumeType;d.DEFAULT_CHUNK_DATA_SIZES=[n.vec3.fromValues(64,64,64)];e=function(){function a(b,c,e,f,h,l,g){k(this,a);this.chunkLayout=b;this.chunkDataSize=c;this.numChannels=
e;this.dataType=f;this.lowerVoxelBound=h;this.upperVoxelBound=l;this.compressedSegmentationBlockSize=g;this.chunkBytes=n.prod3(c)*d.DATA_TYPE_BYTES[f]*e;c=this.voxelSize=n.vec3.divide(n.vec3.create(),this.chunkLayout.size,this.chunkDataSize);e=this.lowerChunkBound=n.vec3.create();f=this.upperChunkBound=n.vec3.create();var m=b.size;b=b.offset;for(var p=0;3>p;++p)e[p]=Math.floor((h[p]*c[p]-b[p])/m[p]),f[p]=Math.floor(((l[p]-1)*c[p]-b[p])/m[p]+1);this.compressedSegmentationBlockSize=g}l(a,[{key:"toObject",
value:function(a){this.chunkLayout.toObject(a.chunkLayout={});a.chunkDataSize=this.chunkDataSize;a.numChannels=this.numChannels;a.dataType=this.dataType;a.lowerVoxelBound=this.lowerVoxelBound;a.upperVoxelBound=this.upperVoxelBound;a.compressedSegmentationBlockSize=this.compressedSegmentationBlockSize}}],[{key:"fromObject",value:function(b){return new a(h.ChunkLayout.fromObject(b.chunkLayout),b.chunkDataSize,b.numChannels,b.dataType,b.lowerVoxelBound,b.upperVoxelBound,b.compressedSegmentationBlockSize)}},
{key:"getDefaults",value:function(b){function c(t,Ta){for(;;)switch(e){case 0:Y=b.voxelSize,N=b.dataType,X=b.lowerVoxelBound,S=b.chunkDataSizes,w=void 0===S?d.DEFAULT_CHUNK_DATA_SIZES:S,u=b.numChannels,r=void 0===u?1:u,q=b.compressedSegmentationBlockSize,m=n.vec3.multiply(n.vec3.create(),X,Y),void 0!==q||b.volumeType!==v.SEGMENTATION||N!==x.UINT32&&N!==x.UINT64||(q=n.vec3.fromValues(8,8,8)),p=$jscomp.makeIterator(w),g=p.next();case 1:if(g.done){e=3;break}k=g.value;l=n.vec3.create();n.vec3.multiply(l,
Y,k);f=h.ChunkLayout.get(l,m);e=4;return{value:new a(f,k,r,N,X,b.upperVoxelBound,q),done:!1};case 4:if(void 0===Ta){e=5;break}e=-1;throw Ta;case 5:case 2:g=p.next();e=1;break;case 3:e=-1;default:return{value:void 0,done:!0}}}var e=0,f,l,k,g,p,m,q,r,u,w,S,X,N,Y,ba={next:function(a){return c(a,void 0)},throw:function(a){return c(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();ba[Symbol.iterator]=function(){return this};return ba}}]);return a}();d.VolumeChunkSpecification=
e},function(g,d,e){var k=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),b=e(22);g=function(){function a(c,d){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.size=b.vec3.clone(c);this.offset=void 0===d?b.vec3.create():b.vec3.clone(d)}k(a,[{key:"toObject",value:function(a){a.size=
this.size;a.offset=this.offset}}],[{key:"get",value:function(c){var d=1>=arguments.length||void 0===arguments[1]?b.kZeroVec:arguments[1],e=a.cache,k=b.vec3Key(c)+"+"+b.vec3Key(d),l=e.get(k);void 0===l&&(l=new a(c,d),e.set(k,l));return l}},{key:"fromObject",value:function(b){return a.get(b.size,b.offset)}}]);return a}();g.cache=new Map;d.ChunkLayout=g},function(g,d){d.approxEqual=function(d,k){return d===k?!0:1E-6>Math.abs(d-k)/Math.min(Math.abs(d),Math.abs(k))}},function(g,d){d.partitionArray=function(d,
k,b,a){for(;k<b;){var c=d[k];a(c)?++k:(--b,d[k]=d[b],d[b]=c)}return b};d.maybePadArray=function(d,k){if(d.length===k)return d;var b=new d.constructor(k);b.set(d);return b};d.getFortranOrderStrides=function(d){for(var k=d.length,b=Array(k),a=b[0]=1>=arguments.length||void 0===arguments[1]?1:arguments[1],c=1;c<k;++c)a*=d[c-1],b[c]=a;return b}},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a){for(var b=0,c=0;3>c;++c)0>a[c]&&(b+=1<<c);return b}var f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=
c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=e(57);g=e(37);var u=e(59),l=e(64),h=e(8),n=e(22),p=e(11),r=e(35),q=e(20),w=e(7),x=e(48);d.GLSL_TYPE_FOR_DATA_TYPE=new Map([[u.DataType.UINT8,"uint8_t"],[u.DataType.FLOAT32,"float"],[u.DataType.UINT16,"uint16_t"],[u.DataType.UINT32,"uint32_t"],[u.DataType.UINT64,"uint64_t"]]);d.trackableAlphaValue=function(){return new l.TrackableValue(0>=
arguments.length||void 0===arguments[0]?.5:arguments[0],p.verifyFloat01)};var v=function(c){function d(a){k(this,d);var c=b(this,Object.getPrototypeOf(d).call(this));c.outputVertexIndices=c.registerDisposer(r.Buffer.fromData(a,new Float32Array([0,1,2,3,4,5]),a.ARRAY_BUFFER,a.STATIC_DRAW));c.vertexBasePositions=[0,0,0,1,0,0,0,1,0,1,1,0,0,0,1,1,0,1,0,1,1,1,1,1];a=[0,1,2,4,5,3,6,7];for(var e=[0,1,2,5,3,4,6,7],f=[0,1,1,4,4,7,4,7,1,5,0,1,1,4,4,7,0,2,2,5,5,7,5,7,2,6,0,2,2,5,5,7,0,3,3,6,6,7,6,7,3,4,0,3,
3,6,6,7],h=[0,1,2,3,4,5,6,7,1,4,5,0,3,7,2,6,2,6,0,5,7,3,1,4,3,0,6,4,1,2,7,5,4,3,7,1,0,6,5,2,5,2,1,7,6,0,4,3,6,7,3,2,5,4,0,1,7,5,4,6,2,1,3,0],l=[],n=0;8>n;++n)for(var g=0;g<f.length;++g)l.push(a[h[8*e[n]+f[g]]]);c.vertexIndices=new Int32Array(l);return c}a(d,c);f(d,null,[{key:"get",value:function(a){return a.memoize.get("SliceViewShaderBuffers",function(){return new d(a)})}}]);return d}(h.RefCounted),y=function(d){function e(a){k(this,e);var c=b(this,Object.getPrototypeOf(e).call(this));c.data=c.registerDisposer(v.get(a));
return c}a(e,d);f(e,[{key:"defineShader",value:function(a){var b=this.data;a.addAttribute("highp float","aVertexIndexFloat");a.addUniform("highp vec3","uTranslation");a.addUniform("highp mat4","uProjectionMatrix");a.addUniform("highp vec3","uPlaneNormal");a.addUniform("highp float","uPlaneDistance");a.addUniform("highp ivec2","uVertexIndex",24);a.addUniform("highp vec3","uVertexBasePosition",8);a.addInitializer(function(a){a.gl.uniform3fv(a.uniform("uVertexBasePosition"),new Float32Array(b.vertexBasePositions))});
a.addUniform("highp vec3","uChunkSize");a.addVarying("highp vec3","vChunkPosition");a.setVertexMain("\nint vertexIndex = int(aVertexIndexFloat);\nfor (int e = 0; e < 4; ++e) {\n  highp ivec2 vidx = uVertexIndex[vertexIndex*4 + e];\n  highp vec3 v1 = uChunkSize * uVertexBasePosition[vidx.x];\n  highp vec3 v2 = uChunkSize * uVertexBasePosition[vidx.y];\n  highp vec3 vStart = v1 + uTranslation;\n  highp vec3 vDir = v2 - v1;\n  highp float denom = dot(vDir, uPlaneNormal);\n  if (abs(denom) > 1e-6) {\n    highp float lambda = (uPlaneDistance - dot(vStart, uPlaneNormal)) / denom;\n    if ((lambda >= 0.0) && (lambda <= 1.0)) {\n      highp vec3 position = vStart + lambda * vDir;\n      gl_Position = uProjectionMatrix * vec4(position, 1.0);\n      vChunkPosition = mix(uVertexBasePosition[vidx.x], uVertexBasePosition[vidx.y], lambda);\n      break;\n    }\n  }\n}\n")}},
{key:"computeVerticesDebug",value:function(a,b,d,e,f){for(var h=c(d),h=this.data.vertexIndices.subarray(48*h,48*(h+1)),l=[0,0],k=[n.vec3.create(),n.vec3.create()],g=n.vec3.create(),p=n.vec3.create(),m=n.vec3.create(),q=n.vec3.create(),t=n.vec3.create(),r=new Float32Array(this.data.vertexBasePositions),v=function(a){return r.subarray(3*a,3*a+3)},u=0;6>u;++u)for(var A=0;4>A;++A){for(var y=0;2>y;++y)l[y]=h[2*(4*u+A)+y],n.vec3.multiply(k[y],a,v(l[y]));n.vec3.add(g,k[0],e);n.vec3.subtract(p,k[1],k[0]);
y=n.vec3.dot(p,d);if(1E-6<Math.abs(y)){var x=(b-n.vec3.dot(g,d))/y;if(0<=x&&1>=x){n.vec3.scaleAndAdd(m,g,p,x);n.vec3.transformMat4(q,n.vec4.fromValues(m[0],m[1],m[2],1),f);n.vec3.scale(t,v(l[0]),1-x);n.vec3.scaleAndAdd(t,t,v(l[1]),x);console.log("vertex "+u+" at "+q+", vChunkPosition = "+t+", edge dir = "+p+", denom = "+y);break}}}}},{key:"beginSlice",value:function(a,b,d,e){var f=e.viewportAxes[2],h=c(f);a.uniformMatrix4fv(b.uniform("uProjectionMatrix"),!1,d);a.uniform3fv(b.uniform("uPlaneNormal"),
f.subarray(0,3));a.uniform1f(b.uniform("uPlaneDistance"),e.viewportPlaneDistanceToOrigin);d=b.attribute("aVertexIndexFloat");this.data.outputVertexIndices.bindToVertexAttrib(d,1);a.uniform2iv(b.uniform("uVertexIndex"),this.data.vertexIndices.subarray(48*h,48*(h+1)))}},{key:"endSlice",value:function(a,b){var c=b.attribute("aVertexIndexFloat");a.disableVertexAttribArray(c)}},{key:"setupChunkSize",value:function(a,b,c){a.uniform3fv(b.uniform("uChunkSize"),c)}},{key:"drawChunk",value:function(a,b,c){a.uniform3fv(b.uniform("uTranslation"),
c);a.drawArrays(a.TRIANGLE_FAN,0,6)}}],[{key:"get",value:function(a){return a.memoize.get("sliceview.VolumeSliceVertexComputationManager",function(){return new e(a)})}}]);return e}(h.RefCounted);e=function(c){function e(a,c){k(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.chunkManager=a;d.sources=null;d.shader=void 0;d.shaderUpdated=!0;d.redrawNeeded=new x.Signal;d.voxelSize=null;d.boundingBox=null;d.rpcId=null;d.shaderError=new l.WatchableValue(void 0);d.vertexComputationManager=y.get(d.gl);
Promise.resolve(c).then(function(b){var c=d.sources=b.getSources(a);b=[];for(var c=$jscomp.makeIterator(c),e=c.next();!e.done;e=c.next()){var f=e.value,e=[];b.push(e);for(var f=$jscomp.makeIterator(f),h=f.next();!h.done;h=f.next())e.push(h.value.rpcId)}c=d.registerDisposer(new w.SharedObject);c.initializeCounterpart(a.rpc,{type:"sliceview/RenderLayer",sources:b});d.rpcId=c.rpcId;b=d.sources[0][0].spec;d.voxelSize=b.voxelSize;d.boundingBox=new n.BoundingBox(b.lowerVoxelBound,b.upperVoxelBound);d.setReady(!0)});
return d}a(e,c);f(e,[{key:"initializeShader",value:function(){if(this.shaderUpdated){this.shaderUpdated=!1;try{var a=this.getShader();this.disposeShader();this.shader=a;this.shaderError.value=void 0}catch(b){this.shaderError.value=b}}}},{key:"disposeShader",value:function(){this.shader&&(this.shader.dispose(),this.shader=null)}},{key:"dispose",value:function(){this.disposeShader()}},{key:"getValueAt",value:function(a){for(var b=$jscomp.makeIterator(this.sources),c=b.next();!c.done;c=b.next())for(var c=
$jscomp.makeIterator(c.value),d=c.next();!d.done;d=c.next())if(d=d.value.getValueAt(a),null!=d)return d;return null}},{key:"getShaderKey",value:function(){return""}},{key:"getShader",value:function(){var a=this,b=this.getShaderKey()+"/"+this.chunkFormat.shaderKey;return this.gl.memoize.get(b,function(){return a.buildShader()})}},{key:"buildShader",value:function(){var a=new q.ShaderBuilder(this.gl);this.defineShader(a);return a.build()}},{key:"defineShader",value:function(a){this.vertexComputationManager.defineShader(a);
a.addFragmentCode("\nvoid emit(vec4 color) {\n  gl_FragData[0] = color;\n}\n");this.chunkFormat.defineShader(a);a.addFragmentCode("\n"+d.GLSL_TYPE_FOR_DATA_TYPE.get(this.dataType)+" getDataValue() { return getDataValue(0); }\n")}},{key:"beginSlice",value:function(a){var b=a.dataToDevice,c=this.gl,d=this.shader;d.bind();this.vertexComputationManager.beginSlice(c,d,b,a);return d}},{key:"endSlice",value:function(a){this.vertexComputationManager.endSlice(this.gl,a)}},{key:"draw",value:function(a){var b=
a.visibleLayers.get(this);if(0!==b.length&&(this.initializeShader(),void 0!==this.shader)){var c=this.gl,d=n.vec3.create(),e=n.vec3.create(),f=this.beginSlice(a),h=this.vertexComputationManager,l=this.chunkFormat;l.beginDrawing(c,f);for(var b=$jscomp.makeIterator(b),k=b.next();!k.done;k=b.next()){var k=k.value,g=k.spec.chunkLayout,p=g.offset,q=k.chunks,t=g.size,r=null;if(g=a.visibleChunks.get(g))for(var g=$jscomp.makeIterator(g),v=g.next();!v.done;v=g.next())if((v=q.get(v.value))&&v.state===m.ChunkState.GPU_MEMORY){var u=
v.chunkDataSize;u!==r&&(r=u,n.vec3.multiply(e,r,k.spec.voxelSize),h.setupChunkSize(c,f,e));n.vec3.multiply(d,t,v.chunkGridPosition);n.vec3.add(d,d,p);l.bindChunk(c,f,v);h.drawChunk(c,f,d)}}l.endDrawing(c,f);this.endSlice(f)}}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}},{key:"chunkFormat",get:function(){return this.sources[0][0].chunkFormat}},{key:"dataType",get:function(){return this.sources[0][0].spec.dataType}}]);return e}(g.RenderLayer);d.RenderLayer=e},function(g,
d,e){function k(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=
e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),c=e(48);g=function(){function d(a){b(this,d);this.value_=a;this.changed=new c.Signal}a(d,[{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,this.changed.dispatch())}}]);return d}();d.WatchableValue=g;g=function(c){function d(a,c){var e=2>=arguments.length||void 0===arguments[2]?a:arguments[2];
b(this,d);var f;f=Object.getPrototypeOf(d).call(this,a);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");f=!f||"object"!==typeof f&&"function"!==typeof f?this:f;f.validator=c;f.defaultValue=e;return f}k(d,c);a(d,[{key:"toJSON",value:function(){return this.value_===this.defaultValue?void 0:this.value_}},{key:"restoreState",value:function(a){if(void 0!==a){var b=this.validator;try{this.value=b(a);return}catch(c){}}a=this.defaultValue;void 0!==a&&(this.value=
a)}}]);return d}(g);d.TrackableValue=g},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(8);var f=e(66),m=e(36),u=e(35),l=e(22);e=function(d){function e(a){var c=1>=arguments.length||void 0===arguments[1]?{}:arguments[1],d=c.numDataBuffers,
d=void 0===d?1:d,f=c.depthBuffer,f=void 0===f?!1:f,c=c.stencilBuffer,c=void 0===c?!1:c;k(this,e);var h=b(this,Object.getPrototypeOf(e).call(this));h.gl=a;h.width=null;h.height=null;h.framebuffer=h.gl.createFramebuffer();h.depthBuffer=null;h.dataTextures=[];h.attachmentVerified=!1;h.tempPixel=new Uint8Array(4);h.fullAttachmentList=[];h.singleAttachmentList=[h.gl.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL];for(var l=h.dataTextures,g=h.fullAttachmentList,m=0;m<d;++m)l[m]=a.createTexture(),g[m]=a.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL+
m;if(f||c)h.depthBuffer=a.createRenderbuffer();h.useStencilBuffer=c;return h}a(e,d);c(e,[{key:"disposed",value:function(){var a=this.gl,b=this.depthBuffer;a.deleteFramebuffer(this.framebuffer);null!=b&&a.deleteRenderbuffer(b);for(var b=$jscomp.makeIterator(this.dataTextures),c=b.next();!c.done;c=b.next())a.deleteTexture(c.value)}},{key:"resize",value:function(a,b){if(!this.hasSize(a,b)){this.width=a;this.height=b;for(var c=this.gl,d=this.useStencilBuffer,e=this.depthBuffer,h=$jscomp.makeIterator(this.dataTextures),
l=h.next();!l.done;l=h.next())f.resizeTexture(c,l.value,a,b);e&&(c.bindRenderbuffer(c.RENDERBUFFER,e),c.renderbufferStorage(c.RENDERBUFFER,d?c.DEPTH_STENCIL:c.DEPTH_COMPONENT16,a,b),c.bindRenderbuffer(c.RENDERBUFFER,null))}}},{key:"hasSize",value:function(a,b){return this.width===a&&this.height===b}},{key:"bind",value:function(a,b){this.resize(a,b);var c=this.gl,d=this.useStencilBuffer,e=this.depthBuffer;c.bindFramebuffer(c.FRAMEBUFFER,this.framebuffer);e&&c.framebufferRenderbuffer(c.FRAMEBUFFER,
d?c.DEPTH_STENCIL_ATTACHMENT:c.DEPTH_ATTACHMENT,c.RENDERBUFFER,e);this.dataTextures.forEach(function(a,b){c.framebufferTexture2D(c.FRAMEBUFFER,c.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL+b,c.TEXTURE_2D,a,0)});c.WEBGL_draw_buffers.drawBuffersWEBGL(this.fullAttachmentList);this.verifyAttachment();c.viewport(0,0,a,b)}},{key:"unbind",value:function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,null)}},{key:"bindSingle",value:function(a){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffer);
b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this.dataTextures[a],0);b.WEBGL_draw_buffers.drawBuffersWEBGL(this.singleAttachmentList)}},{key:"readPixel",value:function(a,b,c){var d=this.gl,e=this.tempPixel;try{this.bindSingle(a),d.readPixels(b,c,1,1,d.RGBA,d.UNSIGNED_BYTE,e)}finally{d.bindFramebuffer(d.FRAMEBUFFER,null)}return e}},{key:"readPixelAsUint32",value:function(a,b,c){a=this.readPixel(a,b,c);return a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24)}},{key:"verifyAttachment",value:function(){if(!this.attachmentVerified){var a=
this.gl;if(a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE)throw Error("Framebuffer configuration not supported");this.attachmentVerified=!0}}}]);return e}(g.RefCounted);d.OffscreenFramebuffer=e;e=function(d){function e(a){k(this,e);var c=b(this,Object.getPrototypeOf(e).call(this));c.gl=a;c.copyVertexPositionsBuffer=c.registerDisposer(u.Buffer.fromData(c.gl,new Float32Array([-1,-1,0,1,-1,1,0,1,1,1,0,1,1,-1,0,1]),c.gl.ARRAY_BUFFER,c.gl.STATIC_DRAW));c.copyTexCoordsBuffer=c.registerDisposer(u.Buffer.fromData(c.gl,
new Float32Array([0,0,0,1,1,1,1,0]),c.gl.ARRAY_BUFFER,c.gl.STATIC_DRAW));c.trivialTextureShader=c.registerDisposer(m.trivialTextureShader(c.gl));return c}a(e,d);c(e,[{key:"draw",value:function(a){var b=this.gl,c=this.trivialTextureShader;c.bind();b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,a);b.uniform1i(c.uniform("uSampler"),0);b.uniformMatrix4fv(c.uniform("uProjectionMatrix"),!1,l.identityMat4);a=c.attribute("aVertexPosition");this.copyVertexPositionsBuffer.bindToVertexAttrib(a,4);c=
c.attribute("aTexCoord");this.copyTexCoordsBuffer.bindToVertexAttrib(c,2);b.drawArrays(b.TRIANGLE_FAN,0,4);b.disableVertexAttribArray(a);b.disableVertexAttribArray(c);b.bindTexture(b.TEXTURE_2D,null)}}],[{key:"get",value:function(a){return a.memoize.get("OffscreenCopyHelper",function(){return new e(a)})}}]);return e}(g.RefCounted);d.OffscreenCopyHelper=e},function(g,d){function e(d){d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);
d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE)}d.setRawTextureParameters=e;d.resizeTexture=function(d,b,a,c){var f=4>=arguments.length||void 0===arguments[4]?d.RGBA:arguments[4],g=5>=arguments.length||void 0===arguments[5]?d.UNSIGNED_BYTE:arguments[5];d.activeTexture(d.TEXTURE0+d.tempTextureUnit);d.bindTexture(d.TEXTURE_2D,b);e(d);d.texImage2D(d.TEXTURE_2D,0,f,a,c,0,f,g,null);d.bindTexture(d.TEXTURE_2D,null)}},function(g,
d,e){function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof
b))throw new TypeError("Cannot call a class as a function");}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=e(48);g=e(8);e=function(){function b(c,d){a(this,b);this.value_=c;this.defaultValue=d;this.changed=new f.Signal}c(b,[{key:"toggle",value:function(){this.value=!this.value}},{key:"toJSON",value:function(){return this.value_===
this.defaultValue?void 0:this.value_}},{key:"restoreState",value:function(a){void 0===a&&(a=this.defaultValue);if(!0===a||!1===a)this.value=a}},{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,this.changed.dispatch())}}]);return b}();d.TrackableBoolean=e;e=function(d){function e(b){a(this,e);var c=k(this,Object.getPrototypeOf(e).call(this));c.model=b;c.element=document.createElement("input");var d=c.element;d.type="checkbox";c.registerSignalBinding(b.changed.add(c.updateCheckbox,
c));c.updateCheckbox();c.registerEventListener(d,"change",function(a){b.value=this.checked});return c}b(e,d);c(e,[{key:"updateCheckbox",value:function(){this.element.checked=this.model.value}},{key:"disposed",value:function(){var a=this.element,b=a.parentElement;b&&b.removeChild(a)}}]);return e}(g.RefCounted);d.TrackableBooleanCheckbox=e;g=function(d){function e(b,c){a(this,e);var d=k(this,Object.getPrototypeOf(e).call(this));d.model=b;d.element=c;d.updateVisibility();d.registerSignalBinding(b.changed.add(function(){d.updateVisibility()}));
return d}b(e,d);c(e,[{key:"updateVisibility",value:function(){this.element.style.display=this.model.value?"":"none"}}]);return e}(g.RefCounted);d.ElementVisibilityFromTrackableBoolean=g},function(g,d){d.startRelativeMouseDrag=function(d,k){var b=d.view.document,a=d.screenX,c=d.screenY,f=function(b){var d=a-b.screenX,e=c-b.screenY;a=b.screenX;c=b.screenY;k(b,d,e)},g=d.button,u=function(a){a.button===g&&(b.removeEventListener("mousemove",f,!0),b.removeEventListener("mouseup",u,!1))};b.addEventListener("mousemove",
f,!0);b.addEventListener("mouseup",u,!1)}},function(g,d){d.glsl_packFloat01ToFixedPoint="\nvec4 packFloat01ToFixedPoint(const float value) {\n  const vec4 shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n  const vec4 mask = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n  vec4 result = fract(value * shift);\n  result -= result.xxyz * mask;\n  return result * 256.0 / 255.0;\n}\n";d.unpackFloat01FromFixedPoint=function(d){return(d[3]+1/256*d[2]+1/65536*d[1]+1/16777216*d[0])/256};
d.glsl_hsvToRgb="\nvec3 hueToRgb(float hue) {\n  float hue6 = hue * 6.0;\n  float r = abs(hue6 - 3.0) - 1.0;\n  float g = 2.0 - abs(hue6 - 2.0);\n  float b = 2.0 - abs(hue6 - 4.0);\n  return clamp(vec3(r, g, b), 0.0, 1.0);\n}\nvec3 hsvToRgb(vec3 c) {\n  vec3 hueRgb = hueToRgb(c.x);\n  return c.z * ((hueRgb - 1.0) * c.y + 1.0);\n}\n";d.glsl_uint64="\nstruct uint64_t {\n  vec4 low, high;\n};\nuint64_t toUint64(uint64_t x) { return x; }\n";d.glsl_uint8=[d.glsl_uint64,"\nstruct uint8_t {\n  float value;\n};\nfloat toRaw(uint8_t x) { return x.value * 255.0; }\nfloat toNormalized(uint8_t x) { return x.value; }\nuint64_t toUint64(uint8_t x) {\n  uint64_t result;\n  result.low = vec4(x.value, 0.0, 0.0, 0.0);\n  result.high = vec4(0.0, 0.0, 0.0, 0.0);\n  return result;\n}\n"];
d.glsl_float="\nfloat toRaw(float x) { return x; }\nfloat toNormalized(float x) { return x; }\n";d.glsl_uint16=[d.glsl_uint64,"\nstruct uint16_t {\n  vec2 value;\n};\nfloat toRaw(uint16_t x) { return x.value.x * 255.0 + x.value.y * 65280.0; }\nfloat toNormalized(uint16_t x) { return toRaw(x) / 65535.0; }\nuint64_t toUint64(uint16_t x) {\n  uint64_t result;\n  result.low = vec4(x.value, 0.0, 0.0);\n  result.high = vec4(0.0, 0.0, 0.0, 0.0);\n  return result;\n}\n"];d.glsl_uint32="\nstruct uint32_t {\n  vec4 value;\n};\nuint32_t toUint64(uint32_t x) {\n  uint64_t result;\n  result.low = x.value;\n  result.high = vec4(0.0, 0.0, 0.0, 0.0);\n  return result;\n}\n";
d.glsl_getSubscriptsFromNormalized="\nvec3 getSubscriptsFromNormalized(vec3 normalizedPosition, vec3 size) {\n  return floor(min(normalizedPosition * size, size - 1.0));\n}\n";d.glsl_getFortranOrderIndex="\nfloat getFortranOrderIndex(vec3 subscripts, vec3 size) {\n  return subscripts.x + size.x * (subscripts.y + size.y * subscripts.z);\n}\n";d.glsl_getFortranOrderIndexFromNormalized=[d.glsl_getSubscriptsFromNormalized,d.glsl_getFortranOrderIndex,"\nfloat getFortranOrderIndexFromNormalized(vec3 normalizedPosition, vec3 size) {\n  return getFortranOrderIndex(getSubscriptsFromNormalized(normalizedPosition, size), size);\n}\n"];
d.glsl_imod="\nfloat imod(float x, float y) {\n  return x - y * floor(x / y);\n}\n";d.glsl_exactDot="\nfloat exactDot(vec4 a, vec4 b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n}\nfloat exactDot(vec3 a, vec3 b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n";d.fract=function(d){return d-Math.floor(d)};d.step=function(d,k){return k<d?0:1};d.mod=function(d,k){return d%k};d.exp2=function(d){return Math.pow(2,d)};d.glsl_packFloat="\nvec4 packFloatIntoVec4(float f) {\n  float magnitude = abs(f); \n  if (magnitude == 0.0) {\n     return vec4(0,0,0,0);\n  }\n  float sign =  step(0.0, -f);\n  float exponent = floor(log2(magnitude)); \n  float mantissa = magnitude / exp2(exponent); \n  // Denormalized values if all exponent bits are zero\n  if (mantissa < 1.0) {\n     exponent -= 1.0;\n  }\n\n  exponent +=  127.0;\n\n  vec4 result;\n  result[3] = 128.0 * sign + floor(exponent / 2.0);\n  result[2] = 128.0 * mod(exponent, 2.0) +  mod(floor(mantissa * float(128.0)),128.0);\n  result[1] = floor( mod(floor(mantissa* exp2(float(23.0 - 8.0))), exp2(8.0)));\n  result[0] = floor( exp2(23.0)* mod(mantissa, exp2(-15.0)));\n  return result / 255.0;\n}\n";
d.glsl_debugFunctions=[d.glsl_packFloat];d.encodeBytesToFloat32=function(d){d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength);for(var k=d.length,b=new Float32Array(k),a=0;a<k;++a)b[a]=d[a]/255;return b};d.setVec4FromUint32=function(d,k){for(var b=0;4>b;++b)d[b]=(k>>8*b&255)/255;return d};d.getUint32FromVec4=function(d){return 255*d[0]+65280*d[1]+16711680*d[2]+4278190080*d[3]}},function(g,d){},function(g,d){},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){var c=JSON.stringify({hostnames:a,token:b}),d=C.get(c);if(void 0!==d)return d;d=w.sendHttpRequest(w.openShardedHttpRequest(a,"/ocp/ca/"+b+"/info/"),"json");C.set(c,d);return d}
function c(b,c){var d=c.match(z);if(null===d)throw Error("Invalid volume path "+JSON.stringify(c));var e=x.stableStringify({hostnames:b,path:c}),f=G.get(e);if(void 0!==f)return f;var h=d[1],l=d[2],k=x.parseQueryStringParameters(d[3]||""),d=a(b,h).then(function(a){return new D(b,h,a,l,k)});G.set(e,d);return d}function f(a){var b=a.match(F);if(null===b)throw Error("Invalid ndstore volume path: "+JSON.stringify(a));return c([b[1]],b[2])}function m(a){var b=JSON.stringify(a),c=J.get(b);if(void 0!==c)return c;
a=w.sendHttpRequest(w.openShardedHttpRequest(a,"/ocp/ca/public_tokens/"),"json").then(function(a){return x.parseArray(a,x.verifyString)});J.set(b,a);return a}function u(b,c){var d=c.match(/^(?:([^\/]+)(?:\/([^\/]*))?)?$/);if(null===d)return Promise.reject(null);if(void 0===d[2]){var e=function(){var a=d[1]||"";return{v:m(b).then(function(b){return{offset:0,completions:r.getPrefixMatchesWithDescriptions(a,b,function(a){return a+"/"},function(a){})}})}}();if("object"===typeof e)return e.v}return v.cancellableThen(a(b,
d[1]),function(a){var b=[];"object"!==typeof a||null===a||Array.isArray(a)||function(){var c=a.channels;if("object"===typeof c&&null!==c&&!Array.isArray(c)){var e=Object.keys(c);b=r.getPrefixMatchesWithDescriptions(d[2],e,function(a){return a},function(a){a=c[a];return a.channel_type+" ("+a.datatype+")"})}}();return{offset:d[1].length+1,completions:b}})}function l(a){var b=a.match(F);return null===b?Promise.reject(null):v.cancellableThen(u([b[1]],b[2]),function(a){return r.applyCompletionOffset(b[1].length+
1,a)})}var h=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(17);var n=e(59),p=e(56),r=e(18),q=e(22),w=e(14),x=e(11),v=e(6),y=new Map;y.set("uint8",n.DataType.UINT8);y.set("uint16",n.DataType.UINT16);y.set("uint32",n.DataType.UINT32);y.set("uint64",n.DataType.UINT64);var A=new Map;A.set("image",n.VolumeType.IMAGE);
A.set("annotation",n.VolumeType.SEGMENTATION);var t=new Set(["npz","raw","jpeg"]),B=function(a){function c(a,b,d,e,f,h,l){k(this,c);b=Object.getPrototypeOf(c).call(this,a,b);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");b=!b||"object"!==typeof b&&"function"!==typeof b?this:b;b.hostnames=d;b.key=e;b.channel=f;b.resolution=h;b.encoding=l;b.initializeCounterpart(a.rpc,{type:"ndstore/VolumeChunkSource",hostnames:d,key:e,channel:f,resolution:h,encoding:l});
return b}b(c,a);h(c,[{key:"toString",value:function(){return"ndstore:volume:"+this.hostnames[0]+"/"+this.key+"/"+this.channel+"/"+this.resolution+"/"+this.encoding}}]);return c}(p.VolumeChunkSource);d.VolumeChunkSource=B;var D=function(){function a(b,c,d,e,f){k(this,a);this.hostnames=b;this.key=c;this.response=d;this.parameters=f;b=d.channels;c=Object.keys(b);if(void 0===e){if(1!==c.length)throw Error("Dataset contains multiple channels: "+JSON.stringify(c));e=c[0]}else if(-1===c.indexOf(e))throw Error("Specified channel "+
JSON.stringify(e)+" is not one of the supported channels "+JSON.stringify(c));this.channel=e;e=b[e];b=A.get(e.channel_type);void 0===b&&(b=n.VolumeType.UNKNOWN);this.volumeType=b;e=e.datatype;if(void 0===(this.dataType=y.get(e)))throw Error("Unsupported data type "+JSON.stringify(e));this.numChannels=1}h(a,[{key:"getSources",value:function(a){var b=this,c=[],d=this.volumeType,e=this.response.dataset,f=x.verifyOptionalString(this.parameters.encoding);if(void 0===f)f=d===n.VolumeType.IMAGE?"jpeg":"npz";
else if(!t.has(f))throw Error("Invalid encoding: "+JSON.stringify(f)+".");for(var h=function(h){var l=x.parseIntVec(q.vec3.create(),e.neariso_imagesize[h]),k=x.parseFiniteVec(q.vec3.create(),e.neariso_voxelres[h]),g=[];c.push(g);for(var p=x.parseFiniteVec(q.vec3.create(),e.neariso_offset[h]),m=q.vec3.create(),t=q.vec3.create(),v=0;3>v;++v){var r=p[v];m[v]=Math.ceil(r);t[v]=Math.floor(r+l[v])}l=function(c){var d=x.stableStringify({spec:c,key:b.key,channel:b.channel,resolution:h});g.push(a.getChunkSource(B,
d,function(){return new B(a,c,b.hostnames,b.key,b.channel,h,f)}))};k=$jscomp.makeIterator(n.VolumeChunkSpecification.getDefaults({volumeType:d,voxelSize:k,dataType:b.dataType,lowerVoxelBound:m,upperVoxelBound:t}));for(m=k.next();!m.done;m=k.next())l(m.value)},l=$jscomp.makeIterator(Object.keys(e.neariso_imagesize)),k=l.next();!k.done;k=l.next())h(k.value);return c}},{key:"getMeshSource",value:function(a){return null}}]);return a}();d.MultiscaleVolumeChunkSource=D;var z=/^([^\/?]+)(?:\/([^\/?]+))?(?:\?(.*))?$/,
C=new Map;d.getVolumeInfo=a;var G=new Map;d.getShardedVolume=c;var F=/^((?:http|https):\/\/[^\/?]+)\/(.*)$/;d.getVolume=f;var J=new Map;d.getPublicTokens=m;d.tokenAndChannelCompleter=u;d.volumeCompleter=l;g.registerDataSourceFactory("ndstore",{description:"NDstore",volumeCompleter:l,getVolume:f})},function(g,d,e){function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==
typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function c(a,b){z.verifyObject(a);var c=z.verifyObjectProperty(a,"Base",function(a){return new G(a)});switch(c.typeName){case "uint8blk":case "grayscale8":return new J(a,
b,c,x.VolumeType.IMAGE);case "imagetile":return new R(a,b,c);case "labels64":case "labelblk":return new J(a,b,c,x.VolumeType.SEGMENTATION);default:throw Error("DVID data type "+JSON.stringify(c.typeName)+" is not supported.");}}function f(a){try{for(var b=z.verifyObjectAsMap(a,function(a){return new S(a)}),c=$jscomp.makeIterator(b),d=c.next();!d.done;d=c.next()){var e=r(d.value,2);e[1].uuid=e[0]}return b}catch(f){throw Error("Failed to parse DVID repositories info: "+f.message);}}function m(a){var b=
z.stableStringify(a),c=N.get(b);void 0===c&&(c=D.sendHttpRequest(D.openShardedHttpRequest(a,"/api/repos/info","GET"),"json").then(function(a){return new X(a)}),a="repository info for DVID server "+a[0],A.StatusMessage.forPromise(c,{initialMessage:"Retrieving "+a+".",delay:!0,errorPrefix:"Error retrieving "+a+": "}),N.set(b,c));return c}function u(a,b,c){return m(a).then(function(d){d=d.getNode(b);var e=d.dataInstances.get(c);if(!(e instanceof J||e instanceof R))throw Error("Invalid data instance "+
c+".");var f=z.stableStringify({baseUrls:a,nodeKey:d.uuid,dataInstanceKey:c}),h=ba.get(f);void 0===h&&(h=new Y(a,d.uuid,c,e),ba.set(f,h));return h})}function l(a){var b=a.match(ya);if(null===b)throw Error("Invalid DVID URL: "+JSON.stringify(a)+".");return u([b[1]],b[2],b[3])}function h(a,b){return{offset:0,completions:t.getPrefixMatchesWithDescriptions(b,a.dataInstances.values(),function(a){return a.name},function(a){return""+a.base.typeName})}}function n(a,b){var c=b.match(/^(?:([^\/]+)(?:\/([^\/]*))?)?$/);
if(null===c)throw Error("Invalid DVID URL syntax.");if(void 0===c[2])return{offset:0,completions:t.getPrefixMatchesWithDescriptions(b,a.repositories.values(),function(a){return a.uuid+"/"},function(a){return a.alias+": "+a.description})};var d=c[1],e=a.getNode(d);return t.applyCompletionOffset(d.length+1,h(e,c[2]))}function p(a){a=a.match(/^((?:http|https):\/\/[^\/]+)\/(.*)$/);if(null===a)return Promise.reject(null);var b=a[1],c=a[2];return m([b]).then(function(a){return t.applyCompletionOffset(b.length+
1,n(a,c))})}var r=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),l;!(d=(l=h.next()).done)&&(c.push(l.value),!b||c.length!==b);d=!0);}catch(k){e=!0,f=k}finally{try{if(!d&&h["return"])h["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");
}}(),q=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),w=e(74);g=e(17);var x=e(59),v=e(60),y=e(56),A=e(4),t=e(18),B=e(22),D=e(14),z=e(11),C=new Map;C.set("uint8",x.DataType.UINT8);C.set("uint32",x.DataType.UINT32);C.set("uint64",x.DataType.UINT64);var G=function(){function b(c){a(this,b);this.obj=c;z.verifyObject(c);
z.verifyObjectProperty(c,"TypeName",z.verifyString)}q(b,[{key:"typeName",get:function(){return this.obj.TypeName}}]);return b}();d.DataInstanceBaseInfo=G;e=function za(b,c,d){a(this,za);this.obj=b;this.name=c;this.base=d};d.DataInstanceInfo=e;var F=function(c){function d(b,c,e){a(this,d);c=k(this,Object.getPrototypeOf(d).call(this,b,c));c.parameters=e;c.initializeCounterpart(b.rpc,{type:"dvid/VolumeChunkSource",parameters:e});return c}b(d,c);q(d,[{key:"toString",value:function(){return w.volumeSourceToString(this.parameters)}}]);
return d}(y.VolumeChunkSource);d.VolumeChunkSource=F;var J=function(c){function d(b,c,e,f){a(this,d);c=k(this,Object.getPrototypeOf(d).call(this,b,c,e));c.volumeType=f;b=z.verifyObjectProperty(b,"Extended",z.verifyObject);f=z.verifyObjectProperty(b,"Values",function(a){return z.parseArray(a,z.verifyObject)});if(1>f.length)throw Error("Expected Extended.Values property to have length >= 1, but received: ${JSON.stringify(extendedValues)}.");c.dataType=z.verifyObjectProperty(f[0],"DataType",function(a){return z.verifyMapKey(a,
C)});c.lowerVoxelBound=z.verifyObjectProperty(b,"MinPoint",function(a){return z.parseIntVec(B.vec3.create(),a)});c.upperVoxelBound=z.verifyObjectProperty(b,"MaxPoint",function(a){return z.parseIntVec(B.vec3.create(),a)});c.voxelSize=z.verifyObjectProperty(b,"VoxelSize",function(a){return z.parseFixedLengthArray(B.vec3.create(),a,z.verifyFinitePositiveFloat)});c.numChannels=1;return c}b(d,c);q(d,[{key:"getSources",value:function(a,b){return[Array.from(x.VolumeChunkSpecification.getDefaults({voxelSize:this.voxelSize,
dataType:this.dataType,numChannels:this.numChannels,lowerVoxelBound:this.lowerVoxelBound,upperVoxelBound:this.upperVoxelBound,volumeType:this.volumeType})).map(function(c){return a.getChunkSource(F,z.stableStringify(b),function(){return new F(a,c,b)})})]}}]);return d}(e);d.VolumeDataInstanceInfo=J;var Q=function Ca(b){a(this,Ca);z.verifyObject(b);this.resolution=z.verifyObjectProperty(b,"Resolution",function(a){return z.parseFixedLengthArray(B.vec3.create(),a,z.verifyFinitePositiveFloat)});this.tileSize=
z.verifyObjectProperty(b,"TileSize",function(a){return z.parseFixedLengthArray(B.vec3.create(),a,z.verifyPositiveInt)})};d.TileLevelInfo=Q;var P=[[0,1]],W=function(c){function d(b,c,e){a(this,d);c=k(this,Object.getPrototypeOf(d).call(this,b,c));c.parameters=e;c.initializeCounterpart(b.rpc,{type:"dvid/TileChunkSource",parameters:e});return c}b(d,c);q(d,[{key:"toString",value:function(){return w.tileSourceToString(this.parameters)}}]);return d}(y.VolumeChunkSource);d.TileChunkSource=W;var R=function(c){function d(b,
c,e){a(this,d);c=k(this,Object.getPrototypeOf(d).call(this,b,c,e));b=z.verifyObjectProperty(b,"Extended",z.verifyObject);c.levels=z.verifyObjectProperty(b,"Levels",function(a){return z.verifyObjectAsMap(a,function(a){return new Q(a)})});e=c.levels.get("0");if(void 0===e)throw Error("Level 0 is not defined.");c.voxelSize=e.resolution;var f=z.verifyObjectProperty(b,"MinTileCoord",function(a){return z.parseFixedLengthArray(B.vec3.create(),a,z.verifyInt)}),h=z.verifyObjectProperty(b,"MaxTileCoord",function(a){return z.parseFixedLengthArray(B.vec3.create(),
a,z.verifyInt)});c.lowerVoxelBound=B.vec3.multiply(B.vec3.create(),e.tileSize,f);c.upperVoxelBound=B.vec3.multiply(B.vec3.create(),e.tileSize,h);b=z.verifyObjectProperty(b,"Encoding",function(a){return a});switch(b){case 2:c.encoding=w.TileEncoding.JPEG;break;default:throw Error("Unsupported tile encoding: "+JSON.stringify(b)+".");}return c}b(d,c);q(d,[{key:"getSources",value:function(a,b){for(var c=this,d=[],e=function(e){l=r(e,2);var f=l[0],h=l[1];e=P.map(function(d){for(var e=B.vec3.clone(c.voxelSize),
l=B.vec3.fromValues(1,1,1),k=$jscomp.makeIterator(d),g=k.next();!g.done;g=k.next())g=g.value,e[g]=h.resolution[g],l[g]=h.tileSize[g];for(var k=v.ChunkLayout.get(B.vec3.multiply(B.vec3.create(),e,l)),g=B.vec3.create(),n=B.vec3.create(),p=0;3>p;++p)g[p]=Math.floor(c.voxelSize[p]/e[p]*c.lowerVoxelBound[p]),n[p]=Math.ceil(c.voxelSize[p]/e[p]*c.upperVoxelBound[p]);var m=new x.VolumeChunkSpecification(k,l,c.numChannels,c.dataType,g,n),q={baseUrls:b.baseUrls,nodeKey:b.nodeKey,dataInstanceKey:b.dataInstanceKey,
encoding:c.encoding,level:f,dims:d[0]+"_"+d[1]};return a.getChunkSource(F,z.stableStringify(q),function(){return new W(a,m,q)})});d.push(e)},f=$jscomp.makeIterator(this.levels),h=f.next();!h.done;h=f.next()){var l;e(h.value)}return d}},{key:"dataType",get:function(){return x.DataType.UINT8}},{key:"volumeType",get:function(){return x.VolumeType.IMAGE}},{key:"numChannels",get:function(){return 1}}]);return d}(e);d.TileDataInstanceInfo=R;d.parseDataInstance=c;var S=function ca(b){a(this,ca);this.errors=
[];this.dataInstances=new Map;z.verifyObject(b);this.alias=z.verifyObjectProperty(b,"Alias",z.verifyString);this.description=z.verifyObjectProperty(b,"Description",z.verifyString);b=z.verifyObjectProperty(b,"DataInstances",z.verifyObject);for(var d=$jscomp.makeIterator(Object.keys(b)),e=d.next();!e.done;e=d.next()){e=e.value;try{this.dataInstances.set(e,c(b[e],e))}catch(f){e="Failed to parse data instance "+JSON.stringify(e)+": "+f.message,console.log(e),this.errors.push(e)}}};d.RepositoryInfo=S;
d.parseRepositoriesInfo=f;var X=function(){function b(c){a(this,b);this.repositories=f(c)}q(b,[{key:"getNode",value:function(a){for(var b=[],c=$jscomp.makeIterator(this.repositories.keys()),d=c.next();!d.done;d=c.next())d=d.value,d.startsWith(a)&&b.push(d);if(1!==b.length)throw Error("Node key "+JSON.stringify(a)+" matches "+JSON.stringify(b)+" nodes.");return this.repositories.get(a)}}]);return b}();d.ServerInfo=X;var N=new Map;d.getServerInfo=m;var Y=function(){function b(c,d,e,f){a(this,b);this.baseUrls=
c;this.nodeKey=d;this.dataInstanceKey=e;this.info=f}q(b,[{key:"getSources",value:function(a){return this.info.getSources(a,{baseUrls:this.baseUrls,nodeKey:this.nodeKey,dataInstanceKey:this.dataInstanceKey})}},{key:"getMeshSource",value:function(a){return null}},{key:"dataType",get:function(){return this.info.dataType}},{key:"numChannels",get:function(){return this.info.numChannels}},{key:"volumeType",get:function(){return this.info.volumeType}}]);return b}();d.MultiscaleVolumeChunkSource=Y;var ba=
new Map;d.getShardedVolume=u;var ya=/^((?:http|https):\/\/[^\/]+)\/([^\/]+)\/([^\/]+)$/;d.getVolume=l;d.completeInstanceName=h;d.completeNodeAndInstance=n;d.volumeCompleter=p;g.registerDataSourceFactory("dvid",{description:"DVID",volumeCompleter:p,getVolume:l})},function(g,d){(function(d){d[d.JPEG=0]="JPEG"})(d.TileEncoding||(d.TileEncoding={}));var e=d.TileEncoding;d.volumeSourceToString=function(d){return"dvid:volume:"+d.baseUrls[0]+"/"+d.nodeKey+"/"+d.dataInstanceKey};d.tileSourceToString=function(d){return"dvid:volume:"+
d.baseUrls[0]+"/"+d.nodeKey+"/"+d.dataInstanceKey+"/"+d.dims+"/"+d.level+"/"+e[d.encoding]}},function(g,d,e){function k(b){return a.getShardedVolume(c,b)}function b(b){return a.tokenAndChannelCompleter(c,b)}g=e(17);var a=e(72),c=["http://openconnecto.me","http://www.openconnecto.me"];d.getVolume=k;d.volumeCompleter=b;g.registerDataSourceFactory("openconnectome",{description:"NDstore server hosted at openconnecto.me",getVolume:k,volumeCompleter:b})},function(g,d,e){function k(a,b){if(!(a instanceof
b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,
b):a.__proto__=b)}function c(a,b,c,d){return a.getChunkSource(C,JSON.stringify({baseUrls:b,path:c,lod:d}),function(){return new C(a,b,c,d)})}function f(a,b,d){b=v.parseSpecialUrl(b);b=l(b,2);return c(a,b[0],b[1],d)}function m(a,b){var c=x.stableStringify({baseUrls:a,path:b}),d=G.get(c);if(void 0!==d)return d;d=v.sendHttpRequest(v.openShardedHttpRequest(a,b+"/info"),"json").then(function(c){return new z(a,b,c)});G.set(c,d);return d}function u(a){a=v.parseSpecialUrl(a);a=l(a,2);return m(a[0],a[1])}
var l=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),l;!(d=(l=h.next()).done)&&(c.push(l.value),!b||c.length!==b);d=!0);}catch(k){e=!0,f=k}finally{try{if(!d&&h["return"])h["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");
}}(),h=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),n=e(77),p=e(59);g=e(56);var r=e(19),q=e(17),w=e(22),x=e(11),v=e(14),y=new Map;y.set("uint8",p.DataType.UINT8);y.set("uint32",p.DataType.UINT32);y.set("uint64",p.DataType.UINT64);var A=new Map;A.set("image",p.VolumeType.IMAGE);A.set("segmentation",p.VolumeType.SEGMENTATION);
var t=new Map;t.set("raw",n.VolumeChunkEncoding.RAW);t.set("jpeg",n.VolumeChunkEncoding.JPEG);t.set("compressed_segmentation",n.VolumeChunkEncoding.COMPRESSED_SEGMENTATION);var B=function(c){function d(a,c,e,f,h){k(this,d);c=b(this,Object.getPrototypeOf(d).call(this,a,c));c.baseUrls=e;c.path=f;c.encoding=h;c.initializeCounterpart(a.rpc,{type:"precomputed/VolumeChunkSource",baseUrls:e,path:f,encoding:h});return c}a(d,c);h(d,[{key:"toString",value:function(){return"precomputed:volume:"+this.baseUrls[0]+
"/"+this.path}}]);return d}(g.VolumeChunkSource);d.VolumeChunkSource=B;var D=function J(a){k(this,J);if("object"!==typeof a||Array.isArray(a))throw Error("Failed to parse volume metadata.");this.resolution=x.parseFiniteVec(w.vec3.create(),a.resolution);this.voxelOffset=x.parseIntVec(w.vec3.create(),a.voxel_offset);this.size=x.parseIntVec(w.vec3.create(),a.size);this.chunkSizes=x.parseArray(a.chunk_sizes,function(a){return x.parseFiniteVec(w.vec3.create(),a)});if(0===this.chunkSizes.length)throw Error("No chunk sizes specified.");
var b=a.encoding,c=t.get(b);if(void 0===c)throw Error("Invalid chunk encoding: "+JSON.stringify(b));this.encoding=c;c===n.VolumeChunkEncoding.COMPRESSED_SEGMENTATION&&(this.compressedSegmentationBlockSize=x.parseIntVec(w.vec3.create(),a.compressed_segmentation_block_size));this.key=a.key;if("string"!==typeof this.key)throw Error("No key specified.");},z=function(){function a(b,c,d){k(this,a);this.baseUrls=b;this.path=c;this.response=d;if("object"!==typeof d||Array.isArray(d))throw Error("Failed to parse volume metadata.");
c=d.data_type;b=y.get(c);if(void 0===b)throw Error("Invalid data type: "+JSON.stringify(c));c=d.num_channels;if("number"!==typeof c)throw Error("Invalid number of channels.");this.numChannels=c;this.dataType=b;b=d.type;c=A.get(b);if(void 0===c)throw Error("Invalid volume type: "+JSON.stringify(b));this.volumeType=c;b=d.mesh;if(void 0!==b&&"string"!==typeof b)throw Error('Invalid "mesh" field.');this.mesh=b;this.scales=x.parseArray(d.scales,function(a){return new D(a)})}h(a,[{key:"getMeshSource",value:function(a){var b=
this.mesh;return void 0===b?null:c(a,this.baseUrls,this.path+"/"+b,0)}},{key:"getSources",value:function(a){var b=this;return this.scales.map(function(c){return Array.from(p.VolumeChunkSpecification.getDefaults({voxelSize:c.resolution,dataType:b.dataType,numChannels:b.numChannels,lowerVoxelBound:c.voxelOffset,upperVoxelBound:w.vec3.add(w.vec3.create(),c.voxelOffset,c.size),volumeType:b.volumeType,chunkDataSizes:c.chunkSizes,compressedSegmentationBlockSize:c.compressedSegmentationBlockSize})).map(function(d){var e=
b.path+"/"+c.key,f=x.stableStringify({spec:d,baseUrls:b.baseUrls,path:e,encoding:c.encoding});return a.getChunkSource(B,f,function(){return new B(a,d,b.baseUrls,e,c.encoding)})})})}}]);return a}();d.MultiscaleVolumeChunkSource=z;var C=function(c){function d(a,c,e,f){k(this,d);a=b(this,Object.getPrototypeOf(d).call(this,a));a.baseUrls=c;a.path=e;a.lod=f;a.initializeCounterpart(a.chunkManager.rpc,{type:"precomputed/MeshSource",baseUrls:c,path:e,lod:f});return a}a(d,c);h(d,[{key:"toString",value:function(){return"precomputed:mesh:"+
this.baseUrls[0]+"/"+this.path}}]);return d}(r.MeshSource);d.MeshSource=C;d.getShardedMeshSource=c;d.getMeshSource=f;var G=new Map;d.getShardedVolume=m;d.getVolume=u;q.registerDataSourceFactory("precomputed",{description:"Precomputed file-backed data source",getVolume:u,getMeshSource:f})},function(g,d,e){e(14);g=d.VolumeChunkEncoding||(d.VolumeChunkEncoding={});g[g.RAW=0]="RAW";g[g.JPEG=1]="JPEG";g[g.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"},function(g,d,e){function k(a,b){if(!(a instanceof
b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,
b):a.__proto__=b)}function c(a,b,c,d){return a.getChunkSource(C,JSON.stringify({baseUrls:b,path:c,lod:d}),function(){return new C(a,b,c,d)})}function f(a,b,d){b=v.parseSpecialUrl(b);b=l(b,2);return c(a,b[0],b[1],d)}function m(a,b){var c=x.stableStringify({baseUrls:a,path:b}),d=G.get(c);if(void 0!==d)return d;debugger;d=v.sendHttpRequest(v.openShardedHttpRequest(["http://localhost:1337/"],""),"json").then(function(c){return new z(a,b,c)});G.set(c,d);return d}function u(a){a=v.parseSpecialUrl(a);a=
l(a,2);return m(a[0],a[1])}var l=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),l;!(d=(l=h.next()).done)&&(c.push(l.value),!b||c.length!==b);d=!0);}catch(k){e=!0,f=k}finally{try{if(!d&&h["return"])h["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");
}}(),h=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),n=e(77),p=e(59);g=e(56);var r=e(19),q=e(17),w=e(22),x=e(11),v=e(14),y=new Map;y.set("uint8",p.DataType.UINT8);y.set("uint32",p.DataType.UINT32);y.set("uint64",p.DataType.UINT64);var A=new Map;A.set("image",p.VolumeType.IMAGE);A.set("segmentation",p.VolumeType.SEGMENTATION);
var t=new Map;t.set("raw",n.VolumeChunkEncoding.RAW);t.set("jpeg",n.VolumeChunkEncoding.JPEG);t.set("compressed_segmentation",n.VolumeChunkEncoding.COMPRESSED_SEGMENTATION);var B=function(c){function d(a,c,e,f,h){k(this,d);c=b(this,Object.getPrototypeOf(d).call(this,a,c));c.baseUrls=e;c.path=f;c.encoding=h;c.initializeCounterpart(a.rpc,{type:"butterfly/VolumeChunkSource",baseUrls:e,path:f,encoding:h});return c}a(d,c);h(d,[{key:"toString",value:function(){return"butterfly:volume:"+this.baseUrls[0]+
"/"+this.path}}]);return d}(g.VolumeChunkSource);d.VolumeChunkSource=B;var D=function J(a){k(this,J);if("object"!==typeof a||Array.isArray(a))throw Error("Failed to parse volume metadata.");this.resolution=x.parseFiniteVec(w.vec3.create(),a.resolution);this.voxelOffset=x.parseIntVec(w.vec3.create(),a.voxel_offset);this.size=x.parseIntVec(w.vec3.create(),a.size);this.chunkSizes=x.parseArray(a.chunk_sizes,function(a){return x.parseFiniteVec(w.vec3.create(),a)});if(0===this.chunkSizes.length)throw Error("No chunk sizes specified.");
var b=a.encoding,c=t.get(b);if(void 0===c)throw Error("Invalid chunk encoding: "+JSON.stringify(b));this.encoding=c;c===n.VolumeChunkEncoding.COMPRESSED_SEGMENTATION&&(this.compressedSegmentationBlockSize=x.parseIntVec(w.vec3.create(),a.compressed_segmentation_block_size));this.key=a.key;if("string"!==typeof this.key)throw Error("No key specified.");},z=function(){function a(b,c,d){k(this,a);this.baseUrls=b;this.path=c;this.response=d;debugger;if("object"!==typeof d||Array.isArray(d))throw Error("Failed to parse volume metadata.");
c=d.data_type;b=y.get(c);if(void 0===b)throw Error("Invalid data type: "+JSON.stringify(c));c=d.num_channels;if("number"!==typeof c)throw Error("Invalid number of channels.");this.numChannels=c;this.dataType=b;b=d.type;c=A.get(b);if(void 0===c)throw Error("Invalid volume type: "+JSON.stringify(b));this.volumeType=c;b=d.mesh;if(void 0!==b&&"string"!==typeof b)throw Error('Invalid "mesh" field.');this.mesh=b;this.scales=x.parseArray(d.scales,function(a){return new D(a)})}h(a,[{key:"getMeshSource",value:function(a){var b=
this.mesh;return void 0===b?null:c(a,this.baseUrls,this.path+"/"+b,0)}},{key:"getSources",value:function(a){var b=this;return this.scales.map(function(c){return Array.from(p.VolumeChunkSpecification.getDefaults({voxelSize:c.resolution,dataType:b.dataType,numChannels:b.numChannels,lowerVoxelBound:c.voxelOffset,upperVoxelBound:w.vec3.add(w.vec3.create(),c.voxelOffset,c.size),volumeType:b.volumeType,chunkDataSizes:c.chunkSizes,compressedSegmentationBlockSize:c.compressedSegmentationBlockSize})).map(function(d){var e=
b.path+"/"+c.key,f=x.stableStringify({spec:d,baseUrls:b.baseUrls,path:e,encoding:c.encoding});return a.getChunkSource(B,f,function(){return new B(a,d,b.baseUrls,e,c.encoding)})})})}}]);return a}();d.MultiscaleVolumeChunkSource=z;var C=function(c){function d(a,c,e,f){k(this,d);a=b(this,Object.getPrototypeOf(d).call(this,a));a.baseUrls=c;a.path=e;a.lod=f;a.initializeCounterpart(a.chunkManager.rpc,{type:"butterfly/MeshSource",baseUrls:c,path:e,lod:f});return a}a(d,c);h(d,[{key:"toString",value:function(){return"butterfly:mesh:"+
this.baseUrls[0]+"/"+this.path}}]);return d}(r.MeshSource);d.MeshSource=C;d.getShardedMeshSource=c;d.getMeshSource=f;var G=new Map;d.getShardedVolume=m;d.getVolume=u;q.registerDataSourceFactory("butterfly",{description:"butterfly file-backed data source",getVolume:u,getMeshSource:f})},function(g,d,e){var k=e(80),b=e(146);window.addEventListener("DOMContentLoaded",function(){var a=window.viewer=k.makeDefaultViewer();b.makeDefaultKeyBindings(a.keyMap)})},function(g,d,e){e(81);e(82);var k=e(51),b=e(89);
d.makeDefaultViewer=function(){var a=new k.DisplayContext(document.getElementById("container"));return new b.Viewer(a)}},function(g,d){},function(g,d,e){e(83);e(85)},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function A(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:A(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];
e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=e(59);g=e(56);var u=e(84),l=e(62),h=e(8),n=e(22),p=e(47),r=e(69),q=function(c){function d(a,c,e,f){k(this,d);var h=b(this,Object.getPrototypeOf(d).call(this));h.chunkDataSize=c;a=a.maxTextureSize;var l=c[0]*c[1]*c[2];h.channelStride=l;var g=l*f,l=void 0;h.chunkDataSize=c;if(e*c[0]<=a&&c[1]*c[2]*f<=a)l=c[0];else if(e*c[0]*
c[1]<=a&&c[2]*f<=a)l=c[0]*c[1];else if(l=Math.ceil(g/a),l*e>a)throw Error("Chunk data size exceeds maximum texture size: "+e+" * "+g);c=Math.ceil(g/l);h.textureWidth=l*e;h.textureHeight=c;h.textureAccessCoefficients=Float32Array.of(1/l,1/(l*c));return h}a(d,c);f(d,null,[{key:"get",value:function(a,b,c,e){return a.memoize.get("sliceview.UncompressedTextureLayout:"+n.vec3Key(b)+","+c+","+e,function(){return new d(a,b,c,e)})}}]);return d}(h.RefCounted),w=function(d){function e(a,c,d,f){k(this,e);f=b(this,
Object.getPrototypeOf(e).call(this,f));f.dataType=c;f.numChannels=d;switch(c){case m.DataType.UINT8:f.texelsPerElement=1;f.textureFormat=a.LUMINANCE;f.texelType=a.UNSIGNED_BYTE;f.arrayElementsPerTexel=1;f.arrayConstructor=Uint8Array;break;case m.DataType.UINT16:f.texelsPerElement=1;f.textureFormat=a.LUMINANCE_ALPHA;f.texelType=a.UNSIGNED_BYTE;f.arrayElementsPerTexel=2;f.arrayConstructor=Uint8Array;break;case m.DataType.UINT64:f.texelsPerElement=2;f.textureFormat=a.RGBA;f.texelType=a.UNSIGNED_BYTE;
f.arrayElementsPerTexel=4;f.arrayConstructor=Uint8Array;break;case m.DataType.UINT32:f.texelsPerElement=1;f.textureFormat=a.RGBA;f.texelType=a.UNSIGNED_BYTE;f.arrayElementsPerTexel=4;f.arrayConstructor=Uint8Array;break;case m.DataType.FLOAT32:f.texelsPerElement=1;f.textureFormat=a.LUMINANCE;f.texelType=a.FLOAT;f.arrayElementsPerTexel=1;f.arrayConstructor=Float32Array;break;default:throw Error("Unsupported dataType: "+c);}return f}a(e,d);f(e,[{key:"defineShader",value:function(a){c(Object.getPrototypeOf(e.prototype),
"defineShader",this).call(this,a);a.addUniform("highp vec3","uChunkDataSize");1<this.numChannels?(a.addUniform("highp float","uChannelStride"),a.addFragmentCode("\nfloat getChannelOffset(int channelIndex) {\n  return float(channelIndex) * uChannelStride;\n}\n")):a.addFragmentCode("float getChannelOffset(int channelIndex) { return 0.0; }");a.addUniform("highp vec2","uUncompressedTextureAccessCoefficients");a.addFragmentCode("\nvec3 getPositionWithinChunk () {\n  return floor(min(vChunkPosition * uChunkDataSize, uChunkDataSize - 1.0));\n}\nvec2 getDataTextureCoords (int channelIndex) {\n  vec3 chunkDataPosition = getPositionWithinChunk();\n  float offset = chunkDataPosition.x + uChunkDataSize.x * (chunkDataPosition.y + uChunkDataSize.y * chunkDataPosition.z) + getChannelOffset(channelIndex);\n  return vec2(fract(offset * uUncompressedTextureAccessCoefficients.x),\n              offset * uUncompressedTextureAccessCoefficients.y);\n}\n");
switch(this.dataType){case m.DataType.UINT8:a.addFragmentCode(r.glsl_uint8);a.addFragmentCode("\nuint8_t getDataValue (int channelIndex) {\n  uint8_t result;\n  result.value = texture2D(uVolumeChunkSampler, getDataTextureCoords(channelIndex)).x;\n  return result;\n}\n");break;case m.DataType.FLOAT32:a.addFragmentCode(r.glsl_float);a.addFragmentCode("\nfloat getDataValue (int channelIndex) {\n  return texture2D(uVolumeChunkSampler, getDataTextureCoords(channelIndex)).x;\n}\n");break;case m.DataType.UINT16:a.addFragmentCode(r.glsl_uint16);
a.addFragmentCode("\nuint16_t getDataValue (int channelIndex) {\n  uint16_t result;\n  vec2 texCoords = getDataTextureCoords(channelIndex);\n  result.value = texture2D(uVolumeChunkSampler, texCoords).xw;\n  return result;\n}\n");break;case m.DataType.UINT32:a.addFragmentCode(r.glsl_uint32);a.addFragmentCode("\nuint32_t getDataValue (int channelIndex) {\n  uint32_t result;\n  vec2 texCoords = getDataTextureCoords(channelIndex);\n  result.value = texture2D(uVolumeChunkSampler, texCoords);\n  return result;\n}\n");
break;case m.DataType.UINT64:a.addFragmentCode(r.glsl_uint64),a.addFragmentCode("\nuint64_t getDataValue (int channelIndex) {\n  uint64_t value;\n  vec2 texCoords = getDataTextureCoords(channelIndex);\n  value.low = texture2D(uVolumeChunkSampler, texCoords);\n  value.high = texture2D(uVolumeChunkSampler, vec2(texCoords.x + 0.5 * uUncompressedTextureAccessCoefficients.x, texCoords.y));\n  return value;\n}\n")}}},{key:"setupTextureLayout",value:function(a,b,c){1<this.numChannels&&a.uniform1f(b.uniform("uChannelStride"),
c.channelStride);a.uniform3fv(b.uniform("uChunkDataSize"),c.chunkDataSize);a.uniform2fv(b.uniform("uUncompressedTextureAccessCoefficients"),c.textureAccessCoefficients)}},{key:"getTextureLayout",value:function(a,b){return q.get(a,b,this.texelsPerElement,this.numChannels)}}],[{key:"get",value:function(a,b,c){var d="sliceview.UncompressedChunkFormat:"+b+":"+c;return a.memoize.get(d,function(){return new e(a,b,c,d)})}}]);return e}(u.SingleTextureChunkFormat),x=function(c){function d(){k(this,d);return b(this,
Object.getPrototypeOf(d).apply(this,arguments))}a(d,c);f(d,[{key:"setTextureData",value:function(a){var b=this.source,c=b.chunkFormatHandler,d=c.chunkFormat,e=void 0;this.textureLayout=this.chunkDataSize===b.spec.chunkDataSize?e=c.textureLayout.addRef():e=d.getTextureLayout(a,this.chunkDataSize);var b=e.textureWidth*e.textureHeight*d.arrayElementsPerTexel,c=d.arrayConstructor,f=this.data;f.constructor!==c&&(f=new c(f.buffer,f.byteOffset,f.byteLength/c.BYTES_PER_ELEMENT));b=l.maybePadArray(f,b);a.texImage2D(a.TEXTURE_2D,
0,d.textureFormat,e.textureWidth,e.textureHeight,0,d.textureFormat,d.texelType,b)}},{key:"getChannelValueAt",value:function(a,b){var c=this.chunkDataSize,d=a[0]+c[0]*(a[1]+c[1]*(a[2]+c[2]*b)),e=this.chunkFormat.dataType,c=this.data;switch(e){case m.DataType.UINT8:case m.DataType.FLOAT32:case m.DataType.UINT16:case m.DataType.UINT32:return c[d];case m.DataType.UINT64:return d*=2,new p.Uint64(c[d],c[d+1])}throw Error("Invalid data type: "+e);}}]);return d}(u.SingleTextureVolumeChunk);d.UncompressedVolumeChunk=
x;var v=function(c){function d(a,c){k(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.chunkFormat=e.registerDisposer(w.get(a,c.dataType,c.numChannels));e.textureLayout=e.registerDisposer(e.chunkFormat.getTextureLayout(a,c.chunkDataSize));return e}a(d,c);f(d,[{key:"getChunk",value:function(a,b){return new x(a,b)}}]);return d}(h.RefCounted);d.UncompressedChunkFormatHandler=v;g.registerChunkFormatHandler(function(a,b){return null==b.compressedSegmentationBlockSize?new v(a,b):null})},function(g,
d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});
b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function n(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:n(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,
c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(8);var m=e(66);e=e(56);$jscomp.initSymbol();var u=Symbol("SingleTextureVolumeChunk.textureUnit");$jscomp.initSymbol();var l=Symbol("SingleTextureVolumeChunk.textureLayout");g=function(c){function d(a){k(this,d);var c=b(this,Object.getPrototypeOf(d).call(this));c.shaderKey=a;return c}a(d,c);f(d,[{key:"defineShader",value:function(a){a.addTextureSampler2D("uVolumeChunkSampler",u)}},{key:"beginDrawing",value:function(a,b){var c=b.textureUnit(u);a.activeTexture(a.TEXTURE0+
c);b[l]=null}},{key:"endDrawing",value:function(a,b){a.bindTexture(a.TEXTURE_2D,null);b[l]=null}},{key:"bindChunk",value:function(a,b,c){var d=c.textureLayout;b[l]!==d&&(b[l]=d,this.setupTextureLayout(a,b,d));a.bindTexture(a.TEXTURE_2D,c.texture)}}]);return d}(g.RefCounted);d.SingleTextureChunkFormat=g;e=function(d){function e(a,c){k(this,e);var d=b(this,Object.getPrototypeOf(e).call(this,a,c));d.texture=null;d.data=c.data;return d}a(e,d);f(e,[{key:"copyToGPU",value:function(a){c(Object.getPrototypeOf(e.prototype),
"copyToGPU",this).call(this,a);var b=this.texture=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);a.pixelStorei(a.UNPACK_ALIGNMENT,1);m.setRawTextureParameters(a);this.setTextureData(a);a.bindTexture(a.TEXTURE_2D,null)}},{key:"freeGPUMemory",value:function(a){c(Object.getPrototypeOf(e.prototype),"freeGPUMemory",this).call(this,a);a.deleteTexture(this.texture);this.texture=null;this.textureLayout.dispose();this.textureLayout=null}}]);return e}(e.VolumeChunk);d.SingleTextureVolumeChunk=e},function(g,
d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});
b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function D(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:D(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,
c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=e(59),u=e(86),l=e(88);g=e(56);var h=e(63),n=e(84),p=e(62),r=e(8),q=e(22),w=e(47),x=e(69),v=function(c){function d(a,c,e,f){k(this,d);var h=b(this,Object.getPrototypeOf(d).call(this));h.chunkDataSize=c;h.subchunkSize=e;var l=a.maxTextureSize;a=Math.ceil(f/l);if(a>l)throw Error("Chunk data size exceeds maximum texture size: "+f);f=Math.ceil(f/a);h.textureWidth=a;h.textureHeight=f;h.textureAccessCoefficients=Float32Array.of(1/a,1/(a*f));f=h.subchunkGridSize=
q.vec3.create();for(a=0;3>a;++a)f[a]=Math.ceil(c[a]/e[a]);return h}a(d,c);f(d,null,[{key:"get",value:function(a,b,c,e){return a.memoize.get("sliceview.CompressedSegmentationTextureLayout:"+q.vec3Key(b)+","+q.vec3Key(c)+","+e,function(){return new d(a,b,c,e)})}}]);return d}(r.RefCounted),y=function(d){function e(a,c,d,f){k(this,e);f=b(this,Object.getPrototypeOf(e).call(this,f));f.dataType=a;f.subchunkSize=c;f.numChannels=d;return f}a(e,d);f(e,[{key:"defineShader",value:function(a){c(Object.getPrototypeOf(e.prototype),
"defineShader",this).call(this,a);var b=function(a){return"compressedSegmentationChunkFormat_"+a};a.addUniform("highp vec2","uCompressedSegmentationTextureAccessCoefficients");a.addUniform("highp vec3","uSubchunkGridSize");a.addUniform("highp vec3","uChunkDataSize");a.addFragmentCode(x.glsl_getFortranOrderIndexFromNormalized);var d=this.dataType,f=h.GLSL_TYPE_FOR_DATA_TYPE.get(d);d===m.DataType.UINT64?a.addFragmentCode(x.glsl_uint64):a.addFragmentCode(x.glsl_uint32);f="\nvec4 "+b("readTextureValue")+
"(float offset) {\n  // We add 0.5 to avoid being right at a texel boundary.\n  offset += 0.5;\n  return texture2D(uVolumeChunkSampler,\n                   vec2(fract(offset * uCompressedSegmentationTextureAccessCoefficients.x),\n                        offset * uCompressedSegmentationTextureAccessCoefficients.y));\n}\nfloat "+b("getChannelOffset")+"(int channelIndex) {\n  if (channelIndex == 0) {\n    return 1.0;\n  }\n  vec4 v = "+b("readTextureValue")+"(float(channelIndex));\n  return v.x * 255.0 + (v.y * 255.0) * 256.0 + (v.z * 255.0) * 256.0 * 256.0;\n}\n"+
f+" getDataValue (int channelIndex) {\n  const vec3 uSubchunkSize = "+q.vec3.str(this.subchunkSize)+";\n\n  vec3 chunkPosition = getSubscriptsFromNormalized(vChunkPosition, uChunkDataSize);\n\n  // TODO: maybe premultiply this and store as uniform.\n  vec3 subchunkGridPosition = floor(chunkPosition / uSubchunkSize);\n  float subchunkGridOffset = getFortranOrderIndex(subchunkGridPosition, uSubchunkGridSize);\n\n  float channelOffset = "+b("getChannelOffset")+"(channelIndex);\n\n  // TODO: Maybe just combine this offset into subchunkGridStrides.\n  float subchunkHeaderOffset = subchunkGridOffset * 2.0 + channelOffset;\n\n  vec4 subchunkHeader0 = "+
b("readTextureValue")+"(subchunkHeaderOffset);\n  vec4 subchunkHeader1 = "+b("readTextureValue")+"(subchunkHeaderOffset + 1.0);\n\n  float outputValueOffset = dot(subchunkHeader0.xyz, vec3(255, 256 * 255, 256 * 256 * 255)) + channelOffset;\n  float encodingBits = subchunkHeader0[3] * 255.0;\n  if (encodingBits > 0.0) {\n    vec3 subchunkPosition = floor(min(chunkPosition - subchunkGridPosition * uSubchunkSize, uSubchunkSize - 1.0));\n    float subchunkOffset = getFortranOrderIndex(subchunkPosition, uSubchunkSize);\n    highp float encodedValueBaseOffset = dot(subchunkHeader1.xyz, vec3(255.0, 256.0 * 255.0, 256.0 * 256.0 * 255.0)) + channelOffset;\n    highp float encodedValueOffset = floor(encodedValueBaseOffset + subchunkOffset * encodingBits / 32.0);\n    vec4 encodedValue = "+
b("readTextureValue")+"(encodedValueOffset);\n    float wordOffset = mod(subchunkOffset * encodingBits, 32.0);\n    // If the value is in the first byte, then 0 <= wordOffset < 8.\n    // We need to mod by 2**encodedBits\n    float wordShifter = pow(2.0, -wordOffset);\n    float encodedValueMod = pow(2.0, encodingBits);\n    float encodedValueShifted;\n    if (wordOffset < 16.0) {\n      encodedValueShifted = dot(encodedValue.xy, vec2(255.0, 255.0 * 256.0));\n    } else {\n      encodedValueShifted = dot(encodedValue.zw, vec2(255.0 * 256.0 * 256.0, 255.0 * 256.0 * 256.0 * 256.0));\n    }\n    encodedValueShifted = floor(encodedValueShifted * wordShifter);\n    float decodedValue = mod(encodedValueShifted, encodedValueMod);\n    outputValueOffset += decodedValue * "+
(this.dataType===m.DataType.UINT64?"2.0":"1.0")+";\n  }\n  "+f+" result;\n";f=d===m.DataType.UINT64?f+("\n  result.low = "+b("readTextureValue")+"(outputValueOffset);\n  result.high = "+b("readTextureValue")+"(outputValueOffset+1.0);\n"):f+("\n  result.value = "+b("readTextureValue")+"(outputValueOffset);\n");a.addFragmentCode(f+"\n  return result;\n}\n")}},{key:"setupTextureLayout",value:function(a,b,c){a.uniform3fv(b.uniform("uChunkDataSize"),c.chunkDataSize);a.uniform3fv(b.uniform("uSubchunkGridSize"),
c.subchunkGridSize);a.uniform2fv(b.uniform("uCompressedSegmentationTextureAccessCoefficients"),c.textureAccessCoefficients)}},{key:"getTextureLayout",value:function(a,b,c){return v.get(a,b,this.subchunkSize,c)}}],[{key:"get",value:function(a,b,c,d){var f="sliceview.CompressedSegmentationChunkFormat:"+b+":"+q.vec3Key(c)+":"+d;return a.memoize.get(f,function(){return new e(b,c,d,f)})}}]);return e}(n.SingleTextureChunkFormat),A=function(c){function d(){k(this,d);return b(this,Object.getPrototypeOf(d).apply(this,
arguments))}a(d,c);f(d,[{key:"setTextureData",value:function(a){var b=this.data,c=this.textureLayout=this.chunkFormat.getTextureLayout(a,this.chunkDataSize,b.length),b=p.maybePadArray(b,c.textureWidth*c.textureHeight);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,c.textureWidth,c.textureHeight,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array(b.buffer,b.byteOffset,b.byteLength))}},{key:"getChannelValueAt",value:function(a,b){var c=this.chunkDataSize,d=this.chunkFormat,e=this.data,f=e[b];if(d.dataType===m.DataType.UINT64){var h=
new w.Uint64;l.readSingleChannelValue(h,e,f,c,d.subchunkSize,a);return h}return u.readSingleChannelValue(e,f,c,d.subchunkSize,a)}}]);return d}(n.SingleTextureVolumeChunk);d.CompressedSegmentationVolumeChunk=A;var t=function(c){function d(a,c){k(this,d);var e=b(this,Object.getPrototypeOf(d).call(this)),f=c.dataType;if(f!==m.DataType.UINT64&&f!==m.DataType.UINT32)throw Error("Unsupported compressed segmentation data type: "+m.DataType[f]);e.chunkFormat=e.registerDisposer(y.get(a,c.dataType,c.compressedSegmentationBlockSize,
c.numChannels));return e}a(d,c);f(d,[{key:"getChunk",value:function(a,b){return new A(a,b)}}]);return d}(r.RefCounted);d.CompressedSegmentationChunkFormatHandler=t;g.registerChunkFormatHandler(function(a,b){return null!=b.compressedSegmentationBlockSize?new t(a,b):null})},function(g,d,e){function k(b,d,e,k,l){d=a.decodeValueOffset(b,d,e,k,l,1)+d;return b[d]}function b(b,d,e,k,l){var h=k[0]*k[1]*k[2]*1;if(h!==b.length)throw Error("Output length "+b.length+" is not equal to expected length "+h+".");
for(var h=k[0],g=k[1],p=k[2],r=[0,0,0],q=0,w=0;w<p;++w){r[2]=w;for(var x=0;x<g;++x){r[1]=x;for(var v=0;v<h;++v){r[0]=v;var y=a.decodeValueOffset(d,e,k,l,r,1)+e;b[q++]=d[y]}}}return b}var a=e(87);d.readSingleChannelValue=k;d.readValue=function(a,b,d,e,l){return k(a,b+a[l[3]],d,e,l)};d.decodeChannel=b;d.decodeChannels=function(a,d,e,k,l){var h=k[0]*k[1]*k[2]*1,g=h*k[3];if(g!==a.length)throw Error("Output length "+a.length+" is not equal to expected length "+g+".");for(var g=k[3],p=0;p<g;++p)b(a.subarray(h*
p,h*(p+1)),d,e+d[p],k,l);return a}},function(g,d){d.decodeValueOffset=function(d,k,b,a,c,f){for(var g=0,u=0,l=1,h=1,n=0;3>n;++n)var p=c[n],r=a[n],q=p%r,g=g+Math.floor(p/r)*l,l=l*Math.ceil(b[n]/r),u=u+q*h,h=h*r;a=k+2*g;b=d[a];a=d[a+1];c=b&16777215;b=b>>24&255;0<b&&(c+=f*(d[(k+a&16777215)+Math.floor(u*b/32)]>>u*b%32&(1<<b)-1));return c}},function(g,d,e){function k(b,d,e,k,l,h){e=a.decodeValueOffset(d,e,k,l,h,2)+e;b.low=d[e];b.high=d[e+1];return b}function b(b,d,e,k,l){var h=k[0]*k[1]*k[2]*2;if(h!==
b.length)throw Error("Output length "+b.length+" is not equal to expected length "+h+".");for(var h=k[0],g=k[1],p=k[2],r=[0,0,0],q=0,w=0;w<p;++w){r[2]=w;for(var x=0;x<g;++x){r[1]=x;for(var v=0;v<h;++v){r[0]=v;var y=a.decodeValueOffset(d,e,k,l,r,2)+e;b[q++]=d[y];b[q++]=d[y+1]}}}return b}var a=e(87);d.readSingleChannelValue=k;d.readValue=function(a,b,d,e,l,h){return k(a,b,d+b[h[3]],e,l,h)};d.decodeChannel=b;d.decodeChannels=function(a,d,e,k,l){var h=k[0]*k[1]*k[2]*2,g=h*k[3];if(g!==a.length)throw Error("Output length "+
a.length+" is not equal to expected length "+g+".");for(var g=k[3],p=0;p<g;++p)b(a.subarray(h*p,h*(p+1)),d,e+d[p],k,l);return a}},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a){var b=d.LAYOUTS.find(function(b){return b[0]===a});if(void 0===b)throw Error("Invalid layout name: "+JSON.stringify(a)+".");return b}function f(a){return c(a)[0]}var m=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=
!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),u=e(57),l=e(58),h=e(90),n=e(37),p=e(95),r=e(136),q=e(96),w=e(140),x=e(141),v=e(91),y=e(33),A=e(142),t=e(56),B=e(105),D=e(67),z=e(64),C=e(144);g=e(8);var G=e(10),F=e(22),J=e(92),Q=e(7),P=e(48);e(145);e(125);e(70);var W=function(c){function d(a,c){k(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.rootElement=a;e.viewer=c;var f=c.makeOrthogonalSliceViews(),h=c.display,l={mouseState:c.mouseState,
layerManager:c.layerManager,navigationState:c.perspectiveNavigationState,showSliceViews:c.showPerspectiveSliceViews,showAxisLines:c.showAxisLines},g={mouseState:c.mouseState,layerManager:c.layerManager,navigationState:c.navigationState,showAxisLines:c.showAxisLines,showScaleBar:c.showScaleBar},n={mouseState:c.mouseState,layerManager:c.layerManager,navigationState:c.navigationState,showAxisLines:c.showAxisLines,showScaleBar:new D.TrackableBoolean(!1,!1)},p=[w.withFlex(1,w.box("column",[w.withFlex(1,
w.box("row",[w.withFlex(1,function(a){a.className="gllayoutcell noselect";e.registerDisposer(new B.SliceViewPanel(h,a,f[0],g))}),w.withFlex(1,function(a){a.className="gllayoutcell noselect";e.registerDisposer(new B.SliceViewPanel(h,a,f[1],n))})])),w.withFlex(1,w.box("row",[w.withFlex(1,function(a){a.className="gllayoutcell noselect";a=e.registerDisposer(new y.PerspectivePanel(h,a,l));for(var b=$jscomp.makeIterator(f),c=b.next();!c.done;c=b.next())a.sliceViews.add(c.value.addRef())}),w.withFlex(1,
function(a){a.className="gllayoutcell noselect";e.registerDisposer(new B.SliceViewPanel(h,a,f[2],n))})]))]))];w.box("row",p)(a);h.onResize();return e}a(d,c);m(d,[{key:"disposed",value:function(){G.removeChildren(this.rootElement)}}]);return d}(g.RefCounted);d.FourPanelLayout=W;var R=function(c){function d(a,c){k(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.rootElement=a;e.viewer=c;var f=c.makeSliceView(),h={mouseState:c.mouseState,layerManager:c.layerManager,navigationState:c.navigationState,
showAxisLines:c.showAxisLines,showScaleBar:c.showScaleBar};w.box("row",[w.withFlex(1,function(a){e.registerDisposer(new B.SliceViewPanel(c.display,a,f,h))})])(a);c.display.onResize();return e}a(d,c);m(d,[{key:"disposed",value:function(){G.removeChildren(this.rootElement)}}]);return d}(g.RefCounted);d.SinglePanelLayout=R;d.LAYOUTS=[["4panel",function(a,b){return new W(a,b)}],["xy",function(a,b){return new R(a,b)}]];d.getLayoutByName=c;d.validateLayoutName=f;e=function(e){function g(a){k(this,g);var c=
b(this,Object.getPrototypeOf(g).call(this));c.display=a;c.navigationState=c.registerDisposer(new x.NavigationState);c.perspectiveNavigationState=new x.NavigationState(new x.Pose(c.navigationState.position),1);c.mouseState=new n.MouseSelectionState;c.layerManager=c.registerDisposer(new n.LayerManager);c.showAxisLines=new D.TrackableBoolean(!0,!0);c.showScaleBar=new D.TrackableBoolean(!0,!0);c.showPerspectiveSliceViews=new D.TrackableBoolean(!0,!0);c.layerSelectedValues=c.registerDisposer(new n.LayerSelectedValues(c.layerManager,
c.mouseState));c.worker=new Q.RPC(new Worker("chunk_worker.bundle.js"));c.resetInitiated=new P.Signal;c.chunkQueueManager=new l.ChunkQueueManager(c.worker,c.display.gl,{gpuMemory:new u.AvailableCapacity(1E6,1E9),systemMemory:new u.AvailableCapacity(1E7,2E9),download:new u.AvailableCapacity(32,Number.POSITIVE_INFINITY)});c.chunkManager=new l.ChunkManager(c.chunkQueueManager);c.keyMap=new J.KeySequenceMap;c.keyCommands=new Map;c.layerSpecification=new q.LayerListSpecification(c.layerManager,c.chunkManager,
c.worker,c.layerSelectedValues,c.navigationState.voxelSize);c.layoutName=new z.TrackableValue(d.LAYOUTS[0][0],f);c.registerSignalBinding(a.updateStarted.add(c.onUpdateDisplay,c));c.registerSignalBinding(a.updateFinished.add(c.onUpdateDisplayFinished,c));c.registerEventListener(document,"contextmenu",function(a){a.preventDefault();return!1});C.registerTrackable("layers",c.layerSpecification);C.registerTrackable("navigation",c.navigationState);C.registerTrackable("showAxisLines",c.showAxisLines);C.registerTrackable("showScaleBar",
c.showScaleBar);C.registerTrackable("perspectiveOrientation",c.perspectiveNavigationState.pose.orientation);C.registerTrackable("perspectiveZoom",c.perspectiveNavigationState.zoomFactor);C.registerTrackable("showSlices",c.showPerspectiveSliceViews);C.registerTrackable("layout",c.layoutName);c.registerSignalBinding(c.navigationState.changed.add(c.handleNavigationStateChanged,c));c.layerManager.initializePosition(c.navigationState.position);c.layerManager.layersChanged.add(function(){0===c.layerManager.managedLayers.length&&
(c.navigationState.voxelSize.reset(),c.navigationState.reset(),c.perspectiveNavigationState.pose.orientation.reset(),c.perspectiveNavigationState.zoomFactor.reset(),c.resetInitiated.dispatch(),c.layerManager.initializePosition(c.navigationState.position),v.overlaysOpen||new p.LayerDialog(c.layerSpecification))});c.registerSignalBinding(c.chunkQueueManager.visibleChunksChanged.add(function(){c.layerSelectedValues.handleLayerChange()}));c.chunkQueueManager.visibleChunksChanged.add(a.scheduleRedraw,
a);c.makeUI();c.registerDisposer(new J.GlobalKeyboardShortcutHandler(c.keyMap,c.onKeyCommand.bind(c)));c.layoutName.changed.add(function(){if(void 0!==c.dataDisplayLayout){var a=c.dataDisplayLayout.rootElement;c.dataDisplayLayout.dispose();c.createDataDisplayLayout(a)}});var e=c.keyCommands;e.set("toggle-layout",function(){this.toggleLayout()});e.set("snap",function(){this.navigationState.pose.snap()});e.set("add-layer",function(){this.layerPanel.addLayerMenu();return!0});e.set("help",c.showHelpDialog);
a=function(a){e.set("toggle-layer-"+a,function(){var b=a-1,c=this.layerManager.managedLayers;b<c.length&&(b=c[b],b.setVisible(!b.visible))})};for(var h=1;9>=h;++h)a(h);a=function(a){e.set(a,function(){this.layerManager.invokeAction(a)})};for(var h=$jscomp.makeIterator(["recolor","clear-segments"]),m=h.next();!m.done;m=h.next())a(m.value);e.set("toggle-axis-lines",function(){this.showAxisLines.toggle()});e.set("toggle-scale-bar",function(){this.showScaleBar.toggle()});c.keyCommands.set("toggle-show-slices",
function(){this.showPerspectiveSliceViews.toggle()});0===c.layerManager.managedLayers.length&&new p.LayerDialog(c.layerSpecification);return c}a(g,e);m(g,[{key:"makeUI",value:function(){var a=this,b=this.display,c=document.createElement("div");c.setAttribute("class","gllayoutcontainer noselect");b.container.appendChild(c);w.box("column",[w.box("row",[w.withFlex(1,function(b){return new A.PositionStatusPanel(b,a)}),function(b){var c=document.createElement("button");c.className="help-button";c.textContent=
"?";c.title="Help";b.appendChild(c);a.registerEventListener(c,"click",function(){a.showHelpDialog()})}]),function(b){a.layerPanel=new r.LayerPanel(b,a.layerSpecification)},w.withFlex(1,function(b){a.createDataDisplayLayout(b)})])(c);this.display.onResize()}},{key:"createDataDisplayLayout",value:function(a){this.dataDisplayLayout=(0,c(this.layoutName.value)[1])(a,this)}},{key:"toggleLayout",value:function(){var a=c(this.layoutName.value),a=d.LAYOUTS.indexOf(a);this.layoutName.value=d.LAYOUTS[(a+1)%
d.LAYOUTS.length][0]}},{key:"showHelpDialog",value:function(){new h.KeyBindingHelpDialog(this.keyMap)}},{key:"onUpdateDisplay",value:function(){C.delayHashUpdate();this.chunkQueueManager.chunkUpdateDeadline=null}},{key:"onUpdateDisplayFinished",value:function(){this.mouseState.updateIfStale()}},{key:"onKeyCommand",value:function(a){var b=this.keyCommands.get(a);return b&&b.call(this)?!0:(b=this.display.activePanel)?b.onKeyCommand(a):!1}},{key:"makeSliceView",value:function(a){var b=void 0,b=void 0===
a?this.navigationState:new x.NavigationState(new x.Pose(this.navigationState.pose.position,x.OrientationState.makeRelative(this.navigationState.pose.orientation,a)),this.navigationState.zoomFactor);return new t.SliceView(this.gl,this.chunkManager,this.layerManager,b)}},{key:"makeOrthogonalSliceViews",value:function(){var a=[];a.push(this.makeSliceView(void 0));var b=F.quat.rotateX(F.quat.create(),F.quat.create(),Math.PI/2);a.push(this.makeSliceView(b));b=F.quat.rotateY(F.quat.create(),F.quat.create(),
Math.PI/2);a.push(this.makeSliceView(b));return a}},{key:"handleNavigationStateChanged",value:function(){var a=this.chunkQueueManager;null===a.chunkUpdateDeadline&&(a.chunkUpdateDeadline=Date.now()+10);this.mouseState.stale=!0}},{key:"gl",get:function(){return this.display.gl}}]);return g}(g.RefCounted);d.Viewer=e},function(g,d,e){function k(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&
b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function b(a){return a.startsWith("key")?a.substring(3):a.startsWith("digit")||a.startsWith("arrow")?a.substring(5):a}function a(a){return a.split("+").map(b).join("+")}var c=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,k=void 0;try{$jscomp.initSymbol();
$jscomp.initSymbolIterator();for(var g=a[Symbol.iterator](),r;!(d=(r=g.next()).done)&&(c.push(r.value),!b||c.length!==b);d=!0);}catch(q){e=!0,k=q}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw k;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}();g=e(91);e(94);d.formatKeyName=b;d.formatKeyStroke=a;e=function(b){function d(b){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var e;e=Object.getPrototypeOf(d).call(this);
if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");e=!e||"object"!==typeof e&&"function"!==typeof e?this:e;var f=e.content;f.classList.add("describe-key-bindings");var k=document.createElement("div"),g=document.createElement("div");g.className="dl";b=$jscomp.makeIterator(b.entries());for(var r=b.next();!r.done;r=b.next()){var q=c(r.value,2),r=q[0],q=q[1],w=document.createElement("div"),x=document.createElement("div");x.className="definition-outer-container";
w.className="definition-container";var v=document.createElement("div");v.className="dt";v.textContent=r.map(a).join(" ");r=document.createElement("div");r.className="dd";r.textContent=q;w.appendChild(v);w.appendChild(r);g.appendChild(x);x.appendChild(w)}k.appendChild(g);f.appendChild(k);return e}k(d,b);return d}(g.Overlay);d.KeyBindingHelpDialog=e},function(g,d,e){function k(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);
a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var b=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(8);var a=e(92);e(93);d.overlaysOpen=0;var c=new a.KeySequenceMap;c.bind("escape",
"close");e=function(e){function g(){var b=0>=arguments.length||void 0===arguments[0]?c:arguments[0];if(!(this instanceof g))throw new TypeError("Cannot call a class as a function");var e;e=Object.getPrototypeOf(g).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");e=!e||"object"!==typeof e&&"function"!==typeof e?this:e;e.keySequenceMap=b;++d.overlaysOpen;var f=e.container=document.createElement("div");f.className="overlay";var k=e.content=document.createElement("div");
k.className="overlay-content";f.appendChild(k);document.body.appendChild(f);e.keyboardShortcutHandler=e.registerDisposer(new a.GlobalKeyboardShortcutHandler(b,e.commandReceived.bind(e)));return e}k(g,e);b(g,[{key:"commandReceived",value:function(a){"close"===a&&this.dispose();return!1}},{key:"disposed",value:function(){--d.overlaysOpen;document.body.removeChild(this.container)}}]);return g}(g.RefCounted);d.Overlay=e},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a){return(a.ctrlKey?
1:0)|(a.altKey?2:0)|(a.metaKey?4:0)|(a.shiftKey?8:0)}function f(a,b){var c="";b&1&&(c+="control+");b&2&&(c+="alt+");b&4&&(c+="meta+");b&8&&(c+="shift+");return c+a}function m(a){return a.code.toLowerCase()}function u(a){a=a.toLowerCase().replace(" ","");for(var b=a.split("+"),c=void 0,d=0,b=$jscomp.makeIterator(b),e=b.next();!e.done;e=b.next())switch(e=e.value,e){case "control":d|=1;break;case "alt":d|=2;break;case "meta":d|=4;break;case "shift":d|=8;break;default:c=void 0===c?e:null}if(null==c)throw Error("Invalid stroke "+
JSON.stringify(a));return f(c,d)}function l(a){"string"===typeof a&&(a=a.replace(/[ +]*\+[ +]*/g,"+").replace(/[ ]+/g," ").toLowerCase(),a=a.split(" "));a=a.map(u);if(0===a.length)throw Error("Key sequence must not be empty");return a}function h(a){return JSON.stringify(a.join(" "))}function n(a){function b(r,y){for(;;)switch(c){case 0:t=1>=v.length||void 0===v[1]?[]:v[1],m=$jscomp.makeIterator(a),p=m.next();case 1:if(p.done){c=3;break}g=p.value;k=q(g,2);l=k[0];h=k[1];f=[].concat($jscomp.arrayFromIterable(t),
[l]);if("string"!==typeof h){c=4;break}c=6;return{value:[f,h],done:!1};case 6:if(void 0===y){c=7;break}c=-1;throw y;case 7:c=5;break;case 4:e=$jscomp.makeIterator(n(h,f));case 8:if((d=e.next(r)).done){c=9;break}c=10;return{value:d.value,done:!1};case 10:if(void 0===y){c=11;break}c=-1;throw y;case 11:c=8;break;case 9:case 5:case 2:p=m.next();c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,h,l,k,g,p,m,t,v=arguments,r={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,
a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();r[Symbol.iterator]=function(){return this};return r}function p(a,b,c){void 0===B&&(B=new y(window,new t,function(){return!1}));D.push([B.keySequenceMap,B.handler,z]);B.setKeySequenceMap(a);B.handler=b;z=c}function r(){var a=D.pop(),a=q(a,3),b=a[1],c=a[2];B.setKeySequenceMap(a[0]);B.handler=b;z=c}var q=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();
if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var h=a[Symbol.iterator](),l;!(d=(l=h.next()).done)&&(c.push(l.value),!b||c.length!==b);d=!0);}catch(k){e=!0,f=k}finally{try{if(!d&&h["return"])h["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),w=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=
!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(8);var x=new Set("f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11 f12 escape pause".split(" ")),v=new Set("color date datetime datetime-local email month number password search tel text time url week".split(" ")),y=function(d){function e(a,c,d){k(this,e);var f=b(this,Object.getPrototypeOf(e).call(this));f.target=a;f.keySequenceMap=c;f.handler=d;f.modifierShortcutsAreGlobal=!0;
f.allShortcutsAreGlobal=!1;f.allowSpaceKeyOnButtons=!1;f.reset();f.registerEventListener(a,"keydown",f.handleKeyDown.bind(f),!0);return f}a(e,d);w(e,[{key:"reset",value:function(){this.currentNode=this.keySequenceMap.root;this.lastStrokeTime=Number.NEGATIVE_INFINITY}},{key:"setKeySequenceMap",value:function(a){this.keySequenceMap=a;this.reset()}},{key:"shouldIgnoreEvent",value:function(a,b){var c=b.target,d=c.tagName;if(c===this.target)return!1;var e="TEXTAREA"===d||"INPUT"===d||"BUTTON"===d||"SELECT"===
d,f=!e&&(c.isContentEditable||c.ownerDocument&&"on"===c.ownerDocument.designMode);return!e&&!f||this.allShortcutsAreGlobal||x.has(a)?!1:f||this.modifierShortcutsAreGlobal&&(b.altKey||b.ctrlKey||b.metaKey)?!0:"INPUT"===d&&v.has(c.type)?"enter"!==a:"INPUT"===d||"BUTTON"===d?this.allowSpaceKeyOnButtons?!1:"space"===a:!0}},{key:"handleKeyDown",value:function(a){var b=m(a);if(!this.shouldIgnoreEvent(b,a)){var b=f(b,c(a)),d=this.keySequenceMap.root,e=this.currentNode,h=e.get(b),l=Date.now();e!==d&&(void 0===
h||l>this.lastStrokeTime+1500)&&(this.currentNode=d,h=e.get(b));void 0!==h&&("string"===typeof h?(this.reset(),this.handler(h)&&a.preventDefault()):(this.currentNode=h,this.lastStrokeTime=l,a.preventDefault()))}}}]);return e}(g.RefCounted);d.KeyboardShortcutHandler=y;d.getEventStrokeIdentifier=function(a){return f(m(a),c(a))};var A;(function(a){a[a.CONTROL=1]="CONTROL";a[a.ALT=2]="ALT";a[a.META=4]="META";a[a.SHIFT=8]="SHIFT"})(A||(A={}));d.getEventModifierMask=c;d.getStrokeIdentifier=f;d.getEventKeyName=
m;d.parseKeyStroke=u;d.parseKeySequence=l;d.formatKeySequence=h;var t=function(){function a(){var b=0>=arguments.length||void 0===arguments[0]?null:arguments[0];k(this,a);this.root=new Map;null!=b&&this.bindMultiple(b)}w(a,[{key:"bind",value:function(a,b){for(var c=l(a),d=this.root,e=c.length-1,f=0;f<e;++f){var k=c[f],g=d.get(k);void 0===g&&(g=new Map,d.set(k,g));if("string"===typeof g)throw Error("Error binding key sequence "+h(c)+": prefix "+h(c.slice(0,f+1))+" is already bound to action "+JSON.stringify(g));
d=g}e=c[e];f=d.get(e);if(void 0!==f)throw Error("Key sequence "+h(c)+" is already bound to action "+JSON.stringify(f));d.set(e,b)}},{key:"bindMultiple",value:function(a){for(var b=$jscomp.makeIterator(Object.keys(a)),c=b.next();!c.done;c=b.next())c=c.value,this.bind(c,a[c])}},{key:"entries",value:function(){return n(this.root)}}]);return a}();d.KeySequenceMap=t;var B=void 0,D=[],z=void 0;d.pushGlobalKeyboardHandler=p;d.popGlobalKeyboardHandler=r;A=function(c){function d(a,c){k(this,d);var e=b(this,
Object.getPrototypeOf(d).call(this));e.keySequenceMap=a;e.handler=c;p(a,c,e);return e}a(d,c);w(d,[{key:"disposed",value:function(){if(z===this)r();else{var a=this,b=D.findIndex(function(b){return b[2]===a});D.splice(b,1)}}}]);return d}(g.RefCounted);d.GlobalKeyboardShortcutHandler=A},function(g,d){},function(g,d){},function(g,d,e){function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,
b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,
c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),c=e(17),f=e(96);g=e(91);var m=e(59),u=e(6),l=e(128),h=e(129),n=e(134);e(135);e=function(d){function e(a,b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var d=k(this,Object.getPrototypeOf(e).call(this));d.manager=a;d.existingLayer=b;d.statusElement=document.createElement("div");d.submitElement=document.createElement("button");d.namePromptElement=document.createElement("label");d.nameInputElement=document.createElement("input");
d.sourceValid=!1;d.nameValid=!0;var g=d.content;g.classList.add("add-layer-overlay");var p=document.createElement("form");p.className="source-form";d.registerEventListener(p,"submit",function(a){a.preventDefault();d.validateSource(!0)});var m=document.createElement("label");m.textContent="Source:";var t=d.sourceInput=d.registerDisposer(new h.AutocompleteTextInput({completer:function(a){return u.cancellableThen(c.volumeCompleter(a),function(a){return{completions:a.completions,makeElement:h.makeCompletionElementWithDescription,
offset:a.offset,showSingleResult:!0}})},delay:0}));t.element.classList.add("add-layer-source");t.inputElement.addEventListener("blur",function(a){d.validateSource(!1)});d.submitElement.disabled=!0;t.inputChanged.add(function(){u.cancelPromise(d.volumePromise);d.volumePromise=void 0;d.sourceValid=!1;d.submitElement.disabled=!0;d.statusElement.textContent=""});p.appendChild(m);p.appendChild(t.element);l.associateLabelWithElement(m,t.inputElement);m=n.makeHiddenSubmitButton();p.appendChild(m);g.appendChild(p);
var B=d.statusElement,D=d.namePromptElement,z=d.nameInputElement,p=d.submitElement;B.className="dialog-status";m=document.createElement("form");m.className="name-form";D.textContent="Name:";z.className="add-layer-name";z.autocomplete="off";z.spellcheck=!1;z.type="text";d.registerEventListener(z,"input",function(){d.validateName()});p.type="submit";l.associateLabelWithElement(D,z);m.appendChild(D);m.appendChild(z);m.appendChild(p);g.appendChild(m);g.appendChild(B);void 0!==b?(void 0!==b.sourceUrl?
(t.value=b.sourceUrl,d.validateSource()):d.sourceValid=!0,t.disabled=!0,z.value=b.name,d.validateName(),p.textContent="Save",z.focus()):(g=d.manager.layerManager.managedLayers,0<g.length&&(g=g[g.length-1],g instanceof f.ManagedUserLayerWithSpecification&&(g=g.sourceUrl,void 0!==g&&(B=c.findSourceGroup(g),t.value=g.substring(0,B),t.inputElement.setSelectionRange(0,B)))),t.inputElement.focus(),p.textContent="Add Layer");d.registerEventListener(m,"submit",function(a){a.preventDefault();d.submit()});
return d}b(e,d);a(e,[{key:"isNameValid",value:function(){var a=this.nameInputElement.value;if(""===a)return!1;a=this.manager.layerManager.getLayerByName(a);return void 0===a||a===this.existingLayer}},{key:"submit",value:function(){this.sourceValid&&this.isNameValid()&&(this.existingLayer?(this.existingLayer.name=this.nameInputElement.value,this.manager.layerManager.layersChanged.dispatch()):this.manager.layerManager.addManagedLayer(this.manager.getLayer(this.nameInputElement.value,this.sourceInput.value)),
this.dispose())}},{key:"validateName",value:function(){var a=this.nameInputElement;(this.nameValid=this.isNameValid())?(a.classList.add("valid-input"),a.classList.remove("invalid-input")):(a.classList.remove("valid-input"),a.classList.add("invalid-input"));this.validityChanged()}},{key:"validityChanged",value:function(){this.submitElement.disabled=!(this.nameValid&&this.sourceValid)}},{key:"validateSource",value:function(){var a=this,b=0>=arguments.length||void 0===arguments[0]?!1:arguments[0],d=
this.sourceInput.value;if(""!==d){try{var e=c.suggestLayerName(d),f=this.nameInputElement;if(""===this.nameInputElement.value){for(var h=e,l=0;void 0!==this.manager.layerManager.getLayerByName(h);)h=e+ ++l;f.value=h;f.setSelectionRange(0,h.length);this.validateName()}b&&f.focus()}catch(g){this.setError(g.message);return}this.setInfo("Validating volume source...");b=new Promise(function(a){a(c.getVolume(d))});this.volumePromise=u.cancellableThen(b,function(b){a.sourceValid=!0;a.setInfo(m.VolumeType[b.volumeType].toLowerCase()+
": "+b.numChannels+"-channel "+m.DataType[b.dataType].toLowerCase());a.validityChanged()});b.catch(function(b){b!==u.CANCELLED&&a.setError(b.message)})}}},{key:"setInfo",value:function(a){this.statusElement.className="dialog-status dialog-status-info";this.statusElement.textContent=a}},{key:"setError",value:function(a){this.statusElement.className="dialog-status dialog-status-error";this.statusElement.textContent=a}}]);return e}(g.Overlay);d.LayerDialog=e},function(g,d,e){function k(a,b){if(!(a instanceof
b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,
b):a.__proto__=b)}function c(a){return r.StatusMessage.forPromise(new Promise(function(b){b(l.getVolume(a))}),{initialMessage:"Retrieving metadata for volume "+a+".",delay:!0,errorPrefix:"Error retrieving metadata for volume "+a+": "})}var f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=e(59),u=e(48);
g=e(37);var l=e(17),h=e(8),n=e(97),p=e(117),r=e(4),q=e(11);d.getVolumeWithStatusMessage=c;var w=function(c){function d(a,c,e){k(this,d);a=b(this,Object.getPrototypeOf(d).call(this,a));a.initialSpecification=c;a.manager=e;return a}a(d,c);f(d,[{key:"toJSON",value:function(){var a=this.layer;if(!a)return this.initialSpecification;a=a.toJSON();this.visible||(a.visible=!1);return a}}]);return d}(g.ManagedUserLayer);d.ManagedUserLayerWithSpecification=w;e=function(d){function e(a,c,d,f,h){k(this,e);var l=
b(this,Object.getPrototypeOf(e).call(this));l.layerManager=a;l.chunkManager=c;l.worker=d;l.layerSelectedValues=f;l.voxelSize=h;l.changed=new u.Signal;l.registerSignalBinding(a.layersChanged.add(l.changed.dispatch,l.changed));l.registerSignalBinding(a.specificationChanged.add(l.changed.dispatch,l.changed));return l}a(e,d);f(e,[{key:"restoreState",value:function(a){q.verifyObject(a);this.layerManager.clear();for(var b=$jscomp.makeIterator(Object.keys(a)),c=b.next();!c.done;c=b.next())c=c.value,this.layerManager.addManagedLayer(this.getLayer(c,
a[c]))}},{key:"getLayer",value:function(a,b){var d=new w(a,b,this);"string"===typeof b&&(b={source:b});q.verifyObject(b);var e=q.verifyObjectProperty(b,"type",q.verifyOptionalString);d.visible=q.verifyObjectProperty(b,"visible",function(a){if(void 0===a||!0===a)return!0;if(!1===a)return!1;throw Error("Expected boolean, but received: "+JSON.stringify(a)+".");});var f=d.sourceUrl=q.verifyObjectProperty(b,"source",q.verifyOptionalString);if(void 0===e){var h=this;if(void 0===f)throw Error("Either layer 'type' or 'source' URL must be specified.");
c(f).then(function(a){if(-1!==h.layerManager.managedLayers.indexOf(d))switch(a.volumeType){case m.VolumeType.IMAGE:a=new p.ImageUserLayer(h,b);d.layer=a;break;case m.VolumeType.SEGMENTATION:a=new n.SegmentationUserLayer(h,b);d.layer=a;break;default:throw Error("Unsupported source type.");}})}else if("image"===e)d.layer=new p.ImageUserLayer(this,b);else if("segmentation"===e)d.layer=new n.SegmentationUserLayer(this,b);else throw Error("Layer type not specified.");return d}},{key:"toJSON",value:function(){for(var a=
{},b=0,c=$jscomp.makeIterator(this.layerManager.managedLayers),d=c.next();!d.done;d=c.next())d=d.value,a[d.name]=d.toJSON(),++b;return 0===b?void 0:a}}]);return e}(h.RefCounted);d.LayerListSpecification=e},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==
typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,
c);d&&a(b,d);return b}}(),f=function z(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:z(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},m=e(17);g=e(37);var u=e(96),l=e(19),h=e(98),n=e(103),p=e(104),r=e(63),q=e(108),w=e(109),x=e(11),v=e(47),y=e(110),A=e(112),t=e(114);e(116);e=function(d){function e(a,c){k(this,e);var d=b(this,Object.getPrototypeOf(e).call(this,[]));d.manager=
a;d.segmentColorHash=h.SegmentColorHash.getDefault();d.segmentSelectionState=new n.SegmentSelectionState;d.selectedAlpha=r.trackableAlphaValue(.5);d.notSelectedAlpha=r.trackableAlphaValue(0);d.wasDisposed=!1;d.visibleSegments=w.Uint64Set.makeWithCounterpart(a.worker);d.visibleSegments.changed.add(function(){d.specificationChanged.dispatch()});d.segmentSelectionState.bindTo(a.layerSelectedValues,d);d.selectedAlpha.changed.add(function(){d.specificationChanged.dispatch()});d.notSelectedAlpha.changed.add(function(){d.specificationChanged.dispatch()});
d.selectedAlpha.restoreState(c.selectedAlpha);d.notSelectedAlpha.restoreState(c.notSelectedAlpha);var f=d.volumePath=x.verifyOptionalString(c.source),l=d.meshPath=x.verifyOptionalString(c.mesh),g=d.skeletonsPath=x.verifyOptionalString(c.skeletons);void 0!==f&&(f=u.getVolumeWithStatusMessage(f),f.then(function(a){d.wasDisposed||d.meshLayer||(a=a.getMeshSource(d.manager.chunkManager),null!=a&&d.addMesh(a))}),d.addRenderLayer(new q.SegmentationRenderLayer(a.chunkManager,f,d,d.selectedAlpha,d.notSelectedAlpha)));
void 0!==l&&(f=c.meshLod,"number"!==typeof f&&(f=void 0),d.meshLod=f,d.addMesh(m.getMeshSource(a.chunkManager,l,f)));void 0!==g&&(l=new p.SkeletonLayer(a.chunkManager,m.getSkeletonSource(a.chunkManager,g),a.voxelSize,d),d.addRenderLayer(new p.PerspectiveViewSkeletonLayer(l)),d.addRenderLayer(new p.SliceViewPanelSkeletonLayer(l)));x.verifyObjectProperty(c,"segments",function(a){void 0!==a&&function(){var b=d.visibleSegments;x.parseArray(a,function(a){a=v.Uint64.parseString(String(a),10);b.add(a)})}()});
return d}a(e,d);c(e,[{key:"disposed",value:function(){f(Object.getPrototypeOf(e.prototype),"disposed",this).call(this);this.wasDisposed=!0}},{key:"addMesh",value:function(a){this.meshLayer=new l.MeshLayer(this.manager.chunkManager,a,this);this.addRenderLayer(this.meshLayer)}},{key:"toJSON",value:function(){var a={type:"segmentation"};a.source=this.volumePath;a.mesh=this.meshPath;a.meshLod=this.meshLod;a.skeletons=this.skeletonsPath;a.selectedAlpha=this.selectedAlpha.toJSON();a.notSelectedAlpha=this.notSelectedAlpha.toJSON();
var b=this.visibleSegments;if(0<b.size)for(var c=a.segments=[],b=$jscomp.makeIterator(b),d=b.next();!d.done;d=b.next())c.push(d.value.toString());return a}},{key:"makeDropdown",value:function(a){return new B(a,this)}},{key:"handleAction",value:function(a){switch(a){case "recolor":this.segmentColorHash.randomize();break;case "clear-segments":this.visibleSegments.clear();break;case "select":if(a=this.segmentSelectionState,a.hasSelectedSegment){a=a.selectedSegment;var b=this.visibleSegments;b.has(a)?
b.delete(a):b.add(a)}}}}]);return e}(g.UserLayer);d.SegmentationUserLayer=e;var B=function(c){function d(a,c){k(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.element=a;e.layer=c;e.visibleSegmentWidget=e.registerDisposer(new A.SegmentSetWidget(e.layer));e.addSegmentWidget=e.registerDisposer(new t.Uint64EntryWidget);e.selectedAlphaWidget=e.registerDisposer(new y.RangeWidget(e.layer.selectedAlpha));e.notSelectedAlphaWidget=e.registerDisposer(new y.RangeWidget(e.layer.notSelectedAlpha));
a.classList.add("segmentation-dropdown");var f=e.notSelectedAlphaWidget;e.selectedAlphaWidget.promptElement.textContent="Opacity (on)";f.promptElement.textContent="Opacity (off)";a.appendChild(e.selectedAlphaWidget.element);a.appendChild(e.notSelectedAlphaWidget.element);e.addSegmentWidget.element.classList.add("add-segment");e.addSegmentWidget.element.title="Add segment ID";a.appendChild(e.registerDisposer(e.addSegmentWidget).element);e.registerSignalBinding(e.addSegmentWidget.valueEntered.add(function(a){e.layer.visibleSegments.add(a)}));
a.appendChild(e.registerDisposer(e.visibleSegmentWidget).element);return e}a(d,c);return d}(g.UserLayerDropdown)},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a){return a-Math.floor(a)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),
c=e(99),f=e(69),m=e(100),u=e(48),l=e(102);g=function(){function b(a){k(this,b);this.prefix=a;this.aName=this.prefix+"_a";this.bName=this.prefix+"_b"}a(b,[{key:"defineShader",value:function(a){var b=this.aName,d=this.bName;a.addUniform("highp vec4",b,4);a.addUniform("highp float",d,4);a.addFragmentCode(f.glsl_uint64);a.addFragmentCode(m.glsl_hashFunction);a.addFragmentCode(f.glsl_hsvToRgb);for(var e="\nvec3 "+this.prefix+"(uint64_t x) {\n  vec2 v;\n  float primeModulus = float("+c.PRIME_MODULUS+");\n",
h=0;2>h;++h)var l=2*h,g=2*h,e=e+("\n  v["+h+"] = computeHash(x, "+b+"["+g+"], "+b+"["+(g+1)+"], "+d+"["+l+"], "+d+"["+(l+1)+"], primeModulus, 1.0 / 256.0);\n");a.addFragmentCode(e+"\n  vec3 hsv = vec3(v.x, 0.5 + v.y * 0.5, 1.0);\n  return hsvToRgb(hsv);\n}\n")}},{key:"enable",value:function(a,b,c){a.uniform4fv(b.uniform(this.aName),c.a_);a.uniform1fv(b.uniform(this.bName),c.b_)}}]);return b}();d.SegmentColorShaderManager=g;var h=new Float32Array(2),n=new Float32Array(3);g=function(){function d(a){k(this,
d);this.a_=new Float32Array(16);this.b_=new Float32Array(4);this.changed=new u.Signal;null==a?(this.hashFunctions=Array(2),this.randomize_()):this.hashFunctions=a;this.computeGPUCoefficients_()}a(d,[{key:"compute",value:function(a,c){for(var d=c.low,e=c.high,f=this.hashFunctions,g=0;2>g;++g)h[g]=b(f[g].compute(d,e)/256);l.hsvToRgb(a,h[0],.5+.5*h[1],1);return a}},{key:"computeCssColor",value:function(a){this.compute(n,a);return"rgb("+100*n[0]+"%,"+100*n[1]+"%,"+100*n[2]+"%)"}},{key:"debugCompute",
value:function(a,d){for(var e=d.low,f=d.high,h=this.b_,l=c.PRIME_MODULUS,g=0;2>g;++g){for(var k=2*g,n=2*g,p=new Float32Array(2),m=0;4>m;++m)p[0]+=this.a_[4*n+m]*(e>>8*m&255),p[1]+=this.a_[4*(n+1)+m]*(f>>8*m&255);var n=(p[0]+p[1])%l,m=n*n%l,u=m*h[k+1]%l,G=(h[k]+n+u)%l;console.log("b = "+h[k]+", sums="+p[0]+" "+p[1]+", dotResult="+n+", prod = "+n*n+" dotResult2="+m+", y="+u+", modResult="+G);a[g]=b(1/256*G)}return a}},{key:"randomize_",value:function(){for(var a=0;2>a;++a)this.hashFunctions[a]=c.HashFunction.generate()}},
{key:"randomize",value:function(){this.randomize_();this.computeGPUCoefficients_();this.changed.dispatch()}},{key:"toString",value:function(){return"new SegmentColorHash(["+this.hashFunctions+"])"}},{key:"computeGPUCoefficients_",value:function(){for(var a=this.hashFunctions,b=this.a_,c=this.b_,d=0;2>d;++d){var e=a[d],f=2*d,h=8*d;c[f]=1*e.b;c[f+1]=1*e.c;for(f=0;4>f;++f)b[h+f]=1*e.a0[f],b[h+4+f]=1*e.a1[f]}}}],[{key:"getDefault",value:function(){return new d([new c.HashFunction(Float32Array.of(609,
2364,3749,2289),Float32Array.of(2840,1186,3660,1833),1718,1109),new c.HashFunction(Float32Array.of(3466,3835,3345,2040),Float32Array.of(3382,901,18,3444),1534,1432)])}}]);return d}();d.SegmentColorHash=g},function(g,d){var e=function(){function b(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,c,d){c&&b(a.prototype,c);d&&b(a,d);return a}}();d.PRIME_MODULUS=4093;var k=function(){function b(a,
c,d,e){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.a0=a;this.a1=c;this.b=d;this.c=e}e(b,[{key:"computeDotProduct",value:function(a,b){var d=this.a0,e=this.a1;return d[0]*(a&255)+d[1]*(a>>8&255)+d[2]*(a>>16&255)+d[3]*(a>>24&255)+(e[0]*(b&255)+e[1]*(b>>8&255)+e[2]*(b>>16&255)+e[3]*(b>>24&255))}},{key:"compute",value:function(a,b){var e=this.b,g=this.c,k=this.computeDotProduct(a,b);return(k+k*k%d.PRIME_MODULUS*g+e)%d.PRIME_MODULUS}},{key:"toString",value:function(){return"new HashFunction(Float32Array.of("+
this.a0+"), Float32Array.of("+this.a1+"), "+this.b+", "+this.c+")"}}],[{key:"generate",value:function(){function a(){return Math.floor(Math.random()*d.PRIME_MODULUS)}return new b(Float32Array.of(a(),a(),a(),a()),Float32Array.of(a(),a(),a(),a()),a(),a())}}]);return b}();d.HashFunction=k},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),c=e(99),f=e(101);g=e(69);var m=e(8),u=e(66);d.glsl_hashFunction=[g.glsl_uint64,
g.glsl_exactDot,g.glsl_imod,"\nfloat computeHash(uint64_t x, vec4 a0, vec4 a1, float b, float c, float modulus, float scalar) {\n  x.low *= 255.0;\n  x.high *= 255.0;\n  float dotResult = imod(exactDot(a0, x.low) + exactDot(a1, x.high), modulus);\n  float dotResult2 = imod(dotResult * dotResult, modulus);\n  float y = imod(dotResult2 * c, modulus);\n  float modResult = imod(dotResult + y + b, modulus);\n  return fract(modResult * scalar);\n}\n"];e=function(d){function e(a,b){k(this,e);var c;c=Object.getPrototypeOf(e).call(this);
if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.gl=a;c.hashTable=b;c.hashFunctions=null;c.generation=null;c.textures=[];var d=b.hashFunctions.length;c.a=new Float32Array(16*d);c.b=new Float32Array(4*d+5);for(var f=c.textures,l=0;l<d;++l)f[l]=a.createTexture();return c}b(e,d);a(e,[{key:"computeCoefficients",value:function(){var a=this.hashTable,b=a.hashFunctions;if(this.hashFunctions!==b){this.hashFunctions=
b;for(var d=this.a,e=this.b,f=b.length,h=a.width,a=[1/h,1/a.height],l=0;2>l;++l)e[4*f+l]=c.PRIME_MODULUS,e[4*f+3+l]=a[l];e[4*f+2]=1/(2*h);for(h=0;h<f;++h)for(a=b[h],l=0;2>l;++l){var g=a[l],k=4*h+2*l,m=4*(4*h+2*l);e[k]=g.b+(0===l?.25:.5);e[k+1]=g.c;for(k=0;4>k;++k)d[m+k]=g.a0[k],d[m+4+k]=g.a1[k]}}}},{key:"copyToGPU",value:function(){this.computeCoefficients();var a=this.hashTable,b=a.generation;if(this.generation!==b){this.generation=b;var b=a.width,c=a.height,a=a.tables,d=this.gl,e=this.textures,
f=e.length;d.activeTexture(d.TEXTURE0+d.tempTextureUnit);for(var h=0;h<f;++h){d.bindTexture(d.TEXTURE_2D,e[h]);d.pixelStorei(d.UNPACK_ALIGNMENT,1);u.setRawTextureParameters(d);var l=d.RGBA;d.texImage2D(d.TEXTURE_2D,0,l,2*b,c,0,l,d.UNSIGNED_BYTE,new Uint8Array(a[h].buffer))}d.bindTexture(d.TEXTURE_2D,null)}}},{key:"disposed",value:function(){var a=this.gl;this.textures.forEach(function(b){a.deleteTexture(b)});this.hashFunctions=this.hashTable=this.gl=this.textures=null}}],[{key:"get",value:function(a,
b){return a.memoize.get(b,function(){return new e(a,b)})}}]);return e}(m.RefCounted);d.GPUHashTable=e;e=function(){function b(a){var c=1>=arguments.length||void 0===arguments[1]?f.NUM_ALTERNATIVES:arguments[1];k(this,b);this.prefix=a;this.numAlternatives=c;$jscomp.initSymbol();this.textureUnitSymbol=Symbol("gpuhashtable:"+this.prefix);this.aName=this.prefix+"_a";this.bName=this.prefix+"_b";this.samplerName=this.prefix+"_sampler"}a(b,[{key:"defineShader",value:function(a){var b=this.aName,c=this.bName,
e=this.samplerName,f=this.numAlternatives;a.addUniform("highp vec4",b,4*f);a.addUniform("highp float",c,4*f+5);a.addTextureSampler2D(e,this.textureUnitSymbol,f);a.addFragmentCode(d.glsl_hashFunction);for(var l="",g=0;g<f;++g){for(var k=0;2>k;++k)var m=4*g+2*k,u=4*g+2*k,l=l+("\nfloat "+this.prefix+"_computeHash_"+g+"_"+k+"(uint64_t x) {\n  float primeModulus = "+c+"["+(4*f+k)+"];\n  float scalar = "+c+"["+(4*f+3+k)+"];\n  return computeHash(x, "+b+"["+u+"], "+b+"["+(u+1)+"], "+c+"["+m+"], "+c+"["+
(m+1)+"], primeModulus, scalar);\n}\n");l+="\nvec2 "+this.prefix+"_computeHash_"+g+"(uint64_t x) {\n  vec2 v;\n  v[0] = "+this.prefix+"_computeHash_"+g+"_0(x);\n  v[1] = "+this.prefix+"_computeHash_"+g+"_1(x);\n  return v;\n}\n"}l+="\nbool "+this.hasFunctionName+"(uint64_t x) {\n  float highOffset = "+c+"["+(4*f+2)+"];\n";for(b=0;b<f;++b)l+="\n  {\n    vec2 v = "+this.prefix+"_computeHash_"+b+"(x);\n    vec4 lowResult = texture2D("+e+"["+b+"], v);\n    vec4 highResult = texture2D("+e+"["+b+"], vec2(v.x + highOffset, v.y));\n    if (lowResult == x.low && highResult == x.high) {\n      return true;\n    }\n  }\n";
a.addFragmentCode(l+"\n  return false;\n}\n")}},{key:"enable",value:function(a,b,c){var d=this.numAlternatives,e=c.textures;c.copyToGPU();for(var f=b.textureUnit(this.textureUnitSymbol),l=0;l<d;++l)a.activeTexture(a.TEXTURE0+(l+f)),a.bindTexture(a.TEXTURE_2D,e[l]);a.uniform4fv(b.uniform(this.aName),c.a);a.uniform1fv(b.uniform(this.bName),c.b)}},{key:"disable",value:function(a,b){for(var c=this.numAlternatives,d=b.textureUnit(this.textureUnitSymbol),e=0;e<c;++e)a.activeTexture(a.TEXTURE0+(e+d)),a.bindTexture(a.TEXTURE_2D,
null)}},{key:"hasFunctionName",get:function(){return this.prefix+"_has"}}]);return b}();d.HashTableShaderManager=e},function(g,d,e){var k=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),b=e(99);d.NUM_ALTERNATIVES=3;g=function(){function a(){var b=0>=arguments.length||void 0===arguments[0]?a.generateHashFunctions(d.NUM_ALTERNATIVES):
arguments[0];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.loadFactor=.9;this.size=0;this.growFactor=1.2;this.maxWidth=4096;this.height=this.width=null;this.maxHeight=8192;this.emptyHigh=this.emptyLow=4294967295;this.maxAttempts=this.maxRehashAttempts=5;this.generation=0;this.hashFunctions=b;this.allocate(4,1)}$jscomp.initSymbol();$jscomp.initSymbolIterator();k(a,[{key:"updateHashFunctions",value:function(b){this.hashFunctions=a.generateHashFunctions(b)}},{key:"getHash",
value:function(a,b,d){a=this.hashFunctions[a];var e=this.width,l=this.height,e=a[0].compute(b,d)%e;return 2*(a[1].compute(b,d)%l*this.width+e)}},{key:Symbol.iterator,value:function(){function a(c,t){for(;;)switch(b){case 0:x=v.width*v.height,w=v.emptyLow,q=v.emptyHigh,r=[0,0],k=$jscomp.makeIterator(v.tables),g=k.next();case 1:if(g.done){b=3;break}h=g.value;l=0;case 4:if(!(l<x)){b=6;break}e=h[2*l];d=h[2*l+1];if(e===w&&d===q){b=7;break}r[0]=e;r[1]=d;b=8;return{value:r,done:!1};case 8:if(void 0===t){b=
9;break}b=-1;throw t;case 9:case 7:case 5:++l;b=4;break;case 6:case 2:g=k.next();b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,d,e,l,h,g,k,r,q,w,x,v=this,y={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();y[Symbol.iterator]=function(){return this};return y}},{key:"hasWithTableIndex",value:function(a,b){for(var d=this.tables.length,e=0;e<d;++e){var l=this.getHash(e,
a,b),h=this.tables[e];if(h[l]===a&&h[l+1]===b)return e}return null}},{key:"has",value:function(a,b){for(var d=this.tables.length,e=0;e<d;++e){var l=this.getHash(e,a,b),h=this.tables[e];if(h[l]===a&&h[l+1]===b)return!0}return!1}},{key:"delete",value:function(a,b){for(var d=this.tables.length,e=0;e<d;++e){var l=this.getHash(e,a,b),h=this.tables[e];if(h[l]===a&&h[l+1]===b)return h[l]=this.emptyLow,h[l+1]=this.emptyHigh,++this.generation,this.size--,!0}return!1}},{key:"clear",value:function(){if(0===
this.size)return!1;this.size=0;++this.generation;for(var a=this.tables,b=this.emptyLow,d=this.emptyHigh,e=a.length,l=0;l<e;++l)for(var h=a[l],g=h.length,k=0;k<g;k+=2)h[k]=b,h[k+1]=d;return!0}},{key:"tryToInsert",value:function(a,b){for(var d=0,e=this.emptyLow,l=this.emptyHigh,h=this.maxAttempts,g=this.tables,k=g.length,r=Math.floor(Math.random()*k);;){var q=this.getHash(r,a,b),w=g[r],x=w[q],v=w[q+1];w[q]=a;w[q+1]=b;if(x===e&&v===l)return null;a=x;b=v;if(++d===h)break;r=(r+Math.floor(Math.random()*
(k-1)))%k}return[a,b]}},{key:"allocate",value:function(a,b){var d=a*b;this.width=a;this.height=b;for(var e=this.hashFunctions.length,l=this.tables=Array(e),h=0;h<e;++h)l[h]=new Uint32Array(2*d);this.maxAttempts=d;for(var e=this.emptyLow,h=this.emptyHigh,l=$jscomp.makeIterator(l),g=l.next();!g.done;g=l.next())for(var g=g.value,k=0;k<d;++k)g[2*k]=e,g[2*k+1]=h;this.capacity=d*this.tables.length*this.loadFactor}},{key:"rehash",value:function(a,b,d){this.allocate(b,d);this.updateHashFunctions(a.length);
a=$jscomp.makeIterator(a);for(b=a.next();!b.done;b=a.next()){b=b.value;d=b.length/2;for(var e=0;e<d;++e){var l=2*e,h=b[l],l=b[l+1];if((0!==h||0!==l)&&null!==this.tryToInsert(h,l))return!1}}return!0}},{key:"grow",value:function(a){for(var b=this.tables,d=this.width,e=this.height,l=this.maxWidth,h=this.maxHeight;;){var g=d*e,d=Math.min(l,Math.ceil(a/this.height));d*e<a&&(e=Math.min(h,Math.ceil(a/this.width)));var k=d*e;if(k<a&&k===g)throw Error("Maximum table size exceeded");for(g=0;g<this.maxRehashAttempts;++g)if(this.rehash(b,
d,e))return;a=Math.ceil(this.growFactor*a)}}},{key:"add",value:function(a,b){if(this.has(a,b))return!1;++this.generation;for(++this.size>this.capacity&&this.grow(Math.ceil(this.growFactor*this.width*this.height));;){var d=this.tryToInsert(a,b);if(null==d)return!0;a=d[0];b=d[1];this.grow(this.width*this.height)}}}],[{key:"generateHashFunctions",value:function(){for(var a=0>=arguments.length||void 0===arguments[0]?d.NUM_ALTERNATIVES:arguments[0],e=[],g=0;g<a;++g){var k=[b.HashFunction.generate(),b.HashFunction.generate()];
e.push(k)}return e}}]);return a}();d.HashTable=g},function(g,d){d.hsvToRgb=function(d,g,b,a){g*=6;var c=Math.floor(g),f=g-c;g=a*(1-b);var m=a*(1-b*f);b=a*(1-b*(1-f));switch(c%6){case 0:d[0]=a;d[1]=b;d[2]=g;break;case 1:d[0]=m;d[1]=a;d[2]=g;break;case 2:d[0]=g;d[1]=a;d[2]=b;break;case 3:d[0]=g;d[1]=m;d[2]=a;break;case 4:d[0]=b;d[1]=g;d[2]=a;break;case 5:d[0]=a,d[1]=g,d[2]=m}return d}},function(g,d,e){function k(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var b=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(8);var a=e(47),c=e(48);e=function(d){function e(){if(!(this instanceof
e))throw new TypeError("Cannot call a class as a function");for(var b=arguments.length,d=Array(b),f=0;f<b;f++)d[f]=arguments[f];var g,b=(g=Object.getPrototypeOf(e)).call.apply(g,[].concat([this],$jscomp.arrayFromIterable(d)));if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");g=!b||"object"!==typeof b&&"function"!==typeof b?this:b;g.selectedSegment=new a.Uint64;g.hasSelectedSegment=!1;g.changed=new c.Signal;return g}k(e,d);b(e,[{key:"set",value:function(a){if(null==
a)this.hasSelectedSegment&&(this.hasSelectedSegment=!1,this.changed.dispatch());else{var b=this.selectedSegment;this.hasSelectedSegment&&a.low===b.low&&a.high===b.high||(b.low=a.low,b.high=a.high,this.hasSelectedSegment=!0,this.changed.dispatch())}}},{key:"isSelected",value:function(b){return this.hasSelectedSegment&&a.Uint64.equal(b,this.selectedSegment)}},{key:"bindTo",value:function(b,c){var d=this,e=new a.Uint64;this.registerSignalBinding(b.changed.add(function(){var a=b.get(c);"number"===typeof a&&
(e.low=a,e.high=0,a=e);d.set(a)}))}}]);return e}(g.RefCounted);d.SegmentSelectionState=e},function(g,d,e){function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});
b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var c=function t(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:t(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||
!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=e(20),u=e(57),l=e(48);g=e(58);var h=e(8),n=e(22),p=e(33),r=e(105),q=e(69),w=e(35),x=e(7),v=function(){function b(){a(this,b);this.tempMat=n.mat4.create();this.tempPickID=new Float32Array(4)}f(b,[{key:"defineShader",value:function(a){a.addAttribute("highp vec3","aVertexPosition");a.addUniform("highp vec3","uColor");a.addUniform("highp mat4","uProjection");
a.addUniform("highp vec4","uPickID");a.setVertexMain("gl_Position = uProjection * vec4(aVertexPosition, 1.0);");a.setFragmentMain("emit(vec4(uColor, 1.0), uPickID);")}},{key:"beginLayer",value:function(a,b,c,d){c=n.mat4.multiply(this.tempMat,c.dataToDevice,d);a.uniformMatrix4fv(b.uniform("uProjection"),!1,c)}},{key:"getShader",value:function(a,b,c){var d=this;return a.memoize.get(b,function(){var b=new m.ShaderBuilder(a);b.require(c);d.defineShader(b);return b.build()})}},{key:"drawSkeleton",value:function(a,
b,c,d,e,f){f||a.uniform3fv(b.uniform("uColor"),d);a.uniform4fv(b.uniform("uPickID"),q.setVec4FromUint32(this.tempPickID,e));c.vertexBuffer.bindToVertexAttrib(b.attribute("aVertexPosition"),3);c.indexBuffer.bind();a.drawElements(a.LINES,c.numIndices,a.UNSIGNED_INT,0)}},{key:"endLayer",value:function(a,b){a.disableVertexAttribArray(b.attribute("aVertexPosition"))}}]);return b}();e=function(c){function d(b){a(this,d);var c=k(this,Object.getPrototypeOf(d).call(this));c.base=b;c.shader=c.base.skeletonShaderManager.getShader(c.gl,
"skeleton/SkeletonShaderManager:PerspectivePanel",p.perspectivePanelEmit);c.registerDisposer(b);c.registerSignalBinding(b.redrawNeeded.add(function(){c.redrawNeeded.dispatch()}));c.setReady(!0);return c}b(d,c);f(d,[{key:"draw",value:function(a){this.base.draw(a,this,this.shader,1>=arguments.length||void 0===arguments[1]?!1:arguments[1])}},{key:"drawPicking",value:function(a){this.base.draw(a,this,this.shader,!0)}},{key:"gl",get:function(){return this.base.gl}}]);return d}(p.PerspectiveViewRenderLayer);
d.PerspectiveViewSkeletonLayer=e;e=function(c){function d(b){a(this,d);var c=k(this,Object.getPrototypeOf(d).call(this));c.base=b;c.shader=c.base.skeletonShaderManager.getShader(c.gl,"skeleton/SkeletonShaderManager:SliceViewPanel",r.sliceViewPanelEmit);c.registerDisposer(b);c.registerSignalBinding(b.redrawNeeded.add(function(){c.redrawNeeded.dispatch()}));c.setReady(!0);return c}b(d,c);f(d,[{key:"draw",value:function(a){console.log("drawing on sliceview");this.base.draw(a,this,this.shader,!1,10)}},
{key:"gl",get:function(){return this.base.gl}}]);return d}(r.SliceViewPanelRenderLayer);d.SliceViewPanelSkeletonLayer=e;h=function(c){function d(b,c,e,f){a(this,d);var h=k(this,Object.getPrototypeOf(d).call(this));h.chunkManager=b;h.source=c;h.voxelSizeObject=e;h.displayState=f;h.tempMat=n.mat4.create();h.skeletonShaderManager=new v;h.redrawNeeded=new l.Signal;e=function(){h.redrawNeeded.dispatch()};h.registerSignalBinding(f.segmentColorHash.changed.add(e));h.registerSignalBinding(f.visibleSegments.changed.add(e));
h.registerSignalBinding(f.segmentSelectionState.changed.add(e));h.registerDisposer(new x.SharedObject).initializeCounterpart(b.rpc,{type:"skeleton/SkeletonLayer",chunkManager:b.rpcId,source:c.addCounterpartRef(),visibleSegmentSet:f.visibleSegments.rpcId});return h}b(d,c);f(d,[{key:"draw",value:function(a,b,c){var d=3>=arguments.length||void 0===arguments[3]?!1:arguments[3],e=4>=arguments.length||void 0===arguments[4]?d?5:1:arguments[4],f=this.gl,h=this.skeletonShaderManager;c.bind();var g=this.tempMat;
n.mat4.identity(g);n.mat4.scale(g,g,this.voxelSizeObject.size);h.beginLayer(f,c,a,g);var g=this.source.chunks,l=a.pickIDs,k=n.vec3.create(),p=this.displayState,m=p.segmentColorHash,q=p.segmentSelectionState;f.lineWidth(e);e=$jscomp.makeIterator(p.visibleSegments);for(p=e.next();!p.done;p=e.next()){var p=p.value,t=g.get(p.low+":"+p.high);if(void 0!==t&&t.state===u.ChunkState.GPU_MEMORY){if(!d&&(m.compute(k,p),q.isSelected(p)))for(var v=0;3>v;++v)k[v]=.5*k[v]+.5;h.drawSkeleton(f,c,t,k,l.register(b,
p),d)}}h.endLayer(f,c)}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);return d}(h.RefCounted);d.SkeletonLayer=h;var y=function(d){function e(b,c){a(this,e);var d=k(this,Object.getPrototypeOf(e).call(this,b));d.data=c.data;return d}b(e,d);f(e,[{key:"copyToGPU",value:function(a){c(Object.getPrototypeOf(e.prototype),"copyToGPU",this).call(this,a);var b=this.data,d=(new DataView(b.buffer)).getInt32(0,!0),f=new Float32Array(b.buffer,4,3*d),b=new Uint32Array(b.buffer,12*d+
4);this.vertexBuffer=w.Buffer.fromData(a,f,a.ARRAY_BUFFER,a.STATIC_DRAW);this.indexBuffer=w.Buffer.fromData(a,b,a.ELEMENT_ARRAY_BUFFER,a.STATIC_DRAW);this.numIndices=b.length}},{key:"freeGPUMemory",value:function(a){c(Object.getPrototypeOf(e.prototype),"freeGPUMemory",this).call(this,a);this.vertexBuffer.dispose();this.indexBuffer.dispose()}}]);return e}(g.Chunk);d.SkeletonChunk=y;g=function(c){function d(){a(this,d);return k(this,Object.getPrototypeOf(d).apply(this,arguments))}b(d,c);f(d,[{key:"getChunk",
value:function(a){return new y(this,a)}}]);return d}(g.ChunkSource);d.SkeletonSource=g},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);
a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a){a.addFragmentExtension("GL_EXT_draw_buffers");a.addFragmentCode("\nvoid emit(vec4 color, vec4 pickId) {\n  gl_FragData["+y.COLOR+"] = color;\n  gl_FragData["+y.PICK+"] = pickId;\n}\n")}var f=function B(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),
null===a?void 0:B(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},m=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),u=e(34),l=e(37),h=e(49);g=e(50);var n=e(56),p=e(67),r=e(22),q=e(68),w=e(65),x=e(106),v=e(48);(function(a){a[a.COLOR=0]="COLOR";a[a.PICK=1]="PICK";a[a.NUM_TEXTURES=
2]="NUM_TEXTURES"})(d.OffscreenTextures||(d.OffscreenTextures={}));var y=d.OffscreenTextures;d.sliceViewPanelEmit=c;var A=function(c){function d(){k(this,d);for(var a=arguments.length,c=Array(a),e=0;e<a;e++)c[e]=arguments[e];var f,a=b(this,(f=Object.getPrototypeOf(d)).call.apply(f,[].concat([this],$jscomp.arrayFromIterable(c))));a.redrawNeeded=new v.Signal;return a}a(d,c);m(d,[{key:"draw",value:function(a){}}]);return d}(l.RenderLayer);d.SliceViewPanelRenderLayer=A;e=function(d){function e(a,d,f,
g){k(this,e);var m=b(this,Object.getPrototypeOf(e).call(this,a,d,g));m.sliceView=f;m.axesLineHelper=u.AxesLineHelper.get(m.gl);m.sliceViewRenderHelper=n.SliceViewRenderHelper.get(m.gl,"SliceViewRenderHelper",c);m.colorFactor=r.vec4.fromValues(1,1,1,1);m.backgroundColor=r.vec4.fromValues(.5,.5,.5,1);m.pickIDs=new h.PickIDManager;m.visibleLayerTracker=m.registerDisposer(new l.VisibleRenderLayerTracker(m.viewer.layerManager,A,function(a){a.redrawNeeded.add(m.scheduleRedraw,m);m.scheduleRedraw()},function(a){a.redrawNeeded.remove(m.scheduleRedraw,
m);m.scheduleRedraw()}));m.offscreenFramebuffer=new w.OffscreenFramebuffer(m.gl,{numDataBuffers:y.NUM_TEXTURES});m.offscreenCopyHelper=w.OffscreenCopyHelper.get(m.gl);m.scaleBarWidget=m.registerDisposer(new x.ScaleBarWidget);m.registerDisposer(f);m.registerSignalBinding(f.viewChanged.add(a.scheduleRedraw,a));m.registerSignalBinding(g.showAxisLines.changed.add(function(){m.scheduleRedraw()}));a=m.scaleBarWidget.element;m.registerDisposer(new p.ElementVisibilityFromTrackableBoolean(g.showScaleBar,a));
m.element.appendChild(a);return m}a(e,d);m(e,[{key:"draw",value:function(){var a=this.sliceView;if(a.hasValidViewport){a.updateRendering();var b=this.gl,c=a.width,d=a.height,e=a.dataToDevice;this.offscreenFramebuffer.bind(c,d);b.disable(b.SCISSOR_TEST);this.gl.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT);var f=r.mat4.create();this.sliceViewRenderHelper.draw(a.offscreenFramebuffer.dataTextures[0],r.identityMat4,this.colorFactor,this.backgroundColor,0,0,1,1);var h=this.visibleLayerTracker.getVisibleLayers(),
g=this.pickIDs;g.clear();for(var g={dataToDevice:a.dataToDevice,pickIDs:g},h=$jscomp.makeIterator(h),l=h.next();!l.done;l=h.next())l.value.draw(g);if(this.viewer.showAxisLines.value){r.mat4.copy(f,e);for(e=0;3>e;++e)f[12+e]=0;for(e=0;4>e;++e)f[2+4*e]=0;d=Math.min(c,d)/4*1.5;e=a.pixelSize;for(g=0;12>g;++g)f[g]=f[g]*d*e;b.WEBGL_draw_buffers.drawBuffersWEBGL([b.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL]);this.axesLineHelper.draw(f)}this.offscreenFramebuffer.unbind();this.setGLViewport();this.offscreenCopyHelper.draw(this.offscreenFramebuffer.dataTextures[y.COLOR]);
b=this.scaleBarWidget;f=b.dimensions;f.targetLengthInPixels=Math.min(c/4,100);f.nanometersPerPixel=a.pixelSize;b.update()}}},{key:"onResize",value:function(){this.sliceView.setViewportSize(this.element.clientWidth,this.element.clientHeight)}},{key:"updateMouseState",value:function(a){a.pickedRenderLayer=null;var b=this.sliceView;if(!b.hasValidViewport)return!1;var c=b.width,d=b.height,e=this.offscreenFramebuffer;if(!e.hasSize(c,d))return!1;var f=a.position,h=this.mouseX,g=this.mouseY;r.vec3.set(f,
h-c/2,g-d/2,0);r.vec3.transformMat4(f,f,b.viewportToData);this.pickIDs.setMouseState(a,e.readPixelAsUint32(y.PICK,h,d-g));return!0}},{key:"onMousedown",value:function(a){var b=this;event.target===this.element&&(f(Object.getPrototypeOf(e.prototype),"onMousedown",this).call(this,a),this.sliceView.hasValidViewport&&0===a.button&&this.viewer.mouseState.updateUnconditionally()&&function(){var c=r.vec3.clone(b.viewer.mouseState.position);q.startRelativeMouseDrag(a,function(a,d,e){var f=b.viewer.navigationState.position;
a.shiftKey?(f=b.sliceView.viewportAxes,b.viewer.navigationState.pose.rotateAbsolute(f[1],d/4*Math.PI/180,c),b.viewer.navigationState.pose.rotateAbsolute(f[0],e/4*Math.PI/180,c)):(a=f.spatialCoordinates,r.vec3.set(a,d,e,0),r.vec3.transformMat4(a,a,b.sliceView.viewportToData),f.changed.dispatch())})}())}},{key:"zoomByMouse",value:function(a){var b=this.navigationState;if(b.valid){var c=this.sliceView,d=c.height,e=this.mouseX,f=this.mouseY,e=e-c.width/2,f=f-d/2,d=this.navigationState.zoomFactor.value;
b.zoomBy(a);a=b.zoomFactor.value;var h=b.position.spatialCoordinates;r.vec3.scaleAndAdd(h,h,c.viewportAxes[0],e*(d-a));r.vec3.scaleAndAdd(h,h,c.viewportAxes[1],f*(d-a));b.position.changed.dispatch()}}},{key:"navigationState",get:function(){return this.sliceView.navigationState}}]);return e}(g.RenderedDataPanel);d.SliceViewPanel=e},function(g,d,e){function k(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=
Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();
g=e(8);var c=e(10);e(107);var f=[1.5,2,3,5,7.5,10],m=[{unit:"km",lengthInNanometers:1E12},{unit:"m",lengthInNanometers:1E9},{unit:"mm",lengthInNanometers:1E6},{unit:"\u00b5m",lengthInNanometers:1E3},{unit:"nm",lengthInNanometers:1},{unit:"pm",lengthInNanometers:.001}],u=function(){function c(){b(this,c);this.allowedSignificands=f;this.prevTargetLengthInPixels=this.prevNanometersPerPixel=0}a(c,[{key:"update",value:function(){var a=this.nanometersPerPixel,b=this.targetLengthInPixels;if(this.prevNanometersPerPixel===
a&&this.prevTargetLengthInPixels===b)return!1;this.prevNanometersPerPixel=a;this.prevTargetLengthInPixels=b;for(var c=b*a,b=Math.pow(10,Math.floor(Math.log(c)/Math.LN10)),c=c/b,d=1,e=$jscomp.makeIterator(this.allowedSignificands),f=e.next();!f.done;f=e.next())if(f=f.value,Math.abs(f-c)<Math.abs(d-c))d=f;else break;b*=d;c=m.length;d=m[c-1];for(e=0;e<c;++e)if(f=m[e],b>=f.lengthInNanometers){d=f;break}this.lengthInPixels=Math.round(b/a);this.physicalUnit=d.unit;this.physicalLength=b/d.lengthInNanometers;
return!0}}]);return c}();d.ScaleBarDimensions=u;e=function(d){function e(){var a=0>=arguments.length||void 0===arguments[0]?new u:arguments[0];b(this,e);var c;c=Object.getPrototypeOf(e).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.dimensions=a;c.element=document.createElement("div");c.textNode=document.createTextNode("");c.barElement=document.createElement("div");var a=c.element,
d=c.textNode,f=c.barElement;a.className="scale-bar-container";a.appendChild(d);a.appendChild(f);f.className="scale-bar";return c}k(e,d);a(e,[{key:"update",value:function(){var a=this.dimensions;a.update()&&(this.textNode.textContent=a.physicalLength+" "+a.physicalUnit,this.barElement.style.width=a.lengthInPixels+"px")}},{key:"disposed",value:function(){c.removeFromParent(this.element)}}]);return e}(g.RefCounted);d.ScaleBarWidget=e},function(g,d){},function(g,d,e){function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in
e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),c=function h(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:h(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},f=e(100),m=e(98),u=e(63);g=function(d){function e(a,b,c){var d=3>=arguments.length||void 0===arguments[3]?u.trackableAlphaValue(.5):arguments[3],
h=4>=arguments.length||void 0===arguments[4]?u.trackableAlphaValue(0):arguments[4];if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var g=k(this,Object.getPrototypeOf(e).call(this,a,b));g.displayState=c;g.selectedAlpha=d;g.notSelectedAlpha=h;g.selectedSegmentForShader=new Float32Array(8);g.segmentColorShaderManager=new m.SegmentColorShaderManager("segmentColorHash");g.hashTableManager=new f.HashTableShaderManager("visibleSegments");g.gpuHashTable=f.GPUHashTable.get(g.gl,
g.displayState.visibleSegments.hashTable);g.registerSignalBinding(c.segmentSelectionState.changed.add(g.redrawNeeded.dispatch,g));g.registerSignalBinding(c.segmentColorHash.changed.add(g.redrawNeeded.dispatch,g));g.registerSignalBinding(c.visibleSegments.changed.add(g.redrawNeeded.dispatch,g));g.registerSignalBinding(d.changed.add(function(){g.redrawNeeded.dispatch()}));g.registerSignalBinding(h.changed.add(function(){g.redrawNeeded.dispatch()}));return g}b(e,d);a(e,[{key:"getShaderKey",value:function(){return"sliceview.SegmentationRenderLayer"}},
{key:"defineShader",value:function(a){c(Object.getPrototypeOf(e.prototype),"defineShader",this).call(this,a);this.hashTableManager.defineShader(a);this.segmentColorShaderManager.defineShader(a);a.addUniform("highp vec4","uSelectedSegment",2);a.addUniform("highp float","uShowAllSegments");a.addUniform("highp float","uSelectedAlpha");a.addUniform("highp float","uNotSelectedAlpha");a.setFragmentMain("\n  uint64_t value = toUint64(getDataValue());\n  float alpha = uSelectedAlpha;\n  float saturation = 1.0;\n  if (value.low == vec4(0,0,0,0) && value.high == vec4(0,0,0,0)) {\n    emit(vec4(vec4(0, 0, 0, 0)));\n    return;\n  }\n  bool has = uShowAllSegments > 0.0 ? true : "+
this.hashTableManager.hasFunctionName+"(value);\n  if (uSelectedSegment[0] == value.low && uSelectedSegment[1] == value.high) {\n    saturation = has ? 0.5 : 0.75;\n  } else if (!has) {\n    alpha = uNotSelectedAlpha;\n  }\n  vec3 rgb = segmentColorHash(value);\n  emit(vec4(mix(vec3(1.0,1.0,1.0), rgb, saturation), alpha));\n")}},{key:"beginSlice",value:function(a){a=c(Object.getPrototypeOf(e.prototype),"beginSlice",this).call(this,a);var b=this.gl,d=this.selectedSegmentForShader,f=this.displayState,
h=this.displayState,g=h.segmentSelectionState,h=h.visibleSegments;if(g.hasSelectedSegment)for(var k=g.selectedSegment,g=k.low,k=k.high,m=0;4>m;++m)d[m]=(g>>8*m&255)/255,d[4+m]=(k>>8*m&255)/255;else d.fill(0);b.uniform1f(a.uniform("uSelectedAlpha"),this.selectedAlpha.value);b.uniform1f(a.uniform("uNotSelectedAlpha"),this.notSelectedAlpha.value);b.uniform4fv(a.uniform("uSelectedSegment"),d);b.uniform1f(a.uniform("uShowAllSegments"),h.hashTable.size?0:1);this.hashTableManager.enable(b,a,this.gpuHashTable);
this.segmentColorShaderManager.enable(b,a,f.segmentColorHash);return a}},{key:"endSlice",value:function(a){this.hashTableManager.disable(this.gl,a);c(Object.getPrototypeOf(e.prototype),"endSlice",this).call(this,a)}}]);return e}(u.RenderLayer);d.SegmentationRenderLayer=g},function(g,d,e){function k(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,
writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var b=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),a=function l(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?
void 0:l(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)};g=e(7);var c=e(101),f=e(48),m=e(47);e=function(d){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");for(var a=arguments.length,b=Array(a),d=0;d<a;d++)b[d]=arguments[d];var g,a=(g=Object.getPrototypeOf(e)).call.apply(g,[].concat([this],$jscomp.arrayFromIterable(b)));if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");g=!a||
"object"!==typeof a&&"function"!==typeof a?this:a;g.hashTable=new c.HashTable;g.changed=new f.Signal;return g}k(e,d);$jscomp.initSymbol();$jscomp.initSymbolIterator();b(e,[{key:"initializeCounterpart",value:function(b){var c=1>=arguments.length||void 0===arguments[1]?{}:arguments[1];c.type="Uint64Set";a(Object.getPrototypeOf(e.prototype),"initializeCounterpart",this).call(this,b,c)}},{key:"disposed",value:function(){a(Object.getPrototypeOf(e.prototype),"disposed",this).call(this);this.changed=this.hashTable=
null}},{key:"add_",value:function(a){return this.hashTable.add(a.low,a.high)}},{key:"add",value:function(a){if(this.add_(a)){var b=this.rpc;b&&b.invoke("Uint64Set.add",{id:this.rpcId,value:a});this.changed.dispatch(a,!0)}}},{key:"has",value:function(a){return this.hashTable.has(a.low,a.high)}},{key:Symbol.iterator,value:function(){function a(g,k){for(;;)switch(b){case 0:f=new m.Uint64,$jscomp.initSymbol(),$jscomp.initSymbolIterator(),e=$jscomp.makeIterator(h.hashTable[Symbol.iterator]()),d=e.next();
case 1:if(d.done){b=3;break}c=d.value;f.low=c[0];f.high=c[1];b=4;return{value:f,done:!1};case 4:if(void 0===k){b=5;break}b=-1;throw k;case 5:case 2:d=e.next();b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,c,d,e,f,h=this,g={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}},{key:"delete_",value:function(a){return this.hashTable.delete(a.low,
a.high)}},{key:"delete",value:function(a){if(this.delete_(a)){var b=this.rpc;b&&b.invoke("Uint64Set.delete",{id:this.rpcId,value:a});this.changed.dispatch(a,!1)}}},{key:"clear",value:function(){if(this.hashTable.clear()){var a=this.rpc;a&&a.invoke("Uint64Set.clear",{id:this.rpcId});this.changed.dispatch(null,!1)}}},{key:"size",get:function(){return this.hashTable.size}}],[{key:"makeWithCounterpart",value:function(a){var b=new e;b.initializeCounterpart(a);return b}}]);return e}(g.SharedObjectCounterpart);
d.Uint64Set=e;g.registerRPC("Uint64Set.add",function(a){var b=this.get(a.id);b.add_(a.value)&&b.changed.dispatch()});g.registerRPC("Uint64Set.delete",function(a){var b=this.get(a.id);b.delete_(a.value)&&b.changed.dispatch()});g.registerRPC("Uint64Set.clear",function(a){a=this.get(a.id);a.hashTable.clear()&&a.changed.dispatch()});g.registerSharedObject("Uint64Set",e)},function(g,d,e){function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||
"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=
!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(8);var c=e(10);e(111);e=function(d){function e(a){var b=1>=arguments.length||void 0===arguments[1]?{}:arguments[1],c=b.min,c=void 0===c?0:c,d=b.max,d=void 0===d?1:d,b=b.step,b=void 0===b?.01:b;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var f=k(this,Object.getPrototypeOf(e).call(this));f.value=a;f.element=document.createElement("label");f.promptElement=document.createElement("span");
f.inputElement=document.createElement("input");var g=f.element,q=f.promptElement,w=f.inputElement;g.className="range-slider";q.className="range-prompt";w.type="range";w.min=""+c;w.max=""+d;w.step=""+b;w.valueAsNumber=f.value.value;g.appendChild(q);g.appendChild(w);var x=function(){f.value.value=f.inputElement.valueAsNumber};f.registerEventListener(w,"change",x);f.registerEventListener(w,"input",x);f.registerEventListener(w,"wheel",function(a){a=a.deltaY;0<a?(f.inputElement.stepUp(),x()):0>a&&(f.inputElement.stepDown(),
x())});a.changed.add(function(){f.inputElement.valueAsNumber=f.value.value});return f}b(e,d);a(e,[{key:"disposed",value:function(){c.removeFromParent(this.element)}}]);return e}(g.RefCounted);d.RangeWidget=e},function(g,d){},function(g,d,e){function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(8);var c=e(47);e(70);e(113);var f=new c.Uint64;e=function(c){function d(a){if(!(this instanceof
d))throw new TypeError("Cannot call a class as a function");var b=k(this,Object.getPrototypeOf(d).call(this));b.displayState=a;b.element=document.createElement("div");b.clearButton=document.createElement("button");b.itemContainer=document.createElement("span");b.items=new Map;var c=b.element,e=b.clearButton,f=b.itemContainer;c.className="segment-set-widget noselect";e.className="clear-button";e.title="Remove all segment IDs";b.registerEventListener(e,"click",function(){b.visibleSegments.clear()});
f.className="item-container";c.appendChild(f);f.appendChild(e);b.registerSignalBinding(a.visibleSegments.changed.add(b.handleSetChanged,b));b.registerSignalBinding(a.segmentColorHash.changed.add(b.handleColorChanged,b));a=$jscomp.makeIterator(a.visibleSegments);for(c=a.next();!c.done;c=a.next())b.addElement(c.value.toString());b.updateClearButtonVisibility();return b}b(d,c);a(d,[{key:"updateClearButtonVisibility",value:function(){this.clearButton.style.display=0<this.displayState.visibleSegments.size?
"":"none"}},{key:"handleSetChanged",value:function(a,b){this.updateClearButtonVisibility();var c=this.items;if(null===a){for(var d=this.itemContainer,e=this.clearButton;;){var f=d.lastElementChild;if(f===e)break;d.removeChild(f)}c.clear()}else b?this.addElement(a.toString()):(d=a.toString(),e=c.get(d),e.parentElement.removeChild(e),c.delete(d))}},{key:"addElement",value:function(a){var b=document.createElement("button");b.className="segment-button";b.textContent=a;b.title="Remove segment ID "+a;var c=
this;b.addEventListener("click",function(){f.parseString(this.textContent);c.visibleSegments.delete(f)});b.addEventListener("mouseenter",function(){f.parseString(this.textContent);c.segmentSelectionState.set(f)});b.addEventListener("mouseleave",function(){f.parseString(this.textContent);c.segmentSelectionState.set(null)});this.setItemColor(b);this.itemContainer.appendChild(b);this.items.set(a,b)}},{key:"setItemColor",value:function(a){f.parseString(a.textContent);a.style.backgroundColor=this.segmentColorHash.computeCssColor(f)}},
{key:"handleColorChanged",value:function(){var a=this;this.items.forEach(function(b){a.setItemColor(b)})}},{key:"disposed",value:function(){var a=this.element,b=a.parentElement;b&&b.removeChild(a)}},{key:"visibleSegments",get:function(){return this.displayState.visibleSegments}},{key:"segmentColorHash",get:function(){return this.displayState.segmentColorHash}},{key:"segmentSelectionState",get:function(){return this.displayState.segmentSelectionState}}]);return d}(g.RefCounted);d.SegmentSetWidget=
e},function(g,d){},function(g,d,e){function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):
a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),c=e(10);g=e(8);var f=e(47),m=e(48);e(70);e(115);e=function(d){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var a=k(this,Object.getPrototypeOf(e).call(this));a.element=document.createElement("form");
a.label=document.createElement("label");a.input=document.createElement("input");a.value=new f.Uint64;a.valueEntered=new m.Signal;var b=a.element,c=a.label,d=a.input;b.className="uint64-entry noselect";b.appendChild(c);c.appendChild(d);a.registerEventListener(b,"submit",function(b){b.preventDefault();a.validateInput()&&(a.input.value="",a.input.classList.remove("valid-input","invalid-input"),a.valueEntered.dispatch(a.value))});a.registerEventListener(b,"input",function(){""===a.input.value?a.input.classList.remove("valid-input",
"invalid-input"):a.validateInput()?a.input.classList.remove("invalid-input"):a.input.classList.add("invalid-input")});return a}b(e,d);a(e,[{key:"validateInput",value:function(){return this.value.parseString(this.input.value)}},{key:"disposed",value:function(){c.removeFromParent(this.element)}}]);return e}(g.RefCounted);d.Uint64EntryWidget=e},function(g,d){},function(g,d){},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in
e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();e(118);var f=e(119),m=e(39);g=e(37);var u=e(96),l=e(91),h=e(120),n=e(63),p=e(8),r=e(10),q=e(110);e(122);e(123);e(124);e(125);e(126);e(127)(f);e=function(d){function e(a,c){k(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.opacity=n.trackableAlphaValue(.5);d.fragmentMain=h.getTrackableFragmentMain();var f=c.source;if("string"!==typeof f)throw Error("Invalid image layer specification");
d.opacity.restoreState(c.opacity);d.fragmentMain.restoreState(c.shader);d.registerSignalBinding(d.fragmentMain.changed.add(function(){d.specificationChanged.dispatch()}));d.volumePath=f;f=new h.ImageRenderLayer(a.chunkManager,u.getVolumeWithStatusMessage(f),d.opacity,d.fragmentMain);d.renderLayer=f;d.addRenderLayer(f);return d}a(e,d);c(e,[{key:"toJSON",value:function(){var a={type:"image"};a.source=this.volumePath;a.opacity=this.opacity.toJSON();a.shader=this.fragmentMain.toJSON();return a}},{key:"makeDropdown",
value:function(a){return new x(a,this)}}]);return e}(g.UserLayer);d.ImageUserLayer=e;var w=function(d){function e(a){k(this,e);var c=b(this,Object.getPrototypeOf(e).call(this));c.layer=a;c.changingValue=!1;c.debouncedValueUpdater=m(function(){c.changingValue=!0;try{c.layer.fragmentMain.value=c.textEditor.getValue()}finally{c.changingValue=!1}},500);c.textEditor=f(function(a){},{value:c.layer.fragmentMain.value,mode:"glsl",gutters:["CodeMirror-lint-markers"]});c.textEditor.on("change",function(){c.setValidState(void 0);
c.debouncedValueUpdater()});c.registerSignalBinding(c.layer.fragmentMain.changed.add(function(){c.changingValue||c.textEditor.setValue(c.layer.fragmentMain.value)}));c.registerSignalBinding(c.layer.renderLayer.shaderError.changed.add(function(){c.updateErrorState()}));c.updateErrorState();return c}a(e,d);c(e,[{key:"updateErrorState",value:function(){this.layer.renderLayer.shaderUpdated&&this.setValidState(void 0);var a=this.layer.renderLayer.shaderError.value;void 0!==a?(this.textEditor.setOption("lint",
{getAnnotations:function(){if("ShaderCompilationError"===a.name){var b=function(){var b=a.source.split("\n").indexOf(h.FRAGMENT_MAIN_START)+2;return{v:a.errorMessages.map(function(a){return{message:a.message,severity:"error",from:f.Pos(void 0===a.line?0:a.line-b)}})}}();if("object"===typeof b)return b.v}else return"ShaderLinkError"===a.name?[{message:a.log,severity:"error",from:f.Pos(0)}]:[{message:a.message,severity:"error",from:f.Pos(0)}]}}),this.setValidState(!1)):(this.textEditor.setOption("lint",
void 0),this.setValidState(!0))}},{key:"setValidState",value:function(a){var b=this.element;b.classList.remove("invalid-input");b.classList.remove("valid-input");!0===a?b.classList.add("valid-input"):!1===a&&b.classList.add("invalid-input")}},{key:"disposed",value:function(){this.debouncedValueUpdater.flush();this.debouncedValueUpdater=void 0;r.removeFromParent(this.element);this.textEditor=void 0}},{key:"element",get:function(){return this.textEditor.getWrapperElement()}}]);return e}(p.RefCounted),
x=function(d){function e(a,c){k(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.element=a;d.layer=c;d.opacityWidget=d.registerDisposer(new q.RangeWidget(d.layer.opacity));d.codeWidget=d.registerDisposer(new w(d.layer));a.classList.add("image-dropdown");var f=d.opacityWidget,g=document.createElement("div");g.className="image-dropdown-top-row";f.promptElement.textContent="Opacity";f=document.createElement("div");f.style.flex="1";var h=document.createElement("a"),l=document.createElement("button");
l.type="button";l.textContent="?";l.className="help-link";h.appendChild(l);h.title="Documentation on image layer rendering";h.target="_blank";h.href="https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/image_layer_rendering.md";l=document.createElement("button");l.innerHTML="&square;";l.className="maximize-button";l.title="Show larger editor view";d.registerEventListener(l,"click",function(){new v(d.layer)});g.appendChild(d.opacityWidget.element);g.appendChild(f);g.appendChild(l);
g.appendChild(h);a.appendChild(g);a.appendChild(d.codeWidget.element);d.codeWidget.textEditor.refresh();return d}a(e,d);c(e,[{key:"onShow",value:function(){this.codeWidget.textEditor.refresh()}}]);return e}(g.UserLayerDropdown),v=function(c){function d(a){k(this,d);var c=b(this,Object.getPrototypeOf(d).call(this));c.layer=a;c.codeWidget=c.registerDisposer(new w(c.layer));c.content.classList.add("image-layer-shader-overlay");c.content.appendChild(c.codeWidget.element);c.codeWidget.textEditor.refresh();
return c}a(d,c);return d}(l.Overlay)},function(g,d,e){(function(d){d(e(119))})(function(d){function b(a,b){function c(a){if(!e.parentNode)return d.off(document,"mousemove",c);e.style.top=Math.max(0,a.clientY-e.offsetHeight-5)+"px";e.style.left=a.clientX+5+"px"}var e=document.createElement("div");e.className="CodeMirror-lint-tooltip";e.appendChild(b.cloneNode(!0));document.body.appendChild(e);d.on(document,"mousemove",c);c(a);null!=e.style.opacity&&(e.style.opacity=1);return e}function a(a){a.parentNode&&
(null==a.style.opacity&&a.parentNode&&a.parentNode.removeChild(a),a.style.opacity=0,setTimeout(function(){a.parentNode&&a.parentNode.removeChild(a)},600))}function c(c,e,f){function g(){d.off(f,"mouseout",g);h&&(a(h),h=null)}var h=b(c,e),l=setInterval(function(){if(h)for(var a=f;;a=a.parentNode){a&&11==a.nodeType&&(a=a.host);if(a==document.body)return;if(!a){g();break}}if(!h)return clearInterval(l)},400);d.on(f,"mouseout",g)}function e(a,b,d){this.marked=[];this.options=b;this.timeout=null;this.hasGutter=
d;this.onMouseOver=function(b){var d=b.target||b.srcElement;if(/\bCodeMirror-lint-mark-/.test(d.className)){for(var d=d.getBoundingClientRect(),e=a.findMarksAt(a.coordsChar({left:(d.left+d.right)/2,top:(d.top+d.bottom)/2},"client")),d=[],f=0;f<e.length;++f){var g=e[f].__annotation;g&&d.push(g)}if(d.length){e=b.target||b.srcElement;f=document.createDocumentFragment();for(g=0;g<d.length;g++)f.appendChild(l(d[g]));c(b,f,e)}}};this.waitingFor=0}function g(a){var b=a.state.lint;b.hasGutter&&a.clearGutter("CodeMirror-lint-markers");
for(a=0;a<b.marked.length;++a)b.marked[a].clear();b.marked.length=0}function u(a,b,e,f){var g=document.createElement("div"),h=g;g.className="CodeMirror-lint-marker-"+b;e&&(h=g.appendChild(document.createElement("div")),h.className="CodeMirror-lint-marker-multiple");if(0!=f)d.on(h,"mouseover",function(b){c(b,a,h)});return g}function l(a){var b=a.severity;b||(b="error");var c=document.createElement("div");c.className="CodeMirror-lint-message-"+b;c.appendChild(document.createTextNode(a.message));return c}
function h(a,b,c){function e(){g=-1;a.off("change",e)}var f=a.state.lint,g=++f.waitingFor;a.on("change",e);b(a.getValue(),function(b,c){a.off("change",e);f.waitingFor==g&&(c&&b instanceof d&&(b=c),p(a,b))},c,a)}function n(a){var b=a.state.lint.options,c=b.options||b,e=b.getAnnotations||a.getHelper(d.Pos(0,0),"lint");e&&(b.async||e.async?h(a,e,c):p(a,e(a.getValue(),c,a)))}function p(a,b){g(a);for(var c=a.state.lint,d=c.options,e=[],f=0;f<b.length;++f){var h=b[f],k=h.from.line;(e[k]||(e[k]=[])).push(h)}for(f=
0;f<e.length;++f)if(h=e[f]){for(var k=null,n=c.hasGutter&&document.createDocumentFragment(),p=0;p<h.length;++p){var r=h[p],G=r.severity;G||(G="error");"error"!=k&&(k=G);d.formatAnnotation&&(r=d.formatAnnotation(r));c.hasGutter&&n.appendChild(l(r));r.to&&c.marked.push(a.markText(r.from,r.to,{className:"CodeMirror-lint-mark-"+G,__annotation:r}))}c.hasGutter&&a.setGutterMarker(f,"CodeMirror-lint-markers",u(n,k,1<h.length,c.options.tooltips))}if(d.onUpdateLinting)d.onUpdateLinting(b,e,a)}function r(a){var b=
a.state.lint;b&&(clearTimeout(b.timeout),b.timeout=setTimeout(function(){n(a)},b.options.delay||500))}d.defineOption("lint",!1,function(a,b,c){c&&c!=d.Init&&(g(a),!1!==a.state.lint.options.lintOnChange&&a.off("change",r),d.off(a.getWrapperElement(),"mouseover",a.state.lint.onMouseOver),clearTimeout(a.state.lint.timeout),delete a.state.lint);if(b){var h=a.getOption("gutters");c=!1;for(var l=0;l<h.length;++l)"CodeMirror-lint-markers"==h[l]&&(c=!0);h=a.state;b instanceof Function?b={getAnnotations:b}:
b&&!0!==b||(b={});c=h.lint=new e(a,b,c);if(!1!==c.options.lintOnChange)a.on("change",r);if(0!=c.options.tooltips)d.on(a.getWrapperElement(),"mouseover",c.onMouseOver);n(a)}});d.defineExtension("performLint",function(){this.state.lint&&n(this)})})},function(g,d,e){(function(d){g.exports=d()})(function(){function d(a,c){if(!(this instanceof d))return new d(a,c);this.options=c=c?Da(c):{};Da(wf,c,!1);q(c);var e=c.value;"string"==typeof e&&(e=new sa(e,c.mode,null,c.lineSeparator));this.doc=e;var f=new d.inputStyles[c.inputStyle](this),
f=this.display=new b(a,e,f);f.wrapper.CodeMirror=this;h(this);u(this);c.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");c.autofocus&&!Rb&&f.input.focus();y(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new gb,keySeq:null,specialChars:null};var Ea=this;U&&11>da&&setTimeout(function(){Ea.display.input.reset(!0)},20);xf(this);Sd||(yf(),Sd=!0);
yb(this);this.curOp.forceUpdate=!0;Td(this,e);c.autofocus&&!Rb||Ea.hasFocus()?setTimeout(Sb(ed,this),20):Tb(this);for(var g in zb)if(zb.hasOwnProperty(g))zb[g](this,c[g],Ud);z(this);c.finishInit&&c.finishInit(this);for(e=0;e<fd.length;++e)fd[e](this);Ab(this);ka&&c.lineWrapping&&"optimizelegibility"==getComputedStyle(f.lineDiv).textRendering&&(f.lineDiv.style.textRendering="auto")}function b(a,b,c){this.input=c;this.scrollbarFiller=H("div",null,"CodeMirror-scrollbar-filler");this.scrollbarFiller.setAttribute("cm-not-content",
"true");this.gutterFiller=H("div",null,"CodeMirror-gutter-filler");this.gutterFiller.setAttribute("cm-not-content","true");this.lineDiv=H("div",null,"CodeMirror-code");this.selectionDiv=H("div",null,null,"position: relative; z-index: 1");this.cursorDiv=H("div",null,"CodeMirror-cursors");this.measure=H("div",null,"CodeMirror-measure");this.lineMeasure=H("div",null,"CodeMirror-measure");this.lineSpace=H("div",[this.measure,this.lineMeasure,this.selectionDiv,this.cursorDiv,this.lineDiv],null,"position: relative; outline: none");
this.mover=H("div",[H("div",[this.lineSpace],"CodeMirror-lines")],null,"position: relative");this.sizer=H("div",[this.mover],"CodeMirror-sizer");this.sizerWidth=null;this.heightForcer=H("div",null,null,"position: absolute; height: "+Vd+"px; width: 1px;");this.gutters=H("div",null,"CodeMirror-gutters");this.lineGutter=null;this.scroller=H("div",[this.sizer,this.heightForcer,this.gutters],"CodeMirror-scroll");this.scroller.setAttribute("tabIndex","-1");this.wrapper=H("div",[this.scrollbarFiller,this.gutterFiller,
this.scroller],"CodeMirror");U&&8>da&&(this.gutters.style.zIndex=-1,this.scroller.style.paddingRight=0);ka||$a&&Rb||(this.scroller.draggable=!0);a&&(a.appendChild?a.appendChild(this.wrapper):a(this.wrapper));this.reportedViewFrom=this.reportedViewTo=this.viewFrom=this.viewTo=b.first;this.view=[];this.externalMeasured=this.renderedView=null;this.lastWrapHeight=this.lastWrapWidth=this.viewOffset=0;this.updateLineNumbers=null;this.nativeBarWidth=this.barHeight=this.barWidth=0;this.scrollbarsClipped=
!1;this.lineNumWidth=this.lineNumInnerWidth=this.lineNumChars=null;this.alignWidgets=!1;this.maxLine=this.cachedCharWidth=this.cachedTextHeight=this.cachedPaddingH=null;this.maxLineLength=0;this.maxLineChanged=!1;this.wheelDX=this.wheelDY=this.wheelStartX=this.wheelStartY=null;this.shift=!1;this.activeTouch=this.selForContextMenu=null;c.init(this)}function a(a){a.doc.mode=d.getMode(a.options,a.doc.modeOption);c(a)}function c(a){a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=
null)});a.doc.frontier=a.doc.first;Ub(a,100);a.state.modeGen++;a.curOp&&qa(a)}function e(a){var b=hb(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/Vb(a.display)-3);return function(e){if(ib(a.doc,e))return 0;var f=0;if(e.widgets)for(var g=0;g<e.widgets.length;g++)e.widgets[g].height&&(f+=e.widgets[g].height);return c?f+(Math.ceil(e.text.length/d)||1)*b:f+b}}function g(a){var b=a.doc,c=e(a);b.iter(function(a){var b=c(a);b!=a.height&&La(a,b)})}function u(a){a.display.wrapper.className=
a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-");Wb(a)}function l(a){h(a);qa(a);setTimeout(function(){D(a)},20)}function h(a){var b=a.display.gutters,c=a.options.gutters;jb(b);for(var d=0;d<c.length;++d){var e=c[d],f=b.appendChild(H("div",null,"CodeMirror-gutter "+e));"CodeMirror-linenumbers"==e&&(a.display.lineGutter=f,f.style.width=(a.display.lineNumWidth||1)+"px")}b.style.display=d?"":"none";n(a)}function n(a){a.display.sizer.style.marginLeft=
a.display.gutters.offsetWidth+"px"}function p(a){if(0==a.height)return 0;for(var b=a.text.length,c,d=a;c=kb(d,!0);)c=c.find(0,!0),d=c.from.line,b+=c.from.ch-c.to.ch;for(d=a;c=kb(d,!1);)c=c.find(0,!0),b-=d.text.length-c.from.ch,d=c.to.line,b+=d.text.length-c.to.ch;return b}function r(a){var b=a.display;a=a.doc;b.maxLine=I(a,a.first);b.maxLineLength=p(b.maxLine);b.maxLineChanged=!0;a.iter(function(a){var c=p(a);c>b.maxLineLength&&(b.maxLineLength=c,b.maxLine=a)})}function q(a){var b=ma(a.gutters,"CodeMirror-linenumbers");
-1==b&&a.lineNumbers?a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):-1<b&&!a.lineNumbers&&(a.gutters=a.gutters.slice(0),a.gutters.splice(b,1))}function w(a){var b=a.display,c=b.gutters.offsetWidth,d=Math.round(a.doc.height+gd(a.display));return{clientHeight:b.scroller.clientHeight,viewHeight:b.wrapper.clientHeight,scrollWidth:b.scroller.scrollWidth,clientWidth:b.scroller.clientWidth,viewWidth:b.wrapper.clientWidth,barLeft:a.options.fixedGutter?c:0,docHeight:d,scrollHeight:d+Ma(a)+b.barHeight,
nativeBarWidth:b.nativeBarWidth,gutterWidth:c}}function x(a,b,c){this.cm=c;var d=this.vert=H("div",[H("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),e=this.horiz=H("div",[H("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");a(d);a(e);K(d,"scroll",function(){d.clientHeight&&b(d.scrollTop,"vertical")});K(e,"scroll",function(){e.clientWidth&&b(e.scrollLeft,"horizontal")});this.checkedZeroWidth=!1;U&&8>da&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")}
function v(){}function y(a){a.display.scrollbars&&(a.display.scrollbars.clear(),a.display.scrollbars.addClass&&Xb(a.display.wrapper,a.display.scrollbars.addClass));a.display.scrollbars=new d.scrollbarModel[a.options.scrollbarStyle](function(b){a.display.wrapper.insertBefore(b,a.display.scrollbarFiller);K(b,"mousedown",function(){a.state.focused&&setTimeout(function(){a.display.input.focus()},0)});b.setAttribute("cm-not-content","true")},function(b,c){"horizontal"==c?Bb(a,b):Yb(a,b)},a);a.display.scrollbars.addClass&&
Zb(a.display.wrapper,a.display.scrollbars.addClass)}function A(a,b){b||(b=w(a));var c=a.display.barWidth,d=a.display.barHeight;t(a,b);for(var e=0;4>e&&c!=a.display.barWidth||d!=a.display.barHeight;e++)c!=a.display.barWidth&&a.options.lineWrapping&&R(a),t(a,w(a)),c=a.display.barWidth,d=a.display.barHeight}function t(a,b){var c=a.display,d=c.scrollbars.update(b);c.sizer.style.paddingRight=(c.barWidth=d.right)+"px";c.sizer.style.paddingBottom=(c.barHeight=d.bottom)+"px";c.heightForcer.style.borderBottom=
d.bottom+"px solid transparent";d.right&&d.bottom?(c.scrollbarFiller.style.display="block",c.scrollbarFiller.style.height=d.bottom+"px",c.scrollbarFiller.style.width=d.right+"px"):c.scrollbarFiller.style.display="";d.bottom&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(c.gutterFiller.style.display="block",c.gutterFiller.style.height=d.bottom+"px",c.gutterFiller.style.width=b.gutterWidth+"px"):c.gutterFiller.style.display=""}function B(a,b,c){var d=c&&null!=c.top?Math.max(0,c.top):
a.scroller.scrollTop,d=Math.floor(d-a.lineSpace.offsetTop),e=c&&null!=c.bottom?c.bottom:d+a.wrapper.clientHeight,d=lb(b,d),e=lb(b,e);if(c&&c.ensure){var f=c.ensure.from.line;c=c.ensure.to.line;f<d?(d=f,e=lb(b,Na(I(b,f))+a.wrapper.clientHeight)):Math.min(c,b.lastLine())>=e&&(d=lb(b,Na(I(b,c))-a.wrapper.clientHeight),e=c)}return{from:d,to:Math.max(e,d+1)}}function D(a){var b=a.display,c=b.view;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var d=G(b)-b.scroller.scrollLeft+a.doc.scrollLeft,
e=b.gutters.offsetWidth,f=d+"px",g=0;g<c.length;g++)if(!c[g].hidden){a.options.fixedGutter&&c[g].gutter&&(c[g].gutter.style.left=f);var h=c[g].alignable;if(h)for(var k=0;k<h.length;k++)h[k].style.left=f}a.options.fixedGutter&&(b.gutters.style.left=d+e+"px")}}function z(a){if(!a.options.lineNumbers)return!1;var b=a.doc,b=C(a.options,b.first+b.size-1),c=a.display;if(b.length!=c.lineNumChars){var d=c.measure.appendChild(H("div",[H("div",b)],"CodeMirror-linenumber CodeMirror-gutter-elt")),e=d.firstChild.offsetWidth,
d=d.offsetWidth-e;c.lineGutter.style.width="";c.lineNumInnerWidth=Math.max(e,c.lineGutter.offsetWidth-d)+1;c.lineNumWidth=c.lineNumInnerWidth+d;c.lineNumChars=c.lineNumInnerWidth?b.length:-1;c.lineGutter.style.width=c.lineNumWidth+"px";n(a);return!0}return!1}function C(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}function G(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function F(a,b,c){var d=a.display;this.viewport=b;this.visible=B(d,a.doc,
b);this.editorIsHidden=!d.wrapper.offsetWidth;this.wrapperHeight=d.wrapper.clientHeight;this.wrapperWidth=d.wrapper.clientWidth;this.oldDisplayWidth=mb(a);this.force=c;this.dims=X(a);this.events=[]}function J(a,b){var c=a.display,d=a.doc;if(b.editorIsHidden)return ab(a),!1;if(!b.force&&b.visible.from>=c.viewFrom&&b.visible.to<=c.viewTo&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo)&&c.renderedView==c.view&&0==Wd(a))return!1;z(a)&&(ab(a),b.dims=X(a));var e=d.first+d.size,f=Math.max(b.visible.from-
a.options.viewportMargin,d.first),g=Math.min(e,b.visible.to+a.options.viewportMargin);c.viewFrom<f&&20>f-c.viewFrom&&(f=Math.max(d.first,c.viewFrom));c.viewTo>g&&20>c.viewTo-g&&(g=Math.min(e,c.viewTo));bb&&(f=hd(a.doc,f),g=Xd(a.doc,g));d=f!=c.viewFrom||g!=c.viewTo||c.lastWrapHeight!=b.wrapperHeight||c.lastWrapWidth!=b.wrapperWidth;e=a.display;0==e.view.length||f>=e.viewTo||g<=e.viewFrom?(e.view=wc(a,f,g),e.viewFrom=f):(e.viewFrom>f?e.view=wc(a,f,e.viewFrom).concat(e.view):e.viewFrom<f&&(e.view=e.view.slice(nb(a,
f))),e.viewFrom=f,e.viewTo<g?e.view=e.view.concat(wc(a,e.viewTo,g)):e.viewTo>g&&(e.view=e.view.slice(0,nb(a,g))));e.viewTo=g;c.viewOffset=Na(I(a.doc,c.viewFrom));a.display.mover.style.top=c.viewOffset+"px";g=Wd(a);if(!d&&0==g&&!b.force&&c.renderedView==c.view&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo))return!1;f=Oa();4<g&&(c.lineDiv.style.display="none");N(a,c.updateLineNumbers,b.dims);4<g&&(c.lineDiv.style.display="");c.renderedView=c.view;f&&Oa()!=f&&f.offsetHeight&&f.focus();jb(c.cursorDiv);
jb(c.selectionDiv);c.gutters.style.height=c.sizer.style.minHeight=0;d&&(c.lastWrapHeight=b.wrapperHeight,c.lastWrapWidth=b.wrapperWidth,Ub(a,400));c.updateLineNumbers=null;return!0}function Q(a,b){for(var c=b.viewport,d=!0;;d=!1){if(!d||!a.options.lineWrapping||b.oldDisplayWidth==mb(a))if(c&&null!=c.top&&(c={top:Math.min(a.doc.height+gd(a.display)-id(a),c.top)}),b.visible=B(a.display,a.doc,c),b.visible.from>=a.display.viewFrom&&b.visible.to<=a.display.viewTo)break;if(!J(a,b))break;R(a);d=w(a);$b(a);
A(a,d);W(a,d)}b.signal(a,"update",a);if(a.display.viewFrom!=a.display.reportedViewFrom||a.display.viewTo!=a.display.reportedViewTo)b.signal(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo),a.display.reportedViewFrom=a.display.viewFrom,a.display.reportedViewTo=a.display.viewTo}function P(a,b){var c=new F(a,b);if(J(a,c)){R(a);Q(a,c);var d=w(a);$b(a);A(a,d);W(a,d);c.finish()}}function W(a,b){a.display.sizer.style.minHeight=b.docHeight+"px";a.display.heightForcer.style.top=b.docHeight+"px";a.display.gutters.style.height=
b.docHeight+a.display.barHeight+Ma(a)+"px"}function R(a){a=a.display;for(var b=a.lineDiv.offsetTop,c=0;c<a.view.length;c++){var d=a.view[c],e;if(!d.hidden){if(U&&8>da){var f=d.node.offsetTop+d.node.offsetHeight;e=f-b;b=f}else e=d.node.getBoundingClientRect(),e=e.bottom-e.top;f=d.line.height-e;2>e&&(e=hb(a));if(.001<f||-.001>f)if(La(d.line,e),S(d.line),d.rest)for(e=0;e<d.rest.length;e++)S(d.rest[e])}}}function S(a){if(a.widgets)for(var b=0;b<a.widgets.length;++b)a.widgets[b].height=a.widgets[b].node.parentNode.offsetHeight}
function X(a){for(var b=a.display,c={},d={},e=b.gutters.clientLeft,f=b.gutters.firstChild,g=0;f;f=f.nextSibling,++g)c[a.options.gutters[g]]=f.offsetLeft+f.clientLeft+e,d[a.options.gutters[g]]=f.clientWidth;return{fixedPos:G(b),gutterTotalWidth:b.gutters.offsetWidth,gutterLeft:c,gutterWidth:d,wrapperWidth:b.wrapper.clientWidth}}function N(a,b,c){function d(b){var c=b.nextSibling;ka&&Fa&&a.display.currentWheelTarget==b?b.style.display="none":b.parentNode.removeChild(b);return c}for(var e=a.display,
f=a.options.lineNumbers,g=e.lineDiv,h=g.firstChild,k=e.view,e=e.viewFrom,l=0;l<k.length;l++){var m=k[l];if(!m.hidden)if(m.node&&m.node.parentNode==g){for(;h!=m.node;)h=d(h);h=f&&null!=b&&b<=e&&m.lineNumber;m.changes&&(-1<ma(m.changes,"gutter")&&(h=!1),Y(a,m,e,c));h&&(jb(m.lineNumber),m.lineNumber.appendChild(document.createTextNode(C(a.options,e))));h=m.node.nextSibling}else{var n=Ca(a,m,e,c);g.insertBefore(n,h)}e+=m.size}for(;h;)h=d(h)}function Y(a,b,c,d){for(var e=0;e<b.changes.length;e++){var f=
b.changes[e];if("text"==f){var f=b,g=f.text.className,h=ya(a,f);f.text==f.node&&(f.node=h.pre);f.text.parentNode.replaceChild(h.pre,f.text);f.text=h.pre;h.bgClass!=f.bgClass||h.textClass!=f.textClass?(f.bgClass=h.bgClass,f.textClass=h.textClass,Ta(f)):g&&(f.text.className=g)}else if("gutter"==f)za(a,b,c,d);else if("class"==f)Ta(b);else if("widget"==f){f=a;g=b;h=d;g.alignable&&(g.alignable=null);for(var k=g.node.firstChild,l=void 0;k;k=l)l=k.nextSibling,"CodeMirror-linewidget"==k.className&&g.node.removeChild(k);
ca(f,g,h)}}b.changes=null}function ba(a){a.node==a.text&&(a.node=H("div",null,null,"position: relative"),a.text.parentNode&&a.text.parentNode.replaceChild(a.node,a.text),a.node.appendChild(a.text),U&&8>da&&(a.node.style.zIndex=2));return a.node}function ya(a,b){var c=a.display.externalMeasured;return c&&c.line==b.line?(a.display.externalMeasured=null,b.measure=c.measure,c.built):Yd(a,b)}function Ta(a){var b=a.bgClass?a.bgClass+" "+(a.line.bgClass||""):a.line.bgClass;b&&(b+=" CodeMirror-linebackground");
if(a.background)b?a.background.className=b:(a.background.parentNode.removeChild(a.background),a.background=null);else if(b){var c=ba(a);a.background=c.insertBefore(H("div",null,b),c.firstChild)}a.line.wrapClass?ba(a).className=a.line.wrapClass:a.node!=a.text&&(a.node.className="");a.text.className=(a.textClass?a.textClass+" "+(a.line.textClass||""):a.line.textClass)||""}function za(a,b,c,d){b.gutter&&(b.node.removeChild(b.gutter),b.gutter=null);b.gutterBackground&&(b.node.removeChild(b.gutterBackground),
b.gutterBackground=null);if(b.line.gutterClass){var e=ba(b);b.gutterBackground=H("div",null,"CodeMirror-gutter-background "+b.line.gutterClass,"left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px; width: "+d.gutterTotalWidth+"px");e.insertBefore(b.gutterBackground,b.text)}var f=b.line.gutterMarkers;if(a.options.lineNumbers||f){var e=ba(b),g=b.gutter=H("div",null,"CodeMirror-gutter-wrapper","left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px");a.display.input.setUneditable(g);
e.insertBefore(g,b.text);b.line.gutterClass&&(g.className+=" "+b.line.gutterClass);!a.options.lineNumbers||f&&f["CodeMirror-linenumbers"]||(b.lineNumber=g.appendChild(H("div",C(a.options,c),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+d.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+a.display.lineNumInnerWidth+"px")));if(f)for(b=0;b<a.options.gutters.length;++b)c=a.options.gutters[b],(e=f.hasOwnProperty(c)&&f[c])&&g.appendChild(H("div",[e],"CodeMirror-gutter-elt","left: "+d.gutterLeft[c]+
"px; width: "+d.gutterWidth[c]+"px"))}}function Ca(a,b,c,d){var e=ya(a,b);b.text=b.node=e.pre;e.bgClass&&(b.bgClass=e.bgClass);e.textClass&&(b.textClass=e.textClass);Ta(b);za(a,b,c,d);ca(a,b,d);return b.node}function ca(a,b,c){Ob(a,b.line,b,c,!0);if(b.rest)for(var d=0;d<b.rest.length;d++)Ob(a,b.rest[d],b,c,!1)}function Ob(a,b,c,d,e){if(b.widgets){var f=ba(c),g=0;for(b=b.widgets;g<b.length;++g){var h=b[g],k=H("div",[h.node],"CodeMirror-linewidget");h.handleMouseEvents||k.setAttribute("cm-ignore-events",
"true");var l=h,m=k,n=d;if(l.noHScroll){(c.alignable||(c.alignable=[])).push(m);var p=n.wrapperWidth;m.style.left=n.fixedPos+"px";l.coverGutter||(p-=n.gutterTotalWidth,m.style.paddingLeft=n.gutterTotalWidth+"px");m.style.width=p+"px"}l.coverGutter&&(m.style.zIndex=5,m.style.position="relative",l.noHScroll||(m.style.marginLeft=-n.gutterTotalWidth+"px"));a.display.input.setUneditable(k);e&&h.above?f.insertBefore(k,c.gutter||c.text):f.appendChild(k);ta(h,"redraw")}}}function Pb(a){return E(a.line,a.ch)}
function eb(a,b){return 0>L(a,b)?b:a}function Za(a,b){return 0>L(a,b)?a:b}function fb(a){a.state.focused||(a.display.input.focus(),ed(a))}function Ka(a,b,c,d,e){var f=a.doc;a.display.shift=!1;d||(d=f.sel);var g=a.state.pasteIncoming||"paste"==e,h=f.splitLines(b),k=null;if(g&&1<d.ranges.length)if(ra&&ra.text.join("\n")==b){if(0==d.ranges.length%ra.text.length)for(var k=[],l=0;l<ra.text.length;l++)k.push(f.splitLines(ra.text[l]))}else h.length==d.ranges.length&&(k=xc(h,function(a){return[a]}));for(l=
d.ranges.length-1;0<=l;l--){var m=d.ranges[l],n=m.from(),p=m.to();m.empty()&&(c&&0<c?n=E(n.line,n.ch-c):a.state.overwrite&&!g?p=E(p.line,Math.min(I(f,p.line).text.length,p.ch+V(h).length)):ra&&ra.lineWise&&ra.text.join("\n")==b&&(n=p=E(n.line,0)));m=a.curOp.updateInput;n={from:n,to:p,text:k?k[l%k.length]:h,origin:e||(g?"paste":a.state.cutIncoming?"cut":"+input")};Cb(a.doc,n);ta(a,"inputRead",a,n)}b&&!g&&Qb(a,b);Db(a);a.curOp.updateInput=m;a.curOp.typing=!0;a.state.pasteIncoming=a.state.cutIncoming=
!1}function uc(a,b){var c=a.clipboardData&&a.clipboardData.getData("text/plain");if(c)return a.preventDefault(),b.isReadOnly()||b.options.disableInput||va(b,function(){Ka(b,c,0,null,"paste")}),!0}function Qb(a,b){if(a.options.electricChars&&a.options.smartIndent)for(var c=a.doc.sel,d=c.ranges.length-1;0<=d;d--){var e=c.ranges[d];if(!(100<e.head.ch||d&&c.ranges[d-1].head.line==e.head.line)){var f=a.getModeAt(e.head),g=!1;if(f.electricChars)for(var h=0;h<f.electricChars.length;h++){if(-1<b.indexOf(f.electricChars.charAt(h))){g=
ac(a,e.head.line,"smart");break}}else f.electricInput&&f.electricInput.test(I(a.doc,e.head.line).text.slice(0,e.head.ch))&&(g=ac(a,e.head.line,"smart"));g&&ta(a,"electricInput",a,e.head.line)}}}function ea(a){for(var b=[],c=[],d=0;d<a.doc.sel.ranges.length;d++){var e=a.doc.sel.ranges[d].head.line,e={anchor:E(e,0),head:E(e+1,0)};c.push(e);b.push(a.getRange(e.anchor,e.head))}return{text:b,ranges:c}}function ga(a){a.setAttribute("autocorrect","off");a.setAttribute("autocapitalize","off");a.setAttribute("spellcheck",
"false")}function cd(a){this.cm=a;this.prevInput="";this.pollingFast=!1;this.polling=new gb;this.hasSelection=this.inaccurateSelection=!1;this.composing=null}function Qd(){var a=H("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none"),b=H("div",[a],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");ka?a.style.width="1000px":a.setAttribute("wrap","off");Eb&&(a.style.border="1px solid black");ga(a);return b}function dd(a){this.cm=a;this.lastAnchorNode=
this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new gb;this.gracePeriod=!1}function Rd(a,b){var c=jd(a,b.line);if(!c||c.hidden)return null;var d=I(a.doc,b.line),c=Zd(c,d,b.line),d=Ga(d),e="left";d&&(e=yc(d,b.ch)%2?"right":"left");c=$d(c.map,b.ch,e);c.offset="right"==c.collapse?c.end:c.start;return c}function xb(a,b){b&&(a.bad=!0);return a}function vc(a,b,c){var d;if(b==a.display.lineDiv){d=a.display.lineDiv.childNodes[c];if(!d)return xb(a.clipPos(E(a.display.viewTo-
1)),!0);b=null;c=0}else for(d=b;;d=d.parentNode){if(!d||d==a.display.lineDiv)return null;if(d.parentNode&&d.parentNode==a.display.lineDiv)break}for(var e=0;e<a.display.view.length;e++){var f=a.display.view[e];if(f.node==d)return uf(f,b,c)}}function uf(a,b,c){function d(b,c,e){for(var T=-1;T<(l?l.length:0);T++)for(var f=0>T?k.map:l[T],Va=0;Va<f.length;Va+=3){var g=f[Va+2];if(g==b||g==c){c=Z(0>T?a.line:a.rest[T]);T=f[Va]+e;if(0>e||g!=b)T=f[Va+(e?1:0)];return E(c,T)}}}var e=a.text.firstChild,f=!1;if(!b||
!kd(e,b))return xb(E(Z(a.line),0),!0);if(b==e&&(f=!0,b=e.childNodes[c],c=0,!b))return c=a.rest?V(a.rest):a.line,xb(E(Z(c),c.text.length),f);var g=3==b.nodeType?b:null,h=b;g||1!=b.childNodes.length||3!=b.firstChild.nodeType||(g=b.firstChild,c&&(c=g.nodeValue.length));for(;h.parentNode!=e;)h=h.parentNode;var k=a.measure,l=k.maps;if(b=d(g,h,c))return xb(b,f);e=h.nextSibling;for(g=g?g.nodeValue.length-c:0;e;e=e.nextSibling){if(b=d(e,e.firstChild,0))return xb(E(b.line,b.ch-g),f);g+=e.textContent.length}h=
h.previousSibling;for(g=c;h;h=h.previousSibling){if(b=d(h,h.firstChild,-1))return xb(E(b.line,b.ch+g),f);g+=e.textContent.length}}function vf(a,b,c,d,e){function f(a){return function(b){return b.id==a}}function g(b){if(1==b.nodeType){var c=b.getAttribute("cm-text");if(null!=c)""==c&&(c=b.textContent.replace(/\u200b/g,"")),h+=c;else{var c=b.getAttribute("cm-marker"),T;if(c)b=a.findMarks(E(d,0),E(e+1,0),f(+c)),b.length&&(T=b[0].find())&&(h+=ob(a.doc,T.from,T.to).join(l));else if("false"!=b.getAttribute("contenteditable")){for(T=
0;T<b.childNodes.length;T++)g(b.childNodes[T]);/^(pre|div|p)$/i.test(b.nodeName)&&(k=!0)}}}else 3==b.nodeType&&(b=b.nodeValue)&&(k&&(h+=l,k=!1),h+=b)}for(var h="",k=!1,l=a.doc.lineSeparator();;){g(b);if(b==c)break;b=b.nextSibling}return h}function Ua(a,b){this.ranges=a;this.primIndex=b}function aa(a,b){this.anchor=a;this.head=b}function Ha(a,b){var c=a[b];a.sort(function(a,b){return L(a.from(),b.from())});b=ma(a,c);for(c=1;c<a.length;c++){var d=a[c],e=a[c-1];if(0<=L(e.to(),d.from())){var f=Za(e.from(),
d.from()),g=eb(e.to(),d.to()),d=e.empty()?d.from()==d.head:e.from()==e.head;c<=b&&--b;a.splice(--c,2,new aa(d?g:f,d?f:g))}}return new Ua(a,b)}function Pa(a,b){return new Ua([new aa(a,b||a)],0)}function O(a,b){if(b.line<a.first)return E(a.first,0);var c=a.first+a.size-1;if(b.line>c)return E(c,I(a,c).text.length);var c=I(a,b.line).text.length,d=b.ch,c=null==d||d>c?E(b.line,c):0>d?E(b.line,0):b;return c}function bc(a,b){return b>=a.first&&b<a.first+a.size}function ae(a,b){for(var c=[],d=0;d<b.length;d++)c[d]=
O(a,b[d]);return c}function cc(a,b,c,d){return a.cm&&a.cm.display.shift||a.extend?(a=b.anchor,d&&(b=0>L(c,a),b!=0>L(d,a)?(a=c,c=d):b!=0>L(c,d)&&(c=d)),new aa(a,c)):new aa(d||c,c)}function zc(a,b,c,d){la(a,new Ua([cc(a,a.sel.primary(),b,c)],0),d)}function be(a,b,c){for(var d=[],e=0;e<a.sel.ranges.length;e++)d[e]=cc(a,a.sel.ranges[e],b[e],null);b=Ha(d,a.sel.primIndex);la(a,b,c)}function ld(a,b,c,d){var e=a.sel.ranges.slice(0);e[b]=c;la(a,Ha(e,a.sel.primIndex),d)}function zf(a,b,c){c={ranges:b.ranges,
update:function(b){this.ranges=[];for(var c=0;c<b.length;c++)this.ranges[c]=new aa(O(a,b[c].anchor),O(a,b[c].head))},origin:c&&c.origin};ia(a,"beforeSelectionChange",a,c);a.cm&&ia(a.cm,"beforeSelectionChange",a.cm,c);return c.ranges!=b.ranges?Ha(c.ranges,c.ranges.length-1):b}function ce(a,b,c){var d=a.history.done,e=V(d);e&&e.ranges?(d[d.length-1]=b,Ac(a,b,c)):la(a,b,c)}function la(a,b,c){Ac(a,b,c);b=a.sel;var d=a.cm?a.cm.curOp.id:NaN,e=a.history,f=c&&c.origin,g;if(!(g=d==e.lastSelOp)&&(g=f&&e.lastSelOrigin==
f)&&!(g=e.lastModTime==e.lastSelTime&&e.lastOrigin==f)){g=V(e.done);var h=f.charAt(0);g="*"==h||"+"==h&&g.ranges.length==b.ranges.length&&g.somethingSelected()==b.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}g?e.done[e.done.length-1]=b:Bc(b,e.done);e.lastSelTime=+new Date;e.lastSelOrigin=f;e.lastSelOp=d;c&&!1!==c.clearRedo&&de(e.undone)}function Ac(a,b,c){if(Ba(a,"beforeSelectionChange")||a.cm&&Ba(a.cm,"beforeSelectionChange"))b=zf(a,b,c);var d=c&&
c.bias||(0>L(b.primary().head,a.sel.primary().head)?-1:1);ee(a,fe(a,b,d,!0));c&&!1===c.scroll||!a.cm||Db(a.cm)}function ee(a,b){b.equals(a.sel)||(a.sel=b,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0,ge(a.cm)),ta(a,"cursorActivity",a))}function he(a){ee(a,fe(a,a.sel,null,!1),Qa)}function fe(a,b,c,d){for(var e,f=0;f<b.ranges.length;f++){var g=b.ranges[f],h=b.ranges.length==a.sel.ranges.length&&a.sel.ranges[f],k=md(a,g.anchor,h&&h.anchor,c,d),h=md(a,g.head,h&&h.head,c,d);if(e||k!=g.anchor||
h!=g.head)e||(e=b.ranges.slice(0,f)),e[f]=new aa(k,h)}return e?Ha(e,b.primIndex):b}function Fb(a,b,c,d,e){var f=I(a,b.line);if(f.markedSpans)for(var g=0;g<f.markedSpans.length;++g){var h=f.markedSpans[g],k=h.marker;if((null==h.from||(k.inclusiveLeft?h.from<=b.ch:h.from<b.ch))&&(null==h.to||(k.inclusiveRight?h.to>=b.ch:h.to>b.ch))){if(e&&(ia(k,"beforeCursorEnter"),k.explicitlyCleared))if(f.markedSpans){--g;continue}else break;if(k.atomic){if(c){var g=k.find(0>d?1:-1),l;if(0>d?k.inclusiveRight:k.inclusiveLeft)g=
ie(a,g,-d,g&&g.line==b.line?f:null);if(g&&g.line==b.line&&(l=L(g,c))&&(0>d?0>l:0<l))return Fb(a,g,b,d,e)}c=k.find(0>d?-1:1);if(0>d?k.inclusiveLeft:k.inclusiveRight)c=ie(a,c,d,c.line==b.line?f:null);return c?Fb(a,c,b,d,e):null}}}return b}function md(a,b,c,d,e){d=d||1;b=Fb(a,b,c,d,e)||!e&&Fb(a,b,c,d,!0)||Fb(a,b,c,-d,e)||!e&&Fb(a,b,c,-d,!0);return b?b:(a.cantEdit=!0,E(a.first,0))}function ie(a,b,c,d){return 0>c&&0==b.ch?b.line>a.first?O(a,E(b.line-1)):null:0<c&&b.ch==(d||I(a,b.line)).text.length?b.line<
a.first+a.size-1?E(b.line+1,0):null:new E(b.line,b.ch+c)}function $b(a){a.display.input.showSelection(a.display.input.prepareSelection())}function je(a,b){for(var c=a.doc,d={},e=d.cursors=document.createDocumentFragment(),f=d.selection=document.createDocumentFragment(),g=0;g<c.sel.ranges.length;g++)if(!1!==b||g!=c.sel.primIndex){var h=c.sel.ranges[g];if(!(h.from().line>=a.display.viewTo||h.to().line<a.display.viewFrom)){var k=h.empty();(k||a.options.showCursorWhenSelecting)&&ke(a,h.head,e);k||Af(a,
h,f)}}return d}function ke(a,b,c){b=Wa(a,b,"div",null,null,!a.options.singleCursorHeightPerLine);var d=c.appendChild(H("div","\u00a0","CodeMirror-cursor"));d.style.left=b.left+"px";d.style.top=b.top+"px";d.style.height=Math.max(0,b.bottom-b.top)*a.options.cursorHeight+"px";b.other&&(a=c.appendChild(H("div","\u00a0","CodeMirror-cursor CodeMirror-secondarycursor")),a.style.display="",a.style.left=b.other.left+"px",a.style.top=b.other.top+"px",a.style.height=.85*(b.other.bottom-b.other.top)+"px")}function Af(a,
b,c){function d(a,b,c,e){0>b&&(b=0);b=Math.round(b);e=Math.round(e);h.appendChild(H("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+b+"px; width: "+(null==c?m-a:c)+"px; height: "+(e-b)+"px"))}function e(b,c,T){var f=I(g,b),Va=f.text.length,h,Ea;Bf(Ga(f),c||0,null==T?Va:T,function(e,g,k){var n=Cc(a,E(b,e),"div",f,"left"),ha,p;e==g?(ha=n,k=p=n.left):(ha=Cc(a,E(b,g-1),"div",f,"right"),"rtl"==k&&(k=n,n=ha,ha=k),k=n.left,p=ha.right);null==c&&0==e&&(k=l);3<ha.top-n.top&&(d(k,
n.top,null,n.bottom),k=l,n.bottom<ha.top&&d(k,n.bottom,null,ha.top));null==T&&g==Va&&(p=m);if(!h||n.top<h.top||n.top==h.top&&n.left<h.left)h=n;if(!Ea||ha.bottom>Ea.bottom||ha.bottom==Ea.bottom&&ha.right>Ea.right)Ea=ha;k<l+1&&(k=l);d(k,ha.top,p-k,ha.bottom)});return{start:h,end:Ea}}var f=a.display,g=a.doc,h=document.createDocumentFragment(),k=le(a.display),l=k.left,m=Math.max(f.sizerWidth,mb(a)-f.sizer.offsetLeft)-k.right,f=b.from();b=b.to();if(f.line==b.line)e(f.line,f.ch,b.ch);else{var n=I(g,f.line),
k=I(g,b.line),k=Ra(n)==Ra(k),f=e(f.line,f.ch,k?n.text.length+1:null).end;b=e(b.line,k?0:null,b.ch).start;k&&(f.top<b.top-2?(d(f.right,f.top,null,f.bottom),d(l,b.top,b.left,b.bottom)):d(f.right,f.top,b.left-f.right,f.bottom));f.bottom<b.top&&d(l,f.bottom,null,b.top)}c.appendChild(h)}function nd(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursorDiv.style.visibility="";0<a.options.cursorBlinkRate?b.blinker=setInterval(function(){b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},
a.options.cursorBlinkRate):0>a.options.cursorBlinkRate&&(b.cursorDiv.style.visibility="hidden")}}function Ub(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.viewTo&&a.state.highlight.set(b,Sb(Cf,a))}function Cf(a){var b=a.doc;b.frontier<b.first&&(b.frontier=b.first);if(!(b.frontier>=a.display.viewTo)){var c=+new Date+a.options.workTime,d=cb(b.mode,dc(a,b.frontier)),e=[];b.iter(b.frontier,Math.min(b.first+b.size,a.display.viewTo+500),function(f){if(b.frontier>=a.display.viewFrom){var g=f.styles,
h=f.text.length>a.options.maxHighlightLength,k=me(a,f,h?cb(b.mode,d):d,!0);f.styles=k.styles;var l=f.styleClasses;(k=k.classes)?f.styleClasses=k:l&&(f.styleClasses=null);l=!g||g.length!=f.styles.length||l!=k&&(!l||!k||l.bgClass!=k.bgClass||l.textClass!=k.textClass);for(k=0;!l&&k<g.length;++k)l=g[k]!=f.styles[k];l&&e.push(b.frontier);f.stateAfter=h?d:cb(b.mode,d)}else f.text.length<=a.options.maxHighlightLength&&od(a,f.text,d),f.stateAfter=0==b.frontier%5?cb(b.mode,d):null;++b.frontier;if(+new Date>
c)return Ub(a,a.options.workDelay),!0});e.length&&va(a,function(){for(var b=0;b<e.length;b++)Xa(a,e[b],"text")})}}function Df(a,b,c){for(var d,e,f=a.doc,g=c?-1:b-(a.doc.mode.innerMode?1E3:100);b>g;--b){if(b<=f.first)return f.first;var h=I(f,b-1);if(h.stateAfter&&(!c||b<=f.frontier))return b;h=Ia(h.text,null,a.options.tabSize);if(null==e||d>h)e=b-1,d=h}return e}function dc(a,b,c){var d=a.doc,e=a.display;if(!d.mode.startState)return!0;var f=Df(a,b,c),g=f>d.first&&I(d,f-1).stateAfter,g=g?cb(d.mode,g):
Ef(d.mode);d.iter(f,b,function(c){od(a,c.text,g);c.stateAfter=f==b-1||0==f%5||f>=e.viewFrom&&f<e.viewTo?cb(d.mode,g):null;++f});c&&(d.frontier=f);return g}function gd(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function le(a){if(a.cachedPaddingH)return a.cachedPaddingH;var b=wa(a.measure,H("pre","x")),b=window.getComputedStyle?window.getComputedStyle(b):b.currentStyle,b={left:parseInt(b.paddingLeft),right:parseInt(b.paddingRight)};isNaN(b.left)||isNaN(b.right)||(a.cachedPaddingH=b);return b}
function Ma(a){return Vd-a.display.nativeBarWidth}function mb(a){return a.display.scroller.clientWidth-Ma(a)-a.display.barWidth}function id(a){return a.display.scroller.clientHeight-Ma(a)-a.display.barHeight}function Zd(a,b,c){if(a.line==b)return{map:a.measure.map,cache:a.measure.cache};for(var d=0;d<a.rest.length;d++)if(a.rest[d]==b)return{map:a.measure.maps[d],cache:a.measure.caches[d]};for(d=0;d<a.rest.length;d++)if(Z(a.rest[d])>c)return{map:a.measure.maps[d],cache:a.measure.caches[d],before:!0}}
function jd(a,b){if(b>=a.display.viewFrom&&b<a.display.viewTo)return a.display.view[nb(a,b)];var c=a.display.externalMeasured;if(c&&b>=c.lineN&&b<c.lineN+c.size)return c}function Dc(a,b){var c=Z(b),d=jd(a,c);d&&!d.text?d=null:d&&d.changes&&(Y(a,d,c,X(a)),a.curOp.forceUpdate=!0);if(!d){var e;e=Ra(b);d=Z(e);e=a.display.externalMeasured=new ne(a.doc,e,d);e.lineN=d;d=e.built=Yd(a,e);e.text=d.pre;wa(a.display.lineMeasure,d.pre);d=e}c=Zd(d,b,c);return{line:b,view:d,rect:null,map:c.map,cache:c.cache,before:c.before,
hasHeights:!1}}function pd(a,b,c,d,e){b.before&&(c=-1);var f=c+(d||"");if(b.cache.hasOwnProperty(f))a=b.cache[f];else{b.rect||(b.rect=b.view.text.getBoundingClientRect());if(!b.hasHeights){var g=b.view,h=b.rect,k=a.options.lineWrapping,l=k&&mb(a);if(!g.measure.heights||k&&g.measure.width!=l){var m=g.measure.heights=[];if(k)for(g.measure.width=l,g=g.text.firstChild.getClientRects(),k=0;k<g.length-1;k++){var l=g[k],n=g[k+1];2<Math.abs(l.bottom-n.bottom)&&m.push((l.bottom+n.top)/2-h.top)}m.push(h.bottom-
h.top)}b.hasHeights=!0}g=d;k=$d(b.map,c,g);d=k.node;h=k.start;l=k.end;c=k.collapse;var p;if(3==d.nodeType){for(m=0;4>m;m++){for(;h&&ec(b.line.text.charAt(k.coverStart+h));)--h;for(;k.coverStart+l<k.coverEnd&&ec(b.line.text.charAt(k.coverStart+l));)++l;if(U&&9>da&&0==h&&l==k.coverEnd-k.coverStart)p=d.parentNode.getBoundingClientRect();else if(U&&a.options.lineWrapping){var q=pb(d,h,l).getClientRects();p=q.length?q["right"==g?q.length-1:0]:qd}else p=pb(d,h,l).getBoundingClientRect()||qd;if(p.left||
p.right||0==h)break;l=h;--h;c="right"}U&&11>da&&((q=!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI)||(null!=rd?q=rd:(m=wa(a.display.measure,H("span","x")),q=m.getBoundingClientRect(),m=pb(m,0,1).getBoundingClientRect(),q=rd=1<Math.abs(q.left-m.left)),q=!q),q||(q=screen.logicalXDPI/screen.deviceXDPI,m=screen.logicalYDPI/screen.deviceYDPI,p={left:p.left*q,right:p.right*q,top:p.top*m,bottom:p.bottom*m}))}else 0<h&&(c=g="right"),p=a.options.lineWrapping&&1<(q=d.getClientRects()).length?
q["right"==g?q.length-1:0]:d.getBoundingClientRect();!(U&&9>da)||h||p&&(p.left||p.right)||(p=(p=d.parentNode.getClientRects()[0])?{left:p.left,right:p.left+Vb(a.display),top:p.top,bottom:p.bottom}:qd);q=p.top-b.rect.top;d=p.bottom-b.rect.top;h=(q+d)/2;g=b.view.measure.heights;for(m=0;m<g.length-1&&!(h<g[m]);m++);c={left:("right"==c?p.right:p.left)-b.rect.left,right:("left"==c?p.left:p.right)-b.rect.left,top:m?g[m-1]:0,bottom:g[m]};p.left||p.right||(c.bogus=!0);a.options.singleCursorHeightPerLine||
(c.rtop=q,c.rbottom=d);a=c;a.bogus||(b.cache[f]=a)}return{left:a.left,right:a.right,top:e?a.rtop:a.top,bottom:e?a.rbottom:a.bottom}}function $d(a,b,c){for(var d,e,f,g,h=0;h<a.length;h+=3){var k=a[h],l=a[h+1];if(b<k)e=0,f=1,g="left";else if(b<l)e=b-k,f=e+1;else if(h==a.length-3||b==l&&a[h+3]>b)f=l-k,e=f-1,b>=l&&(g="right");if(null!=e){d=a[h+2];k==l&&c==(d.insertLeft?"left":"right")&&(g=c);if("left"==c&&0==e)for(;h&&a[h-2]==a[h-3]&&a[h-1].insertLeft;)d=a[(h-=3)+2],g="left";if("right"==c&&e==l-k)for(;h<
a.length-3&&a[h+3]==a[h+4]&&!a[h+5].insertLeft;)d=a[(h+=3)+2],g="right";break}}return{node:d,start:e,end:f,collapse:g,coverStart:k,coverEnd:l}}function oe(a){if(a.measure&&(a.measure.cache={},a.measure.heights=null,a.rest))for(var b=0;b<a.rest.length;b++)a.measure.caches[b]={}}function pe(a){a.display.externalMeasure=null;jb(a.display.lineMeasure);for(var b=0;b<a.display.view.length;b++)oe(a.display.view[b])}function Wb(a){pe(a);a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=
null;a.options.lineWrapping||(a.display.maxLineChanged=!0);a.display.lineNumChars=null}function sd(a,b,c,d){if(b.widgets)for(var e=0;e<b.widgets.length;++e)if(b.widgets[e].above){var f=fc(b.widgets[e]);c.top+=f;c.bottom+=f}if("line"==d)return c;d||(d="local");b=Na(b);b="local"==d?b+a.display.lineSpace.offsetTop:b-a.display.viewOffset;if("page"==d||"window"==d)a=a.display.lineSpace.getBoundingClientRect(),b+=a.top+("window"==d?0:window.pageYOffset||(document.documentElement||document.body).scrollTop),
d=a.left+("window"==d?0:window.pageXOffset||(document.documentElement||document.body).scrollLeft),c.left+=d,c.right+=d;c.top+=b;c.bottom+=b;return c}function qe(a,b,c){if("div"==c)return b;var d=b.left;b=b.top;"page"==c?(d-=window.pageXOffset||(document.documentElement||document.body).scrollLeft,b-=window.pageYOffset||(document.documentElement||document.body).scrollTop):"local"!=c&&c||(c=a.display.sizer.getBoundingClientRect(),d+=c.left,b+=c.top);a=a.display.lineSpace.getBoundingClientRect();return{left:d-
a.left,top:b-a.top}}function Cc(a,b,c,d,e){d||(d=I(a.doc,b.line));var f=d;b=b.ch;d=pd(a,Dc(a,d),b,e);return sd(a,f,d,c)}function Wa(a,b,c,d,e,f){function g(b,T){var h=pd(a,e,b,T?"right":"left",f);T?h.left=h.right:h.right=h.left;return sd(a,d,h,c)}function h(a,b){var c=k[b],d=c.level%2;a==td(c)&&b&&c.level<k[b-1].level?(c=k[--b],a=ud(c)-(c.level%2?0:1),d=!0):a==ud(c)&&b<k.length-1&&c.level<k[b+1].level&&(c=k[++b],a=td(c)-c.level%2,d=!1);return d&&a==c.to&&a>c.from?g(a-1):g(a,d)}d=d||I(a.doc,b.line);
e||(e=Dc(a,d));var k=Ga(d);b=b.ch;if(!k)return g(b);var l=yc(k,b),l=h(b,l);null!=gc&&(l.other=h(b,gc));return l}function re(a,b){var c=0;b=O(a.doc,b);a.options.lineWrapping||(c=Vb(a.display)*b.ch);var d=I(a.doc,b.line),e=Na(d)+a.display.lineSpace.offsetTop;return{left:c,right:c,top:e,bottom:e+d.height}}function Ec(a,b,c,d){a=E(a,b);a.xRel=d;c&&(a.outside=!0);return a}function vd(a,b,c){var d=a.doc;c+=a.display.viewOffset;if(0>c)return Ec(d.first,0,!0,-1);var e=lb(d,c),f=d.first+d.size-1;if(e>f)return Ec(d.first+
d.size-1,I(d,f).text.length,!0,1);0>b&&(b=0);for(d=I(d,e);;)if(e=Ff(a,d,e,b,c),f=(d=kb(d,!1))&&d.find(0,!0),d&&(e.ch>f.from.ch||e.ch==f.from.ch&&0<e.xRel))e=Z(d=f.to.line);else return e}function Ff(a,b,c,d,e){function f(d){d=Wa(a,E(c,d),"line",b,l);h=!0;if(g>d.bottom)return d.left-k;if(g<d.top)return d.left+k;h=!1;return d.left}var g=e-Na(b),h=!1,k=2*a.display.wrapper.clientWidth,l=Dc(a,b),m=Ga(b),n=b.text.length;e=Fc(b);var p=Gc(b),q=f(e),t=h,v=f(p),r=h;if(d>v)return Ec(c,p,r,1);for(;;){if(m?p==
e||p==wd(b,e,1):1>=p-e){m=d<q||d-q<=v-d?e:p;for(d-=m==e?q:v;ec(b.text.charAt(m));)++m;return Ec(c,m,m==e?t:r,-1>d?-1:1<d?1:0)}var y=Math.ceil(n/2),u=e+y;if(m)for(var u=e,A=0;A<y;++A)u=wd(b,u,1);A=f(u);if(A>d){p=u;v=A;if(r=h)v+=1E3;n=y}else e=u,q=A,t=h,n-=y}}function hb(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==qb){qb=H("pre");for(var b=0;49>b;++b)qb.appendChild(document.createTextNode("x")),qb.appendChild(H("br"));qb.appendChild(document.createTextNode("x"))}wa(a.measure,qb);
b=qb.offsetHeight/50;3<b&&(a.cachedTextHeight=b);jb(a.measure);return b||1}function Vb(a){if(null!=a.cachedCharWidth)return a.cachedCharWidth;var b=H("span","xxxxxxxxxx"),c=H("pre",[b]);wa(a.measure,c);b=b.getBoundingClientRect();b=(b.right-b.left)/10;2<b&&(a.cachedCharWidth=b);return b||10}function yb(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,
scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Gf};Gb?Gb.ops.push(a.curOp):a.curOp.ownsGroup=Gb={ops:[a.curOp],delayedCallbacks:[]}}function Ab(a){if(a=a.curOp.ownsGroup)try{var b=a.delayedCallbacks,c=0;do{for(;c<b.length;c++)b[c].call(null);for(var d=0;d<a.ops.length;d++){var e=a.ops[d];if(e.cursorActivityHandlers)for(;e.cursorActivityCalled<e.cursorActivityHandlers.length;)e.cursorActivityHandlers[e.cursorActivityCalled++].call(null,e.cm)}}while(c<b.length)}finally{Gb=null;for(b=
0;b<a.ops.length;b++)a.ops[b].cm.curOp=null;a=a.ops;for(b=0;b<a.length;b++){var e=a[b],c=e.cm,f=d=c.display;!f.scrollbarsClipped&&f.scroller.offsetWidth&&(f.nativeBarWidth=f.scroller.offsetWidth-f.scroller.clientWidth,f.heightForcer.style.height=Ma(c)+"px",f.sizer.style.marginBottom=-f.nativeBarWidth+"px",f.sizer.style.borderRightWidth=Ma(c)+"px",f.scrollbarsClipped=!0);e.updateMaxLine&&r(c);e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<d.viewFrom||
e.scrollToPos.to.line>=d.viewTo)||d.maxLineChanged&&c.options.lineWrapping;e.update=e.mustUpdate&&new F(c,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}for(b=0;b<a.length;b++)e=a[b],e.updatedDisplay=e.mustUpdate&&J(e.cm,e.update);for(b=0;b<a.length;b++)if(e=a[b],c=e.cm,d=c.display,e.updatedDisplay&&R(c),e.barMeasure=w(c),d.maxLineChanged&&!c.options.lineWrapping&&(f=void 0,f=d.maxLine.text.length,f=pd(c,Dc(c,d.maxLine),f,void 0),e.adjustWidthTo=f.left+3,c.display.sizerWidth=
e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(d.scroller.clientWidth,d.sizer.offsetLeft+e.adjustWidthTo+Ma(c)+c.display.barWidth),e.maxScrollLeft=Math.max(0,d.sizer.offsetLeft+e.adjustWidthTo-mb(c))),e.updatedDisplay||e.selectionChanged)e.preparedSelection=d.input.prepareSelection(e.focus);for(b=0;b<a.length;b++)e=a[b],c=e.cm,null!=e.adjustWidthTo&&(c.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<c.doc.scrollLeft&&Bb(c,Math.min(c.display.scroller.scrollLeft,e.maxScrollLeft),
!0),c.display.maxLineChanged=!1),d=e.focus&&e.focus==Oa()&&(!document.hasFocus||document.hasFocus()),e.preparedSelection&&c.display.input.showSelection(e.preparedSelection,d),(e.updatedDisplay||e.startHeight!=c.doc.height)&&A(c,e.barMeasure),e.updatedDisplay&&W(c,e.barMeasure),e.selectionChanged&&nd(c),c.state.focused&&e.updateInput&&c.display.input.reset(e.typing),d&&fb(e.cm);for(b=0;b<a.length;b++){e=a[b];c=e.cm;d=c.display;f=c.doc;e.updatedDisplay&&Q(c,e.update);null==d.wheelStartX||null==e.scrollTop&&
null==e.scrollLeft&&!e.scrollToPos||(d.wheelStartX=d.wheelStartY=null);null==e.scrollTop||d.scroller.scrollTop==e.scrollTop&&!e.forceScroll||(f.scrollTop=Math.max(0,Math.min(d.scroller.scrollHeight-d.scroller.clientHeight,e.scrollTop)),d.scrollbars.setScrollTop(f.scrollTop),d.scroller.scrollTop=f.scrollTop);null==e.scrollLeft||d.scroller.scrollLeft==e.scrollLeft&&!e.forceScroll||(f.scrollLeft=Math.max(0,Math.min(d.scroller.scrollWidth-d.scroller.clientWidth,e.scrollLeft)),d.scrollbars.setScrollLeft(f.scrollLeft),
d.scroller.scrollLeft=f.scrollLeft,D(c));if(e.scrollToPos){var g=void 0,h=O(f,e.scrollToPos.from),g=O(f,e.scrollToPos.to),k=e.scrollToPos.margin;null==k&&(k=0);for(var l=0;5>l;l++){var m=!1,n=Wa(c,h),p=g&&g!=h?Wa(c,g):n,p=Hc(c,Math.min(n.left,p.left),Math.min(n.top,p.top)-k,Math.max(n.left,p.left),Math.max(n.bottom,p.bottom)+k),q=c.doc.scrollTop,t=c.doc.scrollLeft;null!=p.scrollTop&&(Yb(c,p.scrollTop),1<Math.abs(c.doc.scrollTop-q)&&(m=!0));null!=p.scrollLeft&&(Bb(c,p.scrollLeft),1<Math.abs(c.doc.scrollLeft-
t)&&(m=!0));if(!m)break}g=n;e.scrollToPos.isCursor&&c.state.focused&&(ja(c,"scrollCursorIntoView")||(k=c.display,l=k.sizer.getBoundingClientRect(),h=null,0>g.top+l.top?h=!0:g.bottom+l.top>(window.innerHeight||document.documentElement.clientHeight)&&(h=!1),null==h||Hf||(g=H("div","\u200b",null,"position: absolute; top: "+(g.top-k.viewOffset-c.display.lineSpace.offsetTop)+"px; height: "+(g.bottom-g.top+Ma(c)+k.barHeight)+"px; left: "+g.left+"px; width: 2px;"),c.display.lineSpace.appendChild(g),g.scrollIntoView(h),
c.display.lineSpace.removeChild(g))))}h=e.maybeHiddenMarkers;g=e.maybeUnhiddenMarkers;if(h)for(k=0;k<h.length;++k)h[k].lines.length||ia(h[k],"hide");if(g)for(k=0;k<g.length;++k)g[k].lines.length&&ia(g[k],"unhide");d.wrapper.offsetHeight&&(f.scrollTop=c.display.scroller.scrollTop);e.changeObjs&&ia(c,"changes",c,e.changeObjs);e.update&&e.update.finish()}}}function va(a,b){if(a.curOp)return b();yb(a);try{return b()}finally{Ab(a)}}function fa(a,b){return function(){if(a.curOp)return b.apply(a,arguments);
yb(a);try{return b.apply(a,arguments)}finally{Ab(a)}}}function na(a){return function(){if(this.curOp)return a.apply(this,arguments);yb(this);try{return a.apply(this,arguments)}finally{Ab(this)}}}function oa(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);yb(b);try{return a.apply(this,arguments)}finally{Ab(b)}}}function ne(a,b,c){for(var d=this.line=b,e;d=kb(d,!1);)d=d.find(1,!0).line,(e||(e=[])).push(d);this.size=(this.rest=e)?Z(V(this.rest))-c+1:1;this.node=this.text=
null;this.hidden=ib(a,b)}function wc(a,b,c){var d=[],e;for(e=b;e<c;)b=new ne(a.doc,I(a.doc,e),e),e+=b.size,d.push(b);return d}function qa(a,b,c,d){null==b&&(b=a.doc.first);null==c&&(c=a.doc.first+a.doc.size);d||(d=0);var e=a.display;d&&c<e.viewTo&&(null==e.updateLineNumbers||e.updateLineNumbers>b)&&(e.updateLineNumbers=b);a.curOp.viewChanged=!0;if(b>=e.viewTo)bb&&hd(a.doc,b)<e.viewTo&&ab(a);else if(c<=e.viewFrom)bb&&Xd(a.doc,c+d)>e.viewFrom?ab(a):(e.viewFrom+=d,e.viewTo+=d);else if(b<=e.viewFrom&&
c>=e.viewTo)ab(a);else if(b<=e.viewFrom){var f=Ic(a,c,c+d,1);f?(e.view=e.view.slice(f.index),e.viewFrom=f.lineN,e.viewTo+=d):ab(a)}else if(c>=e.viewTo)(f=Ic(a,b,b,-1))?(e.view=e.view.slice(0,f.index),e.viewTo=f.lineN):ab(a);else{var f=Ic(a,b,b,-1),g=Ic(a,c,c+d,1);f&&g?(e.view=e.view.slice(0,f.index).concat(wc(a,f.lineN,g.lineN)).concat(e.view.slice(g.index)),e.viewTo+=d):ab(a)}if(a=e.externalMeasured)c<a.lineN?a.lineN+=d:b<a.lineN+a.size&&(e.externalMeasured=null)}function Xa(a,b,c){a.curOp.viewChanged=
!0;var d=a.display,e=a.display.externalMeasured;e&&b>=e.lineN&&b<e.lineN+e.size&&(d.externalMeasured=null);b<d.viewFrom||b>=d.viewTo||(a=d.view[nb(a,b)],null!=a.node&&(a=a.changes||(a.changes=[]),-1==ma(a,c)&&a.push(c)))}function ab(a){a.display.viewFrom=a.display.viewTo=a.doc.first;a.display.view=[];a.display.viewOffset=0}function nb(a,b){if(b>=a.display.viewTo)return null;b-=a.display.viewFrom;if(0>b)return null;for(var c=a.display.view,d=0;d<c.length;d++)if(b-=c[d].size,0>b)return d}function Ic(a,
b,c,d){var e=nb(a,b),f=a.display.view;if(!bb||c==a.doc.first+a.doc.size)return{index:e,lineN:c};for(var g=0,h=a.display.viewFrom;g<e;g++)h+=f[g].size;if(h!=b){if(0<d){if(e==f.length-1)return null;b=h+f[e].size-b;e++}else b=h-b;c+=b}for(;hd(a.doc,c)!=c;){if(e==(0>d?0:f.length-1))return null;c+=d*f[e-(0>d?1:0)].size;e+=d}return{index:e,lineN:c}}function Wd(a){a=a.display.view;for(var b=0,c=0;c<a.length;c++){var d=a[c];d.hidden||d.node&&!d.changes||++b}return b}function xf(a){function b(){d.activeTouch&&
(e=setTimeout(function(){d.activeTouch=null},1E3),f=d.activeTouch,f.end=+new Date)}function c(a,b){if(null==b.left)return!0;var d=b.left-a.left,e=b.top-a.top;return 400<d*d+e*e}var d=a.display;K(d.scroller,"mousedown",fa(a,If));U&&11>da?K(d.scroller,"dblclick",fa(a,function(b){if(!ja(a,b)){var c=rb(a,b);!c||xd(a,b,"gutterClick",!0)||Ya(a.display,b)||(pa(b),b=a.findWordAt(c),zc(a.doc,b.anchor,b.head))}})):K(d.scroller,"dblclick",function(b){ja(a,b)||pa(b)});yd||K(d.scroller,"contextmenu",function(b){se(a,
b)});var e,f={end:0};K(d.scroller,"touchstart",function(b){var c;if(c=!ja(a,b))1!=b.touches.length?c=!1:(c=b.touches[0],c=1>=c.radiusX&&1>=c.radiusY),c=!c;c&&(clearTimeout(e),c=+new Date,d.activeTouch={start:c,moved:!1,prev:300>=c-f.end?f:null},1==b.touches.length&&(d.activeTouch.left=b.touches[0].pageX,d.activeTouch.top=b.touches[0].pageY))});K(d.scroller,"touchmove",function(){d.activeTouch&&(d.activeTouch.moved=!0)});K(d.scroller,"touchend",function(e){var f=d.activeTouch;if(f&&!Ya(d,e)&&null!=
f.left&&!f.moved&&300>new Date-f.start){var g=a.coordsChar(d.activeTouch,"page"),f=!f.prev||c(f,f.prev)?new aa(g,g):!f.prev.prev||c(f,f.prev.prev)?a.findWordAt(g):new aa(E(g.line,0),O(a.doc,E(g.line+1,0)));a.setSelection(f.anchor,f.head);a.focus();pa(e)}b()});K(d.scroller,"touchcancel",b);K(d.scroller,"scroll",function(){d.scroller.clientHeight&&(Yb(a,d.scroller.scrollTop),Bb(a,d.scroller.scrollLeft,!0),ia(a,"scroll",a))});K(d.scroller,"mousewheel",function(b){te(a,b)});K(d.scroller,"DOMMouseScroll",
function(b){te(a,b)});K(d.wrapper,"scroll",function(){d.wrapper.scrollTop=d.wrapper.scrollLeft=0});d.dragFunctions={enter:function(b){ja(a,b)||Jc(b)},over:function(b){if(!ja(a,b)){var c=rb(a,b);if(c){var d=document.createDocumentFragment();ke(a,c,d);a.display.dragCursor||(a.display.dragCursor=H("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),a.display.lineSpace.insertBefore(a.display.dragCursor,a.display.cursorDiv));wa(a.display.dragCursor,d)}Jc(b)}},start:function(b){if(U&&(!a.state.draggingText||
100>+new Date-ue))Jc(b);else if(!ja(a,b)&&!Ya(a.display,b)&&(b.dataTransfer.setData("Text",a.getSelection()),b.dataTransfer.effectAllowed="copyMove",b.dataTransfer.setDragImage&&!ve)){var c=H("img",null,null,"position: fixed; left: 0; top: 0;");c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";Ja&&(c.width=c.height=1,a.display.wrapper.appendChild(c),c._top=c.offsetTop);b.dataTransfer.setDragImage(c,0,0);Ja&&c.parentNode.removeChild(c)}},drop:fa(a,Jf),leave:function(b){ja(a,
b)||we(a)}};var g=d.input.getField();K(g,"keyup",function(b){xe.call(a,b)});K(g,"keydown",fa(a,ye));K(g,"keypress",fa(a,ze));K(g,"focus",Sb(ed,a));K(g,"blur",Sb(Tb,a))}function Kf(a){var b=a.display;if(b.lastWrapHeight!=b.wrapper.clientHeight||b.lastWrapWidth!=b.wrapper.clientWidth)b.cachedCharWidth=b.cachedTextHeight=b.cachedPaddingH=null,b.scrollbarsClipped=!1,a.setSize()}function Ya(a,b){for(var c=b.target||b.srcElement;c!=a.wrapper;c=c.parentNode)if(!c||1==c.nodeType&&"true"==c.getAttribute("cm-ignore-events")||
c.parentNode==a.sizer&&c!=a.mover)return!0}function rb(a,b,c,d){var e=a.display;if(!c&&"true"==(b.target||b.srcElement).getAttribute("cm-not-content"))return null;var f,g;c=e.lineSpace.getBoundingClientRect();try{f=b.clientX-c.left,g=b.clientY-c.top}catch(h){return null}b=vd(a,f,g);var k;d&&1==b.xRel&&(k=I(a.doc,b.line).text).length==b.ch&&(d=Ia(k,k.length,a.options.tabSize)-k.length,b=E(b.line,Math.max(0,Math.round((f-le(a.display).left)/Vb(a.display))-d)));return b}function If(a){var b=this.display;
if(!(ja(this,a)||b.activeTouch&&b.input.supportsTouch()))if(b.shift=a.shiftKey,Ya(b,a))ka||(b.scroller.draggable=!1,setTimeout(function(){b.scroller.draggable=!0},100));else if(!xd(this,a,"gutterClick",!0)){var c=rb(this,a);window.focus();switch(Ae(a)){case 1:this.state.selectingText?this.state.selectingText(a):c?Lf(this,a,c):(a.target||a.srcElement)==b.scroller&&pa(a);break;case 2:ka&&(this.state.lastMiddleDown=+new Date);c&&zc(this.doc,c);setTimeout(function(){b.input.focus()},20);pa(a);break;case 3:yd?
se(this,a):Mf(this)}}}function Lf(a,b,c){U?setTimeout(Sb(fb,a),0):a.curOp.focus=Oa();var d=+new Date,e;Kc&&Kc.time>d-400&&0==L(Kc.pos,c)?e="triple":Lc&&Lc.time>d-400&&0==L(Lc.pos,c)?(e="double",Kc={time:d,pos:c}):(e="single",Lc={time:d,pos:c});var d=a.doc.sel,f=Fa?b.metaKey:b.ctrlKey,g;a.options.dragDrop&&Nf&&!a.isReadOnly()&&"single"==e&&-1<(g=d.contains(c))&&(0>L((g=d.ranges[g]).from(),c)||0<c.xRel)&&(0<L(g.to(),c)||0>c.xRel)?Of(a,b,c,f):Pf(a,b,c,e,f)}function Of(a,b,c,d){var e=a.display,f=+new Date,
g=fa(a,function(h){ka&&(e.scroller.draggable=!1);a.state.draggingText=!1;Sa(document,"mouseup",g);Sa(e.scroller,"drop",g);10>Math.abs(b.clientX-h.clientX)+Math.abs(b.clientY-h.clientY)&&(pa(h),!d&&+new Date-200<f&&zc(a.doc,c),ka||U&&9==da?setTimeout(function(){document.body.focus();e.input.focus()},20):e.input.focus())});ka&&(e.scroller.draggable=!0);a.state.draggingText=g;e.scroller.dragDrop&&e.scroller.dragDrop();K(document,"mouseup",g);K(e.scroller,"drop",g)}function Pf(a,b,c,d,e){function f(b){if(0!=
L(v,b))if(v=b,"rect"==d){for(var e=[],T=a.options.tabSize,g=Ia(I(l,c.line).text,c.ch,T),h=Ia(I(l,b.line).text,b.ch,T),k=Math.min(g,h),g=Math.max(g,h),h=Math.min(c.line,b.line),Ea=Math.min(a.lastLine(),Math.max(c.line,b.line));h<=Ea;h++){var q=I(l,h).text,ha=Be(q,k,T);k==g?e.push(new aa(E(h,ha),E(h,ha))):q.length>ha&&e.push(new aa(E(h,ha),E(h,Be(q,g,T))))}e.length||e.push(new aa(c,c));la(l,Ha(p.ranges.slice(0,n).concat(e),n),{origin:"*mouse",scroll:!1});a.scrollIntoView(b)}else e=m,T=e.anchor,k=b,
"single"!=d&&(b="double"==d?a.findWordAt(b):new aa(E(b.line,0),O(l,E(b.line+1,0))),0<L(b.anchor,T)?(k=b.head,T=Za(e.from(),b.anchor)):(k=b.anchor,T=eb(e.to(),b.head))),e=p.ranges.slice(0),e[n]=new aa(O(l,T),k),la(l,Ha(e,n),zd)}function g(b){var c=++y,e=rb(a,b,!0,"rect"==d);if(e)if(0!=L(e,v)){a.curOp.focus=Oa();f(e);var T=B(k,l);(e.line>=T.to||e.line<T.from)&&setTimeout(fa(a,function(){y==c&&g(b)}),150)}else{var h=b.clientY<r.top?-20:b.clientY>r.bottom?20:0;h&&setTimeout(fa(a,function(){y==c&&(k.scroller.scrollTop+=
h,g(b))}),50)}}function h(b){a.state.selectingText=!1;y=Infinity;pa(b);k.input.focus();Sa(document,"mousemove",u);Sa(document,"mouseup",A);l.history.lastSelOrigin=null}var k=a.display,l=a.doc;pa(b);var m,n,p=l.sel,q=p.ranges;e&&!b.shiftKey?(n=l.sel.contains(c),m=-1<n?q[n]:new aa(c,c)):(m=l.sel.primary(),n=l.sel.primIndex);if(Qf?b.shiftKey&&b.metaKey:b.altKey)d="rect",e||(m=new aa(c,c)),c=rb(a,b,!0,!0),n=-1;else if("double"==d){var t=a.findWordAt(c);m=a.display.shift||l.extend?cc(l,m,t.anchor,t.head):
t}else"triple"==d?(t=new aa(E(c.line,0),O(l,E(c.line+1,0))),m=a.display.shift||l.extend?cc(l,m,t.anchor,t.head):t):m=cc(l,m,c);e?-1==n?(n=q.length,la(l,Ha(q.concat([m]),n),{scroll:!1,origin:"*mouse"})):1<q.length&&q[n].empty()&&"single"==d&&!b.shiftKey?(la(l,Ha(q.slice(0,n).concat(q.slice(n+1)),0),{scroll:!1,origin:"*mouse"}),p=l.sel):ld(l,n,m,zd):(n=0,la(l,new Ua([m],0),zd),p=l.sel);var v=c,r=k.wrapper.getBoundingClientRect(),y=0,u=fa(a,function(a){Ae(a)?g(a):h(a)}),A=fa(a,h);a.state.selectingText=
A;K(document,"mousemove",u);K(document,"mouseup",A)}function xd(a,b,c,d){try{var e=b.clientX,f=b.clientY}catch(g){return!1}if(e>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;d&&pa(b);d=a.display;var h=d.lineDiv.getBoundingClientRect();if(f>h.bottom||!Ba(a,c))return Ad(b);f-=h.top-d.viewOffset;for(h=0;h<a.options.gutters.length;++h){var k=d.gutters.childNodes[h];if(k&&k.getBoundingClientRect().right>=e)return e=lb(a.doc,f),ia(a,c,a,e,a.options.gutters[h],b),Ad(b)}}function Jf(a){var b=
this;we(b);if(!ja(b,a)&&!Ya(b.display,a)){pa(a);U&&(ue=+new Date);var c=rb(b,a,!0),d=a.dataTransfer.files;if(c&&!b.isReadOnly())if(d&&d.length&&window.FileReader&&window.File){var e=d.length,f=Array(e),g=0;a=function(a,d){if(!b.options.allowDropFileTypes||-1!=ma(b.options.allowDropFileTypes,a.type)){var Aa=new FileReader;Aa.onload=fa(b,function(){var a=Aa.result;/[\x00-\x08\x0e-\x1f]{2}/.test(a)&&(a="");f[d]=a;++g==e&&(c=O(b.doc,c),a={from:c,to:c,text:b.doc.splitLines(f.join(b.doc.lineSeparator())),
origin:"paste"},Cb(b.doc,a),ce(b.doc,Pa(c,sb(a))))});Aa.readAsText(a)}};for(var h=0;h<e;++h)a(d[h],h)}else if(b.state.draggingText&&-1<b.doc.sel.contains(c))b.state.draggingText(a),setTimeout(function(){b.display.input.focus()},20);else try{if(f=a.dataTransfer.getData("Text")){if(b.state.draggingText&&(Fa?!a.altKey:!a.ctrlKey))var k=b.listSelections();Ac(b.doc,Pa(c,c));if(k)for(h=0;h<k.length;++h)Hb(b.doc,"",k[h].anchor,k[h].head,"drag");b.replaceSelection(f,"around","paste");b.display.input.focus()}}catch(l){}}}
function we(a){a.display.dragCursor&&(a.display.lineSpace.removeChild(a.display.dragCursor),a.display.dragCursor=null)}function Yb(a,b){2>Math.abs(a.doc.scrollTop-b)||(a.doc.scrollTop=b,$a||P(a,{top:b}),a.display.scroller.scrollTop!=b&&(a.display.scroller.scrollTop=b),a.display.scrollbars.setScrollTop(b),$a&&P(a),Ub(a,100))}function Bb(a,b,c){(c?b==a.doc.scrollLeft:2>Math.abs(a.doc.scrollLeft-b))||(b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth),a.doc.scrollLeft=b,D(a),
a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbars.setScrollLeft(b))}function te(a,b){var c=Ce(b),d=c.x,c=c.y,e=a.display,f=e.scroller,g=f.scrollWidth>f.clientWidth,h=f.scrollHeight>f.clientHeight;if(d&&g||c&&h){if(c&&Fa&&ka){var g=b.target,k=e.view;a:for(;g!=f;g=g.parentNode)for(var l=0;l<k.length;l++)if(k[l].node==g){a.display.currentWheelTarget=g;break a}}!d||$a||Ja||null==xa?(c&&null!=xa&&(h=c*xa,g=a.doc.scrollTop,k=g+e.wrapper.clientHeight,0>h?g=Math.max(0,
g+h-50):k=Math.min(a.doc.height,k+h+50),P(a,{top:g,bottom:k})),20>Mc&&(null==e.wheelStartX?(e.wheelStartX=f.scrollLeft,e.wheelStartY=f.scrollTop,e.wheelDX=d,e.wheelDY=c,setTimeout(function(){if(null!=e.wheelStartX){var a=f.scrollLeft-e.wheelStartX,b=f.scrollTop-e.wheelStartY,a=b&&e.wheelDY&&b/e.wheelDY||a&&e.wheelDX&&a/e.wheelDX;e.wheelStartX=e.wheelStartY=null;a&&(xa=(xa*Mc+a)/(Mc+1),++Mc)}},200)):(e.wheelDX+=d,e.wheelDY+=c))):(c&&h&&Yb(a,Math.max(0,Math.min(f.scrollTop+c*xa,f.scrollHeight-f.clientHeight))),
Bb(a,Math.max(0,Math.min(f.scrollLeft+d*xa,f.scrollWidth-f.clientWidth))),(!c||c&&h)&&pa(b),e.wheelStartX=null)}}function Nc(a,b,c){if("string"==typeof b&&(b=Oc[b],!b))return!1;a.display.input.ensurePolled();var d=a.display.shift,e=!1;try{a.isReadOnly()&&(a.state.suppressEdits=!0),c&&(a.display.shift=!1),e=b(a)!=De}finally{a.display.shift=d,a.state.suppressEdits=!1}return e}function Rf(a,b,c){for(var d=0;d<a.state.keyMaps.length;d++){var e=hc(b,a.state.keyMaps[d],c,a);if(e)return e}return a.options.extraKeys&&
hc(b,a.options.extraKeys,c,a)||hc(b,a.options.keyMap,c,a)}function Pc(a,b,c,d){var e=a.state.keySeq;if(e){if(Sf(b))return"handled";Tf.set(50,function(){a.state.keySeq==e&&(a.state.keySeq=null,a.display.input.reset())});b=e+" "+b}d=Rf(a,b,d);"multi"==d&&(a.state.keySeq=b);"handled"==d&&ta(a,"keyHandled",a,b,c);if("handled"==d||"multi"==d)pa(c),nd(a);return e&&!d&&/\'$/.test(b)?(pa(c),!0):!!d}function Ee(a,b){var c=Uf(b,!0);return c?b.shiftKey&&!a.state.keySeq?Pc(a,"Shift-"+c,b,function(b){return Nc(a,
b,!0)})||Pc(a,c,b,function(b){if("string"==typeof b?/^go[A-Z]/.test(b):b.motion)return Nc(a,b)}):Pc(a,c,b,function(b){return Nc(a,b)}):!1}function Vf(a,b,c){return Pc(a,"'"+c+"'",b,function(b){return Nc(a,b,!0)})}function ye(a){this.curOp.focus=Oa();if(!ja(this,a)){U&&11>da&&27==a.keyCode&&(a.returnValue=!1);var b=a.keyCode;this.display.shift=16==b||a.shiftKey;var c=Ee(this,a);Ja&&(Bd=c?b:null,!c&&88==b&&!Fe&&(Fa?a.metaKey:a.ctrlKey)&&this.replaceSelection("",null,"cut"));18!=b||/\bCodeMirror-crosshair\b/.test(this.display.lineDiv.className)||
Wf(this)}}function Wf(a){function b(a){18!=a.keyCode&&a.altKey||(Xb(c,"CodeMirror-crosshair"),Sa(document,"keyup",b),Sa(document,"mouseover",b))}var c=a.display.lineDiv;Zb(c,"CodeMirror-crosshair");K(document,"keyup",b);K(document,"mouseover",b)}function xe(a){16==a.keyCode&&(this.doc.sel.shift=!1);ja(this,a)}function ze(a){if(!(Ya(this.display,a)||ja(this,a)||a.ctrlKey&&!a.altKey||Fa&&a.metaKey)){var b=a.keyCode,c=a.charCode;if(Ja&&b==Bd)Bd=null,pa(a);else if(!Ja||a.which&&!(10>a.which)||!Ee(this,
a))if(b=String.fromCharCode(null==c?b:c),!Vf(this,a,b))this.display.input.onKeyPress(a)}}function Mf(a){a.state.delayingBlurEvent=!0;setTimeout(function(){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1,Tb(a))},100)}function ed(a){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1);"nocursor"!=a.options.readOnly&&(a.state.focused||(ia(a,"focus",a),a.state.focused=!0,Zb(a.display.wrapper,"CodeMirror-focused"),a.curOp||a.display.selForContextMenu==a.doc.sel||(a.display.input.reset(),
ka&&setTimeout(function(){a.display.input.reset(!0)},20)),a.display.input.receivedFocus()),nd(a))}function Tb(a){a.state.delayingBlurEvent||(a.state.focused&&(ia(a,"blur",a),a.state.focused=!1,Xb(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||(a.display.shift=!1)},150))}function se(a,b){var c;(c=Ya(a.display,b))||(c=Ba(a,"gutterContextMenu")?xd(a,b,"gutterContextMenu",!1):!1);if(!c&&!ja(a,b,"contextmenu"))a.display.input.onContextMenu(b)}
function Ge(a,b){if(0>L(a,b.from))return a;if(0>=L(a,b.to))return sb(b);var c=a.line+b.text.length-(b.to.line-b.from.line)-1,d=a.ch;a.line==b.to.line&&(d+=sb(b).ch-b.to.ch);return E(c,d)}function Cd(a,b){for(var c=[],d=0;d<a.sel.ranges.length;d++){var e=a.sel.ranges[d];c.push(new aa(Ge(e.anchor,b),Ge(e.head,b)))}return Ha(c,a.sel.primIndex)}function He(a,b,c){return a.line==b.line?E(c.line,a.ch-b.ch+c.ch):E(c.line+(a.line-b.line),a.ch)}function Ie(a,b,c){b={canceled:!1,from:b.from,to:b.to,text:b.text,
origin:b.origin,cancel:function(){this.canceled=!0}};c&&(b.update=function(b,c,d,e){b&&(this.from=O(a,b));c&&(this.to=O(a,c));d&&(this.text=d);void 0!==e&&(this.origin=e)});ia(a,"beforeChange",a,b);a.cm&&ia(a.cm,"beforeChange",a.cm,b);return b.canceled?null:{from:b.from,to:b.to,text:b.text,origin:b.origin}}function Cb(a,b,c){if(a.cm){if(!a.cm.curOp)return fa(a.cm,Cb)(a,b,c);if(a.cm.state.suppressEdits)return}if(Ba(a,"beforeChange")||a.cm&&Ba(a.cm,"beforeChange"))if(b=Ie(a,b,!0),!b)return;if(c=Je&&
!c&&Xf(a,b.from,b.to))for(var d=c.length-1;0<=d;--d)Ke(a,{from:c[d].from,to:c[d].to,text:d?[""]:b.text});else Ke(a,b)}function Ke(a,b){if(1!=b.text.length||""!=b.text[0]||0!=L(b.from,b.to)){var c=Cd(a,b);Le(a,b,c,a.cm?a.cm.curOp.id:NaN);ic(a,b,c,Dd(a,b));var d=[];tb(a,function(a,c){c||-1!=ma(d,a.history)||(Me(a.history,b),d.push(a.history));ic(a,b,null,Dd(a,b))})}}function Qc(a,b,c){if(!a.cm||!a.cm.state.suppressEdits){for(var d=a.history,e,f=a.sel,g="undo"==b?d.done:d.undone,h="undo"==b?d.undone:
d.done,k=0;k<g.length&&(e=g[k],c?!e.ranges||e.equals(a.sel):e.ranges);k++);if(k!=g.length){for(d.lastOrigin=d.lastSelOrigin=null;;)if(e=g.pop(),e.ranges){Bc(e,h);if(c&&!e.equals(a.sel)){la(a,e,{clearRedo:!1});return}f=e}else break;c=[];Bc(f,h);h.push({changes:c,generation:d.generation});d.generation=e.generation||++d.maxGeneration;d=Ba(a,"beforeChange")||a.cm&&Ba(a.cm,"beforeChange");for(k=e.changes.length-1;0<=k;--k){var l=e.changes[k];l.origin=b;if(d&&!Ie(a,l,!1)){g.length=0;break}c.push(Ed(a,l));
f=k?Cd(a,l):V(g);ic(a,l,f,Ne(a,l));!k&&a.cm&&a.cm.scrollIntoView({from:l.from,to:sb(l)});var m=[];tb(a,function(a,b){b||-1!=ma(m,a.history)||(Me(a.history,l),m.push(a.history));ic(a,l,null,Ne(a,l))})}}}}function Oe(a,b){if(0!=b&&(a.first+=b,a.sel=new Ua(xc(a.sel.ranges,function(a){return new aa(E(a.anchor.line+b,a.anchor.ch),E(a.head.line+b,a.head.ch))}),a.sel.primIndex),a.cm)){qa(a.cm,a.first,a.first-b,b);for(var c=a.cm.display,d=c.viewFrom;d<c.viewTo;d++)Xa(a.cm,d,"gutter")}}function ic(a,b,c,d){if(a.cm&&
!a.cm.curOp)return fa(a.cm,ic)(a,b,c,d);if(b.to.line<a.first)Oe(a,b.text.length-1-(b.to.line-b.from.line));else if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var e=b.text.length-1-(a.first-b.from.line);Oe(a,e);b={from:E(a.first,0),to:E(b.to.line+e,b.to.ch),text:[V(b.text)],origin:b.origin}}e=a.lastLine();b.to.line>e&&(b={from:b.from,to:E(e,I(a,e).text.length),text:[b.text[0]],origin:b.origin});b.removed=ob(a,b.from,b.to);c||(c=Cd(a,b));a.cm?Yf(a.cm,b,d):Fd(a,b,d);Ac(a,c,Qa)}}function Yf(a,
b,c){var d=a.doc,g=a.display,h=b.from,k=b.to,l=!1,m=h.line;a.options.lineWrapping||(m=Z(Ra(I(d,h.line))),d.iter(m,k.line+1,function(a){if(a==g.maxLine)return l=!0}));-1<d.sel.contains(b.from,b.to)&&ge(a);Fd(d,b,c,e(a));a.options.lineWrapping||(d.iter(m,h.line+b.text.length,function(a){var b=p(a);b>g.maxLineLength&&(g.maxLine=a,g.maxLineLength=b,g.maxLineChanged=!0,l=!1)}),l&&(a.curOp.updateMaxLine=!0));d.frontier=Math.min(d.frontier,h.line);Ub(a,400);c=b.text.length-(k.line-h.line)-1;b.full?qa(a):
h.line!=k.line||1!=b.text.length||Pe(a.doc,b)?qa(a,h.line,k.line+1,c):Xa(a,h.line,"text");c=Ba(a,"changes");if((d=Ba(a,"change"))||c)b={from:h,to:k,text:b.text,removed:b.removed,origin:b.origin},d&&ta(a,"change",a,b),c&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(b);a.display.selForContextMenu=null}function Hb(a,b,c,d,e){d||(d=c);if(0>L(d,c)){var f=d;d=c;c=f}"string"==typeof b&&(b=a.splitLines(b));Cb(a,{from:c,to:d,text:b,origin:e})}function Hc(a,b,c,d,e){var f=a.display,g=hb(a.display);0>
c&&(c=0);var h=a.curOp&&null!=a.curOp.scrollTop?a.curOp.scrollTop:f.scroller.scrollTop,k=id(a),l={};e-c>k&&(e=c+k);var m=a.doc.height+gd(f),n=c<g,g=e>m-g;c<h?l.scrollTop=n?0:c:e>h+k&&(c=Math.min(c,(g?m:e)-k),c!=h&&(l.scrollTop=c));h=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:f.scroller.scrollLeft;a=mb(a)-(a.options.fixedGutter?f.gutters.offsetWidth:0);(f=d-b>a)&&(d=b+a);10>b?l.scrollLeft=0:b<h?l.scrollLeft=Math.max(0,b-(f?0:10)):d>a+h-3&&(l.scrollLeft=d+(f?0:10)-a);return l}function Rc(a,
b,c){null==b&&null==c||Sc(a);null!=b&&(a.curOp.scrollLeft=(null==a.curOp.scrollLeft?a.doc.scrollLeft:a.curOp.scrollLeft)+b);null!=c&&(a.curOp.scrollTop=(null==a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+c)}function Db(a){Sc(a);var b=a.getCursor(),c=b,d=b;a.options.lineWrapping||(c=b.ch?E(b.line,b.ch-1):b,d=E(b.line,b.ch+1));a.curOp.scrollToPos={from:c,to:d,margin:a.options.cursorScrollMargin,isCursor:!0}}function Sc(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=re(a,b.from),
d=re(a,b.to),b=Hc(a,Math.min(c.left,d.left),Math.min(c.top,d.top)-b.margin,Math.max(c.right,d.right),Math.max(c.bottom,d.bottom)+b.margin);a.scrollTo(b.scrollLeft,b.scrollTop)}}function ac(a,b,c,d){var e=a.doc,f;null==c&&(c="add");"smart"==c&&(e.mode.indent?f=dc(a,b):c="prev");var g=a.options.tabSize,h=I(e,b),k=Ia(h.text,null,g);h.stateAfter&&(h.stateAfter=null);var l=h.text.match(/^\s*/)[0],m;if(!d&&!/\S/.test(h.text))m=0,c="not";else if("smart"==c&&(m=e.mode.indent(f,h.text.slice(l.length),h.text),
m==De||150<m)){if(!d)return;c="prev"}"prev"==c?m=b>e.first?Ia(I(e,b-1).text,null,g):0:"add"==c?m=k+a.options.indentUnit:"subtract"==c?m=k-a.options.indentUnit:"number"==typeof c&&(m=k+c);m=Math.max(0,m);c="";d=0;if(a.options.indentWithTabs)for(a=Math.floor(m/g);a;--a)d+=g,c+="\t";d<m&&(c+=Gd(m-d));if(c!=l)return Hb(e,c,E(b,0),E(b,l.length),"+input"),h.stateAfter=null,!0;for(a=0;a<e.sel.ranges.length;a++)if(g=e.sel.ranges[a],g.head.line==b&&g.head.ch<l.length){d=E(b,l.length);ld(e,a,new aa(d,d));break}}
function Tc(a,b,c,d){var e=b,f=b;"number"==typeof b?f=I(a,Math.max(a.first,Math.min(b,a.first+a.size-1))):e=Z(b);if(null==e)return null;d(f,e)&&a.cm&&Xa(a.cm,e,c);return f}function Ib(a,b){for(var c=a.doc.sel.ranges,d=[],e=0;e<c.length;e++){for(var f=b(c[e]);d.length&&0>=L(f.from,V(d).to);){var g=d.pop();if(0>L(g.from,f.from)){f.from=g.from;break}}d.push(f)}va(a,function(){for(var b=d.length-1;0<=b;b--)Hb(a.doc,"",d[b].from,d[b].to,"+delete");Db(a)})}function Hd(a,b,c,d,e){function f(b){var d=(e?
wd:Qe)(l,h,c,!0);if(null==d){if(b=!b)b=g+c,b<a.first||b>=a.first+a.size?b=!1:(g=b,b=l=I(a,b));if(b)h=e?(0>c?Gc:Fc)(l):0>c?l.text.length:0;else return!1}else h=d;return!0}var g=b.line,h=b.ch,k=c,l=I(a,g);if("char"==d)f();else if("column"==d)f(!0);else if("word"==d||"group"==d){var m=null;d="group"==d;for(var n=a.cm&&a.cm.getHelper(b,"wordChars"),p=!0;!(0>c)||f(!p);p=!1){var q=l.text.charAt(h)||"\n",q=Uc(q,n)?"w":d&&"\n"==q?"n":!d||/\s/.test(q)?null:"p";!d||p||q||(q="s");if(m&&m!=q){0>c&&(c=1,f());
break}q&&(m=q);if(0<c&&!f(!p))break}}k=md(a,E(g,h),b,k,!0);L(b,k)||(k.hitSide=!0);return k}function Re(a,b,c,d){var e=a.doc,f=b.left,g;for("page"==d?g=b.top+c*(Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight)-(0>c?1.5:.5)*hb(a.display)):"line"==d&&(g=0<c?b.bottom+3:b.top-3);;){b=vd(a,f,g);if(!b.outside)break;if(0>c?0>=g:g>=e.height){b.hitSide=!0;break}g+=5*c}return b}function M(a,b,c,e){d.defaults[a]=b;c&&(zb[a]=e?function(a,b,d){d!=Ud&&c(a,b,d)}:
c)}function Zf(a){var b=a.split(/-(?!$)/);a=b[b.length-1];for(var c,d,e,f,g=0;g<b.length-1;g++){var h=b[g];if(/^(cmd|meta|m)$/i.test(h))f=!0;else if(/^a(lt)?$/i.test(h))c=!0;else if(/^(c|ctrl|control)$/i.test(h))d=!0;else if(/^s(hift)$/i.test(h))e=!0;else throw Error("Unrecognized modifier name: "+h);}c&&(a="Alt-"+a);d&&(a="Ctrl-"+a);f&&(a="Cmd-"+a);e&&(a="Shift-"+a);return a}function Vc(a){return"string"==typeof a?db[a]:a}function Jb(a,b,c,d,e){if(d&&d.shared)return $f(a,b,c,d,e);if(a.cm&&!a.cm.curOp)return fa(a.cm,
Jb)(a,b,c,d,e);var f=new ub(a,e);e=L(b,c);d&&Da(d,f,!1);if(0<e||0==e&&!1!==f.clearWhenEmpty)return f;f.replacedWith&&(f.collapsed=!0,f.widgetNode=H("span",[f.replacedWith],"CodeMirror-widget"),d.handleMouseEvents||f.widgetNode.setAttribute("cm-ignore-events","true"),d.insertLeft&&(f.widgetNode.insertLeft=!0));if(f.collapsed){if(Se(a,b.line,b,c,f)||b.line!=c.line&&Se(a,c.line,b,c,f))throw Error("Inserting collapsed marker partially overlapping an existing one");bb=!0}f.addToHistory&&Le(a,{from:b,to:c,
origin:"markText"},a.sel,NaN);var g=b.line,h=a.cm,k;a.iter(g,c.line+1,function(a){h&&f.collapsed&&!h.options.lineWrapping&&Ra(a)==h.display.maxLine&&(k=!0);f.collapsed&&g!=b.line&&La(a,0);var d=new Wc(f,g==b.line?b.ch:null,g==c.line?c.ch:null);a.markedSpans=a.markedSpans?a.markedSpans.concat([d]):[d];d.marker.attachLine(a);++g});f.collapsed&&a.iter(b.line,c.line+1,function(b){ib(a,b)&&La(b,0)});f.clearOnEnter&&K(f,"beforeCursorEnter",function(){f.clear()});f.readOnly&&(Je=!0,(a.history.done.length||
a.history.undone.length)&&a.clearHistory());f.collapsed&&(f.id=++Id,f.atomic=!0);if(h){k&&(h.curOp.updateMaxLine=!0);if(f.collapsed)qa(h,b.line,c.line+1);else if(f.className||f.title||f.startStyle||f.endStyle||f.css)for(d=b.line;d<=c.line;d++)Xa(h,d,"text");f.atomic&&he(h.doc);ta(h,"markerAdded",h,f)}return f}function $f(a,b,c,d,e){d=Da(d);d.shared=!1;var f=[Jb(a,b,c,d,e)],g=f[0],h=d.widgetNode;tb(a,function(a){h&&(d.widgetNode=h.cloneNode(!0));f.push(Jb(a,O(a,b),O(a,c),d,e));for(var Aa=0;Aa<a.linked.length;++Aa)if(a.linked[Aa].isParent)return;
g=V(f)});return new Xc(f,g)}function Te(a){return a.findMarks(E(a.first,0),a.clipPos(E(a.lastLine())),function(a){return a.parent})}function ag(a){for(var b=0;b<a.length;b++){var c=a[b],d=[c.primary.doc];tb(c.primary.doc,function(a){d.push(a)});for(var e=0;e<c.markers.length;e++){var f=c.markers[e];-1==ma(d,f.doc)&&(f.parent=null,c.markers.splice(e--,1))}}}function Wc(a,b,c){this.marker=a;this.from=b;this.to=c}function jc(a,b){if(a)for(var c=0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function Dd(a,
b){if(b.full)return null;var c=bc(a,b.from.line)&&I(a,b.from.line).markedSpans,d=bc(a,b.to.line)&&I(a,b.to.line).markedSpans;if(!c&&!d)return null;var e=b.from.ch,f=b.to.ch,g=0==L(b.from,b.to);if(c)for(var h=0,k;h<c.length;++h){var l=c[h],m=l.marker;if(null==l.from||(m.inclusiveLeft?l.from<=e:l.from<e)||!(l.from!=e||"bookmark"!=m.type||g&&l.marker.insertLeft)){var n=null==l.to||(m.inclusiveRight?l.to>=e:l.to>e);(k||(k=[])).push(new Wc(m,l.from,n?null:l.to))}}c=k;if(d)for(var h=0,p;h<d.length;++h)if(k=
d[h],l=k.marker,null==k.to||(l.inclusiveRight?k.to>=f:k.to>f)||k.from==f&&"bookmark"==l.type&&(!g||k.marker.insertLeft))m=null==k.from||(l.inclusiveLeft?k.from<=f:k.from<f),(p||(p=[])).push(new Wc(l,m?null:k.from-f,null==k.to?null:k.to-f));d=p;g=1==b.text.length;p=V(b.text).length+(g?e:0);if(c)for(f=0;f<c.length;++f)if(h=c[f],null==h.to)(k=jc(d,h.marker),k)?g&&(h.to=null==k.to?null:k.to+p):h.to=e;if(d)for(f=0;f<d.length;++f)h=d[f],null!=h.to&&(h.to+=p),null==h.from?(k=jc(c,h.marker),k||(h.from=p,
g&&(c||(c=[])).push(h))):(h.from+=p,g&&(c||(c=[])).push(h));c&&(c=Ue(c));d&&d!=c&&(d=Ue(d));e=[c];if(!g){var g=b.text.length-2,q;if(0<g&&c)for(f=0;f<c.length;++f)null==c[f].to&&(q||(q=[])).push(new Wc(c[f].marker,null,null));for(f=0;f<g;++f)e.push(q);e.push(d)}return e}function Ue(a){for(var b=0;b<a.length;++b){var c=a[b];null!=c.from&&c.from==c.to&&!1!==c.marker.clearWhenEmpty&&a.splice(b--,1)}return a.length?a:null}function Ne(a,b){var c;if(c=b["spans_"+a.id]){for(var d=0,e=[];d<b.text.length;++d)e.push(bg(c[d]));
c=e}else c=null;d=Dd(a,b);if(!c)return d;if(!d)return c;for(e=0;e<c.length;++e){var f=c[e],g=d[e];if(f&&g){var h=0;a:for(;h<g.length;++h){for(var k=g[h],l=0;l<f.length;++l)if(f[l].marker==k.marker)continue a;f.push(k)}}else g&&(c[e]=g)}return c}function Xf(a,b,c){var d=null;a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||d&&-1!=ma(d,c)||(d||(d=[])).push(c)}});if(!d)return null;a=[{from:b,to:c}];for(b=0;b<d.length;++b){c=
d[b];for(var e=c.find(0),f=0;f<a.length;++f){var g=a[f];if(!(0>L(g.to,e.from)||0<L(g.from,e.to))){var h=[f,1],k=L(g.from,e.from),l=L(g.to,e.to);(0>k||!c.inclusiveLeft&&!k)&&h.push({from:g.from,to:e.from});(0<l||!c.inclusiveRight&&!l)&&h.push({from:e.to,to:g.to});a.splice.apply(a,h);f+=h.length-1}}}return a}function Ve(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function We(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=
b}}function Xe(a,b){var c=a.lines.length-b.lines.length;if(0!=c)return c;var c=a.find(),d=b.find(),e=L(c.from,d.from)||(a.inclusiveLeft?-1:0)-(b.inclusiveLeft?-1:0);return e?-e:(c=L(c.to,d.to)||(a.inclusiveRight?1:0)-(b.inclusiveRight?1:0))?c:b.id-a.id}function kb(a,b){var c=bb&&a.markedSpans,d;if(c)for(var e,f=0;f<c.length;++f)e=c[f],e.marker.collapsed&&null==(b?e.from:e.to)&&(!d||0>Xe(d,e.marker))&&(d=e.marker);return d}function Se(a,b,c,d,e){a=I(a,b);if(a=bb&&a.markedSpans)for(b=0;b<a.length;++b){var f=
a[b];if(f.marker.collapsed){var g=f.marker.find(0),h=L(g.from,c)||(f.marker.inclusiveLeft?-1:0)-(e.inclusiveLeft?-1:0),k=L(g.to,d)||(f.marker.inclusiveRight?1:0)-(e.inclusiveRight?1:0);if(!(0<=h&&0>=k||0>=h&&0<=k)&&(0>=h&&(f.marker.inclusiveRight&&e.inclusiveLeft?0<=L(g.to,c):0<L(g.to,c))||0<=h&&(f.marker.inclusiveRight&&e.inclusiveLeft?0>=L(g.from,d):0>L(g.from,d))))return!0}}}function Ra(a){for(var b;b=kb(a,!0);)a=b.find(-1,!0).line;return a}function hd(a,b){var c=I(a,b),d=Ra(c);return c==d?b:Z(d)}
function Xd(a,b){if(b>a.lastLine())return b;var c=I(a,b),d;if(!ib(a,c))return b;for(;d=kb(c,!1);)c=d.find(1,!0).line;return Z(c)+1}function ib(a,b){var c=bb&&b.markedSpans;if(c)for(var d,e=0;e<c.length;++e)if(d=c[e],d.marker.collapsed&&(null==d.from||!d.marker.widgetNode&&0==d.from&&d.marker.inclusiveLeft&&Jd(a,b,d)))return!0}function Jd(a,b,c){if(null==c.to)return b=c.marker.find(1,!0),Jd(a,b.line,jc(b.line.markedSpans,c.marker));if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var d,
e=0;e<b.markedSpans.length;++e)if(d=b.markedSpans[e],d.marker.collapsed&&!d.marker.widgetNode&&d.from==c.to&&(null==d.to||d.to!=c.from)&&(d.marker.inclusiveLeft||c.marker.inclusiveRight)&&Jd(a,b,d))return!0}function fc(a){if(null!=a.height)return a.height;var b=a.doc.cm;if(!b)return 0;if(!kd(document.body,a.node)){var c="position: relative;";a.coverGutter&&(c+="margin-left: -"+b.display.gutters.offsetWidth+"px;");a.noHScroll&&(c+="width: "+b.display.wrapper.clientWidth+"px;");wa(b.display.measure,
H("div",[a.node],null,c))}return a.height=a.node.parentNode.offsetHeight}function cg(a,b,c,d){var e=new Yc(a,c,d),f=a.cm;f&&e.noHScroll&&(f.display.alignWidgets=!0);Tc(a,b,"widget",function(b){var c=b.widgets||(b.widgets=[]);null==e.insertAt?c.push(e):c.splice(Math.min(c.length-1,Math.max(0,e.insertAt)),0,e);e.line=b;f&&!ib(a,b)&&(c=Na(b)<a.scrollTop,La(b,b.height+fc(e)),c&&Rc(f,null,e.height),f.curOp.forceUpdate=!0);return!0});return e}function Ye(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);
if(!c)break;a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var d=c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:(new RegExp("(?:^|s)"+c[2]+"(?:$|s)")).test(b[d])||(b[d]+=" "+c[2])}return a}function Ze(a,b){if(a.blankLine)return a.blankLine(b);if(a.innerMode){var c=d.innerMode(a,b);if(c.mode.blankLine)return c.mode.blankLine(c.state)}}function Kd(a,b,c,e){for(var f=0;10>f;f++){e&&(e[0]=d.innerMode(a,c).mode);var g=a.token(b,c);if(b.pos>b.start)return g}throw Error("Mode "+a.name+" failed to advance stream.");
}function $e(a,b,c,d){function e(a){return{start:m.start,end:m.pos,string:m.current(),type:h||null,state:a?cb(f.mode,l):l}}var f=a.doc,g=f.mode,h;b=O(f,b);var k=I(f,b.line),l=dc(a,b.line,c),m=new Zc(k.text,a.options.tabSize),n;for(d&&(n=[]);(d||m.pos<b.ch)&&!m.eol();)m.start=m.pos,h=Kd(g,m,l),d&&n.push(e(!0));return d?n:e()}function af(a,b,c,d,e,f,g){var h=c.flattenSpans;null==h&&(h=a.options.flattenSpans);var k=0,l=null,m=new Zc(b,a.options.tabSize),n,p=a.options.addModeClass&&[null];for(""==b&&
Ye(Ze(c,d),f);!m.eol();){m.pos>a.options.maxHighlightLength?(h=!1,g&&od(a,b,d,m.pos),m.pos=b.length,n=null):n=Ye(Kd(c,m,d,p),f);if(p){var q=p[0].name;q&&(n="m-"+(n?q+" "+n:q))}if(!h||l!=n){for(;k<m.start;)k=Math.min(m.start,k+5E4),e(k,l);l=n}m.start=m.pos}for(;k<m.pos;)a=Math.min(m.pos,k+5E4),e(a,l),k=a}function me(a,b,c,d){var e=[a.state.modeGen],f={};af(a,b.text,a.doc.mode,c,function(a,b){e.push(a,b)},f,d);for(c=0;c<a.state.overlays.length;++c){var g=a.state.overlays[c],h=1,k=0;af(a,b.text,g.mode,
!0,function(a,b){for(var c=h;k<a;){var d=e[h];d>a&&e.splice(h,1,a,e[h+1],d);h+=2;k=Math.min(a,d)}if(b)if(g.opaque)e.splice(c,h-c,a,"cm-overlay "+b),h=c+2;else for(;c<h;c+=2)d=e[c+1],e[c+1]=(d?d+" ":"")+"cm-overlay "+b},f)}return{styles:e,classes:f.bgClass||f.textClass?f:null}}function bf(a,b,c){if(!b.styles||b.styles[0]!=a.state.modeGen){var d=dc(a,Z(b)),e=me(a,b,b.text.length>a.options.maxHighlightLength?cb(a.doc.mode,d):d);b.stateAfter=d;b.styles=e.styles;e.classes?b.styleClasses=e.classes:b.styleClasses&&
(b.styleClasses=null);c===a.doc.frontier&&a.doc.frontier++}return b.styles}function od(a,b,c,d){var e=a.doc.mode;a=new Zc(b,a.options.tabSize);a.start=a.pos=d||0;for(""==b&&Ze(e,c);!a.eol();)Kd(e,a,c),a.start=a.pos}function cf(a,b){if(!a||/^\s*$/.test(a))return null;var c=b.addModeClass?dg:eg;return c[a]||(c[a]=a.replace(/\S+/g,"cm-$&"))}function Yd(a,b){var c=H("span",null,null,ka?"padding-right: .1px":null),c={pre:H("pre",[c],"CodeMirror-line"),content:c,col:0,pos:0,cm:a,splitSpaces:(U||ka)&&a.getOption("lineWrapping")};
b.measure={};for(var d=0;d<=(b.rest?b.rest.length:0);d++){var e=d?b.rest[d-1]:b.line,f;c.pos=0;c.addToken=fg;var g;if(null!=Ld)g=Ld;else{g=wa(a.display.measure,document.createTextNode("A\u062eA"));var h=pb(g,0,1).getBoundingClientRect();g=h&&h.left!=h.right?Ld=3>pb(g,1,2).getBoundingClientRect().right-h.right:!1}g&&(f=Ga(e))&&(c.addToken=gg(c.addToken,f));c.map=[];h=b!=a.display.externalMeasured&&Z(e);a:{g=c;var h=bf(a,e,h),k=e.markedSpans,l=e.text,m=0;if(k)for(var n=l.length,p=0,q=1,t="",v=void 0,
r=void 0,y=0,u=void 0,A=void 0,w=void 0,B=void 0,x=void 0;;){if(y==p){for(var u=A=w=B=r="",x=null,y=Infinity,z=[],D,ea=0;ea<k.length;++ea){var C=k[ea],ga=C.marker;"bookmark"==ga.type&&C.from==p&&ga.widgetNode?z.push(ga):C.from<=p&&(null==C.to||C.to>p||ga.collapsed&&C.to==p&&C.from==p)?(null!=C.to&&C.to!=p&&y>C.to&&(y=C.to,A=""),ga.className&&(u+=" "+ga.className),ga.css&&(r=(r?r+";":"")+ga.css),ga.startStyle&&C.from==p&&(w+=" "+ga.startStyle),ga.endStyle&&C.to==y&&(D||(D=[])).push(ga.endStyle,C.to),
ga.title&&!B&&(B=ga.title),ga.collapsed&&(!x||0>Xe(x.marker,ga))&&(x=C)):C.from>p&&y>C.from&&(y=C.from)}if(D)for(ea=0;ea<D.length;ea+=2)D[ea+1]==y&&(A+=" "+D[ea]);if(!x||x.from==p)for(ea=0;ea<z.length;++ea)df(g,0,z[ea]);if(x&&(x.from||0)==p){df(g,(null==x.to?n+1:x.to)-p,x.marker,null==x.from);if(null==x.to)break a;x.to==p&&(x=!1)}}if(p>=n)break;for(z=Math.min(n,y);;){if(t){ea=p+t.length;x||(C=ea>z?t.slice(0,z-p):t,g.addToken(g,C,v?v+u:u,w,p+C.length==y?A:"",B,r));if(ea>=z){t=t.slice(z-p);p=z;break}p=
ea;w=""}t=l.slice(m,m=h[q++]);v=cf(h[q++],g.cm.options)}}else for(var q=1;q<h.length;q+=2)g.addToken(g,l.slice(m,m=h[q]),cf(h[q+1],g.cm.options))}e.styleClasses&&(e.styleClasses.bgClass&&(c.bgClass=Md(e.styleClasses.bgClass,c.bgClass||"")),e.styleClasses.textClass&&(c.textClass=Md(e.styleClasses.textClass,c.textClass||"")));0==c.map.length&&c.map.push(0,0,c.content.appendChild(hg(a.display.measure)));0==d?(b.measure.map=c.map,b.measure.cache={}):((b.measure.maps||(b.measure.maps=[])).push(c.map),
(b.measure.caches||(b.measure.caches=[])).push({}))}ka&&(f=c.content.lastChild,/\bcm-tab\b/.test(f.className)||f.querySelector&&f.querySelector(".cm-tab"))&&(c.content.className="cm-tab-wrap-hack");ia(a,"renderLine",a,b.line,c.pre);c.pre.className&&(c.textClass=Md(c.pre.className,c.textClass||""));return c}function fg(a,b,c,d,e,f,g){if(b){var h=a.splitSpaces?b.replace(/ {3,}/g,ig):b,k=a.cm.state.specialChars,l=!1;if(k.test(b))for(var m=document.createDocumentFragment(),n=0;;){k.lastIndex=n;var p=
k.exec(b),q=p?p.index-n:b.length-n;if(q){var t=document.createTextNode(h.slice(n,n+q));U&&9>da?m.appendChild(H("span",[t])):m.appendChild(t);a.map.push(a.pos,a.pos+q,t);a.col+=q;a.pos+=q}if(!p)break;n+=q+1;"\t"==p[0]?(t=a.cm.options.tabSize,p=t-a.col%t,t=m.appendChild(H("span",Gd(p),"cm-tab")),t.setAttribute("role","presentation"),t.setAttribute("cm-text","\t"),a.col+=p):("\r"==p[0]||"\n"==p[0]?(t=m.appendChild(H("span","\r"==p[0]?"\u240d":"\u2424","cm-invalidchar")),t.setAttribute("cm-text",p[0])):
(t=a.cm.options.specialCharPlaceholder(p[0]),t.setAttribute("cm-text",p[0]),U&&9>da?m.appendChild(H("span",[t])):m.appendChild(t)),a.col+=1);a.map.push(a.pos,a.pos+1,t);a.pos++}else{a.col+=b.length;var m=document.createTextNode(h);a.map.push(a.pos,a.pos+b.length,m);U&&9>da&&(l=!0);a.pos+=b.length}if(c||d||e||l||g)return b=c||"",d&&(b+=d),e&&(b+=e),d=H("span",[m],b,g),f&&(d.title=f),a.content.appendChild(d);a.content.appendChild(m)}}function ig(a){for(var b=" ",c=0;c<a.length-2;++c)b+=c%2?" ":"\u00a0";
return b+" "}function gg(a,b){return function(c,d,e,f,g,h,k){e=e?e+" cm-force-border":"cm-force-border";for(var l=c.pos,m=l+d.length;;){for(var n=0;n<b.length;n++){var p=b[n];if(p.to>l&&p.from<=l)break}if(p.to>=m)return a(c,d,e,f,g,h,k);a(c,d.slice(0,p.to-l),e,f,null,h,k);f=null;d=d.slice(p.to-l);l=p.to}}}function df(a,b,c,d){var e=!d&&c.widgetNode;e&&a.map.push(a.pos,a.pos+b,e);!d&&a.cm.display.input.needsContentAttribute&&(e||(e=a.content.appendChild(document.createElement("span"))),e.setAttribute("cm-marker",
c.id));e&&(a.cm.display.input.setUneditable(e),a.content.appendChild(e));a.pos+=b}function Pe(a,b){return 0==b.from.ch&&0==b.to.ch&&""==V(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function Fd(a,b,c,d){function e(a,c,f){a.text=c;a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null);null!=a.order&&(a.order=null);Ve(a);We(a,f);c=d?d(a):1;c!=a.height&&La(a,c);ta(a,"change",a,b)}function f(a,b){for(var e=a,g=[];e<b;++e)g.push(new kc(k[e],c?c[e]:null,d));return g}var g=b.from,h=b.to,k=
b.text,l=I(a,g.line),m=I(a,h.line),n=V(k),p=c?c[k.length-1]:null,q=h.line-g.line;if(b.full)a.insert(0,f(0,k.length)),a.remove(k.length,a.size-k.length);else if(Pe(a,b)){var t=f(0,k.length-1);e(m,m.text,p);q&&a.remove(g.line,q);t.length&&a.insert(g.line,t)}else l==m?1==k.length?e(l,l.text.slice(0,g.ch)+n+l.text.slice(h.ch),p):(t=f(1,k.length-1),t.push(new kc(n+l.text.slice(h.ch),p,d)),e(l,l.text.slice(0,g.ch)+k[0],c?c[0]:null),a.insert(g.line+1,t)):1==k.length?(e(l,l.text.slice(0,g.ch)+k[0]+m.text.slice(h.ch),
c?c[0]:null),a.remove(g.line+1,q)):(e(l,l.text.slice(0,g.ch)+k[0],c?c[0]:null),e(m,n+m.text.slice(h.ch),p),t=f(1,k.length-1),1<q&&a.remove(g.line+1,q-1),a.insert(g.line+1,t));ta(a,"change",a,b)}function lc(a){this.lines=a;this.parent=null;for(var b=0,c=0;b<a.length;++b)a[b].parent=this,c+=a[b].height;this.height=c}function mc(a){this.children=a;for(var b=0,c=0,d=0;d<a.length;++d){var e=a[d],b=b+e.chunkSize(),c=c+e.height;e.parent=this}this.size=b;this.height=c;this.parent=null}function tb(a,b,c){function d(a,
e,f){if(a.linked)for(var g=0;g<a.linked.length;++g){var Aa=a.linked[g];if(Aa.doc!=e){var h=f&&Aa.sharedHist;if(!c||h)b(Aa.doc,h),d(Aa.doc,a,h)}}}d(a,null,!0)}function Td(b,c){if(c.cm)throw Error("This document is already in use.");b.doc=c;c.cm=b;g(b);a(b);b.options.lineWrapping||r(b);b.options.mode=c.modeOption;qa(b)}function I(a,b){b-=a.first;if(0>b||b>=a.size)throw Error("There is no line "+(b+a.first)+" in the document.");for(var c=a;!c.lines;)for(var d=0;;++d){var e=c.children[d],f=e.chunkSize();
if(b<f){c=e;break}b-=f}return c.lines[b]}function ob(a,b,c){var d=[],e=b.line;a.iter(b.line,c.line+1,function(a){a=a.text;e==c.line&&(a=a.slice(0,c.ch));e==b.line&&(a=a.slice(b.ch));d.push(a);++e});return d}function Nd(a,b,c){var d=[];a.iter(b,c,function(a){d.push(a.text)});return d}function La(a,b){var c=b-a.height;if(c)for(var d=a;d;d=d.parent)d.height+=c}function Z(a){if(null==a.parent)return null;var b=a.parent;a=ma(b.lines,a);for(var c=b.parent;c;b=c,c=c.parent)for(var d=0;c.children[d]!=b;++d)a+=
c.children[d].chunkSize();return a+b.first}function lb(a,b){var c=a.first;a:do{for(var d=0;d<a.children.length;++d){var e=a.children[d],f=e.height;if(b<f){a=e;continue a}b-=f;c+=e.chunkSize()}return c}while(!a.lines);for(d=0;d<a.lines.length;++d){e=a.lines[d].height;if(b<e)break;b-=e}return c+d}function Na(a){a=Ra(a);for(var b=0,c=a.parent,d=0;d<c.lines.length;++d){var e=c.lines[d];if(e==a)break;else b+=e.height}for(a=c.parent;a;c=a,a=c.parent)for(d=0;d<a.children.length&&(e=a.children[d],e!=c);++d)b+=
e.height;return b}function Ga(a){var b=a.order;null==b&&(b=a.order=jg(a.text));return b}function $c(a){this.done=[];this.undone=[];this.undoDepth=Infinity;this.lastModTime=this.lastSelTime=0;this.lastOrigin=this.lastSelOrigin=this.lastOp=this.lastSelOp=null;this.generation=this.maxGeneration=a||1}function Ed(a,b){var c={from:Pb(b.from),to:sb(b),text:ob(a,b.from,b.to)};ef(a,c,b.from.line,b.to.line+1);tb(a,function(a){ef(a,c,b.from.line,b.to.line+1)},!0);return c}function de(a){for(;a.length;)if(V(a).ranges)a.pop();
else break}function Le(a,b,c,d){var e=a.history;e.undone.length=0;var f=+new Date,g,h;if(h=e.lastOp==d||e.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&e.lastModTime>f-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0)))e.lastOp==d?(de(e.done),g=V(e.done)):e.done.length&&!V(e.done).ranges?g=V(e.done):1<e.done.length&&!e.done[e.done.length-2].ranges?(e.done.pop(),g=V(e.done)):g=void 0,h=g;if(h){var k=V(g.changes);0==L(b.from,b.to)&&0==L(b.from,k.to)?k.to=sb(b):g.changes.push(Ed(a,
b))}else for((g=V(e.done))&&g.ranges||Bc(a.sel,e.done),g={changes:[Ed(a,b)],generation:e.generation},e.done.push(g);e.done.length>e.undoDepth;)e.done.shift(),e.done[0].ranges||e.done.shift();e.done.push(c);e.generation=++e.maxGeneration;e.lastModTime=e.lastSelTime=f;e.lastOp=e.lastSelOp=d;e.lastOrigin=e.lastSelOrigin=b.origin;k||ia(a,"historyAdded")}function Bc(a,b){var c=V(b);c&&c.ranges&&c.equals(a)||b.push(a)}function ef(a,b,c,d){var e=b["spans_"+a.id],f=0;a.iter(Math.max(a.first,c),Math.min(a.first+
a.size,d),function(c){c.markedSpans&&((e||(e=b["spans_"+a.id]={}))[f]=c.markedSpans);++f})}function bg(a){if(!a)return null;for(var b=0,c;b<a.length;++b)a[b].marker.explicitlyCleared?c||(c=a.slice(0,b)):c&&c.push(a[b]);return c?c.length?c:null:a}function Kb(a,b,c){for(var d=0,e=[];d<a.length;++d){var f=a[d];if(f.ranges)e.push(c?Ua.prototype.deepCopy.call(f):f);else{var f=f.changes,g=[];e.push({changes:g});for(var h=0;h<f.length;++h){var k=f[h],l;g.push({from:k.from,to:k.to,text:k.text});if(b)for(var m in k)(l=
m.match(/^spans_(\d+)$/))&&-1<ma(b,Number(l[1]))&&(V(g)[m]=k[m],delete k[m])}}}return e}function ff(a,b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)}function gf(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e],g=!0;if(f.ranges){f.copied||(f=a[e]=f.deepCopy(),f.copied=!0);for(var h=0;h<f.ranges.length;h++)ff(f.ranges[h].anchor,b,c,d),ff(f.ranges[h].head,b,c,d)}else{for(h=0;h<f.changes.length;++h){var k=f.changes[h];if(c<k.from.line)k.from=E(k.from.line+d,k.from.ch),k.to=E(k.to.line+d,k.to.ch);
else if(b<=k.to.line){g=!1;break}}g||(a.splice(0,e+1),e=0)}}}function Me(a,b){var c=b.from.line,d=b.to.line,e=b.text.length-(d-c)-1;gf(a.done,c,d,e);gf(a.undone,c,d,e)}function Ad(a){return null!=a.defaultPrevented?a.defaultPrevented:0==a.returnValue}function Ae(a){var b=a.which;null==b&&(a.button&1?b=1:a.button&2?b=3:a.button&4&&(b=2));Fa&&a.ctrlKey&&1==b&&(b=3);return b}function ad(a,b,c){a=a._handlers&&a._handlers[b];return c?a&&0<a.length?a.slice():hf:a||hf}function ta(a,b){function c(a){return function(){a.apply(null,
e)}}var d=ad(a,b,!1);if(d.length){var e=Array.prototype.slice.call(arguments,2),f;Gb?f=Gb.delayedCallbacks:nc?f=nc:(f=nc=[],setTimeout(kg,0));for(var g=0;g<d.length;++g)f.push(c(d[g]))}}function kg(){var a=nc;nc=null;for(var b=0;b<a.length;++b)a[b]()}function ja(a,b,c){"string"==typeof b&&(b={type:b,preventDefault:function(){this.defaultPrevented=!0}});ia(a,c||b.type,a,b);return Ad(b)||b.codemirrorIgnore}function ge(a){var b=a._handlers&&a._handlers.cursorActivity;if(b){a=a.curOp.cursorActivityHandlers||
(a.curOp.cursorActivityHandlers=[]);for(var c=0;c<b.length;++c)-1==ma(a,b[c])&&a.push(b[c])}}function Ba(a,b){return 0<ad(a,b).length}function Lb(a){a.prototype.on=function(a,b){K(this,a,b)};a.prototype.off=function(a,b){Sa(this,a,b)}}function gb(){this.id=null}function Gd(a){for(;bd.length<=a;)bd.push(V(bd)+" ");return bd[a]}function V(a){return a[a.length-1]}function ma(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return c;return-1}function xc(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=b(a[d],d);return c}
function oc(){}function jf(a,b){var c;Object.create?c=Object.create(a):(oc.prototype=a,c=new oc);b&&Da(b,c);return c}function Da(a,b,c){b||(b={});for(var d in a)!a.hasOwnProperty(d)||!1===c&&b.hasOwnProperty(d)||(b[d]=a[d]);return b}function Sb(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function Uc(a,b){return b?-1<b.source.indexOf("\\w")&&kf(a)?!0:b.test(a):kf(a)}function lf(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function ec(a){return 768<=
a.charCodeAt(0)&&lg.test(a)}function H(a,b,c,d){a=document.createElement(a);c&&(a.className=c);d&&(a.style.cssText=d);if("string"==typeof b)a.appendChild(document.createTextNode(b));else if(b)for(c=0;c<b.length;++c)a.appendChild(b[c]);return a}function jb(a){for(var b=a.childNodes.length;0<b;--b)a.removeChild(a.firstChild);return a}function wa(a,b){return jb(a).appendChild(b)}function Oa(){for(var a=document.activeElement;a&&a.root&&a.root.activeElement;)a=a.root.activeElement;return a}function pc(a){return new RegExp("(^|\\s)"+
a+"(?:$|\\s)\\s*")}function Md(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)c[d]&&!pc(c[d]).test(b)&&(b+=" "+c[d]);return b}function mf(a){if(document.body.getElementsByClassName)for(var b=document.body.getElementsByClassName("CodeMirror"),c=0;c<b.length;c++){var d=b[c].CodeMirror;d&&a(d)}}function yf(){var a;K(window,"resize",function(){null==a&&(a=setTimeout(function(){a=null;mf(Kf)},100))});K(window,"blur",function(){mf(Tb)})}function hg(a){if(null==Od){var b=H("span","\u200b");wa(a,H("span",
[b,document.createTextNode("x")]));0!=a.firstChild.offsetHeight&&(Od=1>=b.offsetWidth&&2<b.offsetHeight&&!(U&&8>da))}a=Od?H("span","\u200b"):H("span","\u00a0",null,"display: inline-block; width: 1px; margin-right: -1px");a.setAttribute("cm-text","");return a}function Bf(a,b,c,d){if(!a)return d(b,c,"ltr");for(var e=!1,f=0;f<a.length;++f){var g=a[f];if(g.from<c&&g.to>b||b==c&&g.to==b)d(Math.max(g.from,b),Math.min(g.to,c),1==g.level?"rtl":"ltr"),e=!0}e||d(b,c,"ltr")}function td(a){return a.level%2?a.to:
a.from}function ud(a){return a.level%2?a.from:a.to}function Fc(a){return(a=Ga(a))?td(a[0]):0}function Gc(a){var b=Ga(a);return b?ud(V(b)):a.text.length}function nf(a,b){var c=I(a.doc,b),d=Ra(c);d!=c&&(b=Z(d));d=(c=Ga(d))?c[0].level%2?Gc(d):Fc(d):0;return E(b,d)}function of(a,b){var c=nf(a,b.line),d=I(a.doc,c.line),e=Ga(d);return e&&0!=e[0].level?c:(d=Math.max(0,d.text.search(/\S/)),E(c.line,b.line==c.line&&b.ch<=d&&b.ch?0:d))}function yc(a,b){gc=null;for(var c=0,d;c<a.length;++c){var e=a[c];if(e.from<
b&&e.to>b)return c;if(e.from==b||e.to==b)if(null==d)d=c;else{var f;f=e.level;var g=a[d].level,h=a[0].level;f=f==h?!0:g==h?!1:f<g;if(f)return e.from!=e.to&&(gc=d),c;e.from!=e.to&&(gc=c);break}}return d}function Pd(a,b,c,d){if(!d)return b+c;do b+=c;while(0<b&&ec(a.text.charAt(b)));return b}function wd(a,b,c,d){var e=Ga(a);if(!e)return Qe(a,b,c,d);var f=yc(e,b),g=e[f];for(b=Pd(a,b,g.level%2?-c:c,d);;){if(b>g.from&&b<g.to)return b;if(b==g.from||b==g.to){if(yc(e,b)==f)return b;g=e[f+c];return 0<c==g.level%
2?g.to:g.from}g=e[f+=c];if(!g)return null;b=0<c==g.level%2?Pd(a,g.to,-1,d):Pd(a,g.from,1,d)}}function Qe(a,b,c,d){b+=c;if(d)for(;0<b&&ec(a.text.charAt(b));)b+=c;return 0>b||b>a.text.length?null:b}var ua=navigator.userAgent,pf=navigator.platform,$a=/gecko\/\d/i.test(ua),qf=/MSIE \d/.test(ua),rf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ua),U=qf||rf,da=U&&(qf?document.documentMode||6:rf[1]),ka=/WebKit\//.test(ua),mg=ka&&/Qt\/\d+\.\d+/.test(ua),ng=/Chrome\//.test(ua),Ja=/Opera\//.test(ua),ve=/Apple Computer/.test(navigator.vendor),
og=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(ua),Hf=/PhantomJS/.test(ua),Eb=/AppleWebKit/.test(ua)&&/Mobile\/\w+/.test(ua),Rb=Eb||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(ua),Fa=Eb||/Mac/.test(pf),Qf=/\bCrOS\b/.test(ua),pg=/win/i.test(pf),vb=Ja&&ua.match(/Version\/(\d*\.\d*)/);vb&&(vb=Number(vb[1]));vb&&15<=vb&&(Ja=!1,ka=!0);var sf=Fa&&(mg||Ja&&(null==vb||12.11>vb)),yd=$a||U&&9<=da,Je=!1,bb=!1;x.prototype=Da({update:function(a){var b=a.scrollWidth>a.clientWidth+1,c=a.scrollHeight>
a.clientHeight+1,d=a.nativeBarWidth;c?(this.vert.style.display="block",this.vert.style.bottom=b?d+"px":"0",this.vert.firstChild.style.height=Math.max(0,a.scrollHeight-a.clientHeight+(a.viewHeight-(b?d:0)))+"px"):(this.vert.style.display="",this.vert.firstChild.style.height="0");b?(this.horiz.style.display="block",this.horiz.style.right=c?d+"px":"0",this.horiz.style.left=a.barLeft+"px",this.horiz.firstChild.style.width=a.scrollWidth-a.clientWidth+(a.viewWidth-a.barLeft-(c?d:0))+"px"):(this.horiz.style.display=
"",this.horiz.firstChild.style.width="0");!this.checkedZeroWidth&&0<a.clientHeight&&(0==d&&this.zeroWidthHack(),this.checkedZeroWidth=!0);return{right:c?d:0,bottom:b?d:0}},setScrollLeft:function(a){this.horiz.scrollLeft!=a&&(this.horiz.scrollLeft=a);this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz)},setScrollTop:function(a){this.vert.scrollTop!=a&&(this.vert.scrollTop=a);this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert)},zeroWidthHack:function(){this.horiz.style.height=
this.vert.style.width=Fa&&!og?"12px":"18px";this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none";this.disableHoriz=new gb;this.disableVert=new gb},enableZeroWidthBar:function(a,b){function c(){var d=a.getBoundingClientRect();document.elementFromPoint(d.left+1,d.bottom-1)!=a?a.style.pointerEvents="none":b.set(1E3,c)}a.style.pointerEvents="auto";b.set(1E3,c)},clear:function(){var a=this.horiz.parentNode;a.removeChild(this.horiz);a.removeChild(this.vert)}},x.prototype);v.prototype=Da({update:function(){return{bottom:0,
right:0}},setScrollLeft:function(){},setScrollTop:function(){},clear:function(){}},v.prototype);d.scrollbarModel={"native":x,"null":v};F.prototype.signal=function(a,b){Ba(a,b)&&this.events.push(arguments)};F.prototype.finish=function(){for(var a=0;a<this.events.length;a++)ia.apply(null,this.events[a])};var E=d.Pos=function(a,b){if(!(this instanceof E))return new E(a,b);this.line=a;this.ch=b},L=d.cmpPos=function(a,b){return a.line-b.line||a.ch-b.ch},ra=null;cd.prototype=Da({init:function(a){function b(a){if(!ja(d,
a)){if(d.somethingSelected())ra={lineWise:!1,text:d.getSelections()},c.inaccurateSelection&&(c.prevInput="",c.inaccurateSelection=!1,f.value=ra.text.join("\n"),Mb(f));else if(d.options.lineWiseCopyCut){var e=ea(d);ra={lineWise:!0,text:e.text};"cut"==a.type?d.setSelections(e.ranges,null,Qa):(c.prevInput="",f.value=e.text.join("\n"),Mb(f))}else return;"cut"==a.type&&(d.state.cutIncoming=!0)}}var c=this,d=this.cm,e=this.wrapper=Qd(),f=this.textarea=e.firstChild;a.wrapper.insertBefore(e,a.wrapper.firstChild);
Eb&&(f.style.width="0px");K(f,"input",function(){U&&9<=da&&c.hasSelection&&(c.hasSelection=null);c.poll()});K(f,"paste",function(a){ja(d,a)||uc(a,d)||(d.state.pasteIncoming=!0,c.fastPoll())});K(f,"cut",b);K(f,"copy",b);K(a.scroller,"paste",function(b){Ya(a,b)||ja(d,b)||(d.state.pasteIncoming=!0,c.focus())});K(a.lineSpace,"selectstart",function(b){Ya(a,b)||pa(b)});K(f,"compositionstart",function(){var a=d.getCursor("from");c.composing&&c.composing.range.clear();c.composing={start:a,range:d.markText(a,
d.getCursor("to"),{className:"CodeMirror-composing"})}});K(f,"compositionend",function(){c.composing&&(c.poll(),c.composing.range.clear(),c.composing=null)})},prepareSelection:function(){var a=this.cm,b=a.display,c=a.doc,d=je(a);if(a.options.moveInputWithCursor){var a=Wa(a,c.sel.primary().head,"div"),c=b.wrapper.getBoundingClientRect(),e=b.lineDiv.getBoundingClientRect();d.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,a.top+e.top-c.top));d.teLeft=Math.max(0,Math.min(b.wrapper.clientWidth-10,
a.left+e.left-c.left))}return d},showSelection:function(a){var b=this.cm.display;wa(b.cursorDiv,a.cursors);wa(b.selectionDiv,a.selection);null!=a.teTop&&(this.wrapper.style.top=a.teTop+"px",this.wrapper.style.left=a.teLeft+"px")},reset:function(a){if(!this.contextMenuPending){var b,c,d=this.cm,e=d.doc;d.somethingSelected()?(this.prevInput="",b=e.sel.primary(),c=(b=Fe&&(100<b.to().line-b.from().line||1E3<(c=d.getSelection()).length))?"-":c||d.getSelection(),this.textarea.value=c,d.state.focused&&Mb(this.textarea),
U&&9<=da&&(this.hasSelection=c)):a||(this.prevInput=this.textarea.value="",U&&9<=da&&(this.hasSelection=null));this.inaccurateSelection=b}},getField:function(){return this.textarea},supportsTouch:function(){return!1},focus:function(){if("nocursor"!=this.cm.options.readOnly&&(!Rb||Oa()!=this.textarea))try{this.textarea.focus()}catch(a){}},blur:function(){this.textarea.blur()},resetPosition:function(){this.wrapper.style.top=this.wrapper.style.left=0},receivedFocus:function(){this.slowPoll()},slowPoll:function(){var a=
this;a.pollingFast||a.polling.set(this.cm.options.pollInterval,function(){a.poll();a.cm.state.focused&&a.slowPoll()})},fastPoll:function(){function a(){c.poll()||b?(c.pollingFast=!1,c.slowPoll()):(b=!0,c.polling.set(60,a))}var b=!1,c=this;c.pollingFast=!0;c.polling.set(20,a)},poll:function(){var a=this.cm,b=this.textarea,c=this.prevInput;if(this.contextMenuPending||!a.state.focused||qg(b)&&!c&&!this.composing||a.isReadOnly()||a.options.disableInput||a.state.keySeq)return!1;var d=b.value;if(d==c&&
!a.somethingSelected())return!1;if(U&&9<=da&&this.hasSelection===d||Fa&&/[\uf700-\uf7ff]/.test(d))return a.display.input.reset(),!1;if(a.doc.sel==a.display.selForContextMenu){var e=d.charCodeAt(0);8203!=e||c||(c="\u200b");if(8666==e)return this.reset(),this.cm.execCommand("undo")}for(var f=0,e=Math.min(c.length,d.length);f<e&&c.charCodeAt(f)==d.charCodeAt(f);)++f;var g=this;va(a,function(){Ka(a,d.slice(f),c.length-f,null,g.composing?"*compose":null);1E3<d.length||-1<d.indexOf("\n")?b.value=g.prevInput=
"":g.prevInput=d;g.composing&&(g.composing.range.clear(),g.composing.range=a.markText(g.composing.start,a.getCursor("to"),{className:"CodeMirror-composing"}))});return!0},ensurePolled:function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},onKeyPress:function(){U&&9<=da&&(this.hasSelection=null);this.fastPoll()},onContextMenu:function(a){function b(){if(null!=g.selectionStart){var a=e.somethingSelected(),c="\u200b"+(a?g.value:"");g.value="\u21da";g.value=c;d.prevInput=a?"":"\u200b";g.selectionStart=
1;g.selectionEnd=c.length;f.selForContextMenu=e.doc.sel}}function c(){d.contextMenuPending=!1;d.wrapper.style.cssText=m;g.style.cssText=l;U&&9>da&&f.scrollbars.setScrollTop(f.scroller.scrollTop=k);if(null!=g.selectionStart){(!U||U&&9>da)&&b();var a=0,h=function(){f.selForContextMenu==e.doc.sel&&0==g.selectionStart&&0<g.selectionEnd&&"\u200b"==d.prevInput?fa(e,Oc.selectAll)(e):10>a++?f.detectingSelectAll=setTimeout(h,500):f.input.reset()};f.detectingSelectAll=setTimeout(h,200)}}var d=this,e=d.cm,f=
e.display,g=d.textarea,h=rb(e,a),k=f.scroller.scrollTop;if(h&&!Ja){e.options.resetSelectionOnContextMenu&&-1==e.doc.sel.contains(h)&&fa(e,la)(e.doc,Pa(h),Qa);var l=g.style.cssText,m=d.wrapper.style.cssText;d.wrapper.style.cssText="position: absolute";h=d.wrapper.getBoundingClientRect();g.style.cssText="position: absolute; width: 30px; height: 30px; top: "+(a.clientY-h.top-5)+"px; left: "+(a.clientX-h.left-5)+"px; z-index: 1000; background: "+(U?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";
if(ka)var n=window.scrollY;f.input.focus();ka&&window.scrollTo(null,n);f.input.reset();e.somethingSelected()||(g.value=d.prevInput=" ");d.contextMenuPending=!0;f.selForContextMenu=e.doc.sel;clearTimeout(f.detectingSelectAll);U&&9<=da&&b();if(yd){Jc(a);var p=function(){Sa(window,"mouseup",p);setTimeout(c,20)};K(window,"mouseup",p)}else setTimeout(c,50)}},readOnlyChanged:function(a){a||this.reset()},setUneditable:oc,needsContentAttribute:!1},cd.prototype);dd.prototype=Da({init:function(a){function b(a){if(!ja(d,
a)){if(d.somethingSelected())ra={lineWise:!1,text:d.getSelections()},"cut"==a.type&&d.replaceSelection("",null,"cut");else if(d.options.lineWiseCopyCut){var c=ea(d);ra={lineWise:!0,text:c.text};"cut"==a.type&&d.operation(function(){d.setSelections(c.ranges,0,Qa);d.replaceSelection("",null,"cut")})}else return;if(a.clipboardData&&!Eb)a.preventDefault(),a.clipboardData.clearData(),a.clipboardData.setData("text/plain",ra.text.join("\n"));else{var e=Qd();a=e.firstChild;d.display.lineSpace.insertBefore(e,
d.display.lineSpace.firstChild);a.value=ra.text.join("\n");var f=document.activeElement;Mb(a);setTimeout(function(){d.display.lineSpace.removeChild(e);f.focus()},50)}}}var c=this,d=c.cm;a=c.div=a.lineDiv;ga(a);K(a,"paste",function(a){ja(d,a)||uc(a,d)});K(a,"compositionstart",function(a){a=a.data;c.composing={sel:d.doc.sel,data:a,startData:a};if(a){var b=d.doc.sel.primary(),e=d.getLine(b.head.line).indexOf(a,Math.max(0,b.head.ch-a.length));-1<e&&e<=b.head.ch&&(c.composing.sel=Pa(E(b.head.line,e),E(b.head.line,
e+a.length)))}});K(a,"compositionupdate",function(a){c.composing.data=a.data});K(a,"compositionend",function(a){var b=c.composing;b&&(a.data==b.startData||/\u200b/.test(a.data)||(b.data=a.data),setTimeout(function(){b.handled||c.applyComposition(b);c.composing==b&&(c.composing=null)},50))});K(a,"touchstart",function(){c.forceCompositionEnd()});K(a,"input",function(){c.composing||!d.isReadOnly()&&c.pollContent()||va(c.cm,function(){qa(d)})});K(a,"copy",b);K(a,"cut",b)},prepareSelection:function(){var a=
je(this.cm,!1);a.focus=this.cm.state.focused;return a},showSelection:function(a,b){a&&this.cm.display.view.length&&((a.focus||b)&&this.showPrimarySelection(),this.showMultipleSelections(a))},showPrimarySelection:function(){var a=window.getSelection(),b=this.cm.doc.sel.primary(),c=vc(this.cm,a.anchorNode,a.anchorOffset),d=vc(this.cm,a.focusNode,a.focusOffset);if(!c||c.bad||!d||d.bad||0!=L(Za(c,d),b.from())||0!=L(eb(c,d),b.to()))if(c=Rd(this.cm,b.from()),d=Rd(this.cm,b.to()),c||d){var e=this.cm.display.view,
b=a.rangeCount&&a.getRangeAt(0);c?d||(d=e[e.length-1].measure,d=d.maps?d.maps[d.maps.length-1]:d.map,d={node:d[d.length-1],offset:d[d.length-2]-d[d.length-3]}):c={node:e[0].measure.map[2],offset:0};try{var f=pb(c.node,c.offset,d.offset,d.node)}catch(g){}f&&(!$a&&this.cm.state.focused?(a.collapse(c.node,c.offset),f.collapsed||a.addRange(f)):(a.removeAllRanges(),a.addRange(f)),b&&null==a.anchorNode?a.addRange(b):$a&&this.startGracePeriod());this.rememberSelection()}},startGracePeriod:function(){var a=
this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){a.gracePeriod=!1;a.selectionChanged()&&a.cm.operation(function(){a.cm.curOp.selectionChanged=!0})},20)},showMultipleSelections:function(a){wa(this.cm.display.cursorDiv,a.cursors);wa(this.cm.display.selectionDiv,a.selection)},rememberSelection:function(){var a=window.getSelection();this.lastAnchorNode=a.anchorNode;this.lastAnchorOffset=a.anchorOffset;this.lastFocusNode=a.focusNode;this.lastFocusOffset=a.focusOffset},selectionInEditor:function(){var a=
window.getSelection();if(!a.rangeCount)return!1;a=a.getRangeAt(0).commonAncestorContainer;return kd(this.div,a)},focus:function(){"nocursor"!=this.cm.options.readOnly&&this.div.focus()},blur:function(){this.div.blur()},getField:function(){return this.div},supportsTouch:function(){return!0},receivedFocus:function(){function a(){b.cm.state.focused&&(b.pollSelection(),b.polling.set(b.cm.options.pollInterval,a))}var b=this;this.selectionInEditor()?this.pollSelection():va(this.cm,function(){b.cm.curOp.selectionChanged=
!0});this.polling.set(this.cm.options.pollInterval,a)},selectionChanged:function(){var a=window.getSelection();return a.anchorNode!=this.lastAnchorNode||a.anchorOffset!=this.lastAnchorOffset||a.focusNode!=this.lastFocusNode||a.focusOffset!=this.lastFocusOffset},pollSelection:function(){if(!this.composing&&!this.gracePeriod&&this.selectionChanged()){var a=window.getSelection(),b=this.cm;this.rememberSelection();var c=vc(b,a.anchorNode,a.anchorOffset),d=vc(b,a.focusNode,a.focusOffset);c&&d&&va(b,function(){la(b.doc,
Pa(c,d),Qa);if(c.bad||d.bad)b.curOp.selectionChanged=!0})}},pollContent:function(){var a=this.cm,b=a.display,c=a.doc.sel.primary(),d=c.from(),c=c.to();if(d.line<b.viewFrom||c.line>b.viewTo-1)return!1;var e;d.line==b.viewFrom||0==(e=nb(a,d.line))?(d=Z(b.view[0].line),e=b.view[0].node):(d=Z(b.view[e].line),e=b.view[e-1].node.nextSibling);var f=nb(a,c.line);f==b.view.length-1?(c=b.viewTo-1,b=b.lineDiv.lastChild):(c=Z(b.view[f+1].line)-1,b=b.view[f+1].node.previousSibling);b=a.doc.splitLines(vf(a,e,b,
d,c));for(e=ob(a.doc,E(d,0),E(c,I(a.doc,c).text.length));1<b.length&&1<e.length;)if(V(b)==V(e))b.pop(),e.pop(),c--;else if(b[0]==e[0])b.shift(),e.shift(),d++;else break;for(var g=0,f=0,h=b[0],k=e[0],l=Math.min(h.length,k.length);g<l&&h.charCodeAt(g)==k.charCodeAt(g);)++g;h=V(b);k=V(e);for(l=Math.min(h.length-(1==b.length?g:0),k.length-(1==e.length?g:0));f<l&&h.charCodeAt(h.length-f-1)==k.charCodeAt(k.length-f-1);)++f;b[b.length-1]=h.slice(0,h.length-f);b[0]=b[0].slice(g);d=E(d,g);c=E(c,e.length?V(e).length-
f:0);if(1<b.length||b[0]||L(d,c))return Hb(a.doc,b,d,c,"+input"),!0},ensurePolled:function(){this.forceCompositionEnd()},reset:function(){this.forceCompositionEnd()},forceCompositionEnd:function(){this.composing&&!this.composing.handled&&(this.applyComposition(this.composing),this.composing.handled=!0,this.div.blur(),this.div.focus())},applyComposition:function(a){this.cm.isReadOnly()?fa(this.cm,qa)(this.cm):a.data&&a.data!=a.startData&&fa(this.cm,Ka)(this.cm,a.data,0,a.sel)},setUneditable:function(a){a.contentEditable=
"false"},onKeyPress:function(a){a.preventDefault();this.cm.isReadOnly()||fa(this.cm,Ka)(this.cm,String.fromCharCode(null==a.charCode?a.keyCode:a.charCode),0)},readOnlyChanged:function(a){this.div.contentEditable=String("nocursor"!=a)},onContextMenu:oc,resetPosition:oc,needsContentAttribute:!0},dd.prototype);d.inputStyles={textarea:cd,contenteditable:dd};Ua.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=
this.ranges.length)return!1;for(var b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=a.ranges[b];if(0!=L(c.anchor,d.anchor)||0!=L(c.head,d.head))return!1}return!0},deepCopy:function(){for(var a=[],b=0;b<this.ranges.length;b++)a[b]=new aa(Pb(this.ranges[b].anchor),Pb(this.ranges[b].head));return new Ua(a,this.primIndex)},somethingSelected:function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1},contains:function(a,b){b||(b=a);for(var c=0;c<this.ranges.length;c++){var d=
this.ranges[c];if(0<=L(b,d.from())&&0>=L(a,d.to()))return c}return-1}};aa.prototype={from:function(){return Za(this.anchor,this.head)},to:function(){return eb(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var qd={left:0,right:0,top:0,bottom:0},qb,Gb=null,Gf=0,Lc,Kc,ue=0,Mc=0,xa=null;U?xa=-.53:$a?xa=15:ng?xa=-.7:ve&&(xa=-1/3);var Ce=function(a){var b=a.wheelDeltaX,c=a.wheelDeltaY;null==b&&a.detail&&a.axis==a.HORIZONTAL_AXIS&&(b=a.detail);
null==c&&a.detail&&a.axis==a.VERTICAL_AXIS?c=a.detail:null==c&&(c=a.wheelDelta);return{x:b,y:c}};d.wheelEventPixels=function(a){a=Ce(a);a.x*=xa;a.y*=xa;return a};var Tf=new gb,Bd=null,sb=d.changeEnd=function(a){return a.text?E(a.from.line+a.text.length-1,V(a.text).length+(1==a.text.length?a.from.ch:0)):a.to};d.prototype={constructor:d,focus:function(){window.focus();this.display.input.focus()},setOption:function(a,b){var c=this.options,d=c[a];if(c[a]!=b||"mode"==a)c[a]=b,zb.hasOwnProperty(a)&&fa(this,
zb[a])(this,b,d)},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](Vc(a))},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==a||b[c].name==a)return b.splice(c,1),!0},addOverlay:na(function(a,b){var c=a.token?a:d.getMode(this.options,a);if(c.startState)throw Error("Overlays may not be stateful.");this.state.overlays.push({mode:c,modeSpec:a,opaque:b&&b.opaque});this.state.modeGen++;
qa(this)}),removeOverlay:na(function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var d=b[c].modeSpec;if(d==a||"string"==typeof a&&d.name==a){b.splice(c,1);this.state.modeGen++;qa(this);break}}}),indentLine:na(function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract");bc(this.doc,a)&&ac(this,a,b,c)}),indentSelection:na(function(a){for(var b=this.doc.sel.ranges,c=-1,d=0;d<b.length;d++){var e=b[d];if(e.empty())e.head.line>c&&
(ac(this,e.head.line,a,!0),c=e.head.line,d==this.doc.sel.primIndex&&Db(this));else{for(var f=e.from(),e=e.to(),g=Math.max(c,f.line),c=Math.min(this.lastLine(),e.line-(e.ch?0:1))+1,e=g;e<c;++e)ac(this,e,a);e=this.doc.sel.ranges;0==f.ch&&b.length==e.length&&0<e[d].from().ch&&ld(this.doc,d,new aa(f,e[d].to()),Qa)}}}),getTokenAt:function(a,b){return $e(this,a,b)},getLineTokens:function(a,b){return $e(this,E(a),b,!0)},getTokenTypeAt:function(a){a=O(this.doc,a);var b=bf(this,I(this.doc,a.line)),c=0,d=(b.length-
1)/2;a=a.ch;if(0==a)b=b[2];else for(;;){var e=c+d>>1;if((e?b[2*e-1]:0)>=a)d=e;else if(b[2*e+1]<a)c=e+1;else{b=b[2*e+2];break}}c=b?b.indexOf("cm-overlay "):-1;return 0>c?b:0==c?null:b.slice(0,c-1)},getModeAt:function(a){var b=this.doc.mode;return b.innerMode?d.innerMode(b,this.getTokenAt(a).state).mode:b},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var c=[];if(!Nb.hasOwnProperty(b))return c;var d=Nb[b],e=this.getModeAt(a);if("string"==typeof e[b])d[e[b]]&&c.push(d[e[b]]);
else if(e[b])for(var f=0;f<e[b].length;f++){var g=d[e[b][f]];g&&c.push(g)}else e.helperType&&d[e.helperType]?c.push(d[e.helperType]):d[e.name]&&c.push(d[e.name]);for(f=0;f<d._global.length;f++)g=d._global[f],g.pred(e,this)&&-1==ma(c,g.val)&&c.push(g.val);return c},getStateAfter:function(a,b){var c=this.doc;a=Math.max(c.first,Math.min(null==a?c.first+c.size-1:a,c.first+c.size-1));return dc(this,a+1,b)},cursorCoords:function(a,b){var c;c=this.doc.sel.primary();c=null==a?c.head:"object"==typeof a?O(this.doc,
a):a?c.from():c.to();return Wa(this,c,b||"page")},charCoords:function(a,b){return Cc(this,O(this.doc,a),b||"page")},coordsChar:function(a,b){a=qe(this,a,b||"page");return vd(this,a.left,a.top)},lineAtHeight:function(a,b){a=qe(this,{top:a,left:0},b||"page").top;return lb(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b){var c=!1,d;"number"==typeof a?(d=this.doc.first+this.doc.size-1,a<this.doc.first?a=this.doc.first:a>d&&(a=d,c=!0),d=I(this.doc,a)):d=a;return sd(this,d,{top:0,left:0},
b||"page").top+(c?this.doc.height-Na(d):0)},defaultTextHeight:function(){return hb(this.display)},defaultCharWidth:function(){return Vb(this.display)},setGutterMarker:na(function(a,b,c){return Tc(this.doc,a,"gutter",function(a){var d=a.gutterMarkers||(a.gutterMarkers={});d[b]=c;!c&&lf(d)&&(a.gutterMarkers=null);return!0})}),clearGutter:na(function(a){var b=this,c=b.doc,d=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&(c.gutterMarkers[a]=null,Xa(b,d,"gutter"),lf(c.gutterMarkers)&&
(c.gutterMarkers=null));++d})}),lineInfo:function(a){if("number"==typeof a){if(!bc(this.doc,a))return null;var b=a;a=I(this.doc,a);if(!a)return null}else if(b=Z(a),null==b)return null;return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,d,e){var f=this.display;a=Wa(this,O(this.doc,a));var g=a.bottom,
h=a.left;b.style.position="absolute";b.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(b);f.sizer.appendChild(b);if("over"==d)g=a.top;else if("above"==d||"near"==d){var k=Math.max(f.wrapper.clientHeight,this.doc.height),l=Math.max(f.sizer.clientWidth,f.lineSpace.clientWidth);("above"==d||a.bottom+b.offsetHeight>k)&&a.top>b.offsetHeight?g=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=k&&(g=a.bottom);h+b.offsetWidth>l&&(h=l-b.offsetWidth)}b.style.top=g+"px";b.style.left=b.style.right=
"";"right"==e?(h=f.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==e?h=0:"middle"==e&&(h=(f.sizer.clientWidth-b.offsetWidth)/2),b.style.left=h+"px");c&&(a=Hc(this,h,g,h+b.offsetWidth,g+b.offsetHeight),null!=a.scrollTop&&Yb(this,a.scrollTop),null!=a.scrollLeft&&Bb(this,a.scrollLeft))},triggerOnKeyDown:na(ye),triggerOnKeyPress:na(ze),triggerOnKeyUp:xe,execCommand:function(a){if(Oc.hasOwnProperty(a))return Oc[a].call(null,this)},triggerElectric:na(function(a){Qb(this,a)}),findPosH:function(a,
b,c,d){var e=1;0>b&&(e=-1,b=-b);var f=0;for(a=O(this.doc,a);f<b&&(a=Hd(this.doc,a,e,c,d),!a.hitSide);++f);return a},moveH:na(function(a,b){var c=this;c.extendSelectionsBy(function(d){return c.display.shift||c.doc.extend||d.empty()?Hd(c.doc,d.head,a,b,c.options.rtlMoveVisually):0>a?d.from():d.to()},qc)}),deleteH:na(function(a,b){var c=this.doc;this.doc.sel.somethingSelected()?c.replaceSelection("",null,"+delete"):Ib(this,function(d){var e=Hd(c,d.head,a,b,!1);return 0>a?{from:e,to:d.head}:{from:d.head,
to:e}})}),findPosV:function(a,b,c,d){var e=1;0>b&&(e=-1,b=-b);var f=0;for(a=O(this.doc,a);f<b&&(a=Wa(this,a,"div"),null==d?d=a.left:a.left=d,a=Re(this,a,e,c),!a.hitSide);++f);return a},moveV:na(function(a,b){var c=this,d=this.doc,e=[],f=!c.display.shift&&!d.extend&&d.sel.somethingSelected();d.extendSelectionsBy(function(g){if(f)return 0>a?g.from():g.to();var h=Wa(c,g.head,"div");null!=g.goalColumn&&(h.left=g.goalColumn);e.push(h.left);var k=Re(c,h,a,b);"page"==b&&g==d.sel.primary()&&Rc(c,null,Cc(c,
k,"div").top-h.top);return k},qc);if(e.length)for(var g=0;g<d.sel.ranges.length;g++)d.sel.ranges[g].goalColumn=e[g]}),findWordAt:function(a){var b=I(this.doc,a.line).text,c=a.ch,d=a.ch;if(b){var e=this.getHelper(a,"wordChars");(0>a.xRel||d==b.length)&&c?--c:++d;for(var f=b.charAt(c),f=Uc(f,e)?function(a){return Uc(a,e)}:/\s/.test(f)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!Uc(a)};0<c&&f(b.charAt(c-1));)--c;for(;d<b.length&&f(b.charAt(d));)++d}return new aa(E(a.line,c),E(a.line,
d))},toggleOverwrite:function(a){if(null==a||a!=this.state.overwrite)(this.state.overwrite=!this.state.overwrite)?Zb(this.display.cursorDiv,"CodeMirror-overwrite"):Xb(this.display.cursorDiv,"CodeMirror-overwrite"),ia(this,"overwriteToggle",this,this.state.overwrite)},hasFocus:function(){return this.display.input.getField()==Oa()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:na(function(a,b){null==a&&null==b||Sc(this);null!=a&&(this.curOp.scrollLeft=a);null!=
b&&(this.curOp.scrollTop=b)}),getScrollInfo:function(){var a=this.display.scroller;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-Ma(this)-this.display.barHeight,width:a.scrollWidth-Ma(this)-this.display.barWidth,clientHeight:id(this),clientWidth:mb(this)}},scrollIntoView:na(function(a,b){null==a?(a={from:this.doc.sel.primary().head,to:null},null==b&&(b=this.options.cursorScrollMargin)):"number"==typeof a?a={from:E(a,0),to:null}:null==a.from&&(a={from:a,to:null});a.to||(a.to=a.from);
a.margin=b||0;if(null!=a.from.line)Sc(this),this.curOp.scrollToPos=a;else{var c=Hc(this,Math.min(a.from.left,a.to.left),Math.min(a.from.top,a.to.top)-a.margin,Math.max(a.from.right,a.to.right),Math.max(a.from.bottom,a.to.bottom)+a.margin);this.scrollTo(c.scrollLeft,c.scrollTop)}}),setSize:na(function(a,b){function c(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a}var d=this;null!=a&&(d.display.wrapper.style.width=c(a));null!=b&&(d.display.wrapper.style.height=c(b));d.options.lineWrapping&&
pe(this);var e=d.display.viewFrom;d.doc.iter(e,d.display.viewTo,function(a){if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(a.widgets[b].noHScroll){Xa(d,e,"widget");break}++e});d.curOp.forceUpdate=!0;ia(d,"refresh",this)}),operation:function(a){return va(this,a)},refresh:na(function(){var a=this.display.cachedTextHeight;qa(this);this.curOp.forceUpdate=!0;Wb(this);this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop);n(this);(null==a||.5<Math.abs(a-hb(this.display)))&&g(this);ia(this,"refresh",
this)}),swapDoc:na(function(a){var b=this.doc;b.cm=null;Td(this,a);Wb(this);this.display.input.reset();this.scrollTo(a.scrollLeft,a.scrollTop);this.curOp.forceScroll=!0;ta(this,"swapDoc",this,b);return b}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};Lb(d);var wf=d.defaults={},zb=d.optionHandlers={},Ud=d.Init=
{toString:function(){return"CodeMirror.Init"}};M("value","",function(a,b){a.setValue(b)},!0);M("mode",null,function(b,c){b.doc.modeOption=c;a(b)},!0);M("indentUnit",2,a,!0);M("indentWithTabs",!1);M("smartIndent",!0);M("tabSize",4,function(a){c(a);Wb(a);qa(a)},!0);M("lineSeparator",null,function(a,b){if(a.doc.lineSep=b){var c=[],d=a.doc.first;a.doc.iter(function(a){for(var e=0;;){var f=a.text.indexOf(b,e);if(-1==f)break;e=f+b.length;c.push(E(d,f))}d++});for(var e=c.length-1;0<=e;e--)Hb(a.doc,b,c[e],
E(c[e].line,c[e].ch+b.length))}});M("specialChars",/[\u0000-\u001f\u007f\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g,function(a,b,c){a.state.specialChars=new RegExp(b.source+(b.test("\t")?"":"|\t"),"g");c!=d.Init&&a.refresh()});M("specialCharPlaceholder",function(a){var b=H("span","\u2022","cm-invalidchar");b.title="\\u"+a.charCodeAt(0).toString(16);b.setAttribute("aria-label",b.title);return b},function(a){a.refresh()},!0);M("electricChars",!0);M("inputStyle",Rb?"contenteditable":"textarea",function(){throw Error("inputStyle can not (yet) be changed in a running editor");
},!0);M("rtlMoveVisually",!pg);M("wholeLineUpdateBefore",!0);M("theme","default",function(a){u(a);l(a)},!0);M("keyMap","default",function(a,b,c){b=Vc(b);(c=c!=d.Init&&Vc(c))&&c.detach&&c.detach(a,b);b.attach&&b.attach(a,c||null)});M("extraKeys",null);M("lineWrapping",!1,function(a){a.options.lineWrapping?(Zb(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth="",a.display.sizerWidth=null):(Xb(a.display.wrapper,"CodeMirror-wrap"),r(a));g(a);qa(a);Wb(a);setTimeout(function(){A(a)},100)},
!0);M("gutters",[],function(a){q(a.options);l(a)},!0);M("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?G(a.display)+"px":"0";a.refresh()},!0);M("coverGutterNextToScrollbar",!1,function(a){A(a)},!0);M("scrollbarStyle","native",function(a){y(a);A(a);a.display.scrollbars.setScrollTop(a.doc.scrollTop);a.display.scrollbars.setScrollLeft(a.doc.scrollLeft)},!0);M("lineNumbers",!1,function(a){q(a.options);l(a)},!0);M("firstLineNumber",1,l,!0);M("lineNumberFormatter",function(a){return a},l,
!0);M("showCursorWhenSelecting",!1,$b,!0);M("resetSelectionOnContextMenu",!0);M("lineWiseCopyCut",!0);M("readOnly",!1,function(a,b){"nocursor"==b?(Tb(a),a.display.input.blur(),a.display.disabled=!0):a.display.disabled=!1;a.display.input.readOnlyChanged(b)});M("disableInput",!1,function(a,b){b||a.display.input.reset()},!0);M("dragDrop",!0,function(a,b,c){!b!=!(c&&c!=d.Init)&&(c=a.display.dragFunctions,b=b?K:Sa,b(a.display.scroller,"dragstart",c.start),b(a.display.scroller,"dragenter",c.enter),b(a.display.scroller,
"dragover",c.over),b(a.display.scroller,"dragleave",c.leave),b(a.display.scroller,"drop",c.drop))});M("allowDropFileTypes",null);M("cursorBlinkRate",530);M("cursorScrollMargin",0);M("cursorHeight",1,$b,!0);M("singleCursorHeightPerLine",!0,$b,!0);M("workTime",100);M("workDelay",100);M("flattenSpans",!0,c,!0);M("addModeClass",!1,c,!0);M("pollInterval",100);M("undoDepth",200,function(a,b){a.doc.history.undoDepth=b});M("historyEventDelay",1250);M("viewportMargin",10,function(a){a.refresh()},!0);M("maxHighlightLength",
1E4,c,!0);M("moveInputWithCursor",!0,function(a,b){b||a.display.input.resetPosition()});M("tabindex",null,function(a,b){a.display.input.getField().tabIndex=b||""});M("autofocus",null);var tf=d.modes={},rc=d.mimeModes={};d.defineMode=function(a,b){d.defaults.mode||"null"==a||(d.defaults.mode=a);2<arguments.length&&(b.dependencies=Array.prototype.slice.call(arguments,2));tf[a]=b};d.defineMIME=function(a,b){rc[a]=b};d.resolveMode=function(a){if("string"==typeof a&&rc.hasOwnProperty(a))a=rc[a];else if(a&&
"string"==typeof a.name&&rc.hasOwnProperty(a.name)){var b=rc[a.name];"string"==typeof b&&(b={name:b});a=jf(b,a);a.name=b.name}else if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a))return d.resolveMode("application/xml");return"string"==typeof a?{name:a}:a||{name:"null"}};d.getMode=function(a,b){b=d.resolveMode(b);var c=tf[b.name];if(!c)return d.getMode(a,"text/plain");c=c(a,b);if(sc.hasOwnProperty(b.name)){var e=sc[b.name],f;for(f in e)e.hasOwnProperty(f)&&(c.hasOwnProperty(f)&&(c["_"+f]=
c[f]),c[f]=e[f])}c.name=b.name;b.helperType&&(c.helperType=b.helperType);if(b.modeProps)for(f in b.modeProps)c[f]=b.modeProps[f];return c};d.defineMode("null",function(){return{token:function(a){a.skipToEnd()}}});d.defineMIME("text/plain","null");var sc=d.modeExtensions={};d.extendMode=function(a,b){var c=sc.hasOwnProperty(a)?sc[a]:sc[a]={};Da(b,c)};d.defineExtension=function(a,b){d.prototype[a]=b};d.defineDocExtension=function(a,b){sa.prototype[a]=b};d.defineOption=M;var fd=[];d.defineInitHook=function(a){fd.push(a)};
var Nb=d.helpers={};d.registerHelper=function(a,b,c){Nb.hasOwnProperty(a)||(Nb[a]=d[a]={_global:[]});Nb[a][b]=c};d.registerGlobalHelper=function(a,b,c,e){d.registerHelper(a,b,e);Nb[a]._global.push({pred:c,val:e})};var cb=d.copyState=function(a,b){if(!0===b)return b;if(a.copyState)return a.copyState(b);var c={},d;for(d in b){var e=b[d];e instanceof Array&&(e=e.concat([]));c[d]=e}return c},Ef=d.startState=function(a,b,c){return a.startState?a.startState(b,c):!0};d.innerMode=function(a,b){for(;a.innerMode;){var c=
a.innerMode(b);if(!c||c.mode==a)break;b=c.state;a=c.mode}return c||{mode:a,state:b}};var Oc=d.commands={selectAll:function(a){a.setSelection(E(a.firstLine(),0),E(a.lastLine()),Qa)},singleSelection:function(a){a.setSelection(a.getCursor("anchor"),a.getCursor("head"),Qa)},killLine:function(a){Ib(a,function(b){if(b.empty()){var c=I(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?{from:b.head,to:E(b.head.line+1,0)}:{from:b.head,to:E(b.head.line,c)}}return{from:b.from(),to:b.to()}})},
deleteLine:function(a){Ib(a,function(b){return{from:E(b.from().line,0),to:O(a.doc,E(b.to().line+1,0))}})},delLineLeft:function(a){Ib(a,function(a){return{from:E(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){Ib(a,function(b){var c=a.charCoords(b.head,"div").top+5;return{from:a.coordsChar({left:0,top:c},"div"),to:b.from()}})},delWrappedLineRight:function(a){Ib(a,function(b){var c=a.charCoords(b.head,"div").top+5,c=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div");
return{from:b.from(),to:c}})},undo:function(a){a.undo()},redo:function(a){a.redo()},undoSelection:function(a){a.undoSelection()},redoSelection:function(a){a.redoSelection()},goDocStart:function(a){a.extendSelection(E(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(E(a.lastLine()))},goLineStart:function(a){a.extendSelectionsBy(function(b){return nf(a,b.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(a){a.extendSelectionsBy(function(b){return of(a,b.head)},{origin:"+move",
bias:1})},goLineEnd:function(a){a.extendSelectionsBy(function(b){b=b.head.line;for(var c,d=I(a.doc,b);c=kb(d,!1);)d=c.find(1,!0).line,b=null;c=(c=Ga(d))?c[0].level%2?Fc(d):Gc(d):d.text.length;return E(null==b?Z(d):b,c)},{origin:"+move",bias:-1})},goLineRight:function(a){a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:b},"div")},qc)},goLineLeft:function(a){a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+
5;return a.coordsChar({left:0,top:b},"div")},qc)},goLineLeftSmart:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5,c=a.coordsChar({left:0,top:c},"div");return c.ch<a.getLine(c.line).search(/\S/)?of(a,b.head):c},qc)},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,"char")},
goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,"word")},goGroupRight:function(a){a.moveH(1,"group")},goGroupLeft:function(a){a.moveH(-1,"group")},goWordRight:function(a){a.moveH(1,"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},delWordAfter:function(a){a.deleteH(1,"word")},delGroupBefore:function(a){a.deleteH(-1,"group")},
delGroupAfter:function(a){a.deleteH(1,"group")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("\t")},insertSoftTab:function(a){for(var b=[],c=a.listSelections(),d=a.options.tabSize,e=0;e<c.length;e++){var f=c[e].from(),f=Ia(a.getLine(f.line),f.ch,d);b.push(Gd(d-f%d))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):
a.execCommand("insertTab")},transposeChars:function(a){va(a,function(){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++){var e=b[d].head,f=I(a.doc,e.line).text;if(f)if(e.ch==f.length&&(e=new E(e.line,e.ch-1)),0<e.ch)e=new E(e.line,e.ch+1),a.replaceRange(f.charAt(e.ch-1)+f.charAt(e.ch-2),E(e.line,e.ch-2),e,"+transpose");else if(e.line>a.doc.first){var g=I(a.doc,e.line-1).text;g&&a.replaceRange(f.charAt(0)+a.doc.lineSeparator()+g.charAt(g.length-1),E(e.line-1,g.length-1),E(e.line,1),"+transpose")}c.push(new aa(e,
e))}a.setSelections(c)})},newlineAndIndent:function(a){va(a,function(){for(var b=a.listSelections().length,c=0;c<b;c++){var d=a.listSelections()[c];a.replaceRange(a.doc.lineSeparator(),d.anchor,d.head,"+input");a.indentLine(d.from().line+1,null,!0)}Db(a)})},openLine:function(a){a.replaceSelection("\n","start")},toggleOverwrite:function(a){a.toggleOverwrite()}},db=d.keyMap={};db.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",
PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"};db.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart",
"Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"};db.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft",
"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"};db.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight",
"Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic",
"emacsy"]};db["default"]=Fa?db.macDefault:db.pcDefault;d.normalizeKeyMap=function(a){var b={},c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!/^(name|fallthrough|(de|at)tach)$/.test(c)){if("..."!=d)for(var e=xc(c.split(" "),Zf),f=0;f<e.length;f++){var g,h;f==e.length-1?(h=e.join(" "),g=d):(h=e.slice(0,f+1).join(" "),g="...");var k=b[h];if(!k)b[h]=g;else if(k!=g)throw Error("Inconsistent bindings for "+h);}delete a[c]}}for(var l in b)a[l]=b[l];return a};var hc=d.lookupKey=function(a,b,c,d){b=Vc(b);
var e=b.call?b.call(a,d):b[a];if(!1===e)return"nothing";if("..."===e)return"multi";if(null!=e&&c(e))return"handled";if(b.fallthrough){if("[object Array]"!=Object.prototype.toString.call(b.fallthrough))return hc(a,b.fallthrough,c,d);for(e=0;e<b.fallthrough.length;e++){var f=hc(a,b.fallthrough[e],c,d);if(f)return f}}},Sf=d.isModifierKey=function(a){a="string"==typeof a?a:wb[a.keyCode];return"Ctrl"==a||"Alt"==a||"Shift"==a||"Mod"==a},Uf=d.keyName=function(a,b){if(Ja&&34==a.keyCode&&a["char"])return!1;
var c=wb[a.keyCode],d=c;if(null==d||a.altGraphKey)return!1;a.altKey&&"Alt"!=c&&(d="Alt-"+d);(sf?a.metaKey:a.ctrlKey)&&"Ctrl"!=c&&(d="Ctrl-"+d);(sf?a.ctrlKey:a.metaKey)&&"Cmd"!=c&&(d="Cmd-"+d);!b&&a.shiftKey&&"Shift"!=c&&(d="Shift-"+d);return d};d.fromTextArea=function(a,b){function c(){a.value=m.getValue()}b=b?Da(b):{};b.value=a.value;!b.tabindex&&a.tabIndex&&(b.tabindex=a.tabIndex);!b.placeholder&&a.placeholder&&(b.placeholder=a.placeholder);if(null==b.autofocus){var e=Oa();b.autofocus=e==a||null!=
a.getAttribute("autofocus")&&e==document.body}if(a.form&&(K(a.form,"submit",c),!b.leaveSubmitMethodAlone)){var f=a.form,g=f.submit;try{var h=f.submit=function(){c();f.submit=g;f.submit();f.submit=h}}catch(l){}}b.finishInit=function(b){b.save=c;b.getTextArea=function(){return a};b.toTextArea=function(){b.toTextArea=isNaN;c();a.parentNode.removeChild(b.getWrapperElement());a.style.display="";a.form&&(Sa(a.form,"submit",c),"function"==typeof a.form.submit&&(a.form.submit=g))}};a.style.display="none";
var m=d(function(b){a.parentNode.insertBefore(b,a.nextSibling)},b);return m};var Zc=d.StringStream=function(a,b){this.pos=this.start=0;this.string=a;this.tabSize=b||8;this.lineStart=this.lastColumnPos=this.lastColumnValue=0};Zc.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(a){var b=
this.string.charAt(this.pos);if("string"==typeof a?b==a:b&&(a.test?a.test(b):a(b)))return++this.pos,b},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){a=this.string.indexOf(a,this.pos);if(-1<a)return this.pos=a,!0},backUp:function(a){this.pos-=a},column:function(){this.lastColumnPos<this.start&&
(this.lastColumnValue=Ia(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start);return this.lastColumnValue-(this.lineStart?Ia(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return Ia(this.string,null,this.tabSize)-(this.lineStart?Ia(this.string,this.lineStart,this.tabSize):0)},match:function(a,b,c){if("string"==typeof a){var d=function(a){return c?a.toLowerCase():a},e=this.string.substr(this.pos,a.length);if(d(e)==d(a))return!1!==
b&&(this.pos+=a.length),!0}else{if((a=this.string.slice(this.pos).match(a))&&0<a.index)return null;a&&!1!==b&&(this.pos+=a[0].length);return a}},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}}};var Id=0,ub=d.TextMarker=function(a,b){this.lines=[];this.type=b;this.doc=a;this.id=++Id};Lb(ub);ub.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;b&&yb(a);if(Ba(this,
"clear")){var c=this.find();c&&ta(this,"clear",c.from,c.to)}for(var d=c=null,e=0;e<this.lines.length;++e){var f=this.lines[e],g=jc(f.markedSpans,this);a&&!this.collapsed?Xa(a,Z(f),"text"):a&&(null!=g.to&&(d=Z(f)),null!=g.from&&(c=Z(f)));for(var h=f,k=f.markedSpans,l=g,m=void 0,n=0;n<k.length;++n)k[n]!=l&&(m||(m=[])).push(k[n]);h.markedSpans=m;null==g.from&&this.collapsed&&!ib(this.doc,f)&&a&&La(f,hb(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(e=0;e<this.lines.length;++e)f=Ra(this.lines[e]),
g=p(f),g>a.display.maxLineLength&&(a.display.maxLine=f,a.display.maxLineLength=g,a.display.maxLineChanged=!0);null!=c&&a&&this.collapsed&&qa(a,c,d+1);this.lines.length=0;this.explicitlyCleared=!0;this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&he(a.doc));a&&ta(a,"markerCleared",a,this);b&&Ab(a);this.parent&&this.parent.clear()}};ub.prototype.find=function(a,b){null==a&&"bookmark"==this.type&&(a=1);for(var c,d,e=0;e<this.lines.length;++e){var f=this.lines[e],g=jc(f.markedSpans,this);if(null!=
g.from&&(c=E(b?f:Z(f),g.from),-1==a))return c;if(null!=g.to&&(d=E(b?f:Z(f),g.to),1==a))return d}return c&&{from:c,to:d}};ub.prototype.changed=function(){var a=this.find(-1,!0),b=this,c=this.doc.cm;a&&c&&va(c,function(){var d=a.line,e=Z(a.line);if(e=jd(c,e))oe(e),c.curOp.selectionChanged=c.curOp.forceUpdate=!0;c.curOp.updateMaxLine=!0;ib(b.doc,d)||null==b.height||(e=b.height,b.height=null,(e=fc(b)-e)&&La(d,d.height+e))})};ub.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=
this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=ma(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)};ub.prototype.detachLine=function(a){this.lines.splice(ma(this.lines,a),1);!this.lines.length&&this.doc.cm&&(a=this.doc.cm.curOp,(a.maybeHiddenMarkers||(a.maybeHiddenMarkers=[])).push(this))};var Id=0,Xc=d.SharedTextMarker=function(a,b){this.markers=a;this.primary=b;for(var c=0;c<a.length;++c)a[c].parent=this};Lb(Xc);Xc.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=
!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();ta(this,"clear")}};Xc.prototype.find=function(a,b){return this.primary.find(a,b)};var Yc=d.LineWidget=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.doc=a;this.node=b};Lb(Yc);Yc.prototype.clear=function(){var a=this.doc.cm,b=this.line.widgets,c=this.line,d=Z(c);if(null!=d&&b){for(var e=0;e<b.length;++e)b[e]==this&&b.splice(e--,1);b.length||(c.widgets=null);var f=fc(this);La(c,Math.max(0,c.height-f));a&&
va(a,function(){var b=-f;Na(c)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&Rc(a,null,b);Xa(a,d,"widget")})}};Yc.prototype.changed=function(){var a=this.height,b=this.doc.cm,c=this.line;this.height=null;var d=fc(this)-a;d&&(La(c,c.height+d),b&&va(b,function(){b.curOp.forceUpdate=!0;Na(c)<(b.curOp&&b.curOp.scrollTop||b.doc.scrollTop)&&Rc(b,null,d)}))};var kc=d.Line=function(a,b,c){this.text=a;We(this,b);this.height=c?c(this):1};Lb(kc);kc.prototype.lineNo=function(){return Z(this)};var eg={},dg={};
lc.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,d=a+b;c<d;++c){var e=this.lines[c];this.height-=e.height;var f=e;f.parent=null;Ve(f);ta(e,"delete")}this.lines.splice(a,b)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,b,c){this.height+=c;this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));for(a=0;a<b.length;++a)b[a].parent=this},iterN:function(a,b,c){for(b=a+b;a<b;++a)if(c(this.lines[a]))return!0}};mc.prototype=
{chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var d=this.children[c],e=d.chunkSize();if(a<e){var f=Math.min(b,e-a),g=d.height;d.removeInner(a,f);this.height-=g-d.height;e==f&&(this.children.splice(c--,1),d.parent=null);if(0==(b-=f))break;a=0}else a-=e}25>this.size-b&&(1<this.children.length||!(this.children[0]instanceof lc))&&(c=[],this.collapse(c),this.children=[new lc(c)],this.children[0].parent=this)},collapse:function(a){for(var b=
0;b<this.children.length;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length;this.height+=c;for(var d=0;d<this.children.length;++d){var e=this.children[d],f=e.chunkSize();if(a<=f){e.insertInner(a,b,c);if(e.lines&&50<e.lines.length){for(b=a=e.lines.length%25+25;b<e.lines.length;)c=new lc(e.lines.slice(b,b+=25)),e.height-=c.height,this.children.splice(++d,0,c),c.parent=this;e.lines=e.lines.slice(0,a);this.maybeSpill()}break}a-=f}},maybeSpill:function(){if(!(10>=this.children.length)){var a=
this;do{var b=a.children.splice(a.children.length-5,5),b=new mc(b);if(a.parent){a.size-=b.size;a.height-=b.height;var c=ma(a.parent.children,a);a.parent.children.splice(c+1,0,b)}else c=new mc(a.children),c.parent=a,a.children=[c,b],a=c;b.parent=a.parent}while(10<a.children.length);a.parent.maybeSpill()}},iterN:function(a,b,c){for(var d=0;d<this.children.length;++d){var e=this.children[d],f=e.chunkSize();if(a<f){f=Math.min(b,f-a);if(e.iterN(a,f,c))return!0;if(0==(b-=f))break;a=0}else a-=f}}};var rg=
0,sa=d.Doc=function(a,b,c,d){if(!(this instanceof sa))return new sa(a,b,c,d);null==c&&(c=0);mc.call(this,[new lc([new kc("",null)])]);this.first=c;this.scrollTop=this.scrollLeft=0;this.cantEdit=!1;this.cleanGeneration=1;this.frontier=c;c=E(c,0);this.sel=Pa(c);this.history=new $c(null);this.id=++rg;this.modeOption=b;this.lineSep=d;this.extend=!1;"string"==typeof a&&(a=this.splitLines(a));Fd(this,{from:c,to:c,text:a});la(this,Pa(c),Qa)};sa.prototype=jf(mc.prototype,{constructor:sa,iter:function(a,b,
c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,d=0;d<b.length;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=Nd(this,this.first,this.first+this.size);return!1===a?b:b.join(a||this.lineSeparator())},setValue:oa(function(a){var b=E(this.first,0),c=this.first+this.size-1;Cb(this,{from:b,to:E(c,I(this,c).text.length),text:this.splitLines(a),origin:"setValue",
full:!0},!0);la(this,Pa(b))}),replaceRange:function(a,b,c,d){b=O(this,b);c=c?O(this,c):b;Hb(this,a,b,c,d)},getRange:function(a,b,c){a=ob(this,O(this,a),O(this,b));return!1===c?a:a.join(c||this.lineSeparator())},getLine:function(a){return(a=this.getLineHandle(a))&&a.text},getLineHandle:function(a){if(bc(this,a))return I(this,a)},getLineNumber:function(a){return Z(a)},getLineHandleVisualStart:function(a){"number"==typeof a&&(a=I(this,a));return Ra(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},
lastLine:function(){return this.first+this.size-1},clipPos:function(a){return O(this,a)},getCursor:function(a){var b=this.sel.primary();return null==a||"head"==a?b.head:"anchor"==a?b.anchor:"end"==a||"to"==a||!1===a?b.to():b.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:oa(function(a,b,c){a=O(this,"number"==typeof a?E(a,b||0):a);la(this,Pa(a,null),c)}),setSelection:oa(function(a,b,c){var d=O(this,a);a=O(this,b||
a);la(this,Pa(d,a),c)}),extendSelection:oa(function(a,b,c){zc(this,O(this,a),b&&O(this,b),c)}),extendSelections:oa(function(a,b){be(this,ae(this,a),b)}),extendSelectionsBy:oa(function(a,b){var c=xc(this.sel.ranges,a);be(this,ae(this,c),b)}),setSelections:oa(function(a,b,c){if(a.length){for(var d=0,e=[];d<a.length;d++)e[d]=new aa(O(this,a[d].anchor),O(this,a[d].head));null==b&&(b=Math.min(a.length-1,this.sel.primIndex));la(this,Ha(e,b),c)}}),addSelection:oa(function(a,b,c){var d=this.sel.ranges.slice(0);
d.push(new aa(O(this,a),O(this,b||a)));la(this,Ha(d,d.length-1),c)}),getSelection:function(a){for(var b=this.sel.ranges,c,d=0;d<b.length;d++){var e=ob(this,b[d].from(),b[d].to());c=c?c.concat(e):e}return!1===a?c:c.join(a||this.lineSeparator())},getSelections:function(a){for(var b=[],c=this.sel.ranges,d=0;d<c.length;d++){var e=ob(this,c[d].from(),c[d].to());!1!==a&&(e=e.join(a||this.lineSeparator()));b[d]=e}return b},replaceSelection:function(a,b,c){for(var d=[],e=0;e<this.sel.ranges.length;e++)d[e]=
a;this.replaceSelections(d,b,c||"+input")},replaceSelections:oa(function(a,b,c){for(var d=[],e=this.sel,f=0;f<e.ranges.length;f++){var g=e.ranges[f];d[f]={from:g.from(),to:g.to(),text:this.splitLines(a[f]),origin:c}}if(f=b&&"end"!=b){f=[];c=a=E(this.first,0);for(e=0;e<d.length;e++){var h=d[e],g=He(h.from,a,c),k=He(sb(h),a,c);a=h.to;c=k;"around"==b?(h=this.sel.ranges[e],h=0>L(h.head,h.anchor),f[e]=new aa(h?k:g,h?g:k)):f[e]=new aa(g,g)}f=new Ua(f,this.sel.primIndex)}b=f;for(f=d.length-1;0<=f;f--)Cb(this,
d[f]);b?ce(this,b):this.cm&&Db(this.cm)}),undo:oa(function(){Qc(this,"undo")}),redo:oa(function(){Qc(this,"redo")}),undoSelection:oa(function(){Qc(this,"undo",!0)}),redoSelection:oa(function(){Qc(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,b=0,c=0,d=0;d<a.done.length;d++)a.done[d].ranges||++b;for(d=0;d<a.undone.length;d++)a.undone[d].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=
new $c(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null);return this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:Kb(this.history.done),undone:Kb(this.history.undone)}},setHistory:function(a){var b=this.history=new $c(this.history.maxGeneration);b.done=Kb(a.done.slice(0),
null,!0);b.undone=Kb(a.undone.slice(0),null,!0)},addLineClass:oa(function(a,b,c){return Tc(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass";if(a[d]){if(pc(c).test(a[d]))return!1;a[d]+=" "+c}else a[d]=c;return!0})}),removeLineClass:oa(function(a,b,c){return Tc(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass",e=a[d];if(e)if(null==
c)a[d]=null;else{var f=e.match(pc(c));if(!f)return!1;var g=f.index+f[0].length;a[d]=e.slice(0,f.index)+(f.index&&g!=e.length?" ":"")+e.slice(g)||null}else return!1;return!0})}),addLineWidget:oa(function(a,b,c){return cg(this,a,b,c)}),removeLineWidget:function(a){a.clear()},markText:function(a,b,c){return Jb(this,O(this,a),O(this,b),c,c&&c.type||"range")},setBookmark:function(a,b){var c={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared,handleMouseEvents:b&&
b.handleMouseEvents};a=O(this,a);return Jb(this,a,a,c,"bookmark")},findMarksAt:function(a){a=O(this,a);var b=[],c=I(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var e=c[d];(null==e.from||e.from<=a.ch)&&(null==e.to||e.to>=a.ch)&&b.push(e.marker.parent||e.marker)}return b},findMarks:function(a,b,c){a=O(this,a);b=O(this,b);var d=[],e=a.line;this.iter(a.line,b.line+1,function(f){if(f=f.markedSpans)for(var g=0;g<f.length;g++){var h=f[g];null!=h.to&&e==a.line&&a.ch>=h.to||null==h.from&&e!=
a.line||null!=h.from&&e==b.line&&h.from>=b.ch||c&&!c(h.marker)||d.push(h.marker.parent||h.marker)}++e});return d},getAllMarks:function(){var a=[];this.iter(function(b){if(b=b.markedSpans)for(var c=0;c<b.length;++c)null!=b[c].from&&a.push(b[c].marker)});return a},posFromIndex:function(a){var b,c=this.first,d=this.lineSeparator().length;this.iter(function(e){e=e.text.length+d;if(e>a)return b=a,!0;a-=e;++c});return O(this,E(c,b))},indexFromPos:function(a){a=O(this,a);var b=a.ch;if(a.line<this.first||
0>a.ch)return 0;var c=this.lineSeparator().length;this.iter(this.first,a.line,function(a){b+=a.text.length+c});return b},copy:function(a){var b=new sa(Nd(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep);b.scrollTop=this.scrollTop;b.scrollLeft=this.scrollLeft;b.sel=this.sel;b.extend=!1;a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory()));return b},linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&
(b=a.from);null!=a.to&&a.to<c&&(c=a.to);b=new sa(Nd(this,b,c),a.mode||this.modeOption,b,this.lineSep);a.sharedHist&&(b.history=this.history);(this.linked||(this.linked=[])).push({doc:b,sharedHist:a.sharedHist});b.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}];a=Te(this);for(c=0;c<a.length;c++){var d=a[c],e=d.find(),f=b.clipPos(e.from),e=b.clipPos(e.to);L(f,e)&&(f=Jb(b,f,e,d.primary,d.primary.type),d.markers.push(f),f.parent=d)}return b},unlinkDoc:function(a){a instanceof d&&(a=a.doc);if(this.linked)for(var b=
0;b<this.linked.length;++b)if(this.linked[b].doc==a){this.linked.splice(b,1);a.unlinkDoc(this);ag(Te(this));break}if(a.history==this.history){var c=[a.id];tb(a,function(a){c.push(a.id)},!0);a.history=new $c(null);a.history.done=Kb(this.history.done,c);a.history.undone=Kb(this.history.undone,c)}},iterLinkedDocs:function(a){tb(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(a){return this.lineSep?a.split(this.lineSep):sg(a)},lineSeparator:function(){return this.lineSep||
"\n"}});sa.prototype.eachLine=sa.prototype.iter;var tg="iter insert remove copy getEditor constructor".split(" "),tc;for(tc in sa.prototype)sa.prototype.hasOwnProperty(tc)&&0>ma(tg,tc)&&(d.prototype[tc]=function(a){return function(){return a.apply(this.doc,arguments)}}(sa.prototype[tc]));Lb(sa);var pa=d.e_preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},ug=d.e_stopPropagation=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},Jc=d.e_stop=function(a){pa(a);
ug(a)},K=d.on=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):(a=a._handlers||(a._handlers={}),(a[b]||(a[b]=[])).push(c))},hf=[],Sa=d.off=function(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else for(a=ad(a,b,!1),b=0;b<a.length;++b)if(a[b]==c){a.splice(b,1);break}},ia=d.signal=function(a,b){var c=ad(a,b,!0);if(c.length)for(var d=Array.prototype.slice.call(arguments,2),e=0;e<c.length;++e)c[e].apply(null,
d)},nc=null,Vd=30,De=d.Pass={toString:function(){return"CodeMirror.Pass"}},Qa={scroll:!1},zd={origin:"*mouse"},qc={origin:"+move"};gb.prototype.set=function(a,b){clearTimeout(this.id);this.id=setTimeout(b,a)};var Ia=d.countColumn=function(a,b,c,d,e){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));d=d||0;for(e=e||0;;){var f=a.indexOf("\t",d);if(0>f||f>=b)return e+(b-d);e+=f-d;e+=c-e%c;d=f+1}},Be=d.findColumn=function(a,b,c){for(var d=0,e=0;;){var f=a.indexOf("\t",d);-1==f&&(f=a.length);var g=
f-d;if(f==a.length||e+g>=b)return d+Math.min(g,b-e);e+=f-d;e+=c-e%c;d=f+1;if(e>=b)return d}},bd=[""],Mb=function(a){a.select()};Eb?Mb=function(a){a.selectionStart=0;a.selectionEnd=a.value.length}:U&&(Mb=function(a){try{a.select()}catch(b){}});var vg=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,kf=d.isWordChar=function(a){return/\w/.test(a)||"\u0080"<a&&(a.toUpperCase()!=a.toLowerCase()||vg.test(a))},lg=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,
pb;pb=document.createRange?function(a,b,c,d){var e=document.createRange();e.setEnd(d||a,c);e.setStart(a,b);return e}:function(a,b,c){var d=document.body.createTextRange();try{d.moveToElementText(a.parentNode)}catch(e){return d}d.collapse(!0);d.moveEnd("character",c);d.moveStart("character",b);return d};var kd=d.contains=function(a,b){3==b.nodeType&&(b=b.parentNode);if(a.contains)return a.contains(b);do if(11==b.nodeType&&(b=b.host),b==a)return!0;while(b=b.parentNode)};U&&11>da&&(Oa=function(){try{return document.activeElement}catch(a){return document.body}});
var Xb=d.rmClass=function(a,b){var c=a.className,d=pc(b).exec(c);if(d){var e=c.slice(d.index+d[0].length);a.className=c.slice(0,d.index)+(e?d[1]+e:"")}},Zb=d.addClass=function(a,b){var c=a.className;pc(b).test(c)||(a.className+=(c?" ":"")+b)},Sd=!1,Nf=function(){if(U&&9>da)return!1;var a=H("div");return"draggable"in a||"dragDrop"in a}(),Od,Ld,sg=d.splitLines=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;b<=d;){var e=a.indexOf("\n",b);-1==e&&(e=a.length);var f=a.slice(b,"\r"==
a.charAt(e-1)?e-1:e),g=f.indexOf("\r");-1!=g?(c.push(f.slice(0,g)),b+=g+1):(c.push(f),b=e+1)}return c}:function(a){return a.split(/\r\n?|\n/)},qg=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(b){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(c){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},Fe=function(){var a=H("div");if("oncopy"in a)return!0;a.setAttribute("oncopy","return;");return"function"==typeof a.oncopy}(),
rd=null,wb=d.keyNames={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",
63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};(function(){for(var a=0;10>a;a++)wb[a+48]=wb[a+96]=String(a);for(a=65;90>=a;a++)wb[a]=String.fromCharCode(a);for(a=1;12>=a;a++)wb[a+111]=wb[a+63235]="F"+a})();var gc,jg=function(){function a(b){return 247>=b?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(b):
1424<=b&&1524>=b?"R":1536<=b&&1773>=b?"rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm".charAt(b-1536):1774<=b&&2220>=b?"r":8192<=b&&8203>=b?"w":8204==b?"b":"L"}function b(a,c,d){this.level=a;this.from=c;this.to=d}var c=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,d=/[stwN]/,e=/[LRr]/,f=/[Lb1n]/,g=/[1n]/;return function(h){if(!c.test(h))return!1;
for(var k=h.length,l=[],m=0,n;m<k;++m)l.push(a(h.charCodeAt(m)));for(var m=0,p="L";m<k;++m)n=l[m],"m"==n?l[m]=p:p=n;m=0;for(p="L";m<k;++m)n=l[m],"1"==n&&"r"==p?l[m]="n":e.test(n)&&(p=n,"r"==n&&(l[m]="R"));m=1;for(p=l[0];m<k-1;++m)n=l[m],"+"==n&&"1"==p&&"1"==l[m+1]?l[m]="1":","!=n||p!=l[m+1]||"1"!=p&&"n"!=p||(l[m]=p),p=n;for(m=0;m<k;++m)if(n=l[m],","==n)l[m]="N";else if("%"==n){for(p=m+1;p<k&&"%"==l[p];++p);var q=m&&"!"==l[m-1]||p<k&&"1"==l[p]?"1":"N";for(n=m;n<p;++n)l[n]=q;m=p-1}m=0;for(p="L";m<k;++m)n=
l[m],"L"==p&&"1"==n?l[m]="L":e.test(n)&&(p=n);for(m=0;m<k;++m)if(d.test(l[m])){for(p=m+1;p<k&&d.test(l[p]);++p);n="L"==(p<k?l[p]:"L");q="L"==(m?l[m-1]:"L")||n?"L":"R";for(n=m;n<p;++n)l[n]=q;m=p-1}for(var p=[],t,m=0;m<k;)if(f.test(l[m])){n=m;for(++m;m<k&&f.test(l[m]);++m);p.push(new b(0,n,m))}else{var v=m,q=p.length;for(++m;m<k&&"L"!=l[m];++m);for(n=v;n<m;)if(g.test(l[n])){v<n&&p.splice(q,0,new b(1,v,n));v=n;for(++n;n<m&&g.test(l[n]);++n);p.splice(q,0,new b(2,v,n));v=n}else++n;v<m&&p.splice(q,0,new b(1,
v,m))}1==p[0].level&&(t=h.match(/^\s+/))&&(p[0].from=t[0].length,p.unshift(new b(0,0,t[0].length)));1==V(p).level&&(t=h.match(/\s+$/))&&(V(p).to-=t[0].length,p.push(new b(0,k-t[0].length,k)));2==p[0].level&&p.unshift(new b(1,p[0].to,p[0].to));p[0].level!=V(p).level&&p.push(new b(p[0].level,k,k));return p}}();d.version="5.15.2";return d})},function(g,d,e){function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==
typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(){return new u.TrackableValue(0>=arguments.length||void 0===arguments[0]?"void main() {\n  emitGrayscale(toNormalized(getDataValue()));\n}\n":arguments[0],l.verifyString)}
var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=function p(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d)return a=Object.getPrototypeOf(a),null===a?void 0:p(a,b,c);if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)},m=e(63),u=
e(64),l=e(11);d.FRAGMENT_MAIN_START="//NEUROGLANCER_IMAGE_RENDERLAYER_FRAGMENT_MAIN_START";var h=e(121);d.getTrackableFragmentMain=a;g=function(e){function g(b,c){var d=2>=arguments.length||void 0===arguments[2]?m.trackableAlphaValue(.5):arguments[2],e=3>=arguments.length||void 0===arguments[3]?a():arguments[3];if(!(this instanceof g))throw new TypeError("Cannot call a class as a function");var f=k(this,Object.getPrototypeOf(g).call(this,b,c));f.opacity=d;f.fragmentMain=e;f.registerSignalBinding(d.changed.add(function(){f.redrawNeeded.dispatch()}));
f.registerSignalBinding(e.changed.add(function(){f.shaderUpdated=!0;f.redrawNeeded.dispatch()}));return f}b(g,e);c(g,[{key:"getShaderKey",value:function(){return"sliceview.ImageRenderLayer:"+JSON.stringify(this.fragmentMain.value)}},{key:"defineShader",value:function(a){f(Object.getPrototypeOf(g.prototype),"defineShader",this).call(this,a);a.addUniform("highp float","uOpacity");a.addFragmentCode("\nvoid emitRGBA(vec4 rgba) {\n  emit(vec4(rgba.rgb, rgba.a * uOpacity));\n}\nvoid emitRGB(vec3 rgb) {\n  emit(vec4(rgb, uOpacity));\n}\nvoid emitGrayscale(float value) {\n  emit(vec4(value, value, value, uOpacity));\n}\nvoid emitTransparent() {\n  emit(vec4(0.0, 0.0, 0.0, 0.0));\n}\n");
a.addFragmentCode(h);a.setFragmentMainFunction(d.FRAGMENT_MAIN_START+"\n"+this.fragmentMain.value)}},{key:"beginSlice",value:function(a){a=f(Object.getPrototypeOf(g.prototype),"beginSlice",this).call(this,a);this.gl.uniform1f(a.uniform("uOpacity"),this.opacity.value);return a}}]);return g}(m.RenderLayer);d.ImageRenderLayer=g},function(g,d){g.exports='/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvec3 colormapJet(float x) {\n  vec3 result;\n  result.r = x < 0.89 ? ((x - 0.35) / 0.31) : (1.0 - (x - 0.89) / 0.11 * 0.5);\n  result.g = x < 0.64 ? ((x - 0.125) * 4.0) : (1.0 - (x - 0.64) / 0.27);\n  result.b = x < 0.34 ? (0.5 + x * 0.5 / 0.11) : (1.0 - (x - 0.34) / 0.31);\n  return clamp(result, 0.0, 1.0);\n}\n'},
function(g,d){},function(g,d){},function(g,d){},function(g,d){},function(g,d){},function(g,d){g.exports=function(d){function g(a){var b={};a=a.split(" ");for(var d=0;d<a.length;++d)b[a[d]]=!0;return b}d.defineMode("glsl",function(c,d){function e(a,b){var c=a.next();if(y[c]){var d=y[c](a,b);if(!1!==d)return d}if('"'==c||"'"==c)return b.tokenize=u(c),b.tokenize(a,b);if(/[\[\]{}\(\),;\:\.]/.test(c))return B=c,"bracket";if(/\d/.test(c))return a.eatWhile(/[\w\.]/),"number";if("/"==c){if(a.eat("*"))return b.tokenize=
l,l(a,b);if(a.eat("/"))return a.skipToEnd(),"comment"}if("#"==c)return a.eatWhile(/[\S]+/),a.eatWhile(/[\s]+/),a.eatWhile(/[\S]+/),a.eatWhile(/[\s]+/),"comment";if(t.test(c))return a.eatWhile(t),"operator";a.eatWhile(/[\w\$_]/);c=a.current();return q.propertyIsEnumerable(c)?(x.propertyIsEnumerable(c)&&(B="newstatement"),"keyword"):w.propertyIsEnumerable(c)?"builtin":v.propertyIsEnumerable(c)?"atom":"word"}function u(a){return function(b,c){for(var d=!1,f,g=!1;null!=(f=b.next());){if(f==a&&!d){g=!0;
break}d=!d&&"\\"==f}if(g||!d&&!A)c.tokenize=e;return"string"}}function l(a,b){for(var c=!1,d;d=a.next();){if("/"==d&&c){b.tokenize=e;break}c="*"==d}return"comment"}function h(a,b,c,d,e){this.indented=a;this.column=b;this.type=c;this.align=d;this.prev=e}function n(a,b,c){return a.context=new h(a.indented,b,c,null,a.context)}function p(a){var b=a.context.type;if(")"==b||"]"==b||"}"==b)a.indented=a.context.indented;return a.context=a.context.prev}var r=c.indentUnit,q=d.keywords||g(b),w=d.builtins||g(a),
x=d.blockKeywords||g("case do else for if switch while struct"),v=d.atoms||g("null"),y=d.hooks||{},A=d.multiLineStrings,t=/[+\-*&%=<>!?|\/]/,B;return{startState:function(a){return{tokenize:null,context:new h((a||0)-r,0,"top",!1),indented:0,startOfLine:!0}},token:function(a,b){var c=b.context;a.sol()&&(null==c.align&&(c.align=!1),b.indented=a.indentation(),b.startOfLine=!0);if(a.eatSpace())return null;B=null;var d=(b.tokenize||e)(a,b);if("comment"==d||"meta"==d)return d;null==c.align&&(c.align=!0);
if(";"!=B&&":"!=B||"statement"!=c.type)if("{"==B)n(b,a.column(),"}");else if("["==B)n(b,a.column(),"]");else if("("==B)n(b,a.column(),")");else if("}"==B){for(;"statement"==c.type;)c=p(b);for("}"==c.type&&(c=p(b));"statement"==c.type;)c=p(b)}else B==c.type?p(b):("}"==c.type||"top"==c.type||"statement"==c.type&&"newstatement"==B)&&n(b,a.column(),"statement");else p(b);b.startOfLine=!1;return d},indent:function(a,b){if(a.tokenize!=e&&null!=a.tokenize)return 0;var c=b&&b.charAt(0),d=a.context,f=c==d.type;
return"statement"==d.type?d.indented+("{"==c?0:r):d.align?d.column+(f?0:1):d.indented+(f?0:r)},electricChars:"{}"}});var b="attribute const uniform varying break continue do for while if else in out inout float int void bool true false lowp mediump highp precision invariant discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler2D samplerCube struct gl_FragCoord gl_FragColor",a="radians degrees sin cos tan asin acos atan pow exp log exp2 log2 sqrt inversesqrt abs sign floor ceil fract mod min max clamp mix step smoothstep length distance dot cross normalize faceforward reflect refract matrixCompMult lessThan lessThanEqual greaterThan greaterThanEqual equal notEqual any all not dFdx dFdy fwidth texture2D texture2DProj texture2DLod texture2DProjLod textureCube textureCubeLod require export";
d.defineMIME("text/x-glsl",{name:"glsl",keywords:g(b),builtins:g(a),blockKeywords:g("case do else for if switch while struct"),atoms:g("null"),hooks:{"#":function(a,b){if(!b.startOfLine)return!1;a.skipToEnd();return"meta"}}})}},function(g,d){var e=0;d.associateLabelWithElement=function(d,b){""===b.id&&(b.id="unique-id-for-association-"+e++);d.setAttribute("for",b.id)}},function(g,d,e){function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||
"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){var b=document.createElement("div");b.textContent=a.value;return b}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=
c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=e(39);g=e(8);var m=e(10),u=e(130),l=e(92),h=e(131),n=e(6),p=e(132),r=e(128),q=e(48);e(133);$jscomp.initSymbol();var w=Symbol("autocompleteIndex");d.makeDefaultCompletionElement=a;d.makeCompletionElementWithDescription=function(a){var b=document.createElement("div");b.className="autocomplete-completion-with-description";
b.textContent=a.value;var c=document.createElement("div");c.className="autocomplete-completion-description";c.textContent=a.description||"";b.appendChild(c);return b};var x=new l.KeySequenceMap({arrowdown:"cycle-next-active-completion",arrowup:"cycle-prev-active-completion",tab:"choose-active-completion-or-prefix",enter:"choose-active-completion"}),v=new Map([["cycle-next-active-completion",function(){this.cycleActiveCompletion(1);return!0}],["cycle-prev-active-completion",function(){this.cycleActiveCompletion(-1);
return!0}],["choose-active-completion-or-prefix",function(){return this.selectActiveCompletion(!0)}],["choose-active-completion",function(){return this.selectActiveCompletion(!1)}]]);e=function(d){function e(a){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var b=k(this,Object.getPrototypeOf(e).call(this));b.inputChanged=new q.Signal;b.prevInputValue="";b.completionsVisible=!1;b.activeCompletionPromise=null;b.hasFocus=!1;b.completionResult=null;b.dropdownContentsStale=
!0;b.updateHintScrollPositionTimer=null;b.completionElements=null;b.hasResultForDropdown=!1;b.commonPrefix="";b.activeIndex=-1;b.dropdownStyleStale=!0;b.completer=a.completer;a=a.delay;var c=b.scheduleUpdateCompletions=f(function(){var a=b.activeCompletionPromise=b.completer(b.value);null!==a&&a.then(function(c){b.activeCompletionPromise===a&&(b.setCompletions(c),b.activeCompletionPromise=null)})},void 0===a?200:a);b.registerDisposer(function(){c.cancel()});a=b.element=document.createElement("div");
a.className="autocomplete";var d=document.createElement("div");d.className="autocomplete-dropdown-wrapper";var g=b.dropdownElement=document.createElement("div");g.className="autocomplete-dropdown";var h=b.promptElement=document.createElement("label");h.className="autocomplete-prompt";var m=b.inputWrapperElement=document.createElement("div");m.className="autocomplete-input-wrapper";a.appendChild(h);var n=b.inputElement=document.createElement("input");n.type="text";n.autocomplete="off";n.spellcheck=
!1;n.className="autocomplete-input";r.associateLabelWithElement(h,n);h=b.hintElement=document.createElement("input");h.type="text";h.spellcheck=!1;h.className="autocomplete-hint";h.disabled=!0;m.appendChild(h);m.appendChild(n);d.appendChild(m);d.appendChild(g);a.appendChild(d);b.registerInputHandler();b.handleInputChanged("");b.registerEventListener(b.inputElement,"focus",function(){b.hasFocus||(b.hasFocus=!0,b.dropdownStyleStale=!0,b.updateDropdown())});b.registerEventListener(b.inputElement,"blur",
function(){b.hasFocus&&(b.hasFocus=!1,b.updateDropdown())});b.registerEventListener(a.ownerDocument.defaultView,"resize",function(){b.dropdownStyleStale=!0});b.registerEventListener(a.ownerDocument.defaultView,"scroll",function(){b.dropdownStyleStale=!0});b.registerEventListener(b.dropdownElement,"mousedown",b.handleDropdownMousedown.bind(b));b.registerEventListener(b.inputElement,"keydown",function(){b.hintScrollPositionMayBeStale()});b.registerEventListener(b.inputElement,"mousemove",function(a){0!==
a.buttons&&b.hintScrollPositionMayBeStale()});(b.keyboardHandler=b.registerDisposer(new l.KeyboardShortcutHandler(n,x,b.handleKeyCommand.bind(b)))).allShortcutsAreGlobal=!0;return b}b(e,d);c(e,[{key:"hintScrollPositionMayBeStale",value:function(){""!==this.hintElement.value&&this.scheduleUpdateHintScrollPosition()}},{key:"handleDropdownMousedown",value:function(a){this.inputElement.focus();for(var b=this.dropdownElement,c=a.target;c instanceof HTMLElement;c=c.parentElement){var d=c[w];if(void 0!==
d){this.selectCompletion(d);break}if(c===b)break}a.preventDefault()}},{key:"cycleActiveCompletion",value:function(a){if(null!==this.completionResult){var b=this.activeIndex,c=this.completionResult.completions.length;this.setActiveIndex(-1===b?0<a?0:c-1:(b+a+c)%c)}}},{key:"handleKeyCommand",value:function(a){return v.get(a).call(this)}},{key:"registerInputHandler",value:function(){for(var a=this,b=function(b){b=a.inputElement.value;b!==a.prevInputValue&&(a.prevInputValue=b,a.handleInputChanged(b))},
c=$jscomp.makeIterator(["input"]),d=c.next();!d.done;d=c.next())this.registerEventListener(this.inputElement,d.value,b,!1)}},{key:"shouldShowDropdown",value:function(){return null!==this.completionResult&&this.hasFocus?this.hasResultForDropdown:!1}},{key:"updateDropdownStyle",value:function(){u.positionDropdown(this.dropdownElement,this.inputElement,{horizontal:!1});this.dropdownStyleStale=!1}},{key:"updateDropdown",value:function(){var b=this;this.shouldShowDropdown()?function(){var c=b.dropdownElement,
d=b.activeIndex;b.dropdownContentsStale&&function(){var e=b.completionResult,f=e.makeElement,g=void 0===f?a:f;b.completionElements=e.completions.map(function(a,b){var f=g.call(e,a);f[w]=b;f.classList.add("autocomplete-completion");d===b&&f.classList.add("autocomplete-completion-active");c.appendChild(f);return f});b.dropdownContentsStale=!1}();b.dropdownStyleStale&&b.updateDropdownStyle();b.completionsVisible||(c.style.display="block",b.completionsVisible=!0);-1!==d&&p.scrollIntoViewIfNeeded(b.completionElements[d])}():
this.completionsVisible&&(this.dropdownElement.style.display="none",this.completionsVisible=!1)}},{key:"setCompletions",value:function(a){this.clearCompletions();var b=a.completions;0!==b.length&&(this.completionResult=a,1===b.length?(b=b[0],a.showSingleResult?this.hasResultForDropdown=!0:b.value.startsWith(this.prevInputValue)?this.hasResultForDropdown=!1:this.hasResultForDropdown=!0,this.setActiveIndex(0)):(this.hasResultForDropdown=!0,b=h.longestCommonPrefix(function(){function b(g,h){for(;;)switch(c){case 0:f=
$jscomp.makeIterator(a.completions),e=f.next();case 1:if(e.done){c=3;break}d=e.value;c=4;return{value:d.value,done:!1};case 4:if(void 0===h){c=5;break}c=-1;throw h;case 5:case 2:e=f.next();c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,g={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}()),b=this.getCompletedValue(b),
b.startsWith(this.prevInputValue)&&(this.commonPrefix=b,this.setHintValue(b))),this.updateDropdown())}},{key:"scheduleUpdateHintScrollPosition",value:function(){if(null===this.updateHintScrollPositionTimer){var a=this;this.updateHintScrollPositionTimer=setTimeout(function(){a.updateHintScrollPosition()},0)}}},{key:"setHintValue",value:function(a){var b=this.prevInputValue;a!==b&&a.startsWith(b)||(a="");this.hintElement.value=a;this.scheduleUpdateHintScrollPosition()}},{key:"setActiveIndex",value:function(a){if(!this.dropdownContentsStale){var b=
this.activeIndex;-1!==b&&this.completionElements[b].classList.remove("autocomplete-completion-active");-1!==a&&(b=this.completionElements[a],b.classList.add("autocomplete-completion-active"),p.scrollIntoViewIfNeeded(b))}-1!==a&&this.setHintValue(this.getCompletedValueByIndex(a));this.activeIndex=a}},{key:"getCompletedValueByIndex",value:function(a){return this.getCompletedValue(this.completionResult.completions[a].value)}},{key:"getCompletedValue",value:function(a){return this.prevInputValue.substring(0,
this.completionResult.offset)+a}},{key:"selectActiveCompletion",value:function(a){var b=this.activeIndex;if(-1===b){if(!a)return!1;a=this.commonPrefix;return a.length>this.value.length?(this.value=a,!0):!1}a=this.getCompletedValueByIndex(b);if(this.value===a)return!1;this.value=a;return!0}},{key:"selectCompletion",value:function(a){this.value=this.getCompletedValueByIndex(a)}},{key:"updateHintScrollPosition",value:function(){this.updateHintScrollPositionTimer=null;this.hintElement.scrollLeft=this.inputElement.scrollLeft}},
{key:"cancelActiveCompletion",value:function(){n.cancelPromise(this.activeCompletionPromise);this.activeCompletionPromise=null}},{key:"handleInputChanged",value:function(a){this.cancelActiveCompletion();this.hintElement.value="";this.clearCompletions();this.inputChanged.dispatch(a);this.scheduleUpdateCompletions()}},{key:"clearCompletions",value:function(){null!==this.completionResult&&(this.activeIndex=-1,this.completionElements=this.completionResult=null,this.dropdownStyleStale=this.dropdownContentsStale=
!0,this.commonPrefix="",m.removeChildren(this.dropdownElement),this.updateDropdown())}},{key:"disposed",value:function(){m.removeFromParent(this.element);this.cancelActiveCompletion();null!==this.updateHintScrollPositionTimer&&(clearTimeout(this.updateHintScrollPositionTimer),this.updateHintScrollPositionTimer=null)}},{key:"disabled",get:function(){return this.inputElement.disabled},set:function(a){this.inputElement.disabled=a}},{key:"value",get:function(){return this.prevInputValue},set:function(a){a!==
this.prevInputValue&&(this.prevInputValue=this.inputElement.value=a,this.handleInputChanged(a))}}]);return e}(g.RefCounted);d.AutocompleteTextInput=e},function(g,d){d.positionDropdown=function(d,g){var b=2>=arguments.length||void 0===arguments[2]?{}:arguments[2],a=b.horizontal,c=void 0===a?!1:a,a=b.vertical,a=void 0===a?!0:a,f=b.topMargin,f=void 0===f?6:f,m=b.bottomMargin,m=void 0===m?6:m,u=b.leftMargin,u=void 0===u?6:u,l=b.rightMargin,h=void 0===l?6:l,l=b.maxHeight,l=void 0===l?!0:l,b=b.maxWidth,
n=void 0===b?!0:b,b=g.getBoundingClientRect();if(c){var c=b.right,p=d.ownerDocument.documentElement.clientHeight-b.left;c>p?(d.style.left="",d.style.right="0",n&&(d.style.maxWidth=c-u+"px")):(d.style.right="",d.style.left="0",n&&(d.style.maxWidth=p-h+"px"))}a&&(a=b.top-f,c=d.ownerDocument.documentElement.clientHeight-b.bottom-m,a>3*c?(d.style.top="",d.style.bottom="100%",l&&(d.style.maxHeight=a+"px")):(d.style.top="100%",d.style.bottom="",l&&(d.style.maxHeight=c+"px")))}},function(g,d){d.longestCommonPrefix=
function(d){$jscomp.initSymbol();$jscomp.initSymbolIterator();d=d[Symbol.iterator]();var g=d.next(),b=g.value;if(g.done)return"";for(g=b.length;0<g;){var a=d.next(),c=a.value;if(a.done)break;for(a=0;a<g&&b.charCodeAt(a)===c.charCodeAt(a);++a);g=a}return b.substring(0,g)}},function(g,d){d.scrollIntoViewIfNeeded=function(d){var g=d.parentElement,b=d.offsetLeft-g.clientLeft,a=d.offsetTop-g.clientTop,c=g.scrollLeft,f=g.scrollTop,a=Math.max(0,a+d.offsetHeight-(f+g.clientHeight))||Math.min(0,a-f);g.scrollLeft+=
Math.max(0,b+d.offsetWidth-(c+g.clientWidth))||Math.min(0,b-c);g.scrollTop+=a}},function(g,d){},function(g,d){d.makeHiddenSubmitButton=function(){var d=document.createElement("button");d.type="submit";d.className="hidden-submit-button";d.style.margin="0";d.style.border="0";d.style.padding="0";d.style.width="0";d.style.height="0";d.style.overflow="hidden";d.tabIndex=-1;return d}},function(g,d){},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function(){return function(a,
b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();$jscomp.initSymbolIterator();for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done)&&(c.push(h.value),!b||c.length!==b);d=!0);}catch(k){e=!0,f=k}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),f=function(){function a(b,c){for(var d=
0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),m=e(95),u=e(96);g=e(8);var l=e(10),h=e(130),n=e(137);e(70);e(139);var p=function(c){function d(a,c){k(this,d);var e=b(this,Object.getPrototypeOf(d).call(this));e.layer=a;e.panel=c;var f=e.element=document.createElement("span");f.className="layer-item-parent noselect";var g=e.widgetElement=document.createElement("span");
g.className="layer-item noselect";f.appendChild(g);var h=e.labelElement=document.createElement("span");h.className="layer-item-label";var l=e.layerNumberElement=document.createElement("span");l.className="layer-item-number";var n=e.valueElement=document.createElement("span");n.className="layer-item-value";var p=document.createElement("span");p.title="Delete layer";p.className="layer-item-close";e.registerEventListener(p,"click",function(a){e.panel.layerManager.removeManagedLayer(e.layer)});g.appendChild(l);
g.appendChild(h);g.appendChild(n);g.appendChild(p);e.registerEventListener(g,"click",function(b){a.setVisible(!a.visible)});e.registerEventListener(f,"mousedown",function(a){0===a.button&&e.panel.setDragging(!0)});e.registerEventListener(f,"mouseup",function(a){0===a.button&&e.panel.setDragging(!1)});e.registerEventListener(g,"dblclick",function(b){a instanceof u.ManagedUserLayerWithSpecification&&new m.LayerDialog(e.panel.manager,a)});g=e.dropdownElement=document.createElement("div");e.registerEventListener(g,
"mousedown",function(a){a.stopPropagation()});e.setupDropdownElement();e.handleLayerChanged();e.registerSignalBinding(a.layerChanged.add(e.handleLayerChanged,e));f.appendChild(g);e.registerEventListener(f,"mouseenter",function(){e.hovering=!0;e.updateDropdownState()});e.registerEventListener(f,"mouseleave",function(a){e.hovering=!1;e.updateDropdownState()});return e}a(d,c);f(d,[{key:"updateDropdownState",value:function(){var a=this.dropdownElement.style;if(this.hovering&&!this.panel.dragging&&0<this.dropdownElement.childElementCount){if("flex"!==
a.display&&(a.display="flex",this.dropdown))this.dropdown.onShow();h.positionDropdown(this.dropdownElement,this.widgetElement)}else if("none"!==a.display&&(this.dropdownElement.style.display="none",this.dropdown))this.dropdown.onHide()}},{key:"setupDropdownElement",value:function(){this.dropdownElement.className="layer-dropdown"}},{key:"update",value:function(){var a=this.layer;this.labelElement.textContent=a.name;this.widgetElement.setAttribute("layer-visible",a.visible.toString())}},{key:"handleLayerChanged",
value:function(){var a=this.layer.layer;a!==this.userLayer&&(this.dropdown&&(this.dropdown.dispose(),l.removeChildren(this.dropdownElement),this.setupDropdownElement()),this.dropdown=(this.userLayer=a)?a.makeDropdown(this.dropdownElement):void 0)}},{key:"disposed",value:function(){this.dropdown&&this.dropdown.dispose();this.element.parentElement.removeChild(this.element)}}]);return d}(g.RefCounted);e=function(d){function e(a,c){k(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.element=
a;d.manager=c;d.layerWidgets=new Map;d.layerUpdateNeeded=!0;d.valueUpdateNeeded=!1;d.dragging=!1;a.className="layer-panel";d.registerSignalBinding(c.layerSelectedValues.changed.add(d.handleLayerValuesChanged,d));d.registerSignalBinding(c.layerManager.layersChanged.add(d.handleLayersChanged,d));var f=d.addButton=document.createElement("button");f.className="layer-add-button";f.title="Add layer";d.registerEventListener(f,"click",function(){d.addLayerMenu()});a.appendChild(f);d.update();var g=new n.Sortable(d.element,
{draggable:".layer-item-parent",onStart:function(a){d.setDragging(!0);d.element.classList.add("sorting-in-progress")},onEnd:function(a){d.setDragging(!1);d.element.classList.remove("sorting-in-progress");d.layerManager.reorderManagedLayer(a.oldIndex,a.newIndex)},onMove:function(a){return a.related!==d.addButton}});d.registerDisposer(function(){g.destroy()});return d}a(e,d);f(e,[{key:"setDragging",value:function(a){this.dragging=a;a=$jscomp.makeIterator(this.layerWidgets.values());for(var b=a.next();!b.done;b=
a.next())b.value.updateDropdownState()}},{key:"dispose",value:function(){this.layerWidgets.forEach(function(a){return a.dispose()});this.layerWidgets=null}},{key:"handleLayersChanged",value:function(){this.layerUpdateNeeded=!0;this.handleLayerValuesChanged()}},{key:"handleLayerValuesChanged",value:function(){this.valueUpdateNeeded||(this.valueUpdateNeeded=!0,requestAnimationFrame(this.update.bind(this)))}},{key:"update",value:function(){this.valueUpdateNeeded=!1;this.updateLayers();for(var a=this.manager.layerSelectedValues,
b=$jscomp.makeIterator(this.layerWidgets),d=b.next();!d.done;d=b.next()){var e=c(d.value,2),d=e[1],e=a.get(e[0].layer),f="";void 0!==e&&(f=""+e);d.valueElement.textContent=f}}},{key:"updateLayers",value:function(){var a=this;if(this.layerUpdateNeeded){this.layerUpdateNeeded=!1;var b=this.element,d=new Set,e=b.firstElementChild;this.manager.layerManager.managedLayers.forEach(function(c,f){d.add(c);var g=a.layerWidgets.get(c);void 0===g&&(g=new p(c,a),a.layerWidgets.set(c,g));g.layerNumberElement.textContent=
""+(1+f);g.update();g.element!==e&&b.insertBefore(g.element,a.addButton)});for(var f=$jscomp.makeIterator(this.layerWidgets),g=f.next();!g.done;g=f.next()){var h=c(g.value,2),g=h[0],h=h[1];d.has(g)||(this.layerWidgets.delete(g),h.dispose())}}}},{key:"addLayerMenu",value:function(){new m.LayerDialog(this.manager)}},{key:"layerManager",get:function(){return this.manager.layerManager}}]);return e}(g.RefCounted);d.LayerPanel=e},function(g,d,e){d.Sortable=e(138)},function(g,d,e){var k,b;(function(a){!(k=
a,b="function"===typeof k?k.call(d,e,d,g):k,void 0!==b&&(g.exports=b))})(function(){function a(a,b){if(!a||!a.nodeType||1!==a.nodeType)throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(a);this.el=a;this.options=b=A({},b);a[za]=this;var c={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(a.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",ignore:"a, img",filter:null,animation:0,
setData:function(a,b){a.setData("Text",b.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1},d;for(d in c)d in b||(b[d]=c[d]);Qb(b);for(var f in this)"_"===f.charAt(0)&&(this[f]=this[f].bind(this));this.nativeDraggable=b.forceFallback?!1:Pb;e(a,"mousedown",this._onTapStart);e(a,"touchstart",this._onTapStart);this.nativeDraggable&&(e(a,"dragover",this),e(a,"dragenter",this));Ka.push(this._onDragOver);b.store&&
this.sort(b.store.get(this))}function b(a){z&&z.state!==a&&(h(z,"display",a?"none":""),!a&&z.state&&C.insertBefore(z,t),z.state=a)}function d(a,b,c){if(a){c=c||ca;b=b.split(".");var e=b.shift().toUpperCase(),f=new RegExp("\\s("+b.join("|")+")(?=\\s)","g");do if(">*"===e&&a.parentNode===c||!(""!==e&&a.nodeName.toUpperCase()!=e||b.length&&((" "+a.className+" ").match(f)||[]).length!=b.length))return a;while(a!==c&&(a=a.parentNode))}return null}function e(a,b,c){a.addEventListener(b,c,!1)}function g(a,
b,c){a.removeEventListener(b,c,!1)}function k(a,b,c){if(a)if(a.classList)a.classList[c?"add":"remove"](b);else{var d=(" "+a.className+" ").replace(Ta," ").replace(" "+b+" "," ");a.className=(d+(c?" "+b:"")).replace(Ta," ")}}function h(a,b,c){var d=a&&a.style;if(d){if(void 0===c)return ca.defaultView&&ca.defaultView.getComputedStyle?c=ca.defaultView.getComputedStyle(a,""):a.currentStyle&&(c=a.currentStyle),void 0===b?c:c[b];b in d||(b="-webkit-"+b);d[b]=c+("string"===typeof c?"":"px")}}function n(a,
b,c){if(a){a=a.getElementsByTagName(b);b=0;var d=a.length;if(c)for(;b<d;b++)c(a[b],b);return a}return[]}function p(a,b,c,d,e,f,g){var h=ca.createEvent("Event"),k=(a||b[za]).options,l="on"+c.charAt(0).toUpperCase()+c.substr(1);h.initEvent(c,!0,!0);h.to=b;h.from=e||b;h.item=d||b;h.clone=z;h.oldIndex=f;h.newIndex=g;b.dispatchEvent(h);k[l]&&k[l].call(a,h)}function r(a,b,c,d,e,f){var g,h=a[za],k=h.options.onMove,l;g=ca.createEvent("Event");g.initEvent("move",!0,!0);g.to=b;g.from=a;g.dragged=c;g.draggedRect=
d;g.related=e||b;g.relatedRect=f||b.getBoundingClientRect();a.dispatchEvent(g);k&&(l=k.call(h,g));return l}function q(a){a.draggable=!1}function w(){Za=!1}function x(a){a=a.tagName+a.className+a.src+a.href+a.textContent;for(var b=a.length,c=0;b--;)c+=a.charCodeAt(b);return c.toString(36)}function v(a){var b=0;if(!a||!a.parentNode)return-1;for(;a&&(a=a.previousElementSibling);)"TEMPLATE"!==a.nodeName.toUpperCase()&&b++;return b}function y(a,b){var c,d;return function(){void 0===c&&(c=arguments,d=this,
setTimeout(function(){1===c.length?a.call(d,c[0]):a.apply(d,c);c=void 0},b))}}function A(a,b){if(a&&b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}var t,B,D,z,C,G,F,J,Q,P,W,R,S,X,N={},Y,ba,ya,Ta=/\s+/g,za="Sortable"+(new Date).getTime(),Ca=window,ca=Ca.document,Ob=Ca.parseInt,Pb=!!("draggable"in ca.createElement("div")),eb=function(a){a=ca.createElement("x");a.style.cssText="pointer-events:auto";return"auto"===a.style.pointerEvents}(),Za=!1,fb=Math.abs,Ka=[],uc=y(function(a,b,c){if(c&&
b.scroll){var d,e=b.scrollSensitivity,f=b.scrollSpeed,g=a.clientX;a=a.clientY;var h=window.innerWidth,k=window.innerHeight,l,m;if(J!==c&&(F=b.scroll,J=c,!0===F)){F=c;do if(F.offsetWidth<F.scrollWidth||F.offsetHeight<F.scrollHeight)break;while(F=F.parentNode)}F&&(d=F,b=F.getBoundingClientRect(),l=(fb(b.right-g)<=e)-(fb(b.left-g)<=e),m=(fb(b.bottom-a)<=e)-(fb(b.top-a)<=e));l||m||(l=(h-g<=e)-(g<=e),m=(k-a<=e)-(a<=e),(l||m)&&(d=Ca));if(N.vx!==l||N.vy!==m||N.el!==d)N.el=d,N.vx=l,N.vy=m,clearInterval(N.pid),
d&&(N.pid=setInterval(function(){d===Ca?Ca.scrollTo(Ca.pageXOffset+l*f,Ca.pageYOffset+m*f):(m&&(d.scrollTop+=m*f),l&&(d.scrollLeft+=l*f))},24))}},30),Qb=function(a){var b=a.group;b&&"object"==typeof b||(b=a.group={name:b});["pull","put"].forEach(function(a){a in b||(b[a]=!0)});a.groups=" "+b.name+(b.put.join?" "+b.put.join(" "):"")+" "};a.prototype={constructor:a,_onTapStart:function(a){var b=this,c=this.el,e=this.options,g=a.touches&&a.touches[0],h=(g||a).target,k=h,l=e.filter;if(!("mousedown"===
a.type&&0!==a.button||e.disabled)&&(h=d(h,e.draggable,c))){R=v(h);if("function"===typeof l){if(l.call(this,a,h,this)){p(b,k,"filter",h,c,R);a.preventDefault();return}}else if(l&&(l=l.split(",").some(function(a){if(a=d(k,a.trim(),c))return p(b,a,"filter",h,c,R),!0}))){a.preventDefault();return}e.handle&&!d(k,e.handle,c)||this._prepareDragStart(a,g,h)}},_prepareDragStart:function(a,b,c){var d=this,f=d.el,g=d.options,h=f.ownerDocument;c&&!t&&c.parentNode===f&&(Y=a,C=f,t=c,B=t.parentNode,G=t.nextSibling,
X=g.group,a=function(){d._disableDelayedDrag();t.draggable=!0;k(t,d.options.chosenClass,!0);d._triggerDragStart(b)},g.ignore.split(",").forEach(function(a){n(t,a.trim(),q)}),e(h,"mouseup",d._onDrop),e(h,"touchend",d._onDrop),e(h,"touchcancel",d._onDrop),g.delay?(e(h,"mouseup",d._disableDelayedDrag),e(h,"touchend",d._disableDelayedDrag),e(h,"touchcancel",d._disableDelayedDrag),e(h,"mousemove",d._disableDelayedDrag),e(h,"touchmove",d._disableDelayedDrag),d._dragStartTimer=setTimeout(a,g.delay)):a())},
_disableDelayedDrag:function(){var a=this.el.ownerDocument;clearTimeout(this._dragStartTimer);g(a,"mouseup",this._disableDelayedDrag);g(a,"touchend",this._disableDelayedDrag);g(a,"touchcancel",this._disableDelayedDrag);g(a,"mousemove",this._disableDelayedDrag);g(a,"touchmove",this._disableDelayedDrag)},_triggerDragStart:function(a){a?(Y={target:t,clientX:a.clientX,clientY:a.clientY},this._onDragStart(Y,"touch")):this.nativeDraggable?(e(t,"dragend",this),e(C,"dragstart",this._onDragStart)):this._onDragStart(Y,
!0);try{ca.selection?ca.selection.empty():window.getSelection().removeAllRanges()}catch(b){}},_dragStarted:function(){C&&t&&(k(t,this.options.ghostClass,!0),a.active=this,p(this,C,"start",t,C,R))},_emulateDragOver:function(){if(ba&&(this._lastX!==ba.clientX||this._lastY!==ba.clientY)){this._lastX=ba.clientX;this._lastY=ba.clientY;eb||h(D,"display","none");var a=ca.elementFromPoint(ba.clientX,ba.clientY),b=a,c=" "+this.options.group.name+"",d=Ka.length;if(b){do{if(b[za]&&-1<b[za].options.groups.indexOf(c)){for(;d--;)Ka[d]({clientX:ba.clientX,
clientY:ba.clientY,target:a,rootEl:b});break}a=b}while(b=b.parentNode)}eb||h(D,"display","")}},_onTouchMove:function(b){if(Y){a.active||this._dragStarted();this._appendGhost();var c=b.touches?b.touches[0]:b,d=c.clientX-Y.clientX,e=c.clientY-Y.clientY,d=b.touches?"translate3d("+d+"px,"+e+"px,0)":"translate("+d+"px,"+e+"px)";ya=!0;ba=c;h(D,"webkitTransform",d);h(D,"mozTransform",d);h(D,"msTransform",d);h(D,"transform",d);b.preventDefault()}},_appendGhost:function(){if(!D){var a=t.getBoundingClientRect(),
b=h(t),c=this.options;D=t.cloneNode(!0);k(D,c.ghostClass,!1);k(D,c.fallbackClass,!0);h(D,"top",a.top-Ob(b.marginTop,10));h(D,"left",a.left-Ob(b.marginLeft,10));h(D,"width",a.width);h(D,"height",a.height);h(D,"opacity","0.8");h(D,"position","fixed");h(D,"zIndex","100000");h(D,"pointerEvents","none");c.fallbackOnBody&&ca.body.appendChild(D)||C.appendChild(D);b=D.getBoundingClientRect();h(D,"width",2*a.width-b.width);h(D,"height",2*a.height-b.height)}},_onDragStart:function(a,b){var c=a.dataTransfer,
d=this.options;this._offUpEvents();"clone"==X.pull&&(z=t.cloneNode(!0),h(z,"display","none"),C.insertBefore(z,t));b?("touch"===b?(e(ca,"touchmove",this._onTouchMove),e(ca,"touchend",this._onDrop),e(ca,"touchcancel",this._onDrop)):(e(ca,"mousemove",this._onTouchMove),e(ca,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,50)):(c&&(c.effectAllowed="move",d.setData&&d.setData.call(this,c,t)),e(ca,"drop",this),setTimeout(this._dragStarted,0))},_onDragOver:function(a){var e=this.el,
g,k,l;k=this.options;g=k.group;var m=g.put,n=X===g,p=k.sort;void 0!==a.preventDefault&&(a.preventDefault(),!k.dragoverBubble&&a.stopPropagation());ya=!0;if(X&&!k.disabled&&(n?p||(l=!C.contains(t)):X.pull&&m&&(X.name===g.name||m.indexOf&&~m.indexOf(X.name)))&&(void 0===a.rootEl||a.rootEl===this.el)&&(uc(a,k,this.el),!Za))if(g=d(a.target,k.draggable,e),k=t.getBoundingClientRect(),l)b(!0),z||G?C.insertBefore(t,z||G):p||C.appendChild(t);else if(!(l=0===e.children.length||e.children[0]===D)&&(l=e===a.target)&&
(g=e.lastElementChild,l=g.getBoundingClientRect(),l=g=(5<a.clientY-(l.top+l.height)||5<a.clientX-(l.right+l.width))&&g),l){if(g){if(g.animated)return;q=g.getBoundingClientRect()}b(n);!1!==r(C,e,t,k,g,q)&&(t.contains(e)||(e.appendChild(t),B=e),this._animate(k,t),g&&this._animate(q,g))}else if(g&&!g.animated&&g!==t&&void 0!==g.parentNode[za]){Q!==g&&(Q=g,P=h(g),W=h(g.parentNode));var q=g.getBoundingClientRect(),v=q.right-q.left,y=q.bottom-q.top,p=/left|right|inline/.test(P.cssFloat+P.display)||"flex"==
W.display&&0===W["flex-direction"].indexOf("row");l=g.offsetWidth>t.offsetWidth;m=g.offsetHeight>t.offsetHeight;v=.5<(p?(a.clientX-q.left)/v:(a.clientY-q.top)/y);a=g.nextElementSibling;y=r(C,e,t,k,g,q);!1!==y&&(Za=!0,setTimeout(w,30),b(n),1===y||-1===y?n=1===y:p?(n=t.offsetTop,p=g.offsetTop,n=n===p?g.previousElementSibling===t&&!l||v&&l:p>n):n=a!==t&&!m||v&&m,t.contains(e)||(n&&!a?e.appendChild(t):g.parentNode.insertBefore(t,n?a:g)),B=t.parentNode,this._animate(k,t),this._animate(q,g))}},_animate:function(a,
b){var c=this.options.animation;if(c){var d=b.getBoundingClientRect();h(b,"transition","none");h(b,"transform","translate3d("+(a.left-d.left)+"px,"+(a.top-d.top)+"px,0)");b.offsetWidth;h(b,"transition","all "+c+"ms");h(b,"transform","translate3d(0,0,0)");clearTimeout(b.animated);b.animated=setTimeout(function(){h(b,"transition","");h(b,"transform","");b.animated=!1},c)}},_offUpEvents:function(){var a=this.el.ownerDocument;g(ca,"touchmove",this._onTouchMove);g(a,"mouseup",this._onDrop);g(a,"touchend",
this._onDrop);g(a,"touchcancel",this._onDrop)},_onDrop:function(b){var c=this.el,d=this.options;clearInterval(this._loopId);clearInterval(N.pid);clearTimeout(this._dragStartTimer);g(ca,"mousemove",this._onTouchMove);this.nativeDraggable&&(g(ca,"drop",this),g(c,"dragstart",this._onDragStart));this._offUpEvents();if(b){ya&&(b.preventDefault(),!d.dropBubble&&b.stopPropagation());D&&D.parentNode.removeChild(D);if(t&&(this.nativeDraggable&&g(t,"dragend",this),q(t),k(t,this.options.ghostClass,!1),k(t,this.options.chosenClass,
!1),C!==B?(S=v(t),0<=S&&(p(null,B,"sort",t,C,R,S),p(this,C,"sort",t,C,R,S),p(null,B,"add",t,C,R,S),p(this,C,"remove",t,C,R,S))):(z&&z.parentNode.removeChild(z),t.nextSibling!==G&&(S=v(t),0<=S&&(p(this,C,"update",t,C,R,S),p(this,C,"sort",t,C,R,S)))),a.active)){if(null===S||-1===S)S=R;p(this,C,"end",t,C,R,S);this.save()}C=t=B=D=G=z=F=J=Y=ba=ya=S=Q=P=X=a.active=null}},handleEvent:function(a){var b=a.type;"dragover"===b||"dragenter"===b?t&&(this._onDragOver(a),a.dataTransfer&&(a.dataTransfer.dropEffect=
"move"),a.preventDefault()):"drop"!==b&&"dragend"!==b||this._onDrop(a)},toArray:function(){for(var a=[],b,c=this.el.children,e=0,g=c.length,h=this.options;e<g;e++)b=c[e],d(b,h.draggable,this.el)&&a.push(b.getAttribute(h.dataIdAttr)||x(b));return a},sort:function(a){var b={},c=this.el;this.toArray().forEach(function(a,e){var g=c.children[e];d(g,this.options.draggable,c)&&(b[a]=g)},this);a.forEach(function(a){b[a]&&(c.removeChild(b[a]),c.appendChild(b[a]))})},save:function(){var a=this.options.store;
a&&a.set(this)},closest:function(a,b){return d(a,b||this.options.draggable,this.el)},option:function(a,b){var c=this.options;if(void 0===b)return c[a];c[a]=b;"group"===a&&Qb(c)},destroy:function(){var a=this.el;a[za]=null;g(a,"mousedown",this._onTapStart);g(a,"touchstart",this._onTapStart);this.nativeDraggable&&(g(a,"dragover",this),g(a,"dragenter",this));Array.prototype.forEach.call(a.querySelectorAll("[draggable]"),function(a){a.removeAttribute("draggable")});Ka.splice(Ka.indexOf(this._onDragOver),
1);this._onDrop();this.el=a=null}};a.utils={on:e,off:g,css:h,find:n,is:function(a,b){return!!d(a,b,a)},extend:A,throttle:y,closest:d,toggleClass:k,index:v};a.create=function(b,c){return new a(b,c)};a.version="1.4.2";return a})},function(g,d){},function(g,d){d.withFlex=function(d,g){return function(b){b.style.flex=d;g(b)}};d.withStyle=function(d,g){return function(b){Object.assign(b.style,d);g(b)}};d.withAttributes=function(d,g){return function(b){Object.assign(b,d);g(b)}};d.box=function(d,g){return function(b){b.style.display=
"flex";b.style.flexDirection=d;for(var a=$jscomp.makeIterator(g),c=a.next();!c.done;c=a.next()){var c=c.value,f=b.ownerDocument.createElement("div");b.appendChild(f);c(f)}}}},function(g,d,e){function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function a(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(8);var f=e(22),m=e(11),u=e(48),l=function(d){function e(a){k(this,
e);var c=b(this,Object.getPrototypeOf(e).call(this));c.changed=new u.Signal;var d=!0;null==a&&(a=f.vec3.create(),d=!1);c.size=a;c.valid=d;return c}a(e,d);c(e,[{key:"reset",value:function(){this.valid=!1;this.changed.dispatch()}},{key:"setValid",value:function(){this.valid||(this.valid=!0,this.changed.dispatch())}},{key:"toJSON",value:function(){return this.valid?Array.prototype.slice.call(this.size):void 0}},{key:"restoreState",value:function(a){try{m.parseFiniteVec(this.size,a),this.setValid()}catch(b){this.valid=
!1}}},{key:"toString",value:function(){return this.valid?this.size.toString():null}},{key:"voxelFromSpatial",value:function(a,b){f.vec3.divide(a,b,this.size)}},{key:"spatialFromVoxel",value:function(a,b){f.vec3.multiply(a,b,this.size)}}]);return e}(g.RefCounted);d.VoxelSize=l;var h=f.vec3.create(),n=f.quat.create(),p=function(d){function e(a,c){k(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.voxelCoordinates=null;d.changed=new u.Signal;null==a&&(a=new l);d.voxelSize=a;var g=!0;null==
c&&(c=f.vec3.create(),g=!1);d.spatialCoordinates=c;d.spatialCoordinatesValid=g;d.registerDisposer(a);d.registerSignalBinding(a.changed.add(d.handleVoxelSizeChanged,d));return d}a(e,d);c(e,[{key:"reset",value:function(){this.spatialCoordinatesValid=!1;this.voxelCoordinates=null;this.changed.dispatch()}},{key:"getVoxelCoordinates",value:function(a){var b=this.voxelCoordinates;if(b)f.vec3.copy(a,b);else if(this.valid)this.voxelSize.voxelFromSpatial(a,this.spatialCoordinates);else return!1;return!0}},
{key:"setVoxelCoordinates",value:function(a){var b=this.voxelSize;b.valid?(b.spatialFromVoxel(this.spatialCoordinates,a),this.markSpatialCoordinatesChanged()):(b=this.voxelCoordinates)?f.vec3.copy(b,a):this.voxelCoordinates=f.vec3.clone(a);this.changed.dispatch()}},{key:"markSpatialCoordinatesChanged",value:function(){this.spatialCoordinatesValid=!0;this.voxelCoordinates=null;this.changed.dispatch()}},{key:"handleVoxelSizeChanged",value:function(){null==this.voxelCoordinates||this.spatialCoordinatesValid||
(this.voxelSize.spatialFromVoxel(this.spatialCoordinates,this.voxelCoordinates),this.spatialCoordinatesValid=!0);this.voxelCoordinates=null;this.changed.dispatch()}},{key:"toJSON",value:function(){var a=!0,b=this.voxelSize.toJSON(),c={};void 0!==b&&(a=!1,c.voxelSize=b);this.voxelCoordinatesValid?(this.getVoxelCoordinates(h),c.voxelCoordinates=Array.prototype.slice.call(h),a=!1):this.spatialCoordinatesValid&&(c.spatialCoordinates=Array.prototype.slice.call(this.spatialCoordinates),a=!1);return a?void 0:
c}},{key:"restoreState",value:function(a){this.voxelSize.restoreState(a.voxelSize);this.spatialCoordinatesValid=!1;if(a.hasOwnProperty("voxelCoordinates"))try{var b=f.vec3.create();m.parseFiniteVec(b,a.voxelCoordinates);this.setVoxelCoordinates(b)}catch(c){}if(a.hasOwnProperty("spatialCoordinates"))try{m.parseFiniteVec(this.spatialCoordinates,a.spatialCoordinates),this.markSpatialCoordinatesChanged()}catch(c){}}},{key:"snapToVoxel",value:function(){if(this.valid){for(var a=this.spatialCoordinates,
b=this.voxelSize.size,c=0;3>c;++c){var d=b[c];a[c]=Math.round(a[c]/d)*d}this.changed.dispatch()}else if(a=this.voxelCoordinates,null!=a){for(b=0;3>b;++b)a[b]=Math.round(a[b]);this.changed.dispatch()}}},{key:"valid",get:function(){return this.spatialCoordinatesValid&&this.voxelSize.valid}},{key:"voxelCoordinatesValid",get:function(){return this.valid||null!=this.voxelCoordinates}}]);return e}(g.RefCounted);d.SpatialPosition=p;var r=function(d){function e(a){k(this,e);var c=b(this,Object.getPrototypeOf(e).call(this));
c.changed=new u.Signal;null==a&&(a=f.quat.create());c.orientation=a;return c}a(e,d);c(e,[{key:"toJSON",value:function(){var a=this.orientation;return 0===a[0]&&0===a[1]&&0===a[2]&&1===a[3]?void 0:Array.prototype.slice.call(this.orientation)}},{key:"restoreState",value:function(a){try{m.parseFiniteVec(this.orientation,a),f.quat.normalize(this.orientation,this.orientation)}catch(b){f.quat.identity(this.orientation)}this.changed.dispatch()}},{key:"reset",value:function(){f.quat.identity(this.orientation);
this.changed.dispatch()}},{key:"snap",value:function(){var a=f.mat3.create();f.mat3.fromQuat(a,this.orientation);for(var b=[!1,!1,!1],c=0;3>c;++c){for(var d=0,e=0,g=0;3>g;++g){var h=a[3*c+g];a[3*c+g]=0;!b[g]&&Math.abs(h)>Math.abs(d)&&(d=h,e=g)}a[3*c+e]=Math.sign(d);b[e]=!0}f.quat.fromMat3(this.orientation,a);this.changed.dispatch()}}],[{key:"makeRelative",value:function(a,b){var c=new e(f.quat.multiply(f.quat.create(),a.orientation,b)),d=!1;c.registerSignalBinding(a.changed.add(function(){d||(g=!0,
f.quat.multiply(c.orientation,a.orientation,b),c.changed.dispatch(),g=!1)}));var g=!1,h=f.quat.invert(f.quat.create(),b);c.registerSignalBinding(c.changed.add(function(){g||(d=!0,f.quat.multiply(a.orientation,c.orientation,h),a.changed.dispatch(),d=!1)}));return c}}]);return e}(g.RefCounted);d.OrientationState=r;var q=function(d){function e(a,c){k(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.changed=new u.Signal;null==a&&(a=new p);d.position=a;null==c&&(c=new r);d.orientation=c;d.registerDisposer(d.position);
d.registerDisposer(d.orientation);d.registerSignalBinding(d.position.changed.add(d.changed.dispatch,d.changed));d.registerSignalBinding(d.orientation.changed.add(d.changed.dispatch,d.changed));return d}a(e,d);c(e,[{key:"reset",value:function(){this.position.reset();this.orientation.reset()}},{key:"dispose",value:function(){this.position.changed.remove(this.changed.dispatch,this.changed)}},{key:"toMat4",value:function(a){f.mat4.fromRotationTranslation(a,this.orientation.orientation,this.position.spatialCoordinates)}},
{key:"toJSON",value:function(){var a=this.position.toJSON(),b=this.orientation.toJSON();return void 0===a&&void 0===b?void 0:{position:a,orientation:b}}},{key:"restoreState",value:function(a){this.position.restoreState(a.position);this.orientation.restoreState(a.orientation)}},{key:"snap",value:function(){this.orientation.snap();this.position.snapToVoxel();this.changed.dispatch()}},{key:"translateAbsolute",value:function(a){f.vec3.add(this.position.spatialCoordinates,this.position.spatialCoordinates,
a);this.position.changed.dispatch()}},{key:"translateRelative",value:function(a){if(this.valid){var b=f.vec3.create();f.vec3.transformQuat(b,a,this.orientation.orientation);f.vec3.add(this.position.spatialCoordinates,this.position.spatialCoordinates,b);this.position.changed.dispatch()}}},{key:"translateVoxelsRelative",value:function(a){if(this.valid){var b=f.vec3.create();f.vec3.transformQuat(b,a,this.orientation.orientation);f.vec3.multiply(b,b,this.position.voxelSize.size);f.vec3.add(this.position.spatialCoordinates,
this.position.spatialCoordinates,b);this.position.changed.dispatch()}}},{key:"rotateRelative",value:function(a,b){var c=f.quat.create();f.quat.setAxisAngle(c,a,b);var d=this.orientation.orientation;f.quat.multiply(d,d,c);this.orientation.changed.dispatch()}},{key:"rotateAbsolute",value:function(a,b,c){var d=f.quat.create();f.quat.setAxisAngle(d,a,b);a=this.orientation.orientation;if(void 0!==c){b=this.position.spatialCoordinates;var e=f.vec3.subtract(h,c,b),g=f.quat.invert(n,a);f.vec3.transformQuat(e,
e,g);f.quat.multiply(a,d,a);f.vec3.transformQuat(b,e,a);f.vec3.subtract(b,c,b);this.position.changed.dispatch()}else f.quat.multiply(a,d,a);this.orientation.changed.dispatch()}},{key:"valid",get:function(){return this.position.valid}}]);return e}(g.RefCounted);d.Pose=q;var w=function(){function a(){var b=0>=arguments.length||void 0===arguments[0]?Number.NaN:arguments[0],c=1>=arguments.length||void 0===arguments[1]?b:arguments[1];k(this,a);this.value_=b;this.defaultValue=c;this.changed=new u.Signal}
c(a,[{key:"toJSON",value:function(){var a=this.value_,b=this.defaultValue;return Number.isNaN(a)&&Number.isNaN(b)||a===b?void 0:a}},{key:"restoreState",value:function(a){"number"===typeof a&&Number.isFinite(a)&&0<a?this.value=a:this.value=this.defaultValue}},{key:"reset",value:function(){this.value=this.defaultValue}},{key:"zoomBy",value:function(a){var b=this.value_;Number.isNaN(b)||(this.value=b*a)}},{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,
this.changed.dispatch())}}]);return a}();d.TrackableZoomState=w;e=function(d){function e(){var a=0>=arguments.length||void 0===arguments[0]?new q:arguments[0],c=1>=arguments.length||void 0===arguments[1]?Number.NaN:arguments[1];k(this,e);var d=b(this,Object.getPrototypeOf(e).call(this));d.pose=a;d.changed=new u.Signal;d.zoomFactor="number"===typeof c?new w(c):c;d.registerDisposer(a);d.registerSignalBinding(d.pose.changed.add(function(){d.changed.dispatch()}));d.registerSignalBinding(d.zoomFactor.changed.add(function(){d.changed.dispatch()}));
d.registerSignalBinding(d.voxelSize.changed.add(function(){d.handleVoxelSizeChanged()}));d.handleVoxelSizeChanged();return d}a(e,d);c(e,[{key:"reset",value:function(){this.pose.reset();this.zoomFactor.reset()}},{key:"setZoomFactorFromVoxelSize",value:function(){this.voxelSize.valid&&(this.zoomFactor.value=Math.min.apply(null,this.voxelSize.size))}},{key:"handleVoxelSizeChanged",value:function(){Number.isNaN(this.zoomFactor.value)&&this.setZoomFactorFromVoxelSize()}},{key:"toMat4",value:function(a){this.pose.toMat4(a);
var b=this.zoomFactor.value;f.mat4.scale(a,a,f.vec3.fromValues(b,b,b))}},{key:"toJSON",value:function(){var a=this.pose.toJSON(),b=this.zoomFactor.toJSON();return void 0===a&&void 0===b?void 0:{pose:a,zoomFactor:b}}},{key:"restoreState",value:function(a){a&&"object"===typeof a&&(this.pose.restoreState(a.pose),this.zoomFactor.restoreState(a.zoomFactor),this.handleVoxelSizeChanged(),this.changed.dispatch())}},{key:"zoomBy",value:function(a){this.zoomFactor.zoomBy(a)}},{key:"voxelSize",get:function(){return this.pose.position.voxelSize}},
{key:"position",get:function(){return this.pose.position}},{key:"valid",get:function(){return this.pose.valid}}]);return e}(g.RefCounted);d.NavigationState=e},function(g,d,e){function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function b(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&
b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();g=e(8);var c=e(22);e(143);e=function(d){function e(a,b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");
var d=k(this,Object.getPrototypeOf(e).call(this));d.element=a;d.viewer=b;d.positionElements=[];d.needsUpdate=null;d.tempPosition=c.vec3.create();a.setAttribute("class","position-status-panel");for(var f=d.positionElements,g=function(b){var e=a.ownerDocument.createElement("label");e.className="position-status-coord";var g=a.ownerDocument.createElement("input");g.type="number";g.className="position-status-coord";e.textContent=c.AXES_NAMES[b];e.appendChild(g);a.appendChild(e);f.push(g);var k=!1;d.registerEventListener(g,
"change",function(a){d.handleCoordinateChange()});d.registerEventListener(g,"input",function(a){k&&(d.handleCoordinateChange(),k=!1);return!0});d.registerEventListener(g,"wheel",function(a){k=!0;g.focus();return!0});d.registerEventListener(g,"keydown",function(a){k=!1;return!0});d.registerEventListener(g,"mousedown",function(a){return k=!0});d.registerEventListener(g,"click",function(a){return!0});d.registerEventListener(g,"blur",function(a){k=!1;return!0})},r=0;3>r;++r)g(r);g=d.mouseElement=document.createElement("span");
g.className="position-status-mouse";a.appendChild(g);g=b.mouseState;d.registerSignalBinding(b.navigationState.pose.changed.add(d.handleChange,d));d.registerSignalBinding(g.changed.add(d.handleChange,d));d.handleChange();return d}b(e,d);a(e,[{key:"handleChange",value:function(){null==this.needsUpdate&&(this.needsUpdate=requestAnimationFrame(this.update.bind(this)))}},{key:"handleCoordinateChange",value:function(){var a=this.positionElements,b=this.viewer.navigationState.pose.position,c=this.tempPosition;
if(b.voxelCoordinatesValid){b.getVoxelCoordinates(c);for(var d=0;3>d;++d){var e=parseFloat(a[d].value);Number.isNaN(e)||(c[d]=e)}b.setVoxelCoordinates(c)}}},{key:"update",value:function(){this.needsUpdate=null;var a=this.viewer,b=a.mouseState,c=this.tempPosition,a=a.navigationState.pose.position;if(a.getVoxelCoordinates(c))for(var d=this.positionElements,e=0;3>e;++e)d[e].value=""+Math.floor(c[e]);a=a.voxelSize;d="";b.active&&(a.voxelFromSpatial(c,b.position),d="x "+Math.round(c[0])+"  y "+Math.round(c[1])+
"  z "+Math.round(c[2]));this.mouseElement.textContent=d}},{key:"disposed",value:function(){for(var a=$jscomp.makeIterator(this.positionElements),b=a.next();!b.done;b=a.next())this.element.removeChild(b.value);this.element=this.positionElements=null}}]);return e}(g.RefCounted);d.PositionStatusPanel=e},function(g,d){},function(g,d,e){function k(){try{var a=location.href.replace(/^[^#]+/,"");if(""===a||"#"===a||"#!"===a)a="#!{}";if(a.startsWith("#!")){if(a=a.slice(2),a=decodeURI(a),a!==p){p=a;var b=
f.urlSafeParse(a);if("object"===typeof b){l=b;for(var c=$jscomp.makeIterator(Object.keys(l)),d=c.next();!d.done;d=c.next()){var e=d.value,g=m.get(e);if(void 0!==g){a=e;b=g;try{h=b,b.restoreState(l[a])}catch(k){console.log("Failed to restore "+a+" state: "+k)}finally{h=null}}}}}}else p=null}catch(k){console.log(k)}}function b(){null!=r&&clearTimeout(r);r=setTimeout(a,500)}function a(){r=null;for(var a=!1,b=$jscomp.makeIterator(n),c=b.next();!c.done;c=b.next()){var c=c.value,d=u.get(c);void 0===d?l.hasOwnProperty(d)&&
(a=!0):(a=!0,l[d]=c.toJSON())}n.clear();a&&(a=f.urlSafeStringify(l),a!==p&&(p=a,"{}"===p?history.replaceState(null,null,"#"):history.replaceState(null,null,"#!"+p)))}function c(){h!==this&&(n.add(this),b())}var f=e(11),m=new Map,u=new Map,l={},h=null,n=new Set,p=null,r=null;d.delayHashUpdate=function(){null!=r&&b()};addEventListener("hashchange",k);d.registerTrackable=function(a,b){if(m.has(a))throw Error("Key "+JSON.stringify(a)+" already registered.");if(u.has(b))throw Error("Object already registered.");
m.set(a,b);u.set(b,a);l.hasOwnProperty(a)&&b.restoreState(l[a]);b.changed.add(c,b);c.call(b)};d.unregisterTrackable=function(a){var b=m.get(a),d=void 0;if(void 0!==b)d=a;else{d=u.get(a);if(void 0===d)throw Error("Key or object not registered.");b=a}m.delete(d);u.delete(b);b.changed.remove(c,b);c.call(b)};k()},function(g,d){},function(g,d){d.makeDefaultKeyBindings=function(d){d.bind("arrowleft","x-");d.bind("arrowright","x+");d.bind("arrowup","y-");d.bind("arrowdown","y+");d.bind("comma","z-");d.bind("period",
"z+");d.bind("keyz","snap");d.bind("control+equal","zoom-in");d.bind("control+shift+equal","zoom-in");d.bind("control+minus","zoom-out");d.bind("keyr","rotate-relative-z-");d.bind("keye","rotate-relative-z+");d.bind("shift+arrowdown","rotate-relative-x-");d.bind("shift+arrowup","rotate-relative-x+");d.bind("shift+arrowleft","rotate-relative-y-");d.bind("shift+arrowright","rotate-relative-y+");d.bind("keyl","recolor");d.bind("keyx","clear-segments");d.bind("keys","toggle-show-slices");d.bind("keyb",
"toggle-scale-bar");d.bind("keya","toggle-axis-lines");for(var g=1;9>=g;++g)d.bind("digit"+g,"toggle-layer-"+g);d.bind("keyn","add-layer");d.bind("keyh","help");d.bind("space","toggle-layout")}}]);
